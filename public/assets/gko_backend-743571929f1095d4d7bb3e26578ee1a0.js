!function(e,t){var i=function(){var t=e(document).data("events");return t&&t.click&&e.grep(t.click,function(e){return"rails"===e.namespace}).length};i()&&e.error("jquery-ujs has already been loaded!");var n;e.rails=n={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote], a[data-disable-with]",inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type])",disableSelector:"input[data-disable-with], button[data-disable-with], textarea[data-disable-with]",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled",requiredInputSelector:"input[name][required]:not([disabled]),textarea[name][required]:not([disabled])",fileInputSelector:"input:file",linkDisableSelector:"a[data-disable-with]",CSRFProtection:function(t){var i=e('meta[name="csrf-token"]').attr("content");i&&t.setRequestHeader("X-CSRF-Token",i)},fire:function(t,i,n){var r=e.Event(i);return t.trigger(r,n),r.result!==!1},confirm:function(e){return confirm(e)},ajax:function(t){return e.ajax(t)},href:function(e){return e.attr("href")},handleRemote:function(i){var r,o,s,a,l,c,d,h;if(n.fire(i,"ajax:before")){if(a=i.data("cross-domain"),l=a===t?null:a,c=i.data("with-credentials")||null,d=i.data("type")||e.ajaxSettings&&e.ajaxSettings.dataType,i.is("form")){r=i.attr("method"),o=i.attr("action"),s=i.serializeArray();var u=i.data("ujs:submit-button");u&&(s.push(u),i.data("ujs:submit-button",null))}else i.is(n.inputChangeSelector)?(r=i.data("method"),o=i.data("url"),s=i.serialize(),i.data("params")&&(s=s+"&"+i.data("params"))):(r=i.data("method"),o=n.href(i),s=i.data("params")||null);h={type:r||"GET",data:s,dataType:d,beforeSend:function(e,r){return r.dataType===t&&e.setRequestHeader("accept","*/*;q=0.5, "+r.accepts.script),n.fire(i,"ajax:beforeSend",[e,r])},success:function(e,t,n){i.trigger("ajax:success",[e,t,n])},complete:function(e,t){i.trigger("ajax:complete",[e,t])},error:function(e,t,n){i.trigger("ajax:error",[e,t,n])},xhrFields:{withCredentials:c},crossDomain:l},o&&(h.url=o);var f=n.ajax(h);return i.trigger("ajax:send",f),f}return!1},handleMethod:function(i){var r=n.href(i),o=i.data("method"),s=i.attr("target"),a=e("meta[name=csrf-token]").attr("content"),l=e("meta[name=csrf-param]").attr("content"),c=e('<form method="post" action="'+r+'"></form>'),d='<input name="_method" value="'+o+'" type="hidden" />';l!==t&&a!==t&&(d+='<input name="'+l+'" value="'+a+'" type="hidden" />'),s&&c.attr("target",s),c.hide().append(d).appendTo("body"),c.submit()},disableFormElements:function(t){t.find(n.disableSelector).each(function(){var t=e(this),i=t.is("button")?"html":"val";t.data("ujs:enable-with",t[i]()),t[i](t.data("disable-with")),t.prop("disabled",!0)})},enableFormElements:function(t){t.find(n.enableSelector).each(function(){var t=e(this),i=t.is("button")?"html":"val";t.data("ujs:enable-with")&&t[i](t.data("ujs:enable-with")),t.prop("disabled",!1)})},allowAction:function(e){var t,i=e.data("confirm"),r=!1;return i?(n.fire(e,"confirm")&&(r=n.confirm(i),t=n.fire(e,"confirm:complete",[r])),r&&t):!0},blankInputs:function(t,i,n){var r,o,s=e(),a=i||"input,textarea";return t.find(a).each(function(){r=e(this),o=r.is(":checkbox,:radio")?r.is(":checked"):r.val(),o==!!n&&(s=s.add(r))}),s.length?s:!1},nonBlankInputs:function(e,t){return n.blankInputs(e,t,!0)},stopEverything:function(t){return e(t.target).trigger("ujs:everythingStopped"),t.stopImmediatePropagation(),!1},callFormSubmitBindings:function(i,n){var r=i.data("events"),o=!0;return r!==t&&r.submit!==t&&e.each(r.submit,function(e,t){return"function"==typeof t.handler?o=t.handler(n):void 0}),o},disableElement:function(e){e.data("ujs:enable-with",e.html()),e.html(e.data("disable-with")),e.bind("click.railsDisable",function(e){return n.stopEverything(e)})},enableElement:function(e){e.data("ujs:enable-with")!==t&&(e.html(e.data("ujs:enable-with")),e.data("ujs:enable-with",!1)),e.unbind("click.railsDisable")}},n.fire(e(document),"rails:attachBindings")&&(e.ajaxPrefilter(function(e,t,i){e.crossDomain||n.CSRFProtection(i)}),e(document).delegate(n.linkDisableSelector,"ajax:complete",function(){n.enableElement(e(this))}),e(document).delegate(n.linkClickSelector,"click.rails",function(i){var r=e(this),o=r.data("method"),s=r.data("params");return n.allowAction(r)?(r.is(n.linkDisableSelector)&&n.disableElement(r),r.data("remote")!==t?!i.metaKey&&!i.ctrlKey||o&&"GET"!==o||s?(n.handleRemote(r)===!1&&n.enableElement(r),!1):!0:r.data("method")?(n.handleMethod(r),!1):void 0):n.stopEverything(i)}),e(document).delegate(n.inputChangeSelector,"change.rails",function(t){var i=e(this);return n.allowAction(i)?(n.handleRemote(i),!1):n.stopEverything(t)}),e(document).delegate(n.formSubmitSelector,"submit.rails",function(i){var r=e(this),o=r.data("remote")!==t,s=n.blankInputs(r,n.requiredInputSelector),a=n.nonBlankInputs(r,n.fileInputSelector);return n.allowAction(r)?s&&r.attr("novalidate")==t&&n.fire(r,"ajax:aborted:required",[s])?n.stopEverything(i):o?a?(setTimeout(function(){n.disableFormElements(r)},13),n.fire(r,"ajax:aborted:file",[a])):!e.support.submitBubbles&&e().jquery<"1.7"&&n.callFormSubmitBindings(r,i)===!1?n.stopEverything(i):(n.handleRemote(r),!1):(setTimeout(function(){n.disableFormElements(r)},13),void 0):n.stopEverything(i)}),e(document).delegate(n.formInputClickSelector,"click.rails",function(t){var i=e(this);if(!n.allowAction(i))return n.stopEverything(t);var r=i.attr("name"),o=r?{name:r,value:i.val()}:null;i.closest("form").data("ujs:submit-button",o)}),e(document).delegate(n.formSubmitSelector,"ajax:beforeSend.rails",function(t){this==t.target&&n.disableFormElements(e(this))}),e(document).delegate(n.formSubmitSelector,"ajax:complete.rails",function(t){this==t.target&&n.enableFormElements(e(this))}),e(function(){csrf_token=e("meta[name=csrf-token]").attr("content"),csrf_param=e("meta[name=csrf-param]").attr("content"),e('form input[name="'+csrf_param+'"]').val(csrf_token)}))}(jQuery),/*! jQuery UI - v1.10.3 - 2013-09-25
* http://jqueryui.com
* Includes: jquery.ui.core.js, jquery.ui.widget.js, jquery.ui.mouse.js, jquery.ui.position.js, jquery.ui.draggable.js, jquery.ui.droppable.js, jquery.ui.resizable.js, jquery.ui.selectable.js, jquery.ui.sortable.js
* Copyright 2013 jQuery Foundation and other contributors; Licensed MIT */
function(e,t){function i(t,i){var r,o,s,a=t.nodeName.toLowerCase();return"area"===a?(r=t.parentNode,o=r.name,t.href&&o&&"map"===r.nodeName.toLowerCase()?(s=e("img[usemap=#"+o+"]")[0],!!s&&n(s)):!1):(/input|select|textarea|button|object/.test(a)?!t.disabled:"a"===a?t.href||i:i)&&n(t)}function n(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}var r=0,o=/^ui-id-\d+$/;e.ui=e.ui||{},e.extend(e.ui,{version:"1.10.3",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({focus:function(t){return function(i,n){return"number"==typeof i?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),n&&n.call(t)},i)}):t.apply(this,arguments)}}(e.fn.focus),scrollParent:function(){var t;return t=e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(i){if(i!==t)return this.css("zIndex",i);if(this.length)for(var n,r,o=e(this[0]);o.length&&o[0]!==document;){if(n=o.css("position"),("absolute"===n||"relative"===n||"fixed"===n)&&(r=parseInt(o.css("zIndex"),10),!isNaN(r)&&0!==r))return r;o=o.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++r)})},removeUniqueId:function(){return this.each(function(){o.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,n){return!!e.data(t,n[3])},focusable:function(t){return i(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var n=e.attr(t,"tabindex"),r=isNaN(n);return(r||n>=0)&&i(t,!r)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(i,n){function r(t,i,n,r){return e.each(o,function(){i-=parseFloat(e.css(t,"padding"+this))||0,n&&(i-=parseFloat(e.css(t,"border"+this+"Width"))||0),r&&(i-=parseFloat(e.css(t,"margin"+this))||0)}),i}var o="Width"===n?["Left","Right"]:["Top","Bottom"],s=n.toLowerCase(),a={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+n]=function(i){return i===t?a["inner"+n].call(this):this.each(function(){e(this).css(s,r(this,i)+"px")})},e.fn["outer"+n]=function(t,i){return"number"!=typeof t?a["outer"+n].call(this,t):this.each(function(){e(this).css(s,r(this,t,!0,i)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(i){return arguments.length?t.call(this,e.camelCase(i)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.support.selectstart="onselectstart"in document.createElement("div"),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,i,n){var r,o=e.ui[t].prototype;for(r in n)o.plugins[r]=o.plugins[r]||[],o.plugins[r].push([i,n[r]])},call:function(e,t,i){var n,r=e.plugins[t];if(r&&e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType)for(n=0;n<r.length;n++)e.options[r[n][0]]&&r[n][1].apply(e.element,i)}},hasScroll:function(t,i){if("hidden"===e(t).css("overflow"))return!1;var n=i&&"left"===i?"scrollLeft":"scrollTop",r=!1;return t[n]>0?!0:(t[n]=1,r=t[n]>0,t[n]=0,r)}})}(jQuery),function(e,t){var i=0,n=Array.prototype.slice,r=e.cleanData;e.cleanData=function(t){for(var i,n=0;null!=(i=t[n]);n++)try{e(i).triggerHandler("remove")}catch(o){}r(t)},e.widget=function(t,i,n){var r,o,s,a,l={},c=t.split(".")[0];t=t.split(".")[1],r=c+"-"+t,n||(n=i,i=e.Widget),e.expr[":"][r.toLowerCase()]=function(t){return!!e.data(t,r)},e[c]=e[c]||{},o=e[c][t],s=e[c][t]=function(e,t){return this._createWidget?(arguments.length&&this._createWidget(e,t),void 0):new s(e,t)},e.extend(s,o,{version:n.version,_proto:e.extend({},n),_childConstructors:[]}),a=new i,a.options=e.widget.extend({},a.options),e.each(n,function(t,n){return e.isFunction(n)?(l[t]=function(){var e=function(){return i.prototype[t].apply(this,arguments)},r=function(e){return i.prototype[t].apply(this,e)};return function(){var t,i=this._super,o=this._superApply;return this._super=e,this._superApply=r,t=n.apply(this,arguments),this._super=i,this._superApply=o,t}}(),void 0):(l[t]=n,void 0)}),s.prototype=e.widget.extend(a,{widgetEventPrefix:o?a.widgetEventPrefix:t},l,{constructor:s,namespace:c,widgetName:t,widgetFullName:r}),o?(e.each(o._childConstructors,function(t,i){var n=i.prototype;e.widget(n.namespace+"."+n.widgetName,s,i._proto)}),delete o._childConstructors):i._childConstructors.push(s),e.widget.bridge(t,s)},e.widget.extend=function(i){for(var r,o,s=n.call(arguments,1),a=0,l=s.length;l>a;a++)for(r in s[a])o=s[a][r],s[a].hasOwnProperty(r)&&o!==t&&(i[r]=e.isPlainObject(o)?e.isPlainObject(i[r])?e.widget.extend({},i[r],o):e.widget.extend({},o):o);return i},e.widget.bridge=function(i,r){var o=r.prototype.widgetFullName||i;e.fn[i]=function(s){var a="string"==typeof s,l=n.call(arguments,1),c=this;return s=!a&&l.length?e.widget.extend.apply(null,[s].concat(l)):s,a?this.each(function(){var n,r=e.data(this,o);return r?e.isFunction(r[s])&&"_"!==s.charAt(0)?(n=r[s].apply(r,l),n!==r&&n!==t?(c=n&&n.jquery?c.pushStack(n.get()):n,!1):void 0):e.error("no such method '"+s+"' for "+i+" widget instance"):e.error("cannot call methods on "+i+" prior to initialization; "+"attempted to call method '"+s+"'")}):this.each(function(){var t=e.data(this,o);t?t.option(s||{})._init():e.data(this,o,new r(s,this))}),c}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,n){n=e(n||this.defaultElement||this)[0],this.element=e(n),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),n!==this&&(e.data(n,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===n&&this.destroy()}}),this.document=e(n.style?n.ownerDocument:n.document||n),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(i,n){var r,o,s,a=i;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof i)if(a={},r=i.split("."),i=r.shift(),r.length){for(o=a[i]=e.widget.extend({},this.options[i]),s=0;s<r.length-1;s++)o[r[s]]=o[r[s]]||{},o=o[r[s]];if(i=r.pop(),n===t)return o[i]===t?null:o[i];o[i]=n}else{if(n===t)return this.options[i]===t?null:this.options[i];a[i]=n}return this._setOptions(a),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,i,n){var r,o=this;"boolean"!=typeof t&&(n=i,i=t,t=!1),n?(i=r=e(i),this.bindings=this.bindings.add(i)):(n=i,i=this.element,r=this.widget()),e.each(n,function(n,s){function a(){return t||o.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof s?o[s]:s).apply(o,arguments):void 0}"string"!=typeof s&&(a.guid=s.guid=s.guid||a.guid||e.guid++);var l=n.match(/^(\w+)\s*(.*)$/),c=l[1]+o.eventNamespace,d=l[2];d?r.delegate(d,c,a):i.bind(c,a)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function i(){return("string"==typeof e?n[e]:e).apply(n,arguments)}var n=this;return setTimeout(i,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,n){var r,o,s=this.options[t];if(n=n||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],o=i.originalEvent)for(r in o)r in i||(i[r]=o[r]);return this.element.trigger(i,n),!(e.isFunction(s)&&s.apply(this.element[0],[i].concat(n))===!1||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(n,r,o){"string"==typeof r&&(r={effect:r});var s,a=r?r===!0||"number"==typeof r?i:r.effect||i:t;r=r||{},"number"==typeof r&&(r={duration:r}),s=!e.isEmptyObject(r),r.complete=o,r.delay&&n.delay(r.delay),s&&e.effects&&e.effects.effect[a]?n[t](r):a!==t&&n[a]?n[a](r.duration,r.easing,o):n.queue(function(i){e(this)[t](),o&&o.call(n[0]),i()})}})}(jQuery),function(e){var t=!1;e(document).mouseup(function(){t=!1}),e.widget("ui.mouse",{version:"1.10.3",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(i){return!0===e.data(i.target,t.widgetName+".preventClickEvent")?(e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(i){if(!t){this._mouseStarted&&this._mouseUp(i),this._mouseDownEvent=i;var n=this,r=1===i.which,o="string"==typeof this.options.cancel&&i.target.nodeName?e(i.target).closest(this.options.cancel).length:!1;return r&&!o&&this._mouseCapture(i)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){n.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(i)&&this._mouseDelayMet(i)&&(this._mouseStarted=this._mouseStart(i)!==!1,!this._mouseStarted)?(i.preventDefault(),!0):(!0===e.data(i.target,this.widgetName+".preventClickEvent")&&e.removeData(i.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return n._mouseMove(e)},this._mouseUpDelegate=function(e){return n._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),i.preventDefault(),t=!0,!0)):!0}},_mouseMove:function(t){return e.ui.ie&&(!document.documentMode||document.documentMode<9)&&!t.button?this._mouseUp(t):this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(e,t){function i(e,t,i){return[parseFloat(e[0])*(f.test(e[0])?t/100:1),parseFloat(e[1])*(f.test(e[1])?i/100:1)]}function n(t,i){return parseInt(e.css(t,i),10)||0}function r(t){var i=t[0];return 9===i.nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(i)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}e.ui=e.ui||{};var o,s=Math.max,a=Math.abs,l=Math.round,c=/left|center|right/,d=/top|center|bottom/,h=/[\+\-]\d+(\.[\d]+)?%?/,u=/^\w+/,f=/%$/,p=e.fn.position;e.position={scrollbarWidth:function(){if(o!==t)return o;var i,n,r=e("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),s=r.children()[0];return e("body").append(r),i=s.offsetWidth,r.css("overflow","scroll"),n=s.offsetWidth,i===n&&(n=r[0].clientWidth),r.remove(),o=i-n},getScrollInfo:function(t){var i=t.isWindow?"":t.element.css("overflow-x"),n=t.isWindow?"":t.element.css("overflow-y"),r="scroll"===i||"auto"===i&&t.width<t.element[0].scrollWidth,o="scroll"===n||"auto"===n&&t.height<t.element[0].scrollHeight;return{width:o?e.position.scrollbarWidth():0,height:r?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var i=e(t||window),n=e.isWindow(i[0]);return{element:i,isWindow:n,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:n?i.width():i.outerWidth(),height:n?i.height():i.outerHeight()}}},e.fn.position=function(t){if(!t||!t.of)return p.apply(this,arguments);t=e.extend({},t);var o,f,m,g,v,b,y=e(t.of),w=e.position.getWithinInfo(t.within),_=e.position.getScrollInfo(w),x=(t.collision||"flip").split(" "),C={};return b=r(y),y[0].preventDefault&&(t.at="left top"),f=b.width,m=b.height,g=b.offset,v=e.extend({},g),e.each(["my","at"],function(){var e,i,n=(t[this]||"").split(" ");1===n.length&&(n=c.test(n[0])?n.concat(["center"]):d.test(n[0])?["center"].concat(n):["center","center"]),n[0]=c.test(n[0])?n[0]:"center",n[1]=d.test(n[1])?n[1]:"center",e=h.exec(n[0]),i=h.exec(n[1]),C[this]=[e?e[0]:0,i?i[0]:0],t[this]=[u.exec(n[0])[0],u.exec(n[1])[0]]}),1===x.length&&(x[1]=x[0]),"right"===t.at[0]?v.left+=f:"center"===t.at[0]&&(v.left+=f/2),"bottom"===t.at[1]?v.top+=m:"center"===t.at[1]&&(v.top+=m/2),o=i(C.at,f,m),v.left+=o[0],v.top+=o[1],this.each(function(){var r,c,d=e(this),h=d.outerWidth(),u=d.outerHeight(),p=n(this,"marginLeft"),b=n(this,"marginTop"),S=h+p+n(this,"marginRight")+_.width,k=u+b+n(this,"marginBottom")+_.height,T=e.extend({},v),E=i(C.my,d.outerWidth(),d.outerHeight());"right"===t.my[0]?T.left-=h:"center"===t.my[0]&&(T.left-=h/2),"bottom"===t.my[1]?T.top-=u:"center"===t.my[1]&&(T.top-=u/2),T.left+=E[0],T.top+=E[1],e.support.offsetFractions||(T.left=l(T.left),T.top=l(T.top)),r={marginLeft:p,marginTop:b},e.each(["left","top"],function(i,n){e.ui.position[x[i]]&&e.ui.position[x[i]][n](T,{targetWidth:f,targetHeight:m,elemWidth:h,elemHeight:u,collisionPosition:r,collisionWidth:S,collisionHeight:k,offset:[o[0]+E[0],o[1]+E[1]],my:t.my,at:t.at,within:w,elem:d})}),t.using&&(c=function(e){var i=g.left-T.left,n=i+f-h,r=g.top-T.top,o=r+m-u,l={target:{element:y,left:g.left,top:g.top,width:f,height:m},element:{element:d,left:T.left,top:T.top,width:h,height:u},horizontal:0>n?"left":i>0?"right":"center",vertical:0>o?"top":r>0?"bottom":"middle"};h>f&&a(i+n)<f&&(l.horizontal="center"),u>m&&a(r+o)<m&&(l.vertical="middle"),l.important=s(a(i),a(n))>s(a(r),a(o))?"horizontal":"vertical",t.using.call(this,e,l)}),d.offset(e.extend(T,{using:c}))})},e.ui.position={fit:{left:function(e,t){var i,n=t.within,r=n.isWindow?n.scrollLeft:n.offset.left,o=n.width,a=e.left-t.collisionPosition.marginLeft,l=r-a,c=a+t.collisionWidth-o-r;t.collisionWidth>o?l>0&&0>=c?(i=e.left+l+t.collisionWidth-o-r,e.left+=l-i):e.left=c>0&&0>=l?r:l>c?r+o-t.collisionWidth:r:l>0?e.left+=l:c>0?e.left-=c:e.left=s(e.left-a,e.left)},top:function(e,t){var i,n=t.within,r=n.isWindow?n.scrollTop:n.offset.top,o=t.within.height,a=e.top-t.collisionPosition.marginTop,l=r-a,c=a+t.collisionHeight-o-r;t.collisionHeight>o?l>0&&0>=c?(i=e.top+l+t.collisionHeight-o-r,e.top+=l-i):e.top=c>0&&0>=l?r:l>c?r+o-t.collisionHeight:r:l>0?e.top+=l:c>0?e.top-=c:e.top=s(e.top-a,e.top)}},flip:{left:function(e,t){var i,n,r=t.within,o=r.offset.left+r.scrollLeft,s=r.width,l=r.isWindow?r.scrollLeft:r.offset.left,c=e.left-t.collisionPosition.marginLeft,d=c-l,h=c+t.collisionWidth-s-l,u="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,f="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,p=-2*t.offset[0];0>d?(i=e.left+u+f+p+t.collisionWidth-s-o,(0>i||i<a(d))&&(e.left+=u+f+p)):h>0&&(n=e.left-t.collisionPosition.marginLeft+u+f+p-l,(n>0||a(n)<h)&&(e.left+=u+f+p))},top:function(e,t){var i,n,r=t.within,o=r.offset.top+r.scrollTop,s=r.height,l=r.isWindow?r.scrollTop:r.offset.top,c=e.top-t.collisionPosition.marginTop,d=c-l,h=c+t.collisionHeight-s-l,u="top"===t.my[1],f=u?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,p="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,m=-2*t.offset[1];0>d?(n=e.top+f+p+m+t.collisionHeight-s-o,e.top+f+p+m>d&&(0>n||n<a(d))&&(e.top+=f+p+m)):h>0&&(i=e.top-t.collisionPosition.marginTop+f+p+m-l,e.top+f+p+m>h&&(i>0||a(i)<h)&&(e.top+=f+p+m))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,i,n,r,o,s=document.getElementsByTagName("body")[0],a=document.createElement("div");t=document.createElement(s?"div":"body"),n={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},s&&e.extend(n,{position:"absolute",left:"-1000px",top:"-1000px"});for(o in n)t.style[o]=n[o];t.appendChild(a),i=s||document.documentElement,i.insertBefore(t,i.firstChild),a.style.cssText="position: absolute; left: 10.7432222px;",r=e(a).offset().left,e.support.offsetFractions=r>10&&11>r,t.innerHTML="",i.removeChild(t)}()}(jQuery),function(e){e.widget("ui.draggable",e.ui.mouse,{version:"1.10.3",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(t){var i=this.options;return this.helper||i.disabled||e(t.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(t),this.handle?(e(i.iframeFix===!0?"iframe":i.iframeFix).each(function(){e("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(t){var i=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function(t,i){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),!i){var n=this._uiHash();if(this._trigger("drag",t,n)===!1)return this._mouseUp({}),!1;this.position=n.position}return this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i=this,n=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(n=e.ui.ddmanager.drop(this,t)),this.dropped&&(n=this.dropped,this.dropped=!1),"original"!==this.options.helper||e.contains(this.element[0].ownerDocument,this.element[0])?("invalid"===this.options.revert&&!n||"valid"===this.options.revert&&n||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,n)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",t)!==!1&&i._clear()}):this._trigger("stop",t)!==!1&&this._clear(),!1):!1},_mouseUp:function(t){return e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){return this.options.handle?!!e(t.target).closest(this.element.find(this.options.handle)).length:!0},_createHelper:function(t){var i=this.options,n=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,n,r=this.options;return r.containment?"window"===r.containment?(this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):"document"===r.containment?(this.containment=[0,0,e(document).width()-this.helperProportions.width-this.margins.left,(e(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):r.containment.constructor===Array?(this.containment=r.containment,void 0):("parent"===r.containment&&(r.containment=this.helper[0].parentNode),i=e(r.containment),n=i[0],n&&(t="hidden"!==i.css("overflow"),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(t?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=i),void 0):(this.containment=null,void 0)},_convertPositionTo:function(t,i){i||(i=this.position);var n="absolute"===t?1:-1,r="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;return this.offset.scroll||(this.offset.scroll={top:r.scrollTop(),left:r.scrollLeft()}),{top:i.top+this.offset.relative.top*n+this.offset.parent.top*n-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top)*n,left:i.left+this.offset.relative.left*n+this.offset.parent.left*n-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)*n}},_generatePosition:function(t){var i,n,r,o,s=this.options,a="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=t.pageX,c=t.pageY;return this.offset.scroll||(this.offset.scroll={top:a.scrollTop(),left:a.scrollLeft()}),this.originalPosition&&(this.containment&&(this.relative_container?(n=this.relative_container.offset(),i=[this.containment[0]+n.left,this.containment[1]+n.top,this.containment[2]+n.left,this.containment[3]+n.top]):i=this.containment,t.pageX-this.offset.click.left<i[0]&&(l=i[0]+this.offset.click.left),t.pageY-this.offset.click.top<i[1]&&(c=i[1]+this.offset.click.top),t.pageX-this.offset.click.left>i[2]&&(l=i[2]+this.offset.click.left),t.pageY-this.offset.click.top>i[3]&&(c=i[3]+this.offset.click.top)),s.grid&&(r=s.grid[1]?this.originalPageY+Math.round((c-this.originalPageY)/s.grid[1])*s.grid[1]:this.originalPageY,c=i?r-this.offset.click.top>=i[1]||r-this.offset.click.top>i[3]?r:r-this.offset.click.top>=i[1]?r-s.grid[1]:r+s.grid[1]:r,o=s.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/s.grid[0])*s.grid[0]:this.originalPageX,l=i?o-this.offset.click.left>=i[0]||o-this.offset.click.left>i[2]?o:o-this.offset.click.left>=i[0]?o-s.grid[0]:o+s.grid[0]:o)),{top:c-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,i,n){return n=n||this._uiHash(),e.ui.plugin.call(this,t,[i,n]),"drag"===t&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,t,i,n)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,i){var n=e(this).data("ui-draggable"),r=n.options,o=e.extend({},i,{item:n.element});n.sortables=[],e(r.connectToSortable).each(function(){var i=e.data(this,"ui-sortable");i&&!i.options.disabled&&(n.sortables.push({instance:i,shouldRevert:i.options.revert}),i.refreshPositions(),i._trigger("activate",t,o))})},stop:function(t,i){var n=e(this).data("ui-draggable"),r=e.extend({},i,{item:n.element});e.each(n.sortables,function(){this.instance.isOver?(this.instance.isOver=0,n.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,"original"===n.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,r))})},drag:function(t,i){var n=e(this).data("ui-draggable"),r=this;e.each(n.sortables,function(){var o=!1,s=this;this.instance.positionAbs=n.positionAbs,this.instance.helperProportions=n.helperProportions,this.instance.offset.click=n.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(o=!0,e.each(n.sortables,function(){return this.instance.positionAbs=n.positionAbs,this.instance.helperProportions=n.helperProportions,this.instance.offset.click=n.offset.click,this!==s&&this.instance._intersectsWith(this.instance.containerCache)&&e.contains(s.instance.element[0],this.instance.element[0])&&(o=!1),o})),o?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(r).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return i.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=n.offset.click.top,this.instance.offset.click.left=n.offset.click.left,this.instance.offset.parent.left-=n.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=n.offset.parent.top-this.instance.offset.parent.top,n._trigger("toSortable",t),n.dropped=this.instance.element,n.currentItem=n.element,this.instance.fromOutside=n),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),n._trigger("fromSortable",t),n.dropped=!1)})}}),e.ui.plugin.add("draggable","cursor",{start:function(){var t=e("body"),i=e(this).data("ui-draggable").options;
t.css("cursor")&&(i._cursor=t.css("cursor")),t.css("cursor",i.cursor)},stop:function(){var t=e(this).data("ui-draggable").options;t._cursor&&e("body").css("cursor",t._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,i){var n=e(i.helper),r=e(this).data("ui-draggable").options;n.css("opacity")&&(r._opacity=n.css("opacity")),n.css("opacity",r.opacity)},stop:function(t,i){var n=e(this).data("ui-draggable").options;n._opacity&&e(i.helper).css("opacity",n._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(){var t=e(this).data("ui-draggable");t.scrollParent[0]!==document&&"HTML"!==t.scrollParent[0].tagName&&(t.overflowOffset=t.scrollParent.offset())},drag:function(t){var i=e(this).data("ui-draggable"),n=i.options,r=!1;i.scrollParent[0]!==document&&"HTML"!==i.scrollParent[0].tagName?(n.axis&&"x"===n.axis||(i.overflowOffset.top+i.scrollParent[0].offsetHeight-t.pageY<n.scrollSensitivity?i.scrollParent[0].scrollTop=r=i.scrollParent[0].scrollTop+n.scrollSpeed:t.pageY-i.overflowOffset.top<n.scrollSensitivity&&(i.scrollParent[0].scrollTop=r=i.scrollParent[0].scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(i.overflowOffset.left+i.scrollParent[0].offsetWidth-t.pageX<n.scrollSensitivity?i.scrollParent[0].scrollLeft=r=i.scrollParent[0].scrollLeft+n.scrollSpeed:t.pageX-i.overflowOffset.left<n.scrollSensitivity&&(i.scrollParent[0].scrollLeft=r=i.scrollParent[0].scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(t.pageY-e(document).scrollTop()<n.scrollSensitivity?r=e(document).scrollTop(e(document).scrollTop()-n.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<n.scrollSensitivity&&(r=e(document).scrollTop(e(document).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(t.pageX-e(document).scrollLeft()<n.scrollSensitivity?r=e(document).scrollLeft(e(document).scrollLeft()-n.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<n.scrollSensitivity&&(r=e(document).scrollLeft(e(document).scrollLeft()+n.scrollSpeed)))),r!==!1&&e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(i,t)}}),e.ui.plugin.add("draggable","snap",{start:function(){var t=e(this).data("ui-draggable"),i=t.options;t.snapElements=[],e(i.snap.constructor!==String?i.snap.items||":data(ui-draggable)":i.snap).each(function(){var i=e(this),n=i.offset();this!==t.element[0]&&t.snapElements.push({item:this,width:i.outerWidth(),height:i.outerHeight(),top:n.top,left:n.left})})},drag:function(t,i){var n,r,o,s,a,l,c,d,h,u,f=e(this).data("ui-draggable"),p=f.options,m=p.snapTolerance,g=i.offset.left,v=g+f.helperProportions.width,b=i.offset.top,y=b+f.helperProportions.height;for(h=f.snapElements.length-1;h>=0;h--)a=f.snapElements[h].left,l=a+f.snapElements[h].width,c=f.snapElements[h].top,d=c+f.snapElements[h].height,a-m>v||g>l+m||c-m>y||b>d+m||!e.contains(f.snapElements[h].item.ownerDocument,f.snapElements[h].item)?(f.snapElements[h].snapping&&f.options.snap.release&&f.options.snap.release.call(f.element,t,e.extend(f._uiHash(),{snapItem:f.snapElements[h].item})),f.snapElements[h].snapping=!1):("inner"!==p.snapMode&&(n=Math.abs(c-y)<=m,r=Math.abs(d-b)<=m,o=Math.abs(a-v)<=m,s=Math.abs(l-g)<=m,n&&(i.position.top=f._convertPositionTo("relative",{top:c-f.helperProportions.height,left:0}).top-f.margins.top),r&&(i.position.top=f._convertPositionTo("relative",{top:d,left:0}).top-f.margins.top),o&&(i.position.left=f._convertPositionTo("relative",{top:0,left:a-f.helperProportions.width}).left-f.margins.left),s&&(i.position.left=f._convertPositionTo("relative",{top:0,left:l}).left-f.margins.left)),u=n||r||o||s,"outer"!==p.snapMode&&(n=Math.abs(c-b)<=m,r=Math.abs(d-y)<=m,o=Math.abs(a-g)<=m,s=Math.abs(l-v)<=m,n&&(i.position.top=f._convertPositionTo("relative",{top:c,left:0}).top-f.margins.top),r&&(i.position.top=f._convertPositionTo("relative",{top:d-f.helperProportions.height,left:0}).top-f.margins.top),o&&(i.position.left=f._convertPositionTo("relative",{top:0,left:a}).left-f.margins.left),s&&(i.position.left=f._convertPositionTo("relative",{top:0,left:l-f.helperProportions.width}).left-f.margins.left)),!f.snapElements[h].snapping&&(n||r||o||s||u)&&f.options.snap.snap&&f.options.snap.snap.call(f.element,t,e.extend(f._uiHash(),{snapItem:f.snapElements[h].item})),f.snapElements[h].snapping=n||r||o||s||u)}}),e.ui.plugin.add("draggable","stack",{start:function(){var t,i=this.data("ui-draggable").options,n=e.makeArray(e(i.stack)).sort(function(t,i){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(i).css("zIndex"),10)||0)});n.length&&(t=parseInt(e(n[0]).css("zIndex"),10)||0,e(n).each(function(i){e(this).css("zIndex",t+i)}),this.css("zIndex",t+n.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,i){var n=e(i.helper),r=e(this).data("ui-draggable").options;n.css("zIndex")&&(r._zIndex=n.css("zIndex")),n.css("zIndex",r.zIndex)},stop:function(t,i){var n=e(this).data("ui-draggable").options;n._zIndex&&e(i.helper).css("zIndex",n._zIndex)}})}(jQuery),function(e){function t(e,t,i){return e>t&&t+i>e}e.widget("ui.droppable",{version:"1.10.3",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var t=this.options,i=t.accept;this.isover=!1,this.isout=!0,this.accept=e.isFunction(i)?i:function(e){return e.is(i)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},e.ui.ddmanager.droppables[t.scope]=e.ui.ddmanager.droppables[t.scope]||[],e.ui.ddmanager.droppables[t.scope].push(this),t.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){for(var t=0,i=e.ui.ddmanager.droppables[this.options.scope];t<i.length;t++)i[t]===this&&i.splice(t,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(t,i){"accept"===t&&(this.accept=e.isFunction(i)?i:function(e){return e.is(i)}),e.Widget.prototype._setOption.apply(this,arguments)},_activate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger("activate",t,this.ui(i))},_deactivate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger("deactivate",t,this.ui(i))},_over:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(i)))},_out:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(i)))},_drop:function(t,i){var n=i||e.ui.ddmanager.current,r=!1;return n&&(n.currentItem||n.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var t=e.data(this,"ui-droppable");return t.options.greedy&&!t.options.disabled&&t.options.scope===n.options.scope&&t.accept.call(t.element[0],n.currentItem||n.element)&&e.ui.intersect(n,e.extend(t,{offset:t.element.offset()}),t.options.tolerance)?(r=!0,!1):void 0}),r?!1:this.accept.call(this.element[0],n.currentItem||n.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(n)),this.element):!1):!1},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.ui.intersect=function(e,i,n){if(!i.offset)return!1;var r,o,s=(e.positionAbs||e.position.absolute).left,a=s+e.helperProportions.width,l=(e.positionAbs||e.position.absolute).top,c=l+e.helperProportions.height,d=i.offset.left,h=d+i.proportions.width,u=i.offset.top,f=u+i.proportions.height;switch(n){case"fit":return s>=d&&h>=a&&l>=u&&f>=c;case"intersect":return d<s+e.helperProportions.width/2&&a-e.helperProportions.width/2<h&&u<l+e.helperProportions.height/2&&c-e.helperProportions.height/2<f;case"pointer":return r=(e.positionAbs||e.position.absolute).left+(e.clickOffset||e.offset.click).left,o=(e.positionAbs||e.position.absolute).top+(e.clickOffset||e.offset.click).top,t(o,u,i.proportions.height)&&t(r,d,i.proportions.width);case"touch":return(l>=u&&f>=l||c>=u&&f>=c||u>l&&c>f)&&(s>=d&&h>=s||a>=d&&h>=a||d>s&&a>h);default:return!1}},e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,i){var n,r,o=e.ui.ddmanager.droppables[t.options.scope]||[],s=i?i.type:null,a=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();e:for(n=0;n<o.length;n++)if(!(o[n].options.disabled||t&&!o[n].accept.call(o[n].element[0],t.currentItem||t.element))){for(r=0;r<a.length;r++)if(a[r]===o[n].element[0]){o[n].proportions.height=0;continue e}o[n].visible="none"!==o[n].element.css("display"),o[n].visible&&("mousedown"===s&&o[n]._activate.call(o[n],i),o[n].offset=o[n].element.offset(),o[n].proportions={width:o[n].element[0].offsetWidth,height:o[n].element[0].offsetHeight})}},drop:function(t,i){var n=!1;return e.each((e.ui.ddmanager.droppables[t.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance)&&(n=this._drop.call(this,i)||n),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),n},dragStart:function(t,i){t.element.parentsUntil("body").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)})},drag:function(t,i){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,i),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var n,r,o,s=e.ui.intersect(t,this,this.options.tolerance),a=!s&&this.isover?"isout":s&&!this.isover?"isover":null;a&&(this.options.greedy&&(r=this.options.scope,o=this.element.parents(":data(ui-droppable)").filter(function(){return e.data(this,"ui-droppable").options.scope===r}),o.length&&(n=e.data(o[0],"ui-droppable"),n.greedyChild="isover"===a)),n&&"isover"===a&&(n.isover=!1,n.isout=!0,n._out.call(n,i)),this[a]=!0,this["isout"===a?"isover":"isout"]=!1,this["isover"===a?"_over":"_out"].call(this,i),n&&"isout"===a&&(n.isout=!1,n.isover=!0,n._over.call(n,i)))}})},dragStop:function(t,i){t.element.parentsUntil("body").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)}}}(jQuery),function(e){function t(e){return parseInt(e,10)||0}function i(e){return!isNaN(parseInt(e,10))}e.widget("ui.resizable",e.ui.mouse,{version:"1.10.3",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_create:function(){var t,i,n,r,o,s=this,a=this.options;if(this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!a.aspectRatio,aspectRatio:a.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:a.helper||a.ghost||a.animate?a.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.data("ui-resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=a.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),t=this.handles.split(","),this.handles={},i=0;i<t.length;i++)n=e.trim(t[i]),o="ui-resizable-"+n,r=e("<div class='ui-resizable-handle "+o+"'></div>"),r.css({zIndex:a.zIndex}),"se"===n&&r.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[n]=".ui-resizable-"+n,this.element.append(r);this._renderAxis=function(t){var i,n,r,o;t=t||this.element;for(i in this.handles)this.handles[i].constructor===String&&(this.handles[i]=e(this.handles[i],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(n=e(this.handles[i],this.element),o=/sw|ne|nw|se|n|s/.test(i)?n.outerHeight():n.outerWidth(),r=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),t.css(r,o),this._proportionallyResize()),e(this.handles[i]).length},this._renderAxis(this.element),this._handles=e(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){s.resizing||(this.className&&(r=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),s.axis=r&&r[1]?r[1]:"se")}),a.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").mouseenter(function(){a.disabled||(e(this).removeClass("ui-resizable-autohide"),s._handles.show())}).mouseleave(function(){a.disabled||s.resizing||(e(this).addClass("ui-resizable-autohide"),s._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t,i=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),t=this.element,this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_mouseCapture:function(t){var i,n,r=!1;for(i in this.handles)n=e(this.handles[i])[0],(n===t.target||e.contains(n,t.target))&&(r=!0);return!this.options.disabled&&r},_mouseStart:function(i){var n,r,o,s=this.options,a=this.element.position(),l=this.element;return this.resizing=!0,/absolute/.test(l.css("position"))?l.css({position:"absolute",top:l.css("top"),left:l.css("left")}):l.is(".ui-draggable")&&l.css({position:"absolute",top:a.top,left:a.left}),this._renderProxy(),n=t(this.helper.css("left")),r=t(this.helper.css("top")),s.containment&&(n+=e(s.containment).scrollLeft()||0,r+=e(s.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:n,top:r},this.size=this._helper?{width:l.outerWidth(),height:l.outerHeight()}:{width:l.width(),height:l.height()},this.originalSize=this._helper?{width:l.outerWidth(),height:l.outerHeight()}:{width:l.width(),height:l.height()},this.originalPosition={left:n,top:r},this.sizeDiff={width:l.outerWidth()-l.width(),height:l.outerHeight()-l.height()},this.originalMousePosition={left:i.pageX,top:i.pageY},this.aspectRatio="number"==typeof s.aspectRatio?s.aspectRatio:this.originalSize.width/this.originalSize.height||1,o=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor","auto"===o?this.axis+"-resize":o),l.addClass("ui-resizable-resizing"),this._propagate("start",i),!0},_mouseDrag:function(t){var i,n=this.helper,r={},o=this.originalMousePosition,s=this.axis,a=this.position.top,l=this.position.left,c=this.size.width,d=this.size.height,h=t.pageX-o.left||0,u=t.pageY-o.top||0,f=this._change[s];return f?(i=f.apply(this,[t,h,u]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(i=this._updateRatio(i,t)),i=this._respectSize(i,t),this._updateCache(i),this._propagate("resize",t),this.position.top!==a&&(r.top=this.position.top+"px"),this.position.left!==l&&(r.left=this.position.left+"px"),this.size.width!==c&&(r.width=this.size.width+"px"),this.size.height!==d&&(r.height=this.size.height+"px"),n.css(r),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(r)||this._trigger("resize",t,this.ui()),!1):!1},_mouseStop:function(t){this.resizing=!1;var i,n,r,o,s,a,l,c=this.options,d=this;return this._helper&&(i=this._proportionallyResizeElements,n=i.length&&/textarea/i.test(i[0].nodeName),r=n&&e.ui.hasScroll(i[0],"left")?0:d.sizeDiff.height,o=n?0:d.sizeDiff.width,s={width:d.helper.width()-o,height:d.helper.height()-r},a=parseInt(d.element.css("left"),10)+(d.position.left-d.originalPosition.left)||null,l=parseInt(d.element.css("top"),10)+(d.position.top-d.originalPosition.top)||null,c.animate||this.element.css(e.extend(s,{top:l,left:a})),d.helper.height(d.size.height),d.helper.width(d.size.width),this._helper&&!c.animate&&this._proportionallyResize()),e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(e){var t,n,r,o,s,a=this.options;s={minWidth:i(a.minWidth)?a.minWidth:0,maxWidth:i(a.maxWidth)?a.maxWidth:1/0,minHeight:i(a.minHeight)?a.minHeight:0,maxHeight:i(a.maxHeight)?a.maxHeight:1/0},(this._aspectRatio||e)&&(t=s.minHeight*this.aspectRatio,r=s.minWidth/this.aspectRatio,n=s.maxHeight*this.aspectRatio,o=s.maxWidth/this.aspectRatio,t>s.minWidth&&(s.minWidth=t),r>s.minHeight&&(s.minHeight=r),n<s.maxWidth&&(s.maxWidth=n),o<s.maxHeight&&(s.maxHeight=o)),this._vBoundaries=s},_updateCache:function(e){this.offset=this.helper.offset(),i(e.left)&&(this.position.left=e.left),i(e.top)&&(this.position.top=e.top),i(e.height)&&(this.size.height=e.height),i(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,n=this.size,r=this.axis;return i(e.height)?e.width=e.height*this.aspectRatio:i(e.width)&&(e.height=e.width/this.aspectRatio),"sw"===r&&(e.left=t.left+(n.width-e.width),e.top=null),"nw"===r&&(e.top=t.top+(n.height-e.height),e.left=t.left+(n.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,n=this.axis,r=i(e.width)&&t.maxWidth&&t.maxWidth<e.width,o=i(e.height)&&t.maxHeight&&t.maxHeight<e.height,s=i(e.width)&&t.minWidth&&t.minWidth>e.width,a=i(e.height)&&t.minHeight&&t.minHeight>e.height,l=this.originalPosition.left+this.originalSize.width,c=this.position.top+this.size.height,d=/sw|nw|w/.test(n),h=/nw|ne|n/.test(n);return s&&(e.width=t.minWidth),a&&(e.height=t.minHeight),r&&(e.width=t.maxWidth),o&&(e.height=t.maxHeight),s&&d&&(e.left=l-t.minWidth),r&&d&&(e.left=l-t.maxWidth),a&&h&&(e.top=c-t.minHeight),o&&h&&(e.top=c-t.maxHeight),e.width||e.height||e.left||!e.top?e.width||e.height||e.top||!e.left||(e.left=null):e.top=null,e},_proportionallyResize:function(){if(this._proportionallyResizeElements.length){var e,t,i,n,r,o=this.helper||this.element;for(e=0;e<this._proportionallyResizeElements.length;e++){if(r=this._proportionallyResizeElements[e],!this.borderDif)for(this.borderDif=[],i=[r.css("borderTopWidth"),r.css("borderRightWidth"),r.css("borderBottomWidth"),r.css("borderLeftWidth")],n=[r.css("paddingTop"),r.css("paddingRight"),r.css("paddingBottom"),r.css("paddingLeft")],t=0;t<i.length;t++)this.borderDif[t]=(parseInt(i[t],10)||0)+(parseInt(n[t],10)||0);r.css({height:o.height()-this.borderDif[0]-this.borderDif[2]||0,width:o.width()-this.borderDif[1]-this.borderDif[3]||0})}}},_renderProxy:function(){var t=this.element,i=this.options;this.elementOffset=t.offset(),this._helper?(this.helper=this.helper||e("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var i=this.originalSize,n=this.originalPosition;return{left:n.left+t,width:i.width-t}},n:function(e,t,i){var n=this.originalSize,r=this.originalPosition;return{top:r.top+i,height:n.height-i}},s:function(e,t,i){return{height:this.originalSize.height+i}},se:function(t,i,n){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,i,n]))},sw:function(t,i,n){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,i,n]))},ne:function(t,i,n){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,i,n]))},nw:function(t,i,n){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,i,n]))}},_propagate:function(t,i){e.ui.plugin.call(this,t,[i,this.ui()]),"resize"!==t&&this._trigger(t,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var i=e(this).data("ui-resizable"),n=i.options,r=i._proportionallyResizeElements,o=r.length&&/textarea/i.test(r[0].nodeName),s=o&&e.ui.hasScroll(r[0],"left")?0:i.sizeDiff.height,a=o?0:i.sizeDiff.width,l={width:i.size.width-a,height:i.size.height-s},c=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,d=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(e.extend(l,d&&c?{top:d,left:c}:{}),{duration:n.animateDuration,easing:n.animateEasing,step:function(){var n={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};r&&r.length&&e(r[0]).css({width:n.width,height:n.height}),i._updateCache(n),i._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var i,n,r,o,s,a,l,c=e(this).data("ui-resizable"),d=c.options,h=c.element,u=d.containment,f=u instanceof e?u.get(0):/parent/.test(u)?h.parent().get(0):u;f&&(c.containerElement=e(f),/document/.test(u)||u===document?(c.containerOffset={left:0,top:0},c.containerPosition={left:0,top:0},c.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(i=e(f),n=[],e(["Top","Right","Left","Bottom"]).each(function(e,r){n[e]=t(i.css("padding"+r))}),c.containerOffset=i.offset(),c.containerPosition=i.position(),c.containerSize={height:i.innerHeight()-n[3],width:i.innerWidth()-n[1]},r=c.containerOffset,o=c.containerSize.height,s=c.containerSize.width,a=e.ui.hasScroll(f,"left")?f.scrollWidth:s,l=e.ui.hasScroll(f)?f.scrollHeight:o,c.parentData={element:f,left:r.left,top:r.top,width:a,height:l}))},resize:function(t){var i,n,r,o,s=e(this).data("ui-resizable"),a=s.options,l=s.containerOffset,c=s.position,d=s._aspectRatio||t.shiftKey,h={top:0,left:0},u=s.containerElement;u[0]!==document&&/static/.test(u.css("position"))&&(h=l),c.left<(s._helper?l.left:0)&&(s.size.width=s.size.width+(s._helper?s.position.left-l.left:s.position.left-h.left),d&&(s.size.height=s.size.width/s.aspectRatio),s.position.left=a.helper?l.left:0),c.top<(s._helper?l.top:0)&&(s.size.height=s.size.height+(s._helper?s.position.top-l.top:s.position.top),d&&(s.size.width=s.size.height*s.aspectRatio),s.position.top=s._helper?l.top:0),s.offset.left=s.parentData.left+s.position.left,s.offset.top=s.parentData.top+s.position.top,i=Math.abs((s._helper?s.offset.left-h.left:s.offset.left-h.left)+s.sizeDiff.width),n=Math.abs((s._helper?s.offset.top-h.top:s.offset.top-l.top)+s.sizeDiff.height),r=s.containerElement.get(0)===s.element.parent().get(0),o=/relative|absolute/.test(s.containerElement.css("position")),r&&o&&(i-=s.parentData.left),i+s.size.width>=s.parentData.width&&(s.size.width=s.parentData.width-i,d&&(s.size.height=s.size.width/s.aspectRatio)),n+s.size.height>=s.parentData.height&&(s.size.height=s.parentData.height-n,d&&(s.size.width=s.size.height*s.aspectRatio))},stop:function(){var t=e(this).data("ui-resizable"),i=t.options,n=t.containerOffset,r=t.containerPosition,o=t.containerElement,s=e(t.helper),a=s.offset(),l=s.outerWidth()-t.sizeDiff.width,c=s.outerHeight()-t.sizeDiff.height;t._helper&&!i.animate&&/relative/.test(o.css("position"))&&e(this).css({left:a.left-r.left-n.left,width:l,height:c}),t._helper&&!i.animate&&/static/.test(o.css("position"))&&e(this).css({left:a.left-r.left-n.left,width:l,height:c})}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).data("ui-resizable"),i=t.options,n=function(t){e(t).each(function(){var t=e(this);t.data("ui-resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})})};"object"!=typeof i.alsoResize||i.alsoResize.parentNode?n(i.alsoResize):i.alsoResize.length?(i.alsoResize=i.alsoResize[0],n(i.alsoResize)):e.each(i.alsoResize,function(e){n(e)})},resize:function(t,i){var n=e(this).data("ui-resizable"),r=n.options,o=n.originalSize,s=n.originalPosition,a={height:n.size.height-o.height||0,width:n.size.width-o.width||0,top:n.position.top-s.top||0,left:n.position.left-s.left||0},l=function(t,n){e(t).each(function(){var t=e(this),r=e(this).data("ui-resizable-alsoresize"),o={},s=n&&n.length?n:t.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(s,function(e,t){var i=(r[t]||0)+(a[t]||0);i&&i>=0&&(o[t]=i||null)}),t.css(o)})};"object"!=typeof r.alsoResize||r.alsoResize.nodeType?l(r.alsoResize):e.each(r.alsoResize,function(e,t){l(e,t)})},stop:function(){e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).data("ui-resizable"),i=t.options,n=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:n.height,width:n.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof i.ghost?i.ghost:""),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).data("ui-resizable");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).data("ui-resizable");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t=e(this).data("ui-resizable"),i=t.options,n=t.size,r=t.originalSize,o=t.originalPosition,s=t.axis,a="number"==typeof i.grid?[i.grid,i.grid]:i.grid,l=a[0]||1,c=a[1]||1,d=Math.round((n.width-r.width)/l)*l,h=Math.round((n.height-r.height)/c)*c,u=r.width+d,f=r.height+h,p=i.maxWidth&&i.maxWidth<u,m=i.maxHeight&&i.maxHeight<f,g=i.minWidth&&i.minWidth>u,v=i.minHeight&&i.minHeight>f;i.grid=a,g&&(u+=l),v&&(f+=c),p&&(u-=l),m&&(f-=c),/^(se|s|e)$/.test(s)?(t.size.width=u,t.size.height=f):/^(ne)$/.test(s)?(t.size.width=u,t.size.height=f,t.position.top=o.top-h):/^(sw)$/.test(s)?(t.size.width=u,t.size.height=f,t.position.left=o.left-d):(t.size.width=u,t.size.height=f,t.position.top=o.top-h,t.position.left=o.left-d)}})}(jQuery),function(e){e.widget("ui.selectable",e.ui.mouse,{version:"1.10.3",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var t,i=this;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){t=e(i.options.filter,i.element[0]),t.addClass("ui-selectee"),t.each(function(){var t=e(this),i=t.offset();e.data(this,"selectable-item",{element:this,$element:t,left:i.left,top:i.top,right:i.left+t.outerWidth(),bottom:i.top+t.outerHeight(),startselected:!1,selected:t.hasClass("ui-selected"),selecting:t.hasClass("ui-selecting"),unselecting:t.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=t.addClass("ui-selectee"),this._mouseInit(),this.helper=e("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(t){var i=this,n=this.options;this.opos=[t.pageX,t.pageY],this.options.disabled||(this.selectees=e(n.filter,this.element[0]),this._trigger("start",t),e(n.appendTo).append(this.helper),this.helper.css({left:t.pageX,top:t.pageY,width:0,height:0}),n.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var n=e.data(this,"selectable-item");n.startselected=!0,t.metaKey||t.ctrlKey||(n.$element.removeClass("ui-selected"),n.selected=!1,n.$element.addClass("ui-unselecting"),n.unselecting=!0,i._trigger("unselecting",t,{unselecting:n.element}))}),e(t.target).parents().addBack().each(function(){var n,r=e.data(this,"selectable-item");return r?(n=!t.metaKey&&!t.ctrlKey||!r.$element.hasClass("ui-selected"),r.$element.removeClass(n?"ui-unselecting":"ui-selected").addClass(n?"ui-selecting":"ui-unselecting"),r.unselecting=!n,r.selecting=n,r.selected=n,n?i._trigger("selecting",t,{selecting:r.element}):i._trigger("unselecting",t,{unselecting:r.element}),!1):void 0}))},_mouseDrag:function(t){if(this.dragged=!0,!this.options.disabled){var i,n=this,r=this.options,o=this.opos[0],s=this.opos[1],a=t.pageX,l=t.pageY;return o>a&&(i=a,a=o,o=i),s>l&&(i=l,l=s,s=i),this.helper.css({left:o,top:s,width:a-o,height:l-s}),this.selectees.each(function(){var i=e.data(this,"selectable-item"),c=!1;i&&i.element!==n.element[0]&&("touch"===r.tolerance?c=!(i.left>a||i.right<o||i.top>l||i.bottom<s):"fit"===r.tolerance&&(c=i.left>o&&i.right<a&&i.top>s&&i.bottom<l),c?(i.selected&&(i.$element.removeClass("ui-selected"),i.selected=!1),i.unselecting&&(i.$element.removeClass("ui-unselecting"),i.unselecting=!1),i.selecting||(i.$element.addClass("ui-selecting"),i.selecting=!0,n._trigger("selecting",t,{selecting:i.element}))):(i.selecting&&((t.metaKey||t.ctrlKey)&&i.startselected?(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.$element.addClass("ui-selected"),i.selected=!0):(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.startselected&&(i.$element.addClass("ui-unselecting"),i.unselecting=!0),n._trigger("unselecting",t,{unselecting:i.element}))),i.selected&&(t.metaKey||t.ctrlKey||i.startselected||(i.$element.removeClass("ui-selected"),i.selected=!1,i.$element.addClass("ui-unselecting"),i.unselecting=!0,n._trigger("unselecting",t,{unselecting:i.element})))))}),!1}},_mouseStop:function(t){var i=this;return this.dragged=!1,e(".ui-unselecting",this.element[0]).each(function(){var n=e.data(this,"selectable-item");n.$element.removeClass("ui-unselecting"),n.unselecting=!1,n.startselected=!1,i._trigger("unselected",t,{unselected:n.element})}),e(".ui-selecting",this.element[0]).each(function(){var n=e.data(this,"selectable-item");n.$element.removeClass("ui-selecting").addClass("ui-selected"),n.selecting=!1,n.selected=!0,n.startselected=!0,i._trigger("selected",t,{selected:n.element})}),this._trigger("stop",t),this.helper.remove(),!1}})}(jQuery),function(e){function t(e,t,i){return e>t&&t+i>e}function i(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))}e.widget("ui.sortable",e.ui.mouse,{version:"1.10.3",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var e=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===e.axis||i(this.items[0].item):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();
for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_setOption:function(t,i){"disabled"===t?(this.options[t]=i,this.widget().toggleClass("ui-sortable-disabled",!!i)):e.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(t,i){var n=null,r=!1,o=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(t),e(t.target).parents().each(function(){return e.data(this,o.widgetName+"-item")===o?(n=e(this),!1):void 0}),e.data(t.target,o.widgetName+"-item")===o&&(n=e(t.target)),n?!this.options.handle||i||(e(this.options.handle,n).find("*").addBack().each(function(){this===t.target&&(r=!0)}),r)?(this.currentItem=n,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function(t,i,n){var r,o,s=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,s.cursorAt&&this._adjustOffsetFromHelper(s.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),s.containment&&this._setContainment(),s.cursor&&"auto"!==s.cursor&&(o=this.document.find("body"),this.storedCursor=o.css("cursor"),o.css("cursor",s.cursor),this.storedStylesheet=e("<style>*{ cursor: "+s.cursor+" !important; }</style>").appendTo(o)),s.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",s.opacity)),s.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",s.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!n)for(r=this.containers.length-1;r>=0;r--)this.containers[r]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!s.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var i,n,r,o,s=this.options,a=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<s.scrollSensitivity?this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop+s.scrollSpeed:t.pageY-this.overflowOffset.top<s.scrollSensitivity&&(this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop-s.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<s.scrollSensitivity?this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft+s.scrollSpeed:t.pageX-this.overflowOffset.left<s.scrollSensitivity&&(this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft-s.scrollSpeed)):(t.pageY-e(document).scrollTop()<s.scrollSensitivity?a=e(document).scrollTop(e(document).scrollTop()-s.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<s.scrollSensitivity&&(a=e(document).scrollTop(e(document).scrollTop()+s.scrollSpeed)),t.pageX-e(document).scrollLeft()<s.scrollSensitivity?a=e(document).scrollLeft(e(document).scrollLeft()-s.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<s.scrollSensitivity&&(a=e(document).scrollLeft(e(document).scrollLeft()+s.scrollSpeed))),a!==!1&&e.ui.ddmanager&&!s.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(n=this.items[i],r=n.item[0],o=this._intersectsWithPointer(n),o&&n.instance===this.currentContainer&&r!==this.currentItem[0]&&this.placeholder[1===o?"next":"prev"]()[0]!==r&&!e.contains(this.placeholder[0],r)&&("semi-dynamic"===this.options.type?!e.contains(this.element[0],r):!0)){if(this.direction=1===o?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(n))break;this._rearrange(t,n),this._trigger("change",t,this._uiHash());break}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,i){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var n=this,r=this.placeholder.offset(),o=this.options.axis,s={};o&&"x"!==o||(s.left=r.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),o&&"y"!==o||(s.top=r.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(s,parseInt(this.options.revert,10)||500,function(){n._clear(t)})}else this._clear(t,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var i=this._getItemsAsjQuery(t&&t.connected),n=[];return t=t||{},e(i).each(function(){var i=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);i&&n.push((t.key||i[1]+"[]")+"="+(t.key&&t.expression?i[1]:i[2]))}),!n.length&&t.key&&n.push(t.key+"="),n.join("&")},toArray:function(t){var i=this._getItemsAsjQuery(t&&t.connected),n=[];return t=t||{},i.each(function(){n.push(e(t.item||this).attr(t.attribute||"id")||"")}),n},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,n=this.positionAbs.top,r=n+this.helperProportions.height,o=e.left,s=o+e.width,a=e.top,l=a+e.height,c=this.offset.click.top,d=this.offset.click.left,h="x"===this.options.axis||n+c>a&&l>n+c,u="y"===this.options.axis||t+d>o&&s>t+d,f=h&&u;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?f:o<t+this.helperProportions.width/2&&i-this.helperProportions.width/2<s&&a<n+this.helperProportions.height/2&&r-this.helperProportions.height/2<l},_intersectsWithPointer:function(e){var i="x"===this.options.axis||t(this.positionAbs.top+this.offset.click.top,e.top,e.height),n="y"===this.options.axis||t(this.positionAbs.left+this.offset.click.left,e.left,e.width),r=i&&n,o=this._getDragVerticalDirection(),s=this._getDragHorizontalDirection();return r?this.floating?s&&"right"===s||"down"===o?2:1:o&&("down"===o?2:1):!1},_intersectsWithSides:function(e){var i=t(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),n=t(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),r=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return this.floating&&o?"right"===o&&n||"left"===o&&!n:r&&("down"===r&&i||"up"===r&&!i)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){var i,n,r,o,s=[],a=[],l=this._connectWith();if(l&&t)for(i=l.length-1;i>=0;i--)for(r=e(l[i]),n=r.length-1;n>=0;n--)o=e.data(r[n],this.widgetFullName),o&&o!==this&&!o.options.disabled&&a.push([e.isFunction(o.options.items)?o.options.items.call(o.element):e(o.options.items,o.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),o]);for(a.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),i=a.length-1;i>=0;i--)a[i][0].each(function(){s.push(this)});return e(s)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var i=0;i<t.length;i++)if(t[i]===e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var i,n,r,o,s,a,l,c,d=this.items,h=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],u=this._connectWith();if(u&&this.ready)for(i=u.length-1;i>=0;i--)for(r=e(u[i]),n=r.length-1;n>=0;n--)o=e.data(r[n],this.widgetFullName),o&&o!==this&&!o.options.disabled&&(h.push([e.isFunction(o.options.items)?o.options.items.call(o.element[0],t,{item:this.currentItem}):e(o.options.items,o.element),o]),this.containers.push(o));for(i=h.length-1;i>=0;i--)for(s=h[i][1],a=h[i][0],n=0,c=a.length;c>n;n++)l=e(a[n]),l.data(this.widgetName+"-item",s),d.push({item:l,instance:s,width:0,height:0,left:0,top:0})},refreshPositions:function(t){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,n,r,o;for(i=this.items.length-1;i>=0;i--)n=this.items[i],n.instance!==this.currentContainer&&this.currentContainer&&n.item[0]!==this.currentItem[0]||(r=this.options.toleranceElement?e(this.options.toleranceElement,n.item):n.item,t||(n.width=r.outerWidth(),n.height=r.outerHeight()),o=r.offset(),n.left=o.left,n.top=o.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)o=this.containers[i].element.offset(),this.containers[i].containerCache.left=o.left,this.containers[i].containerCache.top=o.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(t){t=t||this;var i,n=t.options;n.placeholder&&n.placeholder.constructor!==String||(i=n.placeholder,n.placeholder={element:function(){var n=t.currentItem[0].nodeName.toLowerCase(),r=e("<"+n+">",t.document[0]).addClass(i||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===n?t.currentItem.children().each(function(){e("<td>&#160;</td>",t.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(r)}):"img"===n&&r.attr("src",t.currentItem.attr("src")),i||r.css("visibility","hidden"),r},update:function(e,r){(!i||n.forcePlaceholderSize)&&(r.height()||r.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),r.width()||r.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}),t.placeholder=e(n.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),n.placeholder.update(t,t.placeholder)},_contactContainers:function(n){var r,o,s,a,l,c,d,h,u,f,p=null,m=null;for(r=this.containers.length-1;r>=0;r--)if(!e.contains(this.currentItem[0],this.containers[r].element[0]))if(this._intersectsWith(this.containers[r].containerCache)){if(p&&e.contains(this.containers[r].element[0],p.element[0]))continue;p=this.containers[r],m=r}else this.containers[r].containerCache.over&&(this.containers[r]._trigger("out",n,this._uiHash(this)),this.containers[r].containerCache.over=0);if(p)if(1===this.containers.length)this.containers[m].containerCache.over||(this.containers[m]._trigger("over",n,this._uiHash(this)),this.containers[m].containerCache.over=1);else{for(s=1e4,a=null,f=p.floating||i(this.currentItem),l=f?"left":"top",c=f?"width":"height",d=this.positionAbs[l]+this.offset.click[l],o=this.items.length-1;o>=0;o--)e.contains(this.containers[m].element[0],this.items[o].item[0])&&this.items[o].item[0]!==this.currentItem[0]&&(!f||t(this.positionAbs.top+this.offset.click.top,this.items[o].top,this.items[o].height))&&(h=this.items[o].item.offset()[l],u=!1,Math.abs(h-d)>Math.abs(h+this.items[o][c]-d)&&(u=!0,h+=this.items[o][c]),Math.abs(h-d)<s&&(s=Math.abs(h-d),a=this.items[o],this.direction=u?"up":"down"));if(!a&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[m])return;a?this._rearrange(n,a,null,!0):this._rearrange(n,null,this.containers[m].element,!0),this._trigger("change",n,this._uiHash()),this.containers[m]._trigger("change",n,this._uiHash(this)),this.currentContainer=this.containers[m],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[m]._trigger("over",n,this._uiHash(this)),this.containers[m].containerCache.over=1}},_createHelper:function(t){var i=this.options,n=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return n.parents("body").length||e("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(n[0]),n[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!n[0].style.width||i.forceHelperSize)&&n.width(this.currentItem.width()),(!n[0].style.height||i.forceHelperSize)&&n.height(this.currentItem.height()),n},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,n,r=this.options;"parent"===r.containment&&(r.containment=this.helper[0].parentNode),("document"===r.containment||"window"===r.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e("document"===r.containment?document:window).width()-this.helperProportions.width-this.margins.left,(e("document"===r.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(r.containment)||(t=e(r.containment)[0],i=e(r.containment).offset(),n="hidden"!==e(t).css("overflow"),this.containment=[i.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,i.left+(n?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(n?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(t,i){i||(i=this.position);var n="absolute"===t?1:-1,r="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(r[0].tagName);return{top:i.top+this.offset.relative.top*n+this.offset.parent.top*n-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():o?0:r.scrollTop())*n,left:i.left+this.offset.relative.left*n+this.offset.parent.left*n-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():o?0:r.scrollLeft())*n}},_generatePosition:function(t){var i,n,r=this.options,o=t.pageX,s=t.pageY,a="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=/(html|body)/i.test(a[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(o=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(s=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(o=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(s=this.containment[3]+this.offset.click.top)),r.grid&&(i=this.originalPageY+Math.round((s-this.originalPageY)/r.grid[1])*r.grid[1],s=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-r.grid[1]:i+r.grid[1]:i,n=this.originalPageX+Math.round((o-this.originalPageX)/r.grid[0])*r.grid[0],o=this.containment?n-this.offset.click.left>=this.containment[0]&&n-this.offset.click.left<=this.containment[2]?n:n-this.offset.click.left>=this.containment[0]?n-r.grid[0]:n+r.grid[0]:n)),{top:s-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():l?0:a.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():l?0:a.scrollLeft())}},_rearrange:function(e,t,i,n){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var r=this.counter;this._delay(function(){r===this.counter&&this.refreshPositions(!n)})},_clear:function(e,t){this.reverting=!1;var i,n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(i in this._storedCSS)("auto"===this._storedCSS[i]||"static"===this._storedCSS[i])&&(this._storedCSS[i]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!t&&n.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||n.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(t||(n.push(function(e){this._trigger("remove",e,this._uiHash())}),n.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer)))),i=this.containers.length-1;i>=0;i--)t||n.push(function(e){return function(t){e._trigger("deactivate",t,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over&&(n.push(function(e){return function(t){e._trigger("out",t,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!t){for(this._trigger("beforeStop",e,this._uiHash()),i=0;i<n.length;i++)n[i].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!1}if(t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!t){for(i=0;i<n.length;i++)n[i].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var i=t||this;return{helper:i.helper,placeholder:i.placeholder||e([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:t?t.element:null}}})}(jQuery);var I18n=I18n||{};I18n.defaultLocale="en",I18n.locale=I18n.locale||null,I18n.lookup=function(e,t){var i=this.prepareOptions(I18n.translations),n=i[I18n.currentLocale()];if(t=this.prepareOptions(t),n){for("object"==typeof e&&(e=e.join(".")),t.scope&&(e=t.scope.toString()+"."+e),e=e.split(".");e.length>0;){var r=e.shift();if(n=n[r],!n)break}return n||null==t.defaultValue||void 0==t.defaultValue||(n=t.defaultValue),n}},I18n.prepareOptions=function(){for(var e,t={},i=arguments.length,n=0;i>n;n++)if(e=arguments[n])for(var r in e)(void 0==t[r]||null==t[r])&&(t[r]=e[r]);return t},I18n.interpolate=function(e,t){t=t||{};var i=/\{\{(.*?)\}\}/gm,n=e.match(i);if(!n)return e;for(var r,o,s,a=0;r=n[a];a++)s=r.replace(/\{\{(.*?)\}\}/gm,"$1"),o=t[s],(null==t[s]||void 0==t[s])&&(o="[missing "+r+" value]"),i=new RegExp(r.replace(/\{/gm,"\\{").replace(/\}/gm,"\\}")),e=e.replace(i,o);return e},I18n.translate=function(e,t){t=this.prepareOptions(t);var i=this.lookup(e,t);try{return"object"==typeof i?"number"==typeof t.count?this.pluralize(t.count,e,t):i:this.interpolate(i,t)}catch(n){return this.missingTranslation(e)}},I18n.localize=function(e,t){switch(e){case"currency":return this.toCurrency(t);case"number":return e=this.lookup("number.format"),this.toNumber(t,e);default:return e.match(/^(date|time)/)?this.toTime(e,t):t.toString()}},I18n.parseDate=function(e){var t,i;if(t=e.toString().match(/(\d{4})-(\d{2})-(\d{2})(?:[ |T](\d{2}):(\d{2}):(\d{2}))?(Z)?/)){for(var n=1;6>=n;n++)t[n]=void 0==t[n]?0:parseInt(t[n],10);t[2]=t[2]-1,i=t[7]?new Date(Date.UTC(t[1],t[2],t[3],t[4],t[5],t[6])):isNaN(t[4])?new Date(t[1],t[2],t[3]):new Date(t[1],t[2],t[3],t[4],t[5],t[6])}else"number"==typeof e?(i=new Date,i.setTime(e)):(i=new Date,i.setTime(Date.parse(e)));return i},I18n.toTime=function(e,t){var i=this.parseDate(t),n=this.lookup(e);return i.toString().match(/invalid/i)?i.toString():n?this.strftime(i,n):i.toString()},I18n.strftime=function(e,t){var i=this.lookup("date");if(!i)return e.toString();var n=e.getDay(),r=e.getDate(),o=e.getFullYear(),s=e.getMonth()+1,a=e.getHours(),l=a,c=a>12?"PM":"AM",d=e.getSeconds(),h=e.getMinutes(),u=e.getTimezoneOffset(),f=Math.floor(Math.abs(u/60)),p=Math.abs(u)-60*f,m=(u>0?"-":"+")+(f.toString().length<2?"0"+f:f)+(p.toString().length<2?"0"+p:p);l>12&&(l-=12);var g=function(e){var t="0"+e.toString();return t.substr(t.length-2)},v=t;return v=v.replace("%a",i.abbr_day_names[n]),v=v.replace("%A",i.day_names[n]),v=v.replace("%b",i.abbr_month_names[s]),v=v.replace("%B",i.month_names[s]),v=v.replace("%d",g(r)),v=v.replace("%-d",r),v=v.replace("%H",g(a)),v=v.replace("%-H",a),v=v.replace("%I",g(l)),v=v.replace("%-I",l),v=v.replace("%m",g(s)),v=v.replace("%-m",s),v=v.replace("%M",g(h)),v=v.replace("%-M",h),v=v.replace("%p",c),v=v.replace("%S",g(d)),v=v.replace("%-S",d),v=v.replace("%w",n),v=v.replace("%y",g(o)),v=v.replace("%-y",g(o).replace(/^0+/,"")),v=v.replace("%Y",o),v=v.replace("%z",m)},I18n.toNumber=function(e,t){t=this.prepareOptions(t,this.lookup("number.format"),{precision:3,separator:".",delimiter:","});var i=e.toFixed(t.precision).toString(),n=i.split(".");e=n[0],n[1];for(var r=[];e.length>0;)r.unshift(e.substr(Math.max(0,e.length-3),3)),e=e.substr(0,e.length-3);var o=r.join(t.delimiter);return t.precision>0&&(o+=t.separator+n[1]),o},I18n.toCurrency=function(e,t){return t=this.prepareOptions(t,this.lookup("number.currency.format"),this.lookup("number.format"),{unit:"$",precision:2,format:"%u%n",delimiter:",",separator:"."}),e=this.toNumber(e,t),e=t.format.replace("%u",t.unit).replace("%n",e)},I18n.toPercentage=function(e,t){return t=this.prepareOptions(t,this.lookup("number.percentage.format"),this.lookup("number.format"),{precision:3,separator:".",delimiter:""}),e=this.toNumber(e,t),e+"%"},I18n.pluralize=function(e,t,i){var n,r=this.lookup(t,i);switch(i=i||{},i.count=e.toString(),Math.abs(e)){case 0:n=r.zero||r.none||r.other||this.missingTranslation(t,"zero");break;case 1:n=r.one||this.missingTranslation(t,"one");break;default:n=r.other||this.missingTranslation(t,"other")}return this.interpolate(n,i)},I18n.missingTranslation=function(){for(var e='[missing "'+this.currentLocale(),t=arguments.length,i=0;t>i;i++)e+="."+arguments[i];return e+='" translation]'},I18n.currentLocale=function(){return I18n.locale||I18n.defaultLocale},I18n.t=I18n.translate,I18n.l=I18n.localize,I18n.p=I18n.pluralize,I18n.locale="en";var I18n=I18n||{};I18n.translations={},window.bootbox=window.bootbox||function e(t,i){"use strict";function n(e){var t=b[g.locale];return t?t[e]:b.en[e]}function r(e,i,n){e.preventDefault();var r=t.isFunction(n)&&n(e)===!1;r||i.modal("hide")}function o(e){var t,i=0;for(t in e)i++;return i}function s(e,i){var n=0;t.each(e,function(e,t){i(e,t,n++)})}function a(e){var i,n;if("object"!=typeof e)throw new Error("Please supply an object of options");if(!e.message)throw new Error("Please specify a message");return e=t.extend({},g,e),e.buttons||(e.buttons={}),e.backdrop=e.backdrop?"static":!1,i=e.buttons,n=o(i),s(i,function(e,r,o){if(t.isFunction(r)&&(r=i[e]={callback:r}),"object"!==t.type(r))throw new Error("button with key "+e+" must be an object");r.label||(r.label=e),r.className||(r.className=2>=n&&o===n-1?"btn-primary":"btn-default")}),e}function l(e,t){var i=e.length,n={};if(1>i||i>2)throw new Error("Invalid argument length");return 2===i||"string"==typeof e[0]?(n[t[0]]=e[0],n[t[1]]=e[1]):n=e[0],n}function c(e,i,n){return t.extend(!0,{},e,l(i,n))}function d(e,t,i){return f(c(u.apply(null,e),t,i),e)}function h(){for(var e={},t=0,i=arguments.length;i>t;t++){var r=arguments[t],o=r.toLowerCase(),s=r.toUpperCase();e[o]={label:n(s)}}return e}function u(){return{buttons:h.apply(null,arguments)}}function f(e,t){var n={};return s(t,function(e,t){n[t]=!0}),s(e.buttons,function(e){if(n[e]===i)throw new Error("button key "+e+" is not allowed (options are "+t.join("\n")+")")}),e}var p={dialog:"<div class='bootbox modal' tabindex='-1' role='dialog'><div class='modal-dialog'><div class='modal-content'><div class='modal-body'><div class='bootbox-body'></div></div></div></div></div>",header:"<div class='modal-header'><h4 class='modal-title'></h4></div>",footer:"<div class='modal-footer'></div>",closeButton:"<button type='button' class='bootbox-close-button close'>&times;</button>",form:"<form class='bootbox-form'></form>",inputs:{text:"<input class='bootbox-input form-control' autocomplete=off type=text />"}},m=t("body"),g={locale:"en",backdrop:!0,animate:!0,className:null,closeButton:!0,show:!0},v={};v.alert=function(){var e;if(e=d(["ok"],arguments,["message","callback"]),e.callback&&!t.isFunction(e.callback))throw new Error("alert requires callback property to be a function when provided");return e.buttons.ok.callback=e.onEscape=function(){return t.isFunction(e.callback)?e.callback():!0},v.dialog(e)},v.confirm=function(){var e;if(e=d(["cancel","confirm"],arguments,["message","callback"]),e.buttons.cancel.callback=e.onEscape=function(){return e.callback(!1)},e.buttons.confirm.callback=function(){return e.callback(!0)},!t.isFunction(e.callback))throw new Error("confirm requires a callback");return v.dialog(e)},v.prompt=function(){var e,n,r,o,s,a;if(o=t(p.form),n={buttons:h("cancel","confirm"),value:""},e=f(c(n,arguments,["title","callback"]),["cancel","confirm"]),a=e.show===i?!0:e.show,e.message=o,e.buttons.cancel.callback=e.onEscape=function(){return e.callback(null)},e.buttons.confirm.callback=function(){return e.callback(s.val())},e.show=!1,!e.title)throw new Error("prompt requires a title");if(!t.isFunction(e.callback))throw new Error("prompt requires a callback");return s=t(p.inputs.text),s.val(e.value),e.placeholder&&s.attr("placeholder",e.placeholder),o.append(s),o.on("submit",function(e){e.preventDefault(),r.find(".btn-primary").click()}),r=v.dialog(e),r.off("shown.bs.modal"),r.on("shown.bs.modal",function(){s.focus()}),a===!0&&r.modal("show"),r},v.dialog=function(e){e=a(e);var i=t(p.dialog),n=i.find(".modal-body"),o=e.buttons,l="",c={onEscape:e.onEscape};if(s(o,function(e,t){l+="<button data-bb-handler='"+e+"' type='button' class='btn "+t.className+"'>"+t.label+"</button>",c[e]=t.callback}),n.find(".bootbox-body").html(e.message),e.animate===!0&&i.addClass("fade"),e.className&&i.addClass(e.className),e.title&&n.before(p.header),e.closeButton){var d=t(p.closeButton);e.title?i.find(".modal-header").prepend(d):d.css("margin-top","-10px").prependTo(n)}return e.title&&i.find(".modal-title").html(e.title),l.length&&(n.after(p.footer),i.find(".modal-footer").html(l)),i.on("hidden.bs.modal",function(e){e.target===this&&i.remove()}),i.on("shown.bs.modal",function(){i.find(".btn-primary:first").focus()}),i.on("escape.close.bb",function(e){c.onEscape&&r(e,i,c.onEscape)}),i.on("click",".modal-footer button",function(e){var n=t(this).data("bb-handler");r(e,i,c[n])}),i.on("click",".bootbox-close-button",function(e){r(e,i,c.onEscape)}),i.on("keyup",function(e){27===e.which&&i.trigger("escape.close.bb")}),m.append(i),i.modal({backdrop:e.backdrop,keyboard:!1,show:!1}),e.show&&i.modal("show"),i},v.setDefaults=function(e){t.extend(g,e)},v.hideAll=function(){t(".bootbox").modal("hide")};var b={br:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Sim"},da:{OK:"OK",CANCEL:"Annuller",CONFIRM:"Accepter"},de:{OK:"OK",CANCEL:"Abbrechen",CONFIRM:"Akzeptieren"},en:{OK:"OK",CANCEL:"Cancel",CONFIRM:"OK"},es:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Aceptar"},fi:{OK:"OK",CANCEL:"Peruuta",CONFIRM:"OK"},fr:{OK:"OK",CANCEL:"Annuler",CONFIRM:"D'accord"},it:{OK:"OK",CANCEL:"Annulla",CONFIRM:"Conferma"},nl:{OK:"OK",CANCEL:"Annuleren",CONFIRM:"Accepteren"},no:{OK:"OK",CANCEL:"Avbryt",CONFIRM:"OK"},pl:{OK:"OK",CANCEL:"Anuluj",CONFIRM:"Potwierdź"},ru:{OK:"OK",CANCEL:"Отмена",CONFIRM:"Применить"},zh_CN:{OK:"OK",CANCEL:"取消",CONFIRM:"确认"},zh_TW:{OK:"OK",CANCEL:"取消",CONFIRM:"確認"}};
return v.init=function(i){window.bootbox=e(i||t)},v}(window.jQuery);/**
 * @license wysihtml5 v0.3.0
 * https://github.com/xing/wysihtml5
 *
 * Author: Christopher Blum (https://github.com/tiff)
 *
 * Copyright (C) 2012 XING AG
 * Licensed under the MIT license (MIT)
 *
 */
var wysihtml5={version:"0.3.0",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},INVISIBLE_SPACE:"﻿",EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,DELETE_KEY:46};/**
 * @license Rangy, a cross-browser JavaScript range and selection library
 * http://code.google.com/p/rangy/
 *
 * Copyright 2011, Tim Down
 * Licensed under the MIT license.
 * Version: 1.2.2
 * Build date: 13 November 2011
 */
window.rangy=function(){function e(e,t){var i=typeof e[t];return i==h||!(i!=d||!e[t])||"unknown"==i}function t(e,t){return!(typeof e[t]!=d||!e[t])}function i(e,t){return typeof e[t]!=u}function n(e){return function(t,i){for(var n=i.length;n--;)if(!e(t,i[n]))return!1;return!0}}function r(e){return e&&v(e,g)&&y(e,m)}function o(e){window.alert("Rangy not supported in your browser. Reason: "+e),w.initialized=!0,w.supported=!1}function s(e){var t="Rangy warning: "+e;w.config.alertOnWarn?window.alert(t):typeof window.console!=u&&typeof window.console.log!=u&&window.console.log(t)}function a(){if(!w.initialized){var i,n=!1,s=!1;e(document,"createRange")&&(i=document.createRange(),v(i,p)&&y(i,f)&&(n=!0),i.detach());var a=t(document,"body")?document.body:document.getElementsByTagName("body")[0];a&&e(a,"createTextRange")&&(i=a.createTextRange(),r(i)&&(s=!0)),n||s||o("Neither Range nor TextRange are implemented"),w.initialized=!0,w.features={implementsDomRange:n,implementsTextRange:s};for(var l=x.concat(_),c=0,d=l.length;d>c;++c)try{l[c](w)}catch(h){t(window,"console")&&e(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",h)}}}function l(e){e=e||window,a();for(var t=0,i=C.length;i>t;++t)C[t](e)}function c(e){this.name=e,this.initialized=!1,this.supported=!1}var d="object",h="function",u="undefined",f=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"],p=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],m=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],g=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"],v=n(e),b=n(t),y=n(i),w={version:"1.2.2",initialized:!1,supported:!0,util:{isHostMethod:e,isHostObject:t,isHostProperty:i,areHostMethods:v,areHostObjects:b,areHostProperties:y,isTextRange:r},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};w.fail=o,w.warn=s,{}.hasOwnProperty?w.util.extend=function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])}:o("hasOwnProperty not supported");var _=[],x=[];w.init=a,w.addInitListener=function(e){w.initialized?e(w):_.push(e)};var C=[];w.addCreateMissingNativeApiListener=function(e){C.push(e)},w.createMissingNativeApi=l,c.prototype.fail=function(e){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+e)},c.prototype.warn=function(e){w.warn("Module "+this.name+": "+e)},c.prototype.createError=function(e){return new Error("Error in Rangy "+this.name+" module: "+e)},w.createModule=function(e,t){var i=new c(e);w.modules[e]=i,x.push(function(e){t(e,i),i.initialized=!0,i.supported=!0})},w.requireModules=function(e){for(var t,i,n=0,r=e.length;r>n;++n){if(i=e[n],t=w.modules[i],!(t&&t instanceof c))throw new Error("Module '"+i+"' not found");if(!t.supported)throw new Error("Module '"+i+"' not supported")}};var S=!1,k=function(){S||(S=!0,w.initialized||a())};return typeof window==u?(o("No window found"),void 0):typeof document==u?(o("No document found"),void 0):(e(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",k,!1),e(window,"addEventListener")?window.addEventListener("load",k,!1):e(window,"attachEvent")?window.attachEvent("onload",k):o("Window does not have required addEventListener or attachEvent method"),w)}(),rangy.createModule("DomUtil",function(e,t){function i(e){var t;return typeof e.namespaceURI==k||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t}function n(e){var t=e.parentNode;return 1==t.nodeType?t:null}function r(e){for(var t=0;e=e.previousSibling;)t++;return t}function o(e){var t;return c(e)?e.length:(t=e.childNodes)?t.length:0}function s(e,t){var i,n=[];for(i=e;i;i=i.parentNode)n.push(i);for(i=t;i;i=i.parentNode)if(L(n,i))return i;return null}function a(e,t,i){for(var n=i?t:t.parentNode;n;){if(n===e)return!0;n=n.parentNode}return!1}function l(e,t,i){for(var n,r=i?e:e.parentNode;r;){if(n=r.parentNode,n===t)return r;r=n}return null}function c(e){var t=e.nodeType;return 3==t||4==t||8==t}function d(e,t){var i=t.nextSibling,n=t.parentNode;return i?n.insertBefore(e,i):n.appendChild(e),e}function h(e,t){var i=e.cloneNode(!1);return i.deleteData(0,t),e.deleteData(t,e.length-t),d(i,e),i}function u(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=k)return e.ownerDocument;if(typeof e.document!=k)return e.document;if(e.parentNode)return u(e.parentNode);throw new Error("getDocument: no document found for node")}function f(e){var t=u(e);if(typeof t.defaultView!=k)return t.defaultView;if(typeof t.parentWindow!=k)return t.parentWindow;throw new Error("Cannot get a window object for node")}function p(e){if(typeof e.contentDocument!=k)return e.contentDocument;if(typeof e.contentWindow!=k)return e.contentWindow.document;throw new Error("getIframeWindow: No Document object found for iframe element")}function m(e){if(typeof e.contentWindow!=k)return e.contentWindow;if(typeof e.contentDocument!=k)return e.contentDocument.defaultView;throw new Error("getIframeWindow: No Window object found for iframe element")}function g(e){return T.isHostObject(e,"body")?e.body:e.getElementsByTagName("body")[0]}function v(e){for(var t;t=e.parentNode;)e=t;return e}function b(e,t,i,n){var o,a,c,d,h;if(e==i)return t===n?0:n>t?-1:1;if(o=l(i,e,!0))return t<=r(o)?-1:1;if(o=l(e,i,!0))return r(o)<n?-1:1;if(a=s(e,i),c=e===a?a:l(e,a,!0),d=i===a?a:l(i,a,!0),c===d)throw new Error("comparePoints got to case 4 and childA and childB are the same!");for(h=a.firstChild;h;){if(h===c)return-1;if(h===d)return 1;h=h.nextSibling}throw new Error("Should not be here!")}function y(e){for(var t,i=u(e).createDocumentFragment();t=e.firstChild;)i.appendChild(t);return i}function w(e){if(!e)return"[No node]";if(c(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">["+e.childNodes.length+"]"}return e.nodeName}function _(e){this.root=e,this._next=e}function x(e){return new _(e)}function C(e,t){this.node=e,this.offset=t}function S(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var k="undefined",T=e.util;T.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),T.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var E=document.createElement("div");T.areHostMethods(E,["insertBefore","appendChild","cloneNode"]||!T.areHostObjects(E,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),T.isHostProperty(E,"innerHTML")||t.fail("Element is missing innerHTML property");var N=document.createTextNode("test");T.areHostMethods(N,["splitText","deleteData","insertData","appendData","cloneNode"]||!T.areHostObjects(E,["previousSibling","nextSibling","childNodes","parentNode"])||!T.areHostProperties(N,["data"]))||t.fail("Incomplete Text Node implementation");var L=function(e,t){for(var i=e.length;i--;)if(e[i]===t)return!0;return!1};_.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,i=this._current=this._next;if(this._current)if(e=i.firstChild)this._next=e;else{for(t=null;i!==this.root&&!(t=i.nextSibling);)i=i.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},C.prototype={equals:function(e){return this.node===e.node&this.offset==e.offset},inspect:function(){return"[DomPosition("+w(this.node)+":"+this.offset+")]"}},S.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},S.prototype.toString=function(){return this.message},e.dom={arrayContains:L,isHtmlNamespace:i,parentElement:n,getNodeIndex:r,getNodeLength:o,getCommonAncestor:s,isAncestorOf:a,getClosestAncestorIn:l,isCharacterDataNode:c,insertAfter:d,splitDataNode:h,getDocument:u,getWindow:f,getIframeWindow:m,getIframeDocument:p,getBody:g,getRootContainer:v,comparePoints:b,inspectNode:w,fragmentFromNodeChildren:y,createIterator:x,DomPosition:C},e.DOMException=S}),rangy.createModule("DomRange",function(e){function t(e,t){return 3!=e.nodeType&&(M.isAncestorOf(e,t.startContainer,!0)||M.isAncestorOf(e,t.endContainer,!0))}function i(e){return M.getDocument(e.startContainer)}function n(e,t,i){var n=e._listeners[t];if(n)for(var r=0,o=n.length;o>r;++r)n[r].call(e,{target:e,args:i})}function r(e){return new H(e.parentNode,M.getNodeIndex(e))}function o(e){return new H(e.parentNode,M.getNodeIndex(e)+1)}function s(e,t,i){var n=11==e.nodeType?e.firstChild:e;return M.isCharacterDataNode(t)?i==t.length?M.insertAfter(e,t):t.parentNode.insertBefore(e,0==i?t:M.splitDataNode(t,i)):i>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[i]),n}function a(e){for(var t,n,r,o=i(e.range).createDocumentFragment();n=e.next();){if(t=e.isPartiallySelectedSubtree(),n=n.cloneNode(!t),t&&(r=e.getSubtreeIterator(),n.appendChild(a(r)),r.detach(!0)),10==n.nodeType)throw new $("HIERARCHY_REQUEST_ERR");o.appendChild(n)}return o}function l(e,t,i){var n,r;i=i||{stop:!1};for(var o,s;o=e.next();)if(e.isPartiallySelectedSubtree()){if(t(o)===!1)return i.stop=!0,void 0;if(s=e.getSubtreeIterator(),l(s,t,i),s.detach(!0),i.stop)return}else for(n=M.createIterator(o);r=n.next();)if(t(r)===!1)return i.stop=!0,void 0}function c(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),c(t),t.detach(!0)):e.remove()}function d(e){for(var t,n,r=i(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),n=e.getSubtreeIterator(),t.appendChild(d(n)),n.detach(!0)):e.remove(),10==t.nodeType)throw new $("HIERARCHY_REQUEST_ERR");r.appendChild(t)}return r}function h(e,t,i){var n,r=!(!t||!t.length),o=!!i;r&&(n=new RegExp("^("+t.join("|")+")$"));var s=[];return l(new f(e,!1),function(e){r&&!n.test(e.nodeType)||o&&!i(e)||s.push(e)}),s}function u(e){var t="undefined"==typeof e.getName?"Range":e.getName();return"["+t+"("+M.inspectNode(e.startContainer)+":"+e.startOffset+", "+M.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function f(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var i=e.commonAncestorContainer;this.sc===this.ec&&M.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==i||M.isCharacterDataNode(this.sc)?M.getClosestAncestorIn(this.sc,i,!0):this.sc.childNodes[this.so],this._last=this.ec!==i||M.isCharacterDataNode(this.ec)?M.getClosestAncestorIn(this.ec,i,!0):this.ec.childNodes[this.eo-1])}}function p(e){this.code=this[e],this.codeName=e,this.message="RangeException: "+this.codeName}function m(e,t,i){this.nodes=h(e,t,i),this._next=this.nodes[0],this._position=0}function g(e){return function(t,i){for(var n,r=i?t:t.parentNode;r;){if(n=r.nodeType,M.arrayContains(e,n))return r;r=r.parentNode}return null}}function v(e,t){if(K(e,t))throw new p("INVALID_NODE_TYPE_ERR")}function b(e){if(!e.startContainer)throw new $("INVALID_STATE_ERR")}function y(e,t){if(!M.arrayContains(t,e.nodeType))throw new p("INVALID_NODE_TYPE_ERR")}function w(e,t){if(0>t||t>(M.isCharacterDataNode(e)?e.length:e.childNodes.length))throw new $("INDEX_SIZE_ERR")}function _(e,t){if(q(e,!0)!==q(t,!0))throw new $("WRONG_DOCUMENT_ERR")}function x(e){if(V(e,!0))throw new $("NO_MODIFICATION_ALLOWED_ERR")}function C(e,t){if(!e)throw new $(t)}function S(e){return!M.arrayContains(W,e.nodeType)&&!q(e,!0)}function k(e,t){return t<=(M.isCharacterDataNode(e)?e.length:e.childNodes.length)}function T(e){if(b(e),S(e.startContainer)||S(e.endContainer)||!k(e.startContainer,e.startOffset)||!k(e.endContainer,e.endOffset))throw new Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}function E(){}function N(e){e.START_TO_START=J,e.START_TO_END=et,e.END_TO_END=tt,e.END_TO_START=it,e.NODE_BEFORE=nt,e.NODE_AFTER=rt,e.NODE_BEFORE_AND_AFTER=ot,e.NODE_INSIDE=st}function L(e){N(e),N(e.prototype)}function R(e,t){return function(){T(this);var i,n,r=this.startContainer,s=this.startOffset,a=this.commonAncestorContainer,c=new f(this,!0);r!==a&&(i=M.getClosestAncestorIn(r,a,!0),n=o(i),r=n.node,s=n.offset),l(c,x),c.reset();var d=e(c);return c.detach(),t(this,r,s,r,s),d}}function A(i,n,s){function a(e,t){return function(i){b(this),y(i,z),y(U(i),W);var n=(e?r:o)(i);(t?l:h)(this,n.node,n.offset)}}function l(e,t,i){var r=e.endContainer,o=e.endOffset;(t!==e.startContainer||i!==e.startOffset)&&((U(t)!=U(r)||1==M.comparePoints(t,i,r,o))&&(r=t,o=i),n(e,t,i,r,o))}function h(e,t,i){var r=e.startContainer,o=e.startOffset;(t!==e.endContainer||i!==e.endOffset)&&((U(t)!=U(r)||-1==M.comparePoints(t,i,r,o))&&(r=t,o=i),n(e,r,o,t,i))}function u(e,t,i){(t!==e.startContainer||i!==e.startOffset||t!==e.endContainer||i!==e.endOffset)&&n(e,t,i,t,i)}i.prototype=new E,e.util.extend(i.prototype,{setStart:function(e,t){b(this),v(e,!0),w(e,t),l(this,e,t)},setEnd:function(e,t){b(this),v(e,!0),w(e,t),h(this,e,t)},setStartBefore:a(!0,!0),setStartAfter:a(!1,!0),setEndBefore:a(!0,!1),setEndAfter:a(!1,!1),collapse:function(e){T(this),e?n(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):n(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){b(this),v(e,!0),n(this,e,0,e,M.getNodeLength(e))},selectNode:function(e){b(this),v(e,!1),y(e,z);var t=r(e),i=o(e);n(this,t.node,t.offset,i.node,i.offset)},extractContents:R(d,n),deleteContents:R(c,n),canSurroundContents:function(){T(this),x(this.startContainer),x(this.endContainer);var e=new f(this,!0),i=e._first&&t(e._first,this)||e._last&&t(e._last,this);return e.detach(),!i},detach:function(){s(this)},splitBoundaries:function(){T(this);var e=this.startContainer,t=this.startOffset,i=this.endContainer,r=this.endOffset,o=e===i;M.isCharacterDataNode(i)&&r>0&&r<i.length&&M.splitDataNode(i,r),M.isCharacterDataNode(e)&&t>0&&t<e.length&&(e=M.splitDataNode(e,t),o?(r-=t,i=e):i==e.parentNode&&r>=M.getNodeIndex(e)&&r++,t=0),n(this,e,t,i,r)},normalizeBoundaries:function(){T(this);var e=this.startContainer,t=this.startOffset,i=this.endContainer,r=this.endOffset,o=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(i=e,r=e.length,e.appendData(t.data),t.parentNode.removeChild(t))},s=function(n){var o=n.previousSibling;if(o&&o.nodeType==n.nodeType){e=n;var s=n.length;if(t=o.length,n.insertData(0,o.data),o.parentNode.removeChild(o),e==i)r+=t,i=e;else if(i==n.parentNode){var a=M.getNodeIndex(n);r==a?(i=n,r=s):r>a&&r--}}},a=!0;if(M.isCharacterDataNode(i))i.length==r&&o(i);else{if(r>0){var l=i.childNodes[r-1];l&&M.isCharacterDataNode(l)&&o(l)}a=!this.collapsed}if(a){if(M.isCharacterDataNode(e))0==t&&s(e);else if(t<e.childNodes.length){var c=e.childNodes[t];c&&M.isCharacterDataNode(c)&&s(c)}}else e=i,t=r;n(this,e,t,i,r)},collapseToPoint:function(e,t){b(this),v(e,!0),w(e,t),u(this,e,t)}}),L(i)}function I(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:M.getCommonAncestor(e.startContainer,e.endContainer)}function D(e,t,i,r,o){var s=e.startContainer!==t||e.startOffset!==i,a=e.endContainer!==r||e.endOffset!==o;e.startContainer=t,e.startOffset=i,e.endContainer=r,e.endOffset=o,I(e),n(e,"boundarychange",{startMoved:s,endMoved:a})}function O(e){b(e),e.startContainer=e.startOffset=e.endContainer=e.endOffset=null,e.collapsed=e.commonAncestorContainer=null,n(e,"detach",null),e._listeners=null}function P(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this._listeners={boundarychange:[],detach:[]},I(this)}e.requireModules(["DomUtil"]);var M=e.dom,H=M.DomPosition,$=e.DOMException;f.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,M.isCharacterDataNode(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,i=this._current;!M.isCharacterDataNode(i)||i!==this.sc&&i!==this.ec?i.parentNode&&i.parentNode.removeChild(i):(e=i===this.sc?this.so:0,t=i===this.ec?this.eo:i.length,e!=t&&i.deleteData(e,t-e))},isPartiallySelectedSubtree:function(){var e=this._current;return t(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse();else{e=new P(i(this.range));var t=this._current,n=t,r=0,o=t,s=M.getNodeLength(t);M.isAncestorOf(t,this.sc,!0)&&(n=this.sc,r=this.so),M.isAncestorOf(t,this.ec,!0)&&(o=this.ec,s=this.eo),D(e,n,r,o,s)}return new f(e,this.clonePartiallySelectedTextNodes)},detach:function(e){e&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},p.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},p.prototype.toString=function(){return this.message},m.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){return this._current=this._next,this._next=this.nodes[++this._position],this._current},detach:function(){this._current=this._next=this.nodes=null}};var z=[1,3,4,5,7,8,10],W=[2,9,11],B=[5,6,10,12],j=[1,3,4,5,7,8,10,11],F=[1,3,4,5,7,8],U=M.getRootContainer,q=g([9,11]),V=g(B),K=g([6,10,12]),Q=document.createElement("style"),X=!1;try{Q.innerHTML="<b>x</b>",X=3==Q.firstChild.nodeType}catch(G){}e.features.htmlParsingConforms=X;var Y=X?function(e){var t=this.startContainer,i=M.getDocument(t);if(!t)throw new $("INVALID_STATE_ERR");var n=null;return 1==t.nodeType?n=t:M.isCharacterDataNode(t)&&(n=M.parentElement(t)),n=null===n||"HTML"==n.nodeName&&M.isHtmlNamespace(M.getDocument(n).documentElement)&&M.isHtmlNamespace(n)?i.createElement("body"):n.cloneNode(!1),n.innerHTML=e,M.fragmentFromNodeChildren(n)}:function(e){b(this);var t=i(this),n=t.createElement("body");return n.innerHTML=e,M.fragmentFromNodeChildren(n)},Z=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],J=0,et=1,tt=2,it=3,nt=0,rt=1,ot=2,st=3;E.prototype={attachListener:function(e,t){this._listeners[e].push(t)},compareBoundaryPoints:function(e,t){T(this),_(this.startContainer,t.startContainer);var i,n,r,o,s=e==it||e==J?"start":"end",a=e==et||e==J?"start":"end";return i=this[s+"Container"],n=this[s+"Offset"],r=t[a+"Container"],o=t[a+"Offset"],M.comparePoints(i,n,r,o)},insertNode:function(e){if(T(this),y(e,j),x(this.startContainer),M.isAncestorOf(e,this.startContainer,!0))throw new $("HIERARCHY_REQUEST_ERR");var t=s(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){T(this);var e,t;if(this.collapsed)return i(this).createDocumentFragment();if(this.startContainer===this.endContainer&&M.isCharacterDataNode(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=i(this).createDocumentFragment(),t.appendChild(e),t;var n=new f(this,!0);return e=a(n),n.detach(),e},canSurroundContents:function(){T(this),x(this.startContainer),x(this.endContainer);var e=new f(this,!0),i=e._first&&t(e._first,this)||e._last&&t(e._last,this);return e.detach(),!i},surroundContents:function(e){if(y(e,F),!this.canSurroundContents())throw new p("BAD_BOUNDARYPOINTS_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);s(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){T(this);for(var e,t=new P(i(this)),n=Z.length;n--;)e=Z[n],t[e]=this[e];return t},toString:function(){T(this);var e=this.startContainer;if(e===this.endContainer&&M.isCharacterDataNode(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],i=new f(this,!0);return l(i,function(e){(3==e.nodeType||4==e.nodeType)&&t.push(e.data)}),i.detach(),t.join("")},compareNode:function(e){T(this);var t=e.parentNode,i=M.getNodeIndex(e);if(!t)throw new $("NOT_FOUND_ERR");var n=this.comparePoint(t,i),r=this.comparePoint(t,i+1);return 0>n?r>0?ot:nt:r>0?rt:st},comparePoint:function(e,t){return T(this),C(e,"HIERARCHY_REQUEST_ERR"),_(e,this.startContainer),M.comparePoints(e,t,this.startContainer,this.startOffset)<0?-1:M.comparePoints(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:Y,toHtml:function(){T(this);var e=i(this).createElement("div");return e.appendChild(this.cloneContents()),e.innerHTML},intersectsNode:function(e,t){if(T(this),C(e,"NOT_FOUND_ERR"),M.getDocument(e)!==i(this))return!1;var n=e.parentNode,r=M.getNodeIndex(e);C(n,"NOT_FOUND_ERR");var o=M.comparePoints(n,r,this.endContainer,this.endOffset),s=M.comparePoints(n,r+1,this.startContainer,this.startOffset);return t?0>=o&&s>=0:0>o&&s>0},isPointInRange:function(e,t){return T(this),C(e,"HIERARCHY_REQUEST_ERR"),_(e,this.startContainer),M.comparePoints(e,t,this.startContainer,this.startOffset)>=0&&M.comparePoints(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e,t){if(T(this),i(e)!=i(this))throw new $("WRONG_DOCUMENT_ERR");var n=M.comparePoints(this.startContainer,this.startOffset,e.endContainer,e.endOffset),r=M.comparePoints(this.endContainer,this.endOffset,e.startContainer,e.startOffset);return t?0>=n&&r>=0:0>n&&r>0},intersection:function(e){if(this.intersectsRange(e)){var t=M.comparePoints(this.startContainer,this.startOffset,e.startContainer,e.startOffset),i=M.comparePoints(this.endContainer,this.endOffset,e.endContainer,e.endOffset),n=this.cloneRange();return-1==t&&n.setStart(e.startContainer,e.startOffset),1==i&&n.setEnd(e.endContainer,e.endOffset),n}return null},union:function(e){if(this.intersectsRange(e,!0)){var t=this.cloneRange();return-1==M.comparePoints(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==M.comparePoints(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new p("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==st},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,M.getNodeLength(e))<=0},containsRange:function(e){return this.intersection(e).equals(e)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var i=t.getNodes([3]);if(i.length>0){t.setStart(i[0],0);var n=i.pop();t.setEnd(n,n.length);var r=this.containsRange(t);return t.detach(),r}return this.containsNodeContents(e)},createNodeIterator:function(e,t){return T(this),new m(this,e,t)},getNodes:function(e,t){return T(this),h(this,e,t)},getDocument:function(){return i(this)},collapseBefore:function(e){b(this),this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){b(this),this.setStartAfter(e),this.collapse(!0)},getName:function(){return"DomRange"},equals:function(e){return P.rangesEqual(this,e)},inspect:function(){return u(this)}},A(P,D,O),e.rangePrototype=E.prototype,P.rangeProperties=Z,P.RangeIterator=f,P.copyComparisonConstants=L,P.createPrototypeRange=A,P.inspect=u,P.getRangeDocument=i,P.rangesEqual=function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset},e.DomRange=P,e.RangeException=p}),rangy.createModule("WrappedRange",function(e){function t(e){var t=e.parentElement(),i=e.duplicate();i.collapse(!0);var n=i.parentElement();i=e.duplicate(),i.collapse(!1);var r=i.parentElement(),o=n==r?n:s.getCommonAncestor(n,r);return o==t?o:s.getCommonAncestor(t,o)}function i(e){return 0==e.compareEndPoints("StartToEnd",e)}function n(e,t,i,n){var r=e.duplicate();r.collapse(i);var o=r.parentElement();if(s.isAncestorOf(t,o,!0)||(o=t),!o.canHaveHTML)return new a(o.parentNode,s.getNodeIndex(o));var l,c,d,h,u,f=s.getDocument(o).createElement("span"),p=i?"StartToStart":"StartToEnd";do o.insertBefore(f,f.previousSibling),r.moveToElementText(f);while((l=r.compareEndPoints(p,e))>0&&f.previousSibling);if(u=f.nextSibling,-1==l&&u&&s.isCharacterDataNode(u)){r.setEndPoint(i?"EndToStart":"EndToEnd",e);var m;if(/[\r\n]/.test(u.data)){var g=r.duplicate(),v=g.text.replace(/\r\n/g,"\r").length;for(m=g.moveStart("character",v);-1==(l=g.compareEndPoints("StartToEnd",g));)m++,g.moveStart("character",1)}else m=r.text.length;h=new a(u,m)}else c=(n||!i)&&f.previousSibling,d=(n||i)&&f.nextSibling,h=d&&s.isCharacterDataNode(d)?new a(d,0):c&&s.isCharacterDataNode(c)?new a(c,c.length):new a(o,s.getNodeIndex(f));return f.parentNode.removeChild(f),h}function r(e,t){var i,n,r,o,a=e.offset,l=s.getDocument(e.node),c=l.body.createTextRange(),d=s.isCharacterDataNode(e.node);return d?(i=e.node,n=i.parentNode):(o=e.node.childNodes,i=a<o.length?o[a]:null,n=e.node),r=l.createElement("span"),r.innerHTML="&#feff;",i?n.insertBefore(r,i):n.appendChild(r),c.moveToElementText(r),c.collapse(!t),n.removeChild(r),d&&c[t?"moveStart":"moveEnd"]("character",a),c}e.requireModules(["DomUtil","DomRange"]);var o,s=e.dom,a=s.DomPosition,l=e.DomRange;if(!e.features.implementsDomRange||e.features.implementsTextRange&&e.config.preferTextRange){if(e.features.implementsTextRange){o=function(e){this.textRange=e,this.refresh()},o.prototype=new l(document),o.prototype.refresh=function(){var e,r,o=t(this.textRange);i(this.textRange)?r=e=n(this.textRange,o,!0,!0):(e=n(this.textRange,o,!0,!1),r=n(this.textRange,o,!1,!1)),this.setStart(e.node,e.offset),this.setEnd(r.node,r.offset)},l.copyComparisonConstants(o);var c=function(){return this}();"undefined"==typeof c.Range&&(c.Range=o),e.createNativeRange=function(e){return e=e||document,e.body.createTextRange()}}}else!function(){function t(e){for(var t,i=d.length;i--;)t=d[i],e[t]=e.nativeRange[t]}function i(e,t,i,n,r){var o=e.startContainer!==t||e.startOffset!=i,s=e.endContainer!==n||e.endOffset!=r;(o||s)&&(e.setEnd(n,r),e.setStart(t,i))}function n(e){e.nativeRange.detach(),e.detached=!0;for(var t,i=d.length;i--;)t=d[i],e[t]=null}var r,a,c,d=l.rangeProperties;o=function(e){if(!e)throw new Error("Range must be specified");this.nativeRange=e,t(this)},l.createPrototypeRange(o,i,n),r=o.prototype,r.selectNode=function(e){this.nativeRange.selectNode(e),t(this)},r.deleteContents=function(){this.nativeRange.deleteContents(),t(this)},r.extractContents=function(){var e=this.nativeRange.extractContents();return t(this),e},r.cloneContents=function(){return this.nativeRange.cloneContents()},r.surroundContents=function(e){this.nativeRange.surroundContents(e),t(this)},r.collapse=function(e){this.nativeRange.collapse(e),t(this)},r.cloneRange=function(){return new o(this.nativeRange.cloneRange())},r.refresh=function(){t(this)},r.toString=function(){return this.nativeRange.toString()};var h=document.createTextNode("test");s.getBody(document).appendChild(h);var u=document.createRange();u.setStart(h,0),u.setEnd(h,0);try{u.setStart(h,1),a=!0,r.setStart=function(e,i){this.nativeRange.setStart(e,i),t(this)},r.setEnd=function(e,i){this.nativeRange.setEnd(e,i),t(this)},c=function(e){return function(i){this.nativeRange[e](i),t(this)}}}catch(f){a=!1,r.setStart=function(e,i){try{this.nativeRange.setStart(e,i)}catch(n){this.nativeRange.setEnd(e,i),this.nativeRange.setStart(e,i)}t(this)},r.setEnd=function(e,i){try{this.nativeRange.setEnd(e,i)}catch(n){this.nativeRange.setStart(e,i),this.nativeRange.setEnd(e,i)}t(this)},c=function(e,i){return function(n){try{this.nativeRange[e](n)}catch(r){this.nativeRange[i](n),this.nativeRange[e](n)}t(this)}}}r.setStartBefore=c("setStartBefore","setEndBefore"),r.setStartAfter=c("setStartAfter","setEndAfter"),r.setEndBefore=c("setEndBefore","setStartBefore"),r.setEndAfter=c("setEndAfter","setStartAfter"),u.selectNodeContents(h),r.selectNodeContents=u.startContainer==h&&u.endContainer==h&&0==u.startOffset&&u.endOffset==h.length?function(e){this.nativeRange.selectNodeContents(e),t(this)}:function(e){this.setStart(e,0),this.setEnd(e,l.getEndOffset(e))},u.selectNodeContents(h),u.setEnd(h,3);var p=document.createRange();p.selectNodeContents(h),p.setEnd(h,4),p.setStart(h,2),r.compareBoundaryPoints=-1==u.compareBoundaryPoints(u.START_TO_END,p)&1==u.compareBoundaryPoints(u.END_TO_START,p)?function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)},e.util.isHostMethod(u,"createContextualFragment")&&(r.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),s.getBody(document).removeChild(h),u.detach(),p.detach()}(),e.createNativeRange=function(e){return e=e||document,e.createRange()};e.features.implementsTextRange&&(o.rangeToTextRange=function(e){if(e.collapsed){var t=r(new a(e.startContainer,e.startOffset),!0);return t}var i=r(new a(e.startContainer,e.startOffset),!0),n=r(new a(e.endContainer,e.endOffset),!1),o=s.getDocument(e.startContainer).body.createTextRange();return o.setEndPoint("StartToStart",i),o.setEndPoint("EndToEnd",n),o}),o.prototype.getName=function(){return"WrappedRange"},e.WrappedRange=o,e.createRange=function(t){return t=t||document,new o(e.createNativeRange(t))},e.createRangyRange=function(e){return e=e||document,new l(e)},e.createIframeRange=function(t){return e.createRange(s.getIframeDocument(t))},e.createIframeRangyRange=function(t){return e.createRangyRange(s.getIframeDocument(t))},e.addCreateMissingNativeApiListener(function(t){var i=t.document;"undefined"==typeof i.createRange&&(i.createRange=function(){return e.createRange(this)}),i=t=null})}),rangy.createModule("WrappedSelection",function(e,t){function i(e){return(e||window).getSelection()}function n(e){return(e||window).document.selection}function r(e,t,i){var n=i?"end":"start",r=i?"start":"end";e.anchorNode=t[n+"Container"],e.anchorOffset=t[n+"Offset"],e.focusNode=t[r+"Container"],e.focusOffset=t[r+"Offset"]}function o(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function s(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function a(t){var i;return t instanceof S?(i=t._selectionNativeRange,i||(i=e.createNativeRange(x.getDocument(t.startContainer)),i.setEnd(t.endContainer,t.endOffset),i.setStart(t.startContainer,t.startOffset),t._selectionNativeRange=i,t.attachListener("detach",function(){this._selectionNativeRange=null}))):t instanceof k?i=t.nativeRange:e.features.implementsDomRange&&t instanceof x.getWindow(t.startContainer).Range&&(i=t),i}function l(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,i=e.length;i>t;++t)if(!x.isAncestorOf(e[0],e[t]))return!1;return!0}function c(e){var t=e.getNodes();if(!l(t))throw new Error("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return t[0]}function d(e){return!!e&&"undefined"!=typeof e.text}function h(e,t){var i=new k(t);e._ranges=[i],r(e,i,!1),e.rangeCount=1,e.isCollapsed=i.collapsed}function u(t){if(t._ranges.length=0,"None"==t.docSelection.type)s(t);else{var i=t.docSelection.createRange();if(d(i))h(t,i);else{t.rangeCount=i.length;for(var n,o=x.getDocument(i.item(0)),a=0;a<t.rangeCount;++a)n=e.createRange(o),n.selectNode(i.item(a)),t._ranges.push(n);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,r(t,t._ranges[t.rangeCount-1],!1)}}}function f(e,t){for(var i=e.docSelection.createRange(),n=c(t),r=x.getDocument(i.item(0)),o=x.getBody(r).createControlRange(),s=0,a=i.length;a>s;++s)o.add(i.item(s));try{o.add(n)}catch(l){throw new Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}o.select(),u(e)}function p(e,t,i){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=i,this.refresh()}function m(e,t){for(var i,n=x.getDocument(t[0].startContainer),r=x.getBody(n).createControlRange(),o=0;rangeCount>o;++o){i=c(t[o]);try{r.add(i)}catch(s){throw new Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")
}}r.select(),u(e)}function g(e,t){if(e.anchorNode&&x.getDocument(e.anchorNode)!==x.getDocument(t))throw new T("WRONG_DOCUMENT_ERR")}function v(e){var t=[],i=new E(e.anchorNode,e.anchorOffset),n=new E(e.focusNode,e.focusOffset),r="function"==typeof e.getName?e.getName():"Selection";if("undefined"!=typeof e.rangeCount)for(var o=0,s=e.rangeCount;s>o;++o)t[o]=S.inspect(e.getRangeAt(o));return"["+r+"(Ranges: "+t.join(", ")+")(anchor: "+i.inspect()+", focus: "+n.inspect()+"]"}e.requireModules(["DomUtil","DomRange","WrappedRange"]),e.config.checkSelectionRanges=!0;var b,y,w="boolean",_="_rangySelection",x=e.dom,C=e.util,S=e.DomRange,k=e.WrappedRange,T=e.DOMException,E=x.DomPosition,N="Control",L=e.util.isHostMethod(window,"getSelection"),R=e.util.isHostObject(document,"selection"),A=R&&(!L||e.config.preferTextRange);A?(b=n,e.isSelectionValid=function(e){var t=(e||window).document,i=t.selection;return"None"!=i.type||x.getDocument(i.createRange().parentElement())==t}):L?(b=i,e.isSelectionValid=function(){return!0}):t.fail("Neither document.selection or window.getSelection() detected."),e.getNativeSelection=b;var I=b(),D=e.createNativeRange(document),O=x.getBody(document),P=C.areHostObjects(I,["anchorNode","focusNode"]&&C.areHostProperties(I,["anchorOffset","focusOffset"]));e.features.selectionHasAnchorAndFocus=P;var M=C.isHostMethod(I,"extend");e.features.selectionHasExtend=M;var H="number"==typeof I.rangeCount;e.features.selectionHasRangeCount=H;var $=!1,z=!0;C.areHostMethods(I,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof I.rangeCount&&e.features.implementsDomRange&&!function(){var e=document.createElement("iframe");O.appendChild(e);var t=x.getIframeDocument(e);t.open(),t.write("<html><head></head><body>12</body></html>"),t.close();var i=x.getIframeWindow(e).getSelection(),n=t.documentElement,r=n.lastChild,o=r.firstChild,s=t.createRange();s.setStart(o,1),s.collapse(!0),i.addRange(s),z=1==i.rangeCount,i.removeAllRanges();var a=s.cloneRange();s.setStart(o,0),a.setEnd(o,2),i.addRange(s),i.addRange(a),$=2==i.rangeCount,s.detach(),a.detach(),O.removeChild(e)}(),e.features.selectionSupportsMultipleRanges=$,e.features.collapsedNonEditableSelectionsSupported=z;var W,B=!1;O&&C.isHostMethod(O,"createControlRange")&&(W=O.createControlRange(),C.areHostProperties(W,["item","add"])&&(B=!0)),e.features.implementsControlRange=B,y=P?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var j;C.isHostMethod(I,"getRangeAt")?j=function(e,t){try{return e.getRangeAt(t)}catch(i){return null}}:P&&(j=function(t){var i=x.getDocument(t.anchorNode),n=e.createRange(i);return n.setStart(t.anchorNode,t.anchorOffset),n.setEnd(t.focusNode,t.focusOffset),n.collapsed!==this.isCollapsed&&(n.setStart(t.focusNode,t.focusOffset),n.setEnd(t.anchorNode,t.anchorOffset)),n}),e.getSelection=function(e){e=e||window;var t=e[_],i=b(e),r=R?n(e):null;return t?(t.nativeSelection=i,t.docSelection=r,t.refresh(e)):(t=new p(i,r,e),e[_]=t),t},e.getIframeSelection=function(t){return e.getSelection(x.getIframeWindow(t))};var F=p.prototype;if(!A&&P&&C.areHostMethods(I,["removeAllRanges","addRange"])){F.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),s(this)};var U=function(t,i){var n=S.getRangeDocument(i),r=e.createRange(n);r.collapseToPoint(i.endContainer,i.endOffset),t.nativeSelection.addRange(a(r)),t.nativeSelection.extend(i.startContainer,i.startOffset),t.refresh()};F.addRange=H?function(t,i){if(B&&R&&this.docSelection.type==N)f(this,t);else if(i&&M)U(this,t);else{var n;if($?n=this.rangeCount:(this.removeAllRanges(),n=0),this.nativeSelection.addRange(a(t)),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==n+1){if(e.config.checkSelectionRanges){var o=j(this.nativeSelection,this.rangeCount-1);o&&!S.rangesEqual(o,t)&&(t=new k(o))}this._ranges[this.rangeCount-1]=t,r(this,t,K(this.nativeSelection)),this.isCollapsed=y(this)}else this.refresh()}}:function(e,t){t&&M?U(this,e):(this.nativeSelection.addRange(a(e)),this.refresh())},F.setRanges=function(e){if(B&&e.length>1)m(this,e);else{this.removeAllRanges();for(var t=0,i=e.length;i>t;++t)this.addRange(e[t])}}}else{if(!(C.isHostMethod(I,"empty")&&C.isHostMethod(D,"select")&&B&&A))return t.fail("No means of selecting a Range or TextRange was found"),!1;F.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=x.getDocument(this.anchorNode);else if(this.docSelection.type==N){var t=this.docSelection.createRange();t.length&&(e=x.getDocument(t.item(0)).body.createTextRange())}if(e){var i=e.body.createTextRange();i.select(),this.docSelection.empty()}}}catch(n){}s(this)},F.addRange=function(e){this.docSelection.type==N?f(this,e):(k.rangeToTextRange(e).select(),this._ranges[0]=e,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,r(this,e,!1))},F.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?m(this,e):t&&this.addRange(e[0])}}F.getRangeAt=function(e){if(0>e||e>=this.rangeCount)throw new T("INDEX_SIZE_ERR");return this._ranges[e]};var q;if(A)q=function(t){var i;e.isSelectionValid(t.win)?i=t.docSelection.createRange():(i=x.getBody(t.win.document).createTextRange(),i.collapse(!0)),t.docSelection.type==N?u(t):d(i)?h(t,i):s(t)};else if(C.isHostMethod(I,"getRangeAt")&&"number"==typeof I.rangeCount)q=function(t){if(B&&R&&t.docSelection.type==N)u(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var i=0,n=t.rangeCount;n>i;++i)t._ranges[i]=new e.WrappedRange(t.nativeSelection.getRangeAt(i));r(t,t._ranges[t.rangeCount-1],K(t.nativeSelection)),t.isCollapsed=y(t)}else s(t)};else{if(!P||typeof I.isCollapsed!=w||typeof D.collapsed!=w||!e.features.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;q=function(e){var t,i=e.nativeSelection;i.anchorNode?(t=j(i,0),e._ranges=[t],e.rangeCount=1,o(e),e.isCollapsed=y(e)):s(e)}}F.refresh=function(e){var t=e?this._ranges.slice(0):null;if(q(this),e){var i=t.length;if(i!=this._ranges.length)return!1;for(;i--;)if(!S.rangesEqual(t[i],this._ranges[i]))return!1;return!0}};var V=function(e,t){var i=e.getAllRanges(),n=!1;e.removeAllRanges();for(var r=0,o=i.length;o>r;++r)n||t!==i[r]?e.addRange(i[r]):n=!0;e.rangeCount||s(e)};F.removeRange=B?function(e){if(this.docSelection.type==N){for(var t,i=this.docSelection.createRange(),n=c(e),r=x.getDocument(i.item(0)),o=x.getBody(r).createControlRange(),s=!1,a=0,l=i.length;l>a;++a)t=i.item(a),t!==n||s?o.add(i.item(a)):s=!0;o.select(),u(this)}else V(this,e)}:function(e){V(this,e)};var K;!A&&P&&e.features.implementsDomRange?(K=function(e){var t=!1;return e.anchorNode&&(t=1==x.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t},F.isBackwards=function(){return K(this)}):K=F.isBackwards=function(){return!1},F.toString=function(){for(var e=[],t=0,i=this.rangeCount;i>t;++t)e[t]=""+this._ranges[t];return e.join("")},F.collapse=function(t,i){g(this,t);var n=e.createRange(x.getDocument(t));n.collapseToPoint(t,i),this.removeAllRanges(),this.addRange(n),this.isCollapsed=!0},F.collapseToStart=function(){if(!this.rangeCount)throw new T("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},F.collapseToEnd=function(){if(!this.rangeCount)throw new T("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},F.selectAllChildren=function(t){g(this,t);var i=e.createRange(x.getDocument(t));i.selectNodeContents(t),this.removeAllRanges(),this.addRange(i)},F.deleteFromDocument=function(){if(B&&R&&this.docSelection.type==N){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),e.parentNode.removeChild(e);this.refresh()}else if(this.rangeCount){var i=this.getAllRanges();this.removeAllRanges();for(var n=0,r=i.length;r>n;++n)i[n].deleteContents();this.addRange(i[r-1])}},F.getAllRanges=function(){return this._ranges.slice(0)},F.setSingleRange=function(e){this.setRanges([e])},F.containsNode=function(e,t){for(var i=0,n=this._ranges.length;n>i;++i)if(this._ranges[i].containsNode(e,t))return!0;return!1},F.toHtml=function(){var e="";if(this.rangeCount){for(var t=S.getRangeDocument(this._ranges[0]).createElement("div"),i=0,n=this._ranges.length;n>i;++i)t.appendChild(this._ranges[i].cloneContents());e=t.innerHTML}return e},F.getName=function(){return"WrappedSelection"},F.inspect=function(){return v(this)},F.detach=function(){this.win[_]=null,this.win=this.anchorNode=this.focusNode=null},p.inspect=v,e.Selection=p,e.selectionPrototype=F,e.addCreateMissingNativeApiListener(function(t){"undefined"==typeof t.getSelection&&(t.getSelection=function(){return e.getSelection(this)}),t=null})});/*
	Base.js, version 1.1a
	Copyright 2006-2010, Dean Edwards
	License: http://www.opensource.org/licenses/mit-license.php
*/
var Base=function(){};if(Base.extend=function(e,t){var i=Base.prototype.extend;Base._prototyping=!0;var n=new this;i.call(n,e),n.base=function(){},delete Base._prototyping;var r=n.constructor,o=n.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==o)this._constructing=!0,r.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||i).call(arguments[0],n)};return o.ancestor=this,o.extend=this.extend,o.forEach=this.forEach,o.implement=this.implement,o.prototype=n,o.toString=this.toString,o.valueOf=function(e){return"object"==e?o:r.valueOf()},i.call(o,t),"function"==typeof o.init&&o.init(),o},Base.prototype={extend:function(e,t){if(arguments.length>1){var i=this[e];if(i&&"function"==typeof t&&(!i.valueOf||i.valueOf()!=t.valueOf())&&/\bbase\b/.test(t)){var n=t.valueOf();t=function(){var e=this.base||Base.prototype.base;this.base=i;var t=n.apply(this,arguments);return this.base=e,t},t.valueOf=function(e){return"object"==e?t:n},t.toString=Base.toString}this[e]=t}else if(e){var r=Base.prototype.extend;Base._prototyping||"function"==typeof this||(r=this.extend||r);for(var o={toSource:null},s=["constructor","toString","valueOf"],a=Base._prototyping?0:1;l=s[a++];)e[l]!=o[l]&&r.call(this,l,e[l]);for(var l in e)o[l]||r.call(this,l,e[l])}return this}},Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(e,t,i){for(var n in e)void 0===this.prototype[n]&&t.call(i,e[n],n,e)},implement:function(){for(var e=0;e<arguments.length;e++)"function"==typeof arguments[e]?arguments[e](this.prototype):this.prototype.extend(arguments[e]);return this},toString:function(){return String(this.valueOf())}}),wysihtml5.browser=function(){function e(e){return(/ipad|iphone|ipod/.test(e)&&e.match(/ os (\d+).+? like mac os x/)||[,0])[1]}var t=navigator.userAgent,i=document.createElement("div"),n=-1!==t.indexOf("MSIE")&&-1===t.indexOf("Opera"),r=-1!==t.indexOf("Gecko")&&-1===t.indexOf("KHTML"),o=-1!==t.indexOf("AppleWebKit/"),s=-1!==t.indexOf("Chrome/"),a=-1!==t.indexOf("Opera/");return{USER_AGENT:t,supported:function(){var t=this.USER_AGENT.toLowerCase(),n="contentEditable"in i,r=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,o=document.querySelector&&document.querySelectorAll,s=this.isIos()&&e(t)<5||-1!==t.indexOf("opera mobi")||-1!==t.indexOf("hpwos/");return n&&r&&o&&!s},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){var e=this.USER_AGENT.toLowerCase();return-1!==e.indexOf("webkit")&&-1!==e.indexOf("mobile")},supportsSandboxedIframes:function(){return n},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return!("querySelector"in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return!r},hasCurrentStyleProperty:function(){return"currentStyle"in i},insertsLineBreaksOnReturn:function(){return r},supportsPlaceholderAttributeOn:function(e){return"placeholder"in e},supportsEvent:function(e){return"on"+e in i||function(){return i.setAttribute("on"+e,"return;"),"function"==typeof i["on"+e]}()},supportsEventsInIframeCorrectly:function(){return!a},firesOnDropOnlyWhenOnDragOverIsCancelled:function(){return o||r},supportsDataTransfer:function(){try{return o&&(window.Clipboard||window.DataTransfer).prototype.getData}catch(e){return!1}},supportsHTML5Tags:function(e){var t=e.createElement("div"),i="<article>foo</article>";return t.innerHTML=i,t.innerHTML.toLowerCase()===i},supportsCommand:function(){var e={formatBlock:n,insertUnorderedList:n||a||o,insertOrderedList:n||a||o},t={insertHTML:r};return function(i,n){var r=e[n];if(!r){try{return i.queryCommandSupported(n)}catch(o){}try{return i.queryCommandEnabled(n)}catch(s){return!!t[n]}}return!1}}(),doesAutoLinkingInContentEditable:function(){return n},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return r||a||o},supportsGetAttributeCorrectly:function(){var e=document.createElement("td");return"1"!=e.getAttribute("rowspan")},canSelectImagesInContentEditable:function(){return r||n||a},clearsListsInContentEditableCorrectly:function(){return r||n||o},autoScrollsToCaret:function(){return!o},autoClosesUnclosedTags:function(){var e,t,n=i.cloneNode(!1);return n.innerHTML="<p><div></div>",t=n.innerHTML.toLowerCase(),e="<p></p><div></div>"===t||"<p><div></div></p>"===t,this.autoClosesUnclosedTags=function(){return e},e},supportsNativeGetElementsByClassName:function(){return-1!==String(document.getElementsByClassName).indexOf("[native code]")},supportsSelectionModify:function(){return"getSelection"in window&&"modify"in window.getSelection()},supportsClassList:function(){return"classList"in i},needsSpaceAfterLineBreak:function(){return a},supportsSpeechApiOn:function(e){var i=t.match(/Chrome\/(\d+)/)||[,0];return i[1]>=11&&("onwebkitspeechchange"in e||"speech"in e)},crashesWhenDefineProperty:function(e){return n&&("XMLHttpRequest"===e||"XDomainRequest"===e)},doesAsyncFocus:function(){return n},hasProblemsSettingCaretAfterImg:function(){return n},hasUndoInContextMenu:function(){return r||s||a}}}(),wysihtml5.lang.array=function(e){return{contains:function(t){if(e.indexOf)return-1!==e.indexOf(t);for(var i=0,n=e.length;n>i;i++)if(e[i]===t)return!0;return!1},without:function(t){t=wysihtml5.lang.array(t);for(var i=[],n=0,r=e.length;r>n;n++)t.contains(e[n])||i.push(e[n]);return i},get:function(){for(var t=0,i=e.length,n=[];i>t;t++)n.push(e[t]);return n}}},wysihtml5.lang.Dispatcher=Base.extend({observe:function(e,t){return this.events=this.events||{},this.events[e]=this.events[e]||[],this.events[e].push(t),this},on:function(){return this.observe.apply(this,wysihtml5.lang.array(arguments).get())},fire:function(e,t){this.events=this.events||{};for(var i=this.events[e]||[],n=0;n<i.length;n++)i[n].call(this,t);return this},stopObserving:function(e,t){this.events=this.events||{};var i,n,r=0;if(e){for(i=this.events[e]||[],n=[];r<i.length;r++)i[r]!==t&&t&&n.push(i[r]);this.events[e]=n}else this.events={};return this}}),wysihtml5.lang.object=function(e){return{merge:function(t){for(var i in t)e[i]=t[i];return this},get:function(){return e},clone:function(){var t,i={};for(t in e)i[t]=e[t];return i},isArray:function(){return"[object Array]"===Object.prototype.toString.call(e)}}},function(){var e=/^\s+/,t=/\s+$/;wysihtml5.lang.string=function(i){return i=String(i),{trim:function(){return i.replace(e,"").replace(t,"")},interpolate:function(e){for(var t in e)i=this.replace("#{"+t+"}").by(e[t]);return i},replace:function(e){return{by:function(t){return i.split(e).join(t)}}}}}}(),function(e){function t(e){return o(e)?e:(e===e.ownerDocument.documentElement&&(e=e.ownerDocument.body),s(e))}function i(e){return e.replace(l,function(e,t){var i=(t.match(c)||[])[1]||"",n=h[i];t=t.replace(c,""),t.split(n).length>t.split(i).length&&(t+=i,i="");var r=t,o=t;return t.length>d&&(o=o.substr(0,d)+"..."),"www."===r.substr(0,4)&&(r="http://"+r),'<a href="'+r+'">'+o+"</a>"+i})}function n(e){var t=e._wysihtml5_tempElement;return t||(t=e._wysihtml5_tempElement=e.createElement("div")),t}function r(e){var t=e.parentNode,r=n(t.ownerDocument);for(r.innerHTML="<span></span>"+i(e.data),r.removeChild(r.firstChild);r.firstChild;)t.insertBefore(r.firstChild,e);t.removeChild(e)}function o(e){for(var t;e.parentNode;){if(e=e.parentNode,t=e.nodeName,a.contains(t))return!0;if("body"===t)return!1}return!1}function s(t){if(!a.contains(t.nodeName)){if(t.nodeType===e.TEXT_NODE&&t.data.match(l))return r(t),void 0;for(var i=e.lang.array(t.childNodes).get(),n=i.length,o=0;n>o;o++)s(i[o]);return t}}var a=e.lang.array(["CODE","PRE","A","SCRIPT","HEAD","TITLE","STYLE"]),l=/((https?:\/\/|www\.)[^\s<]{3,})/gi,c=/([^\w\/\-](,?))$/i,d=100,h={")":"(","]":"[","}":"{"};e.dom.autoLink=t,e.dom.autoLink.URL_REG_EXP=l}(wysihtml5),function(e){var t=e.browser.supportsClassList(),i=e.dom;i.addClass=function(e,n){return t?e.classList.add(n):(i.hasClass(e,n)||(e.className+=" "+n),void 0)},i.removeClass=function(e,i){return t?e.classList.remove(i):(e.className=e.className.replace(new RegExp("(^|\\s+)"+i+"(\\s+|$)")," "),void 0)},i.hasClass=function(e,i){if(t)return e.classList.contains(i);var n=e.className;return n.length>0&&(n==i||new RegExp("(^|\\s)"+i+"(\\s|$)").test(n))}}(wysihtml5),wysihtml5.dom.contains=function(){var e=document.documentElement;return e.contains?function(e,t){return t.nodeType!==wysihtml5.ELEMENT_NODE&&(t=t.parentNode),e!==t&&e.contains(t)}:e.compareDocumentPosition?function(e,t){return!!(16&e.compareDocumentPosition(t))}:void 0}(),wysihtml5.dom.convertToList=function(){function e(e,t){var i=e.createElement("li");return t.appendChild(i),i}function t(e,t){return e.createElement(t)}function i(i,n){if("UL"===i.nodeName||"OL"===i.nodeName||"MENU"===i.nodeName)return i;var r,o,s,a,l,c,d,h,u,f=i.ownerDocument,p=t(f,n),m=i.querySelectorAll("br"),g=m.length;for(u=0;g>u;u++)for(a=m[u];(l=a.parentNode)&&l!==i&&l.lastChild===a;){if("block"===wysihtml5.dom.getStyle("display").from(l)){l.removeChild(a);break}wysihtml5.dom.insert(a).after(a.parentNode)}for(r=wysihtml5.lang.array(i.childNodes).get(),o=r.length,u=0;o>u;u++)h=h||e(f,p),s=r[u],c="block"===wysihtml5.dom.getStyle("display").from(s),d="BR"===s.nodeName,c?(h=h.firstChild?e(f,p):h,h.appendChild(s),h=null):d?h=h.firstChild?null:h:h.appendChild(s);return i.parentNode.replaceChild(p,i),p}return i}(),wysihtml5.dom.copyAttributes=function(e){return{from:function(t){return{to:function(i){for(var n,r=0,o=e.length;o>r;r++)n=e[r],"undefined"!=typeof t[n]&&""!==t[n]&&(i[n]=t[n]);return{andTo:arguments.callee}}}}}},function(e){var t=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"],i=function(t){return n(t)?parseInt(e.getStyle("width").from(t),10)<t.offsetWidth:!1},n=function(i){for(var n=0,r=t.length;r>n;n++)if("border-box"===e.getStyle(t[n]).from(i))return t[n]};e.copyStyles=function(n){return{from:function(r){i(r)&&(n=wysihtml5.lang.array(n).without(t));for(var o,s="",a=n.length,l=0;a>l;l++)o=n[l],s+=o+":"+e.getStyle(o).from(r)+";";return{to:function(t){return e.setStyles(s).on(t),{andTo:arguments.callee}}}}}}}(wysihtml5.dom),function(e){e.dom.delegate=function(t,i,n,r){return e.dom.observe(t,n,function(n){for(var o=n.target,s=e.lang.array(t.querySelectorAll(i));o&&o!==t;){if(s.contains(o)){r.call(o,n);break}o=o.parentNode}})}}(wysihtml5),wysihtml5.dom.getAsDom=function(){var e=function(e,t){var i=t.createElement("div");i.style.display="none",t.body.appendChild(i);try{i.innerHTML=e}catch(n){}return t.body.removeChild(i),i},t=function(e){if(!e._wysihtml5_supportsHTML5Tags){for(var t=0,n=i.length;n>t;t++)e.createElement(i[t]);e._wysihtml5_supportsHTML5Tags=!0}},i=["abbr","article","aside","audio","bdi","canvas","command","datalist","details","figcaption","figure","footer","header","hgroup","keygen","mark","meter","nav","output","progress","rp","rt","ruby","svg","section","source","summary","time","track","video","wbr"];return function(i,n){n=n||document;var r;return"object"==typeof i&&i.nodeType?(r=n.createElement("div"),r.appendChild(i)):wysihtml5.browser.supportsHTML5Tags(n)?(r=n.createElement("div"),r.innerHTML=i):(t(n),r=e(i,n)),r}}(),wysihtml5.dom.getParentElement=function(){function e(e,t){return t&&t.length?"string"==typeof t?e===t:wysihtml5.lang.array(t).contains(e):!0}function t(e){return e.nodeType===wysihtml5.ELEMENT_NODE}function i(e,t,i){var n=(e.className||"").match(i)||[];return t?n[n.length-1]===t:!!n.length}function n(t,i,n){for(;n--&&t&&"BODY"!==t.nodeName;){if(e(t.nodeName,i))return t;t=t.parentNode}return null}function r(n,r,o,s,a){for(;a--&&n&&"BODY"!==n.nodeName;){if(t(n)&&e(n.nodeName,r)&&i(n,o,s))return n;n=n.parentNode}return null}return function(e,t,i){return i=i||50,t.className||t.classRegExp?r(e,t.nodeName,t.className,t.classRegExp,i):n(e,t.nodeName,i)}}(),wysihtml5.dom.getStyle=function(){function e(e){return e.replace(i,function(e){return e.charAt(1).toUpperCase()})}var t={"float":"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},i=/\-[a-z]/g;return function(i){return{from:function(n){if(n.nodeType===wysihtml5.ELEMENT_NODE){var r=n.ownerDocument,o=t[i]||e(i),s=n.style,a=n.currentStyle,l=s[o];if(l)return l;if(a)try{return a[o]}catch(c){}var d,h,u=r.defaultView||r.parentWindow,f=("height"===i||"width"===i)&&"TEXTAREA"===n.nodeName;return u.getComputedStyle?(f&&(d=s.overflow,s.overflow="hidden"),h=u.getComputedStyle(n,null).getPropertyValue(i),f&&(s.overflow=d||""),h):void 0}}}}}(),wysihtml5.dom.hasElementWithTagName=function(){function e(e){return e._wysihtml5_identifier||(e._wysihtml5_identifier=i++)}var t={},i=1;return function(i,n){var r=e(i)+":"+n,o=t[r];return o||(o=t[r]=i.getElementsByTagName(n)),o.length>0}}(),function(e){function t(e){return e._wysihtml5_identifier||(e._wysihtml5_identifier=n++)}var i={},n=1;e.dom.hasElementWithClassName=function(n,r){if(!e.browser.supportsNativeGetElementsByClassName())return!!n.querySelector("."+r);var o=t(n)+":"+r,s=i[o];return s||(s=i[o]=n.getElementsByClassName(r)),s.length>0}}(wysihtml5),wysihtml5.dom.insert=function(e){return{after:function(t){t.parentNode.insertBefore(e,t.nextSibling)},before:function(t){t.parentNode.insertBefore(e,t)},into:function(t){t.appendChild(e)}}},wysihtml5.dom.insertCSS=function(e){return e=e.join("\n"),{into:function(t){var i=t.head||t.getElementsByTagName("head")[0],n=t.createElement("style");n.type="text/css",n.styleSheet?n.styleSheet.cssText=e:n.appendChild(t.createTextNode(e)),i&&i.appendChild(n)}}},wysihtml5.dom.observe=function(e,t,i){t="string"==typeof t?[t]:t;for(var n,r,o=0,s=t.length;s>o;o++)r=t[o],e.addEventListener?e.addEventListener(r,i,!1):(n=function(t){"target"in t||(t.target=t.srcElement),t.preventDefault=t.preventDefault||function(){this.returnValue=!1},t.stopPropagation=t.stopPropagation||function(){this.cancelBubble=!0},i.call(e,t)},e.attachEvent("on"+r,n));return{stop:function(){for(var r,o=0,s=t.length;s>o;o++)r=t[o],e.removeEventListener?e.removeEventListener(r,i,!1):e.detachEvent("on"+r,n)}}},wysihtml5.dom.parse=function(){function e(e,i,n,r){wysihtml5.lang.object(h).merge(d).merge(i).get(),n=n||e.ownerDocument||document;var o,s,a,l=n.createDocumentFragment(),c="string"==typeof e;for(o=c?wysihtml5.dom.getAsDom(e,n):e;o.firstChild;)a=o.firstChild,o.removeChild(a),s=t(a,r),s&&l.appendChild(s);return o.innerHTML="",o.appendChild(l),c?wysihtml5.quirks.getCorrectInnerHTML(o):o}function t(e,i){var n,r=e.nodeType,o=e.childNodes,s=o.length,c=a[r],d=0;if(n=c&&c(e),!n)return null;for(d=0;s>d;d++)newChild=t(o[d],i),newChild&&n.appendChild(newChild);return i&&n.childNodes.length<=1&&n.nodeName.toLowerCase()===l&&!n.attributes.length?n.firstChild:n}function i(e){var t,i,r=h.tags,o=e.nodeName.toLowerCase(),s=e.scopeName;if(e._wysihtml5)return null;if(e._wysihtml5=1,"wysihtml5-temp"===e.className)return null;if(s&&"HTML"!=s&&(o=s+":"+o),"outerHTML"in e&&(wysihtml5.browser.autoClosesUnclosedTags()||"P"!==e.nodeName||"</p>"===e.outerHTML.slice(-4).toLowerCase()||(o="div")),o in r){if(t=r[o],!t||t.remove)return null;t="string"==typeof t?{rename_tag:t}:t}else{if(!e.firstChild)return null;t={rename_tag:l}}return i=e.ownerDocument.createElement(t.rename_tag||o),n(e,i,t),e=null,i}function n(e,t,i){var n,o,s,a,l,d,u,m={},g=i.set_class,v=i.add_class,b=i.set_attributes,y=i.check_attributes,w=h.classes,_=0,x=[],C=[],S=[],k=[];if(b&&(m=wysihtml5.lang.object(b).clone()),y)for(l in y)u=f[y[l]],u&&(d=u(r(e,l)),"string"==typeof d&&(m[l]=d));if(g&&x.push(g),v)for(l in v)u=p[v[l]],u&&(a=u(r(e,l)),"string"==typeof a&&x.push(a));for(w["_wysihtml5-temp-placeholder"]=1,k=e.getAttribute("class"),k&&(x=x.concat(k.split(c))),n=x.length;n>_;_++)s=x[_],w[s]&&C.push(s);for(o=C.length;o--;)s=C[o],wysihtml5.lang.array(S).contains(s)||S.unshift(s);S.length&&(m["class"]=S.join(" "));for(l in m)try{t.setAttribute(l,m[l])}catch(T){}m.src&&("undefined"!=typeof m.width&&t.setAttribute("width",m.width),"undefined"!=typeof m.height&&t.setAttribute("height",m.height))}function r(e,t){t=t.toLowerCase();var i=e.nodeName;if("IMG"==i&&"src"==t&&o(e)===!0)return e.src;if(u&&"outerHTML"in e){var n=e.outerHTML.toLowerCase(),r=-1!=n.indexOf(" "+t+"=");return r?e.getAttribute(t):null}return e.getAttribute(t)}function o(e){try{return e.complete&&!e.mozMatchesSelector(":-moz-broken")}catch(t){if(e.complete&&"complete"===e.readyState)return!0}}function s(e){return e.ownerDocument.createTextNode(e.data)}var a={1:i,3:s},l="span",c=/\s+/,d={tags:{},classes:{}},h={},u=!wysihtml5.browser.supportsGetAttributeCorrectly(),f={url:function(){var e=/^https?:\/\//i;return function(t){return t&&t.match(e)?t.replace(e,function(e){return e.toLowerCase()}):null}}(),alt:function(){var e=/[^ a-z0-9_\-]/gi;return function(t){return t?t.replace(e,""):""}}(),numbers:function(){var e=/\D/g;return function(t){return t=(t||"").replace(e,""),t||null}}()},p={align_img:function(){var e={left:"wysiwyg-float-left",right:"wysiwyg-float-right"};return function(t){return e[String(t).toLowerCase()]}}(),align_text:function(){var e={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"};return function(t){return e[String(t).toLowerCase()]}}(),clear_br:function(){var e={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"};return function(t){return e[String(t).toLowerCase()]}}(),size_font:function(){var e={1:"wysiwyg-font-size-xx-small",2:"wysiwyg-font-size-small",3:"wysiwyg-font-size-medium",4:"wysiwyg-font-size-large",5:"wysiwyg-font-size-x-large",6:"wysiwyg-font-size-xx-large",7:"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"};return function(t){return e[String(t).charAt(0)]}}()};return e}(),wysihtml5.dom.removeEmptyTextNodes=function(e){for(var t,i=wysihtml5.lang.array(e.childNodes).get(),n=i.length,r=0;n>r;r++)t=i[r],t.nodeType===wysihtml5.TEXT_NODE&&""===t.data&&t.parentNode.removeChild(t)},wysihtml5.dom.renameElement=function(e,t){for(var i,n=e.ownerDocument.createElement(t);i=e.firstChild;)n.appendChild(i);return wysihtml5.dom.copyAttributes(["align","className"]).from(e).to(n),e.parentNode.replaceChild(n,e),n},wysihtml5.dom.replaceWithChildNodes=function(e){if(e.parentNode){if(!e.firstChild)return e.parentNode.removeChild(e),void 0;for(var t=e.ownerDocument.createDocumentFragment();e.firstChild;)t.appendChild(e.firstChild);e.parentNode.replaceChild(t,e),e=t=null}},function(e){function t(t){return"block"===e.getStyle("display").from(t)}function i(e){return"BR"===e.nodeName}function n(e){var t=e.ownerDocument.createElement("br");e.appendChild(t)}function r(e){if("MENU"===e.nodeName||"UL"===e.nodeName||"OL"===e.nodeName){var r,o,s,a,l,c=e.ownerDocument,d=c.createDocumentFragment(),h=e.previousElementSibling||e.previousSibling;for(h&&!t(h)&&n(d);l=e.firstChild;){for(o=l.lastChild;r=l.firstChild;)s=r===o,a=s&&!t(r)&&!i(r),d.appendChild(r),a&&n(d);l.parentNode.removeChild(l)}e.parentNode.replaceChild(d,e)}}e.resolveList=r}(wysihtml5.dom),function(e){var t=document,i=["parent","top","opener","frameElement","frames","localStorage","globalStorage","sessionStorage","indexedDB"],n=["open","close","openDialog","showModalDialog","alert","confirm","prompt","openDatabase","postMessage","XMLHttpRequest","XDomainRequest"],r=["referrer","write","open","close"];e.dom.Sandbox=Base.extend({constructor:function(t,i){this.callback=t||e.EMPTY_FUNCTION,this.config=e.lang.object({}).merge(i).get(),this.iframe=this._createIframe()},insertInto:function(e){"string"==typeof e&&(e=t.getElementById(e)),e.appendChild(this.iframe)},getIframe:function(){return this.iframe},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var e=this.getIframe();e.parentNode.removeChild(e)},_readyError:function(){throw new Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet")},_createIframe:function(){var i=this,n=t.createElement("iframe");return n.className="wysihtml5-sandbox",e.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(n),e.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()&&(n.src="javascript:'<html></html>'"),n.onload=function(){n.onreadystatechange=n.onload=null,i._onLoadIframe(n)},n.onreadystatechange=function(){/loaded|complete/.test(n.readyState)&&(n.onreadystatechange=n.onload=null,i._onLoadIframe(n))},n},_onLoadIframe:function(o){if(e.dom.contains(t.documentElement,o)){var s=this,a=o.contentWindow,l=o.contentWindow.document,c=t.characterSet||t.charset||"utf-8",d=this._getHtml({charset:c,stylesheets:this.config.stylesheets});if(l.open("text/html","replace"),l.write(d),l.close(),this.getWindow=function(){return o.contentWindow},this.getDocument=function(){return o.contentWindow.document},a.onerror=function(e,t,i){throw new Error("wysihtml5.Sandbox: "+e,t,i)},!e.browser.supportsSandboxedIframes()){var h,u;for(h=0,u=i.length;u>h;h++)this._unset(a,i[h]);for(h=0,u=n.length;u>h;h++)this._unset(a,n[h],e.EMPTY_FUNCTION);for(h=0,u=r.length;u>h;h++)this._unset(l,r[h]);this._unset(l,"cookie","",!0)}this.loaded=!0,setTimeout(function(){s.callback(s)},0)}},_getHtml:function(t){var i,n=t.stylesheets,r="",o=0;if(n="string"==typeof n?[n]:n)for(i=n.length;i>o;o++)r+='<link rel="stylesheet" href="'+n[o]+'">';return t.stylesheets=r,e.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}</head><body></body></html>').interpolate(t)},_unset:function(t,i,n,r){try{t[i]=n}catch(o){}try{t.__defineGetter__(i,function(){return n})}catch(o){}if(r)try{t.__defineSetter__(i,function(){})}catch(o){}if(!e.browser.crashesWhenDefineProperty(i))try{var s={get:function(){return n}};r&&(s.set=function(){}),Object.defineProperty(t,i,s)}catch(o){}}})}(wysihtml5),function(){var e={className:"class"};wysihtml5.dom.setAttributes=function(t){return{on:function(i){for(var n in t)i.setAttribute(e[n]||n,t[n])}}}}(),wysihtml5.dom.setStyles=function(e){return{on:function(t){var i=t.style;if("string"==typeof e)return i.cssText+=";"+e,void 0;for(var n in e)"float"===n?(i.cssFloat=e[n],i.styleFloat=e[n]):i[n]=e[n]}}},function(e){e.simulatePlaceholder=function(t,i,n){var r="placeholder",o=function(){i.hasPlaceholderSet()&&i.clear(),e.removeClass(i.element,r)},s=function(){i.isEmpty()&&(i.setValue(n),e.addClass(i.element,r))};t.observe("set_placeholder",s).observe("unset_placeholder",o).observe("focus:composer",o).observe("paste:composer",o).observe("blur:composer",s),s()}}(wysihtml5.dom),function(e){var t=document.documentElement;"textContent"in t?(e.setTextContent=function(e,t){e.textContent=t},e.getTextContent=function(e){return e.textContent}):"innerText"in t?(e.setTextContent=function(e,t){e.innerText=t},e.getTextContent=function(e){return e.innerText}):(e.setTextContent=function(e,t){e.nodeValue=t},e.getTextContent=function(e){return e.nodeValue})}(wysihtml5.dom),wysihtml5.quirks.cleanPastedHTML=function(){function e(e,i,n){i=i||t,n=n||e.ownerDocument||document;var r,o,s,a,l,c="string"==typeof e,d=0;r=c?wysihtml5.dom.getAsDom(e,n):e;for(l in i)for(s=r.querySelectorAll(l),o=i[l],a=s.length;a>d;d++)o(s[d]);return s=e=i=null,c?r.innerHTML:r}var t={"a u":wysihtml5.dom.replaceWithChildNodes};return e}(),function(e){var t=e.dom;e.quirks.ensureProperClearing=function(){var e=function(){var e=this;setTimeout(function(){var t=e.innerHTML.toLowerCase();("<p>&nbsp;</p>"==t||"<p>&nbsp;</p><p>&nbsp;</p>"==t)&&(e.innerHTML="")},0)};return function(i){t.observe(i.element,["cut","keydown"],e)}}(),e.quirks.ensureProperClearingOfLists=function(){var i=["OL","UL","MENU"],n=function(n,r){if(r.firstChild&&e.lang.array(i).contains(r.firstChild.nodeName)){var o=t.getParentElement(n,{nodeName:i});if(o){var s=o==r.firstChild;if(s){var a=o.childNodes.length<=1;if(a){var l=o.firstChild?""===o.firstChild.innerHTML:!0;l&&o.parentNode.removeChild(o)}}}}};return function(i){t.observe(i.element,"keydown",function(t){if(t.keyCode===e.BACKSPACE_KEY){var r=i.selection.getSelectedNode();n(r,i.element)}})}}()}(wysihtml5),function(e){var t="%7E";e.quirks.getCorrectInnerHTML=function(i){var n=i.innerHTML;if(-1===n.indexOf(t))return n;var r,o,s,a,l=i.querySelectorAll("[href*='~'], [src*='~']");for(a=0,s=l.length;s>a;a++)r=l[a].href||l[a].src,o=e.lang.string(r).replace("~").by(t),n=e.lang.string(n).replace(o).by(r);return n}}(wysihtml5),function(e){var t=e.dom,i=["LI","P","H1","H2","H3","H4","H5","H6"],n=["UL","OL","MENU"];e.quirks.insertLineBreakOnReturn=function(r){function o(i){var n=t.getParentElement(i,{nodeName:["P","DIV"]},2);if(n){var o=document.createTextNode(e.INVISIBLE_SPACE);t.insert(o).before(n),t.replaceWithChildNodes(n),r.selection.selectNode(o)}}function s(s){var a=s.keyCode;if(!(s.shiftKey||a!==e.ENTER_KEY&&a!==e.BACKSPACE_KEY)){var l=(s.target,r.selection.getSelectedNode()),c=t.getParentElement(l,{nodeName:i},4);return c?("LI"!==c.nodeName||a!==e.ENTER_KEY&&a!==e.BACKSPACE_KEY?c.nodeName.match(/H[1-6]/)&&a===e.ENTER_KEY&&setTimeout(function(){o(r.selection.getSelectedNode())},0):setTimeout(function(){var e,i=r.selection.getSelectedNode();i&&(e=t.getParentElement(i,{nodeName:n},2),e||o(i))},0),void 0):(a!==e.ENTER_KEY||e.browser.insertsLineBreaksOnReturn()||(r.commands.exec("insertLineBreak"),s.preventDefault()),void 0)}}t.observe(r.element.ownerDocument,"keydown",s)}}(wysihtml5),function(e){var t="wysihtml5-quirks-redraw";e.quirks.redraw=function(i){e.dom.addClass(i,t),e.dom.removeClass(i,t);try{var n=i.ownerDocument;n.execCommand("italic",!1,null),n.execCommand("italic",!1,null)}catch(r){}}}(wysihtml5),function(e){function t(e){var t=0;if(e.parentNode)do t+=e.offsetTop||0,e=e.offsetParent;while(e);return t}var i=e.dom;e.Selection=Base.extend({constructor:function(e){window.rangy.init(),this.editor=e,this.composer=e.composer,this.doc=this.composer.doc},getBookmark:function(){var e=this.getRange();return e&&e.cloneRange()},setBookmark:function(e){e&&this.setSelection(e)},setBefore:function(e){var t=rangy.createRange(this.doc);return t.setStartBefore(e),t.setEndBefore(e),this.setSelection(t)},setAfter:function(e){var t=rangy.createRange(this.doc);return t.setStartAfter(e),t.setEndAfter(e),this.setSelection(t)},selectNode:function(t){var n=rangy.createRange(this.doc),r=t.nodeType===e.ELEMENT_NODE,o="canHaveHTML"in t?t.canHaveHTML:"IMG"!==t.nodeName,s=r?t.innerHTML:t.data,a=""===s||s===e.INVISIBLE_SPACE,l=i.getStyle("display").from(t),c="block"===l||"list-item"===l;if(a&&r&&o)try{t.innerHTML=e.INVISIBLE_SPACE}catch(d){}o?n.selectNodeContents(t):n.selectNode(t),o&&a&&r?n.collapse(c):o&&a&&(n.setStartAfter(t),n.setEndAfter(t)),this.setSelection(n)},getSelectedNode:function(e){var t,i;return e&&this.doc.selection&&"Control"===this.doc.selection.type&&(i=this.doc.selection.createRange(),i&&i.length)?i.item(0):(t=this.getSelection(this.doc),t.focusNode===t.anchorNode?t.focusNode:(i=this.getRange(this.doc),i?i.commonAncestorContainer:this.doc.body))},executeAndRestore:function(t,i){var n,r=this.doc.body,o=i&&r.scrollTop,s=i&&r.scrollLeft,a="_wysihtml5-temp-placeholder",l='<span class="'+a+'">'+e.INVISIBLE_SPACE+"</span>",c=this.getRange(this.doc);if(!c)return t(r,r),void 0;var d=c.createContextualFragment(l);c.insertNode(d);try{t(c.startContainer,c.endContainer)}catch(h){setTimeout(function(){throw h},0)}caretPlaceholder=this.doc.querySelector("."+a),caretPlaceholder?(n=rangy.createRange(this.doc),n.selectNode(caretPlaceholder),n.deleteContents(),this.setSelection(n)):r.focus(),i&&(r.scrollTop=o,r.scrollLeft=s);try{caretPlaceholder.parentNode.removeChild(caretPlaceholder)}catch(u){}},executeAndRestoreSimple:function(e){var t,i,n,r,o,s=this.getRange(),a=this.doc.body;if(!s)return e(a,a),void 0;r=s.getNodes([3]),i=r[0]||s.startContainer,n=r[r.length-1]||s.endContainer,o={collapsed:s.collapsed,startContainer:i,startOffset:i===s.startContainer?s.startOffset:0,endContainer:n,endOffset:n===s.endContainer?s.endOffset:n.length};try{e(s.startContainer,s.endContainer)}catch(l){setTimeout(function(){throw l},0)}t=rangy.createRange(this.doc);try{t.setStart(o.startContainer,o.startOffset)}catch(c){}try{t.setEnd(o.endContainer,o.endOffset)}catch(d){}try{this.setSelection(t)}catch(h){}},insertHTML:function(e){var t=rangy.createRange(this.doc),i=t.createContextualFragment(e),n=i.lastChild;this.insertNode(i),n&&this.setAfter(n)},insertNode:function(e){var t=this.getRange();t&&t.insertNode(e)},surround:function(e){var t=this.getRange();if(t)try{t.surroundContents(e),this.selectNode(e)}catch(i){e.appendChild(t.extractContents()),t.insertNode(e)}},scrollIntoView:function(){var i,n=this.doc,r=n.documentElement.scrollHeight>n.documentElement.offsetHeight,o=n._wysihtml5ScrollIntoViewElement=n._wysihtml5ScrollIntoViewElement||function(){var t=n.createElement("span");return t.innerHTML=e.INVISIBLE_SPACE,t}();r&&(this.insertNode(o),i=t(o),o.parentNode.removeChild(o),i>n.body.scrollTop&&(n.body.scrollTop=i))},selectLine:function(){e.browser.supportsSelectionModify()?this._selectLine_W3C():this.doc.selection&&this._selectLine_MSIE()},_selectLine_W3C:function(){var e=this.doc.defaultView,t=e.getSelection();t.modify("extend","left","lineboundary"),t.modify("extend","right","lineboundary")},_selectLine_MSIE:function(){var e,t,i,n,r,o=this.doc.selection.createRange(),s=o.boundingTop,a=(o.boundingHeight,this.doc.body.scrollWidth);if(o.moveToPoint){for(0===s&&(i=this.doc.createElement("span"),this.insertNode(i),s=i.offsetTop,i.parentNode.removeChild(i)),s+=1,n=-10;a>n;n+=2)try{o.moveToPoint(n,s);break}catch(l){}for(e=s,t=this.doc.selection.createRange(),r=a;r>=0;r--)try{t.moveToPoint(r,e);break}catch(c){}o.setEndPoint("EndToEnd",t),o.select()}},getText:function(){var e=this.getSelection();return e?e.toString():""},getNodes:function(e,t){var i=this.getRange();return i?i.getNodes([e],t):[]},getRange:function(){var e=this.getSelection();return e&&e.rangeCount&&e.getRangeAt(0)},getSelection:function(){return rangy.getSelection(this.doc.defaultView||this.doc.parentWindow)},setSelection:function(e){var t=this.doc.defaultView||this.doc.parentWindow,i=rangy.getSelection(t);return i.setSingleRange(e)}})}(wysihtml5),function(e,t){function i(e,t,i){if(!e.className)return!1;var n=e.className.match(i)||[];return n[n.length-1]===t}function n(e,t,i){e.className?(r(e,i),e.className+=" "+t):e.className=t}function r(e,t){e.className&&(e.className=e.className.replace(t,""))}function o(e,t){return e.className.replace(f," ")==t.className.replace(f," ")}function s(e){for(var t=e.parentNode;e.firstChild;)t.insertBefore(e.firstChild,e);t.removeChild(e)}function a(e,t){if(e.attributes.length!=t.attributes.length)return!1;for(var i,n,r,o=0,s=e.attributes.length;s>o;++o)if(i=e.attributes[o],r=i.name,"class"!=r){if(n=t.attributes.getNamedItem(r),i.specified!=n.specified)return!1;if(i.specified&&i.nodeValue!==n.nodeValue)return!1}return!0}function l(e,i){return t.dom.isCharacterDataNode(e)?0==i?!!e.previousSibling:i==e.length?!!e.nextSibling:!0:i>0&&i<e.childNodes.length}function c(e,i,n){var r;if(t.dom.isCharacterDataNode(i)&&(0==n?(n=t.dom.getNodeIndex(i),i=i.parentNode):n==i.length?(n=t.dom.getNodeIndex(i)+1,i=i.parentNode):r=t.dom.splitDataNode(i,n)),!r){r=i.cloneNode(!1),r.id&&r.removeAttribute("id");for(var o;o=i.childNodes[n];)r.appendChild(o);t.dom.insertAfter(r,i)}return i==e?r:c(e,r.parentNode,t.dom.getNodeIndex(r))}function d(t){this.isElementMerge=t.nodeType==e.ELEMENT_NODE,this.firstTextNode=this.isElementMerge?t.lastChild:t,this.textNodes=[this.firstTextNode]}function h(e,t,i,n){this.tagNames=e||[u],this.cssClass=t||"",this.similarClassRegExp=i,this.normalize=n,this.applyToAnyTagName=!1}var u="span",f=/\s+/g;d.prototype={doMerge:function(){for(var e,t,i,n=[],r=0,o=this.textNodes.length;o>r;++r)e=this.textNodes[r],t=e.parentNode,n[r]=e.data,r&&(t.removeChild(e),t.hasChildNodes()||t.parentNode.removeChild(t));return this.firstTextNode.data=i=n.join(""),i},getLength:function(){for(var e=this.textNodes.length,t=0;e--;)t+=this.textNodes[e].length;return t},toString:function(){for(var e=[],t=0,i=this.textNodes.length;i>t;++t)e[t]="'"+this.textNodes[t].data+"'";return"[Merge("+e.join(",")+")]"}},h.prototype={getAncestorWithClass:function(n){for(var r;n;){if(r=this.cssClass?i(n,this.cssClass,this.similarClassRegExp):!0,n.nodeType==e.ELEMENT_NODE&&t.dom.arrayContains(this.tagNames,n.tagName.toLowerCase())&&r)return n;n=n.parentNode}return!1},postApply:function(e,t){for(var i,n,r,o=e[0],s=e[e.length-1],a=[],l=o,c=s,h=0,u=s.length,f=0,p=e.length;p>f;++f)n=e[f],r=this.getAdjacentMergeableTextNode(n.parentNode,!1),r?(i||(i=new d(r),a.push(i)),i.textNodes.push(n),n===o&&(l=i.firstTextNode,h=l.length),n===s&&(c=i.firstTextNode,u=i.getLength())):i=null;
var m=this.getAdjacentMergeableTextNode(s.parentNode,!0);if(m&&(i||(i=new d(s),a.push(i)),i.textNodes.push(m)),a.length){for(f=0,p=a.length;p>f;++f)a[f].doMerge();t.setStart(l,h),t.setEnd(c,u)}},getAdjacentMergeableTextNode:function(t,i){var n,r=t.nodeType==e.TEXT_NODE,o=r?t.parentNode:t,s=i?"nextSibling":"previousSibling";if(r){if(n=t[s],n&&n.nodeType==e.TEXT_NODE)return n}else if(n=o[s],n&&this.areElementsMergeable(t,n))return n[i?"firstChild":"lastChild"];return null},areElementsMergeable:function(e,i){return t.dom.arrayContains(this.tagNames,(e.tagName||"").toLowerCase())&&t.dom.arrayContains(this.tagNames,(i.tagName||"").toLowerCase())&&o(e,i)&&a(e,i)},createContainer:function(e){var t=e.createElement(this.tagNames[0]);return this.cssClass&&(t.className=this.cssClass),t},applyToTextNode:function(e){var i=e.parentNode;if(1==i.childNodes.length&&t.dom.arrayContains(this.tagNames,i.tagName.toLowerCase()))this.cssClass&&n(i,this.cssClass,this.similarClassRegExp);else{var r=this.createContainer(t.dom.getDocument(e));e.parentNode.insertBefore(r,e),r.appendChild(e)}},isRemovable:function(i){return t.dom.arrayContains(this.tagNames,i.tagName.toLowerCase())&&e.lang.string(i.className).trim()==this.cssClass},undoToTextNode:function(e,t,i){if(!t.containsNode(i)){var n=t.cloneRange();n.selectNode(i),n.isPointInRange(t.endContainer,t.endOffset)&&l(t.endContainer,t.endOffset)&&(c(i,t.endContainer,t.endOffset),t.setEndAfter(i)),n.isPointInRange(t.startContainer,t.startOffset)&&l(t.startContainer,t.startOffset)&&(i=c(i,t.startContainer,t.startOffset))}this.similarClassRegExp&&r(i,this.similarClassRegExp),this.isRemovable(i)&&s(i)},applyToRange:function(t){var i=t.getNodes([e.TEXT_NODE]);if(!i.length)try{var n=this.createContainer(t.endContainer.ownerDocument);return t.surroundContents(n),this.selectNode(t,n),void 0}catch(r){}if(t.splitBoundaries(),i=t.getNodes([e.TEXT_NODE]),i.length){for(var o,s=0,a=i.length;a>s;++s)o=i[s],this.getAncestorWithClass(o)||this.applyToTextNode(o);t.setStart(i[0],0),o=i[i.length-1],t.setEnd(o,o.length),this.normalize&&this.postApply(i,t)}},undoToRange:function(t){var i,n,r=t.getNodes([e.TEXT_NODE]);if(r.length)t.splitBoundaries(),r=t.getNodes([e.TEXT_NODE]);else{var o=t.endContainer.ownerDocument,s=o.createTextNode(e.INVISIBLE_SPACE);t.insertNode(s),t.selectNode(s),r=[s]}for(var a=0,l=r.length;l>a;++a)i=r[a],n=this.getAncestorWithClass(i),n&&this.undoToTextNode(i,t,n);1==l?this.selectNode(t,r[0]):(t.setStart(r[0],0),i=r[r.length-1],t.setEnd(i,i.length),this.normalize&&this.postApply(r,t))},selectNode:function(t,i){var n=i.nodeType===e.ELEMENT_NODE,r="canHaveHTML"in i?i.canHaveHTML:!0,o=n?i.innerHTML:i.data,s=""===o||o===e.INVISIBLE_SPACE;if(s&&n&&r)try{i.innerHTML=e.INVISIBLE_SPACE}catch(a){}t.selectNodeContents(i),s&&n?t.collapse(!1):s&&(t.setStartAfter(i),t.setEndAfter(i))},getTextSelectedByRange:function(e,t){var i=t.cloneRange();i.selectNodeContents(e);var n=i.intersection(t),r=n?n.toString():"";return i.detach(),r},isAppliedToRange:function(t){var i,n=[],r=t.getNodes([e.TEXT_NODE]);if(!r.length)return i=this.getAncestorWithClass(t.startContainer),i?[i]:!1;for(var o,s=0,a=r.length;a>s;++s){if(o=this.getTextSelectedByRange(r[s],t),i=this.getAncestorWithClass(r[s]),""!=o&&!i)return!1;n.push(i)}return n},toggleRange:function(e){this.isAppliedToRange(e)?this.undoToRange(e):this.applyToRange(e)}},e.selection.HTMLApplier=h}(wysihtml5,rangy),wysihtml5.Commands=Base.extend({constructor:function(e){this.editor=e,this.composer=e.composer,this.doc=this.composer.doc},support:function(e){return wysihtml5.browser.supportsCommand(this.doc,e)},exec:function(e,t){var i=wysihtml5.commands[e],n=wysihtml5.lang.array(arguments).get(),r=i&&i.exec,o=null;if(this.editor.fire("beforecommand:composer"),r)n.unshift(this.composer),o=r.apply(i,n);else try{o=this.doc.execCommand(e,!1,t)}catch(s){}return this.editor.fire("aftercommand:composer"),o},state:function(e){var t=wysihtml5.commands[e],i=wysihtml5.lang.array(arguments).get(),n=t&&t.state;if(n)return i.unshift(this.composer),n.apply(t,i);try{return this.doc.queryCommandState(e)}catch(r){return!1}},value:function(e){var t=wysihtml5.commands[e],i=t&&t.value;if(i)return i.call(t,this.composer,e);try{return this.doc.queryCommandValue(e)}catch(n){return null}}}),function(e){var t;e.commands.bold={exec:function(t,i){return e.commands.formatInline.exec(t,i,"b")},state:function(t,i){return e.commands.formatInline.state(t,i,"b")},value:function(){return t}}}(wysihtml5),function(e){function t(e,t){for(var i,n,r,s=t.length,a=0;s>a;a++)i=t[a],n=o.getParentElement(i,{nodeName:"code"}),r=o.getTextContent(i),r.match(o.autoLink.URL_REG_EXP)&&!n?n=o.renameElement(i,"code"):o.replaceWithChildNodes(i)}function i(t,i){var s,a,l,c,d,h,u,f,p,m=t.doc,g="_wysihtml5-temp-"+ +new Date,v=/non-matching-class/g,b=0;for(e.commands.formatInline.exec(t,n,r,g,v),a=m.querySelectorAll(r+"."+g),s=a.length;s>b;b++){l=a[b],l.removeAttribute("class");for(p in i)l.setAttribute(p,i[p])}h=l,1===s&&(u=o.getTextContent(l),c=!!l.querySelector("*"),d=""===u||u===e.INVISIBLE_SPACE,!c&&d&&(o.setTextContent(l,i.text||l.href),f=m.createTextNode(" "),t.selection.setAfter(l),t.selection.insertNode(f),h=f)),t.selection.setAfter(h)}var n,r="A",o=e.dom;e.commands.createLink={exec:function(e,n,r){var o=this.state(e,n);o?e.selection.executeAndRestore(function(){t(e,o)}):(r="object"==typeof r?r:{href:r},i(e,r))},state:function(t,i){return e.commands.formatInline.state(t,i,"A")},value:function(){return n}}}(wysihtml5),function(e){var t,i=/wysiwyg-font-size-[a-z\-]+/g;e.commands.fontSize={exec:function(t,n,r){return e.commands.formatInline.exec(t,n,"span","wysiwyg-font-size-"+r,i)},state:function(t,n,r){return e.commands.formatInline.state(t,n,"span","wysiwyg-font-size-"+r,i)},value:function(){return t}}}(wysihtml5),function(e){var t,i=/wysiwyg-color-[a-z]+/g;e.commands.foreColor={exec:function(t,n,r){return e.commands.formatInline.exec(t,n,"span","wysiwyg-color-"+r,i)},state:function(t,n,r){return e.commands.formatInline.state(t,n,"span","wysiwyg-color-"+r,i)},value:function(){return t}}}(wysihtml5),function(e){function t(e,t,n){e.className?(i(e,n),e.className+=" "+t):e.className=t}function i(e,t){e.className=e.className.replace(t,"")}function n(t){return t.nodeType===e.TEXT_NODE&&!e.lang.string(t.data).trim()}function r(e){for(var t=e.previousSibling;t&&n(t);)t=t.previousSibling;return t}function o(e){for(var t=e.nextSibling;t&&n(t);)t=t.nextSibling;return t}function s(e){var t=e.ownerDocument,i=o(e),n=r(e);i&&!d(i)&&e.parentNode.insertBefore(t.createElement("br"),i),n&&!d(n)&&e.parentNode.insertBefore(t.createElement("br"),e)}function a(e){var t=o(e),i=r(e);t&&c(t)&&t.parentNode.removeChild(t),i&&c(i)&&i.parentNode.removeChild(i)}function l(e){var t=e.lastChild;t&&c(t)&&t.parentNode.removeChild(t)}function c(e){return"BR"===e.nodeName}function d(e){return c(e)?!0:"block"===m.getStyle("display").from(e)?!0:!1}function h(t,i,n,r){if(r)var o=m.observe(t,"DOMNodeInserted",function(t){var i,n=t.target;n.nodeType===e.ELEMENT_NODE&&(i=m.getStyle("display").from(n),"inline"!==i.substr(0,6)&&(n.className+=" "+r))});t.execCommand(i,!1,n),o&&o.stop()}function u(e,t){e.selection.selectLine(),e.selection.surround(t),a(t),l(t),e.selection.selectNode(t)}function f(t){return!!e.lang.string(t.className).trim()}var p,m=e.dom,g="DIV",v=["H1","H2","H3","H4","H5","H6","P","BLOCKQUOTE",g];e.commands.formatBlock={exec:function(n,r,o,a,l){var c,d=n.doc,p=this.state(n,r,o,a,l);return o="string"==typeof o?o.toUpperCase():o,p?(n.selection.executeAndRestoreSimple(function(){l&&i(p,l);var e=f(p);e||p.nodeName!==(o||g)?e&&m.renameElement(p,g):(s(p),m.replaceWithChildNodes(p))}),void 0):(null===o||e.lang.array(v).contains(o))&&(c=n.selection.getSelectedNode(),p=m.getParentElement(c,{nodeName:v}))?(n.selection.executeAndRestoreSimple(function(){o&&(p=m.renameElement(p,o)),a&&t(p,a,l)}),void 0):n.commands.support(r)?(h(d,r,o||g,a),void 0):(p=d.createElement(o||g),a&&(p.className=a),u(n,p),void 0)},state:function(e,t,i,n,r){i="string"==typeof i?i.toUpperCase():i;var o=e.selection.getSelectedNode();return m.getParentElement(o,{nodeName:i,className:n,classRegExp:r})},value:function(){return p}}}(wysihtml5),function(e){function t(e){var t=r[e];return t?[e.toLowerCase(),t.toLowerCase()]:[e.toLowerCase()]}function i(i,n,r){var s=i+":"+n;return o[s]||(o[s]=new e.selection.HTMLApplier(t(i),n,r,!0)),o[s]}var n,r={strong:"b",em:"i",b:"strong",i:"em"},o={};e.commands.formatInline={exec:function(e,t,n,r,o){var s=e.selection.getRange();return s?(i(n,r,o).toggleRange(s),e.selection.setSelection(s),void 0):!1},state:function(t,n,o,s,a){var l,c=t.doc,d=r[o]||o;return e.dom.hasElementWithTagName(c,o)||e.dom.hasElementWithTagName(c,d)?s&&!e.dom.hasElementWithClassName(c,s)?!1:(l=t.selection.getRange(),l?i(o,s,a).isAppliedToRange(l):!1):!1},value:function(){return n}}}(wysihtml5),function(e){var t;e.commands.insertHTML={exec:function(e,t,i){e.commands.support(t)?e.doc.execCommand(t,!1,i):e.selection.insertHTML(i)},state:function(){return!1},value:function(){return t}}}(wysihtml5),function(e){var t="IMG";e.commands.insertImage={exec:function(i,n,r){r="object"==typeof r?r:{src:r};var o,s,a,l=i.doc,c=this.state(i);if(c)return i.selection.setBefore(c),a=c.parentNode,a.removeChild(c),e.dom.removeEmptyTextNodes(a),"A"!==a.nodeName||a.firstChild||(i.selection.setAfter(a),a.parentNode.removeChild(a)),e.quirks.redraw(i.element),void 0;c=l.createElement(t);for(s in r)c[s]=r[s];i.selection.insertNode(c),e.browser.hasProblemsSettingCaretAfterImg()?(o=l.createTextNode(e.INVISIBLE_SPACE),i.selection.insertNode(o),i.selection.setAfter(o)):i.selection.setAfter(c)},state:function(i){var n,r,o,s=i.doc;return e.dom.hasElementWithTagName(s,t)?(n=i.selection.getSelectedNode())?n.nodeName===t?n:n.nodeType!==e.ELEMENT_NODE?!1:(r=i.selection.getText(),(r=e.lang.string(r).trim())?!1:(o=i.selection.getNodes(e.ELEMENT_NODE,function(e){return"IMG"===e.nodeName}),1!==o.length?!1:o[0])):!1:!1},value:function(e){var t=this.state(e);return t&&t.src}}}(wysihtml5),function(e){var t,i="<br>"+(e.browser.needsSpaceAfterLineBreak()?" ":"");e.commands.insertLineBreak={exec:function(t,n){t.commands.support(n)?(t.doc.execCommand(n,!1,null),e.browser.autoScrollsToCaret()||t.selection.scrollIntoView()):t.commands.exec("insertHTML",i)},state:function(){return!1},value:function(){return t}}}(wysihtml5),function(e){var t;e.commands.insertOrderedList={exec:function(t,i){var n,r,o=t.doc,s=t.selection.getSelectedNode(),a=e.dom.getParentElement(s,{nodeName:"OL"}),l=e.dom.getParentElement(s,{nodeName:"UL"}),c="_wysihtml5-temp-"+(new Date).getTime();return t.commands.support(i)?(o.execCommand(i,!1,null),void 0):(a?t.selection.executeAndRestoreSimple(function(){e.dom.resolveList(a)}):l?t.selection.executeAndRestoreSimple(function(){e.dom.renameElement(l,"ol")}):(t.commands.exec("formatBlock","div",c),r=o.querySelector("."+c),n=""===r.innerHTML||r.innerHTML===e.INVISIBLE_SPACE,t.selection.executeAndRestoreSimple(function(){a=e.dom.convertToList(r,"ol")}),n&&t.selection.selectNode(a.querySelector("li"))),void 0)},state:function(t){var i=t.selection.getSelectedNode();return e.dom.getParentElement(i,{nodeName:"OL"})},value:function(){return t}}}(wysihtml5),function(e){var t;e.commands.insertUnorderedList={exec:function(t,i){var n,r,o=t.doc,s=t.selection.getSelectedNode(),a=e.dom.getParentElement(s,{nodeName:"UL"}),l=e.dom.getParentElement(s,{nodeName:"OL"}),c="_wysihtml5-temp-"+(new Date).getTime();return t.commands.support(i)?(o.execCommand(i,!1,null),void 0):(a?t.selection.executeAndRestoreSimple(function(){e.dom.resolveList(a)}):l?t.selection.executeAndRestoreSimple(function(){e.dom.renameElement(l,"ul")}):(t.commands.exec("formatBlock","div",c),r=o.querySelector("."+c),n=""===r.innerHTML||r.innerHTML===e.INVISIBLE_SPACE,t.selection.executeAndRestoreSimple(function(){a=e.dom.convertToList(r,"ul")}),n&&t.selection.selectNode(a.querySelector("li"))),void 0)},state:function(t){var i=t.selection.getSelectedNode();return e.dom.getParentElement(i,{nodeName:"UL"})},value:function(){return t}}}(wysihtml5),function(e){var t;e.commands.italic={exec:function(t,i){return e.commands.formatInline.exec(t,i,"i")},state:function(t,i){return e.commands.formatInline.state(t,i,"i")},value:function(){return t}}}(wysihtml5),function(e){var t,i="wysiwyg-text-align-center",n=/wysiwyg-text-align-[a-z]+/g;e.commands.justifyCenter={exec:function(t){return e.commands.formatBlock.exec(t,"formatBlock",null,i,n)},state:function(t){return e.commands.formatBlock.state(t,"formatBlock",null,i,n)},value:function(){return t}}}(wysihtml5),function(e){var t,i="wysiwyg-text-align-left",n=/wysiwyg-text-align-[a-z]+/g;e.commands.justifyLeft={exec:function(t){return e.commands.formatBlock.exec(t,"formatBlock",null,i,n)},state:function(t){return e.commands.formatBlock.state(t,"formatBlock",null,i,n)},value:function(){return t}}}(wysihtml5),function(e){var t,i="wysiwyg-text-align-right",n=/wysiwyg-text-align-[a-z]+/g;e.commands.justifyRight={exec:function(t){return e.commands.formatBlock.exec(t,"formatBlock",null,i,n)},state:function(t){return e.commands.formatBlock.state(t,"formatBlock",null,i,n)},value:function(){return t}}}(wysihtml5),function(e){var t;e.commands.underline={exec:function(t,i){return e.commands.formatInline.exec(t,i,"u")},state:function(t,i){return e.commands.formatInline.state(t,i,"u")},value:function(){return t}}}(wysihtml5),function(e){function t(e){for(var t;t=e.querySelector("._wysihtml5-temp");)t.parentNode.removeChild(t)}var i=90,n=89,r=8,o=46,s=40,a='<span id="_wysihtml5-undo" class="_wysihtml5-temp">'+e.INVISIBLE_SPACE+"</span>",l='<span id="_wysihtml5-redo" class="_wysihtml5-temp">'+e.INVISIBLE_SPACE+"</span>",c=e.dom;e.UndoManager=e.lang.Dispatcher.extend({constructor:function(e){this.editor=e,this.composer=e.composer,this.element=this.composer.element,this.history=[this.composer.getValue()],this.position=1,this.composer.commands.support("insertHTML")&&this._observe()},_observe:function(){var s,d=this,h=this.composer.sandbox.getDocument();if(c.observe(this.element,"keydown",function(e){if(!e.altKey&&(e.ctrlKey||e.metaKey)){var t=e.keyCode,r=t===i&&!e.shiftKey,o=t===i&&e.shiftKey||t===n;r?(d.undo(),e.preventDefault()):o&&(d.redo(),e.preventDefault())}}),c.observe(this.element,"keydown",function(e){var t=e.keyCode;t!==s&&(s=t,(t===r||t===o)&&d.transact())}),e.browser.hasUndoInContextMenu()){var u,f,p=function(){t(h),clearInterval(u)};c.observe(this.element,"contextmenu",function(){p(),d.composer.selection.executeAndRestoreSimple(function(){d.element.lastChild&&d.composer.selection.setAfter(d.element.lastChild),h.execCommand("insertHTML",!1,a),h.execCommand("insertHTML",!1,l),h.execCommand("undo",!1,null)}),u=setInterval(function(){h.getElementById("_wysihtml5-redo")?(p(),d.redo()):h.getElementById("_wysihtml5-undo")||(p(),d.undo())},400),f||(f=!0,c.observe(document,"mousedown",p),c.observe(h,["mousedown","paste","cut","copy"],p))})}this.editor.observe("newword:composer",function(){d.transact()}).observe("beforecommand:composer",function(){d.transact()})},transact:function(){var e=this.history[this.position-1],t=this.composer.getValue();if(t!=e){var i=this.history.length=this.position;i>s&&(this.history.shift(),this.position--),this.position++,this.history.push(t)}},undo:function(){this.transact(),this.position<=1||(this.set(this.history[--this.position-1]),this.editor.fire("undo:composer"))},redo:function(){this.position>=this.history.length||(this.set(this.history[++this.position-1]),this.editor.fire("redo:composer"))},set:function(e){this.composer.setValue(e),this.editor.focus(!0)}})}(wysihtml5),wysihtml5.views.View=Base.extend({constructor:function(e,t,i){this.parent=e,this.element=t,this.config=i,this._observeViewChange()},_observeViewChange:function(){var e=this;this.parent.observe("beforeload",function(){e.parent.observe("change_view",function(t){t===e.name?(e.parent.currentView=e,e.show(),setTimeout(function(){e.focus()},0)):e.hide()})})},focus:function(){if(this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element.focus()}catch(e){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}}),function(e){var t=e.dom,i=e.browser;e.views.Composer=e.views.View.extend({name:"composer",CARET_HACK:"<br>",constructor:function(e,t,i){this.base(e,t,i),this.textarea=this.parent.textarea,this._initSandbox()},clear:function(){this.element.innerHTML=i.displaysCaretInEmptyContentEditableCorrectly()?"":this.CARET_HACK},getValue:function(t){var i=this.isEmpty()?"":e.quirks.getCorrectInnerHTML(this.element);return t&&(i=this.parent.parse(i)),i=e.lang.string(i).replace(e.INVISIBLE_SPACE).by("")},setValue:function(e,t){t&&(e=this.parent.parse(e)),this.element.innerHTML=e},show:function(){this.iframe.style.display=this._displayStyle||"",this.disable(),this.enable()},hide:function(){this._displayStyle=t.getStyle("display").from(this.iframe),"none"===this._displayStyle&&(this._displayStyle=null),this.iframe.style.display="none"},disable:function(){this.element.removeAttribute("contentEditable"),this.base()},enable:function(){this.element.setAttribute("contentEditable","true"),this.base()},focus:function(t){e.browser.doesAsyncFocus()&&this.hasPlaceholderSet()&&this.clear(),this.base();var i=this.element.lastChild;t&&i&&("BR"===i.nodeName?this.selection.setBefore(this.element.lastChild):this.selection.setAfter(this.element.lastChild))},getTextContent:function(){return t.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==this.textarea.element.getAttribute("placeholder")},isEmpty:function(){var e=this.element.innerHTML,t="blockquote, ul, ol, img, embed, object, table, iframe, svg, video, audio, button, input, select, textarea";return""===e||e===this.CARET_HACK||this.hasPlaceholderSet()||""===this.getTextContent()&&!this.element.querySelector(t)},_initSandbox:function(){var e=this;this.sandbox=new t.Sandbox(function(){e._create()},{stylesheets:this.config.stylesheets}),this.iframe=this.sandbox.getIframe();var i=document.createElement("input");i.type="hidden",i.name="_wysihtml5_mode",i.value=1;var n=this.textarea.element;t.insert(this.iframe).after(n),t.insert(i).after(n)},_create:function(){var n=this;this.doc=this.sandbox.getDocument(),this.element=this.doc.body,this.textarea=this.parent.textarea,this.element.innerHTML=this.textarea.getValue(!0),this.enable(),this.selection=new e.Selection(this.parent),this.commands=new e.Commands(this.parent),t.copyAttributes(["className","spellcheck","title","lang","dir","accessKey"]).from(this.textarea.element).to(this.element),t.addClass(this.element,this.config.composerClassName),this.config.style&&this.style(),this.observe();var r=this.config.name;r&&(t.addClass(this.element,r),t.addClass(this.iframe,r));var o="string"==typeof this.config.placeholder?this.config.placeholder:this.textarea.element.getAttribute("placeholder");o&&t.simulatePlaceholder(this.parent,this,o),this.commands.exec("styleWithCSS",!1),this._initAutoLinking(),this._initObjectResizing(),this._initUndoManager(),(this.textarea.element.hasAttribute("autofocus")||document.querySelector(":focus")==this.textarea.element)&&setTimeout(function(){n.focus()},100),e.quirks.insertLineBreakOnReturn(this),i.clearsContentEditableCorrectly()||e.quirks.ensureProperClearing(this),i.clearsListsInContentEditableCorrectly()||e.quirks.ensureProperClearingOfLists(this),this.initSync&&this.config.sync&&this.initSync(),this.textarea.hide(),this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var n=this,r=i.canDisableAutoLinking(),o=i.doesAutoLinkingInContentEditable();if(r&&this.commands.exec("autoUrlDetect",!1),this.config.autoLink){(!o||o&&r)&&this.parent.observe("newword:composer",function(){n.selection.executeAndRestore(function(e,i){t.autoLink(i.parentNode)})});var s=this.sandbox.getDocument().getElementsByTagName("a"),a=t.autoLink.URL_REG_EXP,l=function(i){var n=e.lang.string(t.getTextContent(i)).trim();return"www."===n.substr(0,4)&&(n="http://"+n),n};t.observe(this.element,"keydown",function(e){if(s.length){var i,r=n.selection.getSelectedNode(e.target.ownerDocument),o=t.getParentElement(r,{nodeName:"A"},4);o&&(i=l(o),setTimeout(function(){var e=l(o);e!==i&&e.match(a)&&o.setAttribute("href",e)},0))}})}},_initObjectResizing:function(){var n=["width","height"],r=n.length,o=this.element;this.commands.exec("enableObjectResizing",this.config.allowObjectResizing),this.config.allowObjectResizing?i.supportsEvent("resizeend")&&t.observe(o,"resizeend",function(t){for(var i,s=t.target||t.srcElement,a=s.style,l=0;r>l;l++)i=n[l],a[i]&&(s.setAttribute(i,parseInt(a[i],10)),a[i]="");e.quirks.redraw(o)}):i.supportsEvent("resizestart")&&t.observe(o,"resizestart",function(e){e.preventDefault()})},_initUndoManager:function(){new e.UndoManager(this.parent)}})}(wysihtml5),function(e){var t=e.dom,i=document,n=window,r=i.createElement("div"),o=["background-color","color","cursor","font-family","font-size","font-style","font-variant","font-weight","line-height","letter-spacing","text-align","text-decoration","text-indent","text-rendering","word-break","word-wrap","word-spacing"],s=["background-color","border-collapse","border-bottom-color","border-bottom-style","border-bottom-width","border-left-color","border-left-style","border-left-width","border-right-color","border-right-style","border-right-width","border-top-color","border-top-style","border-top-width","clear","display","float","margin-bottom","margin-left","margin-right","margin-top","outline-color","outline-offset","outline-width","outline-style","padding-left","padding-right","padding-top","padding-bottom","position","top","left","right","bottom","z-index","vertical-align","text-align","-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing","-webkit-box-shadow","-moz-box-shadow","-ms-box-shadow","box-shadow","-webkit-border-top-right-radius","-moz-border-radius-topright","border-top-right-radius","-webkit-border-bottom-right-radius","-moz-border-radius-bottomright","border-bottom-right-radius","-webkit-border-bottom-left-radius","-moz-border-radius-bottomleft","border-bottom-left-radius","-webkit-border-top-left-radius","-moz-border-radius-topleft","border-top-left-radius","width","height"],a=["width","height","top","left","right","bottom"],l=["html             { height: 100%; }","body             { min-height: 100%; padding: 0; margin: 0; margin-top: -1px; padding-top: 1px; }","._wysihtml5-temp { display: none; }",e.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","body[disabled]   { background-color: #eee !important; color: #999 !important; cursor: default !important; }","img:-moz-broken  { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"],c=function(e){if(e.setActive)try{e.setActive()}catch(r){}else{var o=e.style,s=i.documentElement.scrollTop||i.body.scrollTop,a=i.documentElement.scrollLeft||i.body.scrollLeft,l={position:o.position,top:o.top,left:o.left,WebkitUserSelect:o.WebkitUserSelect};t.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(e),e.focus(),t.setStyles(l).on(e),n.scrollTo&&n.scrollTo(a,s)}};e.views.Composer.prototype.style=function(){var d=this,h=i.querySelector(":focus"),u=this.textarea.element,f=u.hasAttribute("placeholder"),p=f&&u.getAttribute("placeholder");this.focusStylesHost=this.focusStylesHost||r.cloneNode(!1),this.blurStylesHost=this.blurStylesHost||r.cloneNode(!1),f&&u.removeAttribute("placeholder"),u===h&&u.blur(),t.copyStyles(s).from(u).to(this.iframe).andTo(this.blurStylesHost),t.copyStyles(o).from(u).to(this.element).andTo(this.blurStylesHost),t.insertCSS(l).into(this.element.ownerDocument),c(u),t.copyStyles(s).from(u).to(this.focusStylesHost),t.copyStyles(o).from(u).to(this.focusStylesHost);var m=e.lang.array(s).without(["display"]);if(h?h.focus():u.blur(),f&&u.setAttribute("placeholder",p),!e.browser.hasCurrentStyleProperty())var g=t.observe(n,"resize",function(){if(!t.contains(document.documentElement,d.iframe))return g.stop(),void 0;var e=t.getStyle("display").from(u),i=t.getStyle("display").from(d.iframe);u.style.display="",d.iframe.style.display="none",t.copyStyles(a).from(u).to(d.iframe).andTo(d.focusStylesHost).andTo(d.blurStylesHost),d.iframe.style.display=i,u.style.display=e});return this.parent.observe("focus:composer",function(){t.copyStyles(m).from(d.focusStylesHost).to(d.iframe),t.copyStyles(o).from(d.focusStylesHost).to(d.element)}),this.parent.observe("blur:composer",function(){t.copyStyles(m).from(d.blurStylesHost).to(d.iframe),t.copyStyles(o).from(d.blurStylesHost).to(d.element)}),this}}(wysihtml5),function(e){var t=e.dom,i=e.browser,n={66:"bold",73:"italic",85:"underline"};e.views.Composer.prototype.observe=function(){var r=this,o=this.getValue(),s=this.sandbox.getIframe(),a=this.element,l=i.supportsEventsInIframeCorrectly()?a:this.sandbox.getWindow(),c=i.supportsEvent("drop")?["drop","paste"]:["dragdrop","paste"];t.observe(s,"DOMNodeRemoved",function(){clearInterval(d),r.parent.fire("destroy:composer")});var d=setInterval(function(){t.contains(document.documentElement,s)||(clearInterval(d),r.parent.fire("destroy:composer"))},250);t.observe(l,"focus",function(){r.parent.fire("focus").fire("focus:composer"),setTimeout(function(){o=r.getValue()},0)}),t.observe(l,"blur",function(){o!==r.getValue()&&r.parent.fire("change").fire("change:composer"),r.parent.fire("blur").fire("blur:composer")}),e.browser.isIos()&&t.observe(a,"blur",function(){var e=a.ownerDocument.createElement("input"),t=document.documentElement.scrollTop||document.body.scrollTop,i=document.documentElement.scrollLeft||document.body.scrollLeft;try{r.selection.insertNode(e)}catch(n){a.appendChild(e)}e.focus(),e.parentNode.removeChild(e),window.scrollTo(i,t)}),t.observe(a,"dragenter",function(){r.parent.fire("unset_placeholder")}),i.firesOnDropOnlyWhenOnDragOverIsCancelled()&&t.observe(a,["dragover","dragenter"],function(e){e.preventDefault()}),t.observe(a,c,function(e){var t,n=e.dataTransfer;n&&i.supportsDataTransfer()&&(t=n.getData("text/html")||n.getData("text/plain")),t?(a.focus(),r.commands.exec("insertHTML",t),r.parent.fire("paste").fire("paste:composer"),e.stopPropagation(),e.preventDefault()):setTimeout(function(){r.parent.fire("paste").fire("paste:composer")},0)}),t.observe(a,"keyup",function(t){var i=t.keyCode;(i===e.SPACE_KEY||i===e.ENTER_KEY)&&r.parent.fire("newword:composer")}),this.parent.observe("paste:composer",function(){setTimeout(function(){r.parent.fire("newword:composer")},0)}),i.canSelectImagesInContentEditable()||t.observe(a,"mousedown",function(e){var t=e.target;"IMG"===t.nodeName&&(r.selection.selectNode(t),e.preventDefault())}),t.observe(a,"keydown",function(e){var t=e.keyCode,i=n[t];(e.ctrlKey||e.metaKey)&&!e.altKey&&i&&(r.commands.exec(i),e.preventDefault())}),t.observe(a,"keydown",function(t){var i,n=r.selection.getSelectedNode(!0),o=t.keyCode;!n||"IMG"!==n.nodeName||o!==e.BACKSPACE_KEY&&o!==e.DELETE_KEY||(i=n.parentNode,i.removeChild(n),"A"!==i.nodeName||i.firstChild||i.parentNode.removeChild(i),setTimeout(function(){e.quirks.redraw(a)},0),t.preventDefault())});var h={IMG:"Image: ",A:"Link: "};t.observe(a,"mouseover",function(e){var t,i=e.target,n=i.nodeName;if("A"===n||"IMG"===n){var r=i.hasAttribute("title");r||(t=h[n]+(i.getAttribute("href")||i.getAttribute("src")),i.setAttribute("title",t))}})}}(wysihtml5),function(e){var t=400;e.views.Synchronizer=Base.extend({constructor:function(e,t,i){this.editor=e,this.textarea=t,this.composer=i,this._observe()},fromComposerToTextarea:function(t){this.textarea.setValue(e.lang.string(this.composer.getValue()).trim(),t)},fromTextareaToComposer:function(e){var t=this.textarea.getValue();t?this.composer.setValue(t,e):(this.composer.clear(),this.editor.fire("set_placeholder"))},sync:function(e){"textarea"===this.editor.currentView.name?this.fromTextareaToComposer(e):this.fromComposerToTextarea(e)},_observe:function(){var i,n=this,r=this.textarea.element.form,o=function(){i=setInterval(function(){n.fromComposerToTextarea()},t)},s=function(){clearInterval(i),i=null};o(),r&&(e.dom.observe(r,"submit",function(){n.sync(!0)}),e.dom.observe(r,"reset",function(){setTimeout(function(){n.fromTextareaToComposer()},0)})),this.editor.observe("change_view",function(e){"composer"!==e||i?"textarea"===e&&(n.fromComposerToTextarea(!0),s()):(n.fromTextareaToComposer(!0),o())}),this.editor.observe("destroy:composer",s)}})}(wysihtml5),wysihtml5.views.Textarea=wysihtml5.views.View.extend({name:"textarea",constructor:function(e,t,i){this.base(e,t,i),this._observe()},clear:function(){this.element.value=""},getValue:function(e){var t=this.isEmpty()?"":this.element.value;return e&&(t=this.parent.parse(t)),t},setValue:function(e,t){t&&(e=this.parent.parse(e)),this.element.value=e},hasPlaceholderSet:function(){var e=wysihtml5.browser.supportsPlaceholderAttributeOn(this.element),t=this.element.getAttribute("placeholder")||null,i=this.element.value,n=!i;return e&&n||i===t},isEmpty:function(){return!wysihtml5.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var e=this.element,t=this.parent,i={focusin:"focus",focusout:"blur"},n=wysihtml5.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];t.observe("beforeload",function(){wysihtml5.dom.observe(e,n,function(e){var n=i[e.type]||e.type;t.fire(n).fire(n+":textarea")}),wysihtml5.dom.observe(e,["paste","drop"],function(){setTimeout(function(){t.fire("paste").fire("paste:textarea")},0)})})}}),function(e){var t=e.dom,i="wysihtml5-command-dialog-opened",n="input, select, textarea",r="[data-wysihtml5-dialog-field]",o="data-wysihtml5-dialog-field";e.toolbar.Dialog=e.lang.Dispatcher.extend({constructor:function(e,t){this.link=e,this.container=t},_observe:function(){if(!this._observed){var r=this,o=function(e){var t=r._serialize();t==r.elementToChange?r.fire("edit",t):r.fire("save",t),r.hide(),e.preventDefault(),e.stopPropagation()};t.observe(r.link,"click",function(){t.hasClass(r.link,i)&&setTimeout(function(){r.hide()},0)}),t.observe(this.container,"keydown",function(t){var i=t.keyCode;i===e.ENTER_KEY&&o(t),i===e.ESCAPE_KEY&&r.hide()}),t.delegate(this.container,"[data-wysihtml5-dialog-action=save]","click",o),t.delegate(this.container,"[data-wysihtml5-dialog-action=cancel]","click",function(e){r.fire("cancel"),r.hide(),e.preventDefault(),e.stopPropagation()});for(var s=this.container.querySelectorAll(n),a=0,l=s.length,c=function(){clearInterval(r.interval)};l>a;a++)t.observe(s[a],"change",c);this._observed=!0}},_serialize:function(){for(var e=this.elementToChange||{},t=this.container.querySelectorAll(r),i=t.length,n=0;i>n;n++)e[t[n].getAttribute(o)]=t[n].value;return e},_interpolate:function(e){for(var t,i,n,s=document.querySelector(":focus"),a=this.container.querySelectorAll(r),l=a.length,c=0;l>c;c++)t=a[c],t!==s&&(e&&"hidden"===t.type||(i=t.getAttribute(o),n=this.elementToChange?this.elementToChange[i]||"":t.defaultValue,t.value=n))},show:function(e){var r=this,o=this.container.querySelector(n);if(this.elementToChange=e,this._observe(),this._interpolate(),e&&(this.interval=setInterval(function(){r._interpolate(!0)},500)),t.addClass(this.link,i),this.container.style.display="",this.fire("show"),o&&!e)try{o.focus()}catch(s){}},hide:function(){clearInterval(this.interval),this.elementToChange=null,t.removeClass(this.link,i),this.container.style.display="none",this.fire("hide")}})}(wysihtml5),function(e){var t=e.dom,i={position:"relative"},n={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1},r={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"},o={"x-webkit-speech":"",speech:""};e.toolbar.Speech=function(s,a){var l=document.createElement("input");if(!e.browser.supportsSpeechApiOn(l))return a.style.display="none",void 0;var c=document.createElement("div");e.lang.object(n).merge({width:a.offsetWidth+"px",height:a.offsetHeight+"px"}),t.insert(l).into(c),t.insert(c).into(a),t.setStyles(r).on(l),t.setAttributes(o).on(l),t.setStyles(n).on(c),t.setStyles(i).on(a);var d="onwebkitspeechchange"in l?"webkitspeechchange":"speechchange";t.observe(l,d,function(){s.execCommand("insertText",l.value),l.value=""}),t.observe(l,"click",function(e){t.hasClass(a,"wysihtml5-command-disabled")&&e.preventDefault(),e.stopPropagation()})}}(wysihtml5),function(e){var t="wysihtml5-command-disabled",i="wysihtml5-commands-disabled",n="wysihtml5-command-active",r="wysihtml5-action-active",o=e.dom;
e.toolbar.Toolbar=Base.extend({constructor:function(t,i){this.editor=t,this.container="string"==typeof i?document.getElementById(i):i,this.composer=t.composer,this._getLinks("command"),this._getLinks("action"),this._observe(),this.show();for(var n=this.container.querySelectorAll("[data-wysihtml5-command=insertSpeech]"),r=n.length,o=0;r>o;o++)new e.toolbar.Speech(this,n[o])},_getLinks:function(t){for(var i,n,r,o,s,a=this[t+"Links"]=e.lang.array(this.container.querySelectorAll("[data-wysihtml5-"+t+"]")).get(),l=a.length,c=0,d=this[t+"Mapping"]={};l>c;c++)i=a[c],r=i.getAttribute("data-wysihtml5-"+t),o=i.getAttribute("data-wysihtml5-"+t+"-value"),n=this.container.querySelector("[data-wysihtml5-"+t+"-group='"+r+"']"),s=this._getDialog(i,r),d[r+":"+o]={link:i,group:n,name:r,value:o,dialog:s,state:!1}},_getDialog:function(t,i){var n,r,o=this,s=this.container.querySelector("[data-wysihtml5-dialog='"+i+"']");return s&&(n=new e.toolbar.Dialog(t,s),n.observe("show",function(){r=o.composer.selection.getBookmark(),o.editor.fire("show:dialog",{command:i,dialogContainer:s,commandLink:t})}),n.observe("save",function(e){r&&o.composer.selection.setBookmark(r),o._execCommand(i,e),o.editor.fire("save:dialog",{command:i,dialogContainer:s,commandLink:t})}),n.observe("cancel",function(){o.editor.focus(!1),o.editor.fire("cancel:dialog",{command:i,dialogContainer:s,commandLink:t})})),n},execCommand:function(e,t){if(!this.commandsDisabled){var i=this.commandMapping[e+":"+t];i&&i.dialog&&!i.state?i.dialog.show():this._execCommand(e,t)}},_execCommand:function(e,t){this.editor.focus(!1),this.composer.commands.exec(e,t),this._updateLinkStates()},execAction:function(e){var t=this.editor;switch(e){case"change_view":t.currentView===t.textarea?t.fire("change_view","composer"):t.fire("change_view","textarea")}},_observe:function(){for(var e=this,t=this.editor,n=this.container,r=this.commandLinks.concat(this.actionLinks),s=r.length,a=0;s>a;a++)o.setAttributes({href:"javascript:;",unselectable:"on"}).on(r[a]);o.delegate(n,"[data-wysihtml5-command]","mousedown",function(e){e.preventDefault()}),o.delegate(n,"[data-wysihtml5-command]","click",function(t){var i=this,n=i.getAttribute("data-wysihtml5-command"),r=i.getAttribute("data-wysihtml5-command-value");e.execCommand(n,r),t.preventDefault()}),o.delegate(n,"[data-wysihtml5-action]","click",function(t){var i=this.getAttribute("data-wysihtml5-action");e.execAction(i),t.preventDefault()}),t.observe("focus:composer",function(){e.bookmark=null,clearInterval(e.interval),e.interval=setInterval(function(){e._updateLinkStates()},500)}),t.observe("blur:composer",function(){clearInterval(e.interval)}),t.observe("destroy:composer",function(){clearInterval(e.interval)}),t.observe("change_view",function(t){setTimeout(function(){e.commandsDisabled="composer"!==t,e._updateLinkStates(),e.commandsDisabled?o.addClass(n,i):o.removeClass(n,i)},0)})},_updateLinkStates:function(){var i,s,a,l,c=(this.composer.element,this.commandMapping),d=this.actionMapping;for(i in c)l=c[i],this.commandsDisabled?(s=!1,o.removeClass(l.link,n),l.group&&o.removeClass(l.group,n),l.dialog&&l.dialog.hide()):(s=this.composer.commands.state(l.name,l.value),e.lang.object(s).isArray()&&(s=1===s.length?s[0]:!0),o.removeClass(l.link,t),l.group&&o.removeClass(l.group,t)),l.state!==s&&(l.state=s,s?(o.addClass(l.link,n),l.group&&o.addClass(l.group,n),l.dialog&&("object"==typeof s?l.dialog.show(s):l.dialog.hide())):(o.removeClass(l.link,n),l.group&&o.removeClass(l.group,n),l.dialog&&l.dialog.hide()));for(i in d)a=d[i],"change_view"===a.name&&(a.state=this.editor.currentView===this.editor.textarea,a.state?o.addClass(a.link,r):o.removeClass(a.link,r))},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}})}(wysihtml5),function(e){var t,i={name:t,style:!0,toolbar:t,autoLink:!0,parserRules:{tags:{br:{},span:{},div:{},p:{}},classes:{}},parser:e.dom.parse,composerClassName:"wysihtml5-editor",bodyClassName:"wysihtml5-supported",stylesheets:[],placeholderText:t,allowObjectResizing:!0,supportTouchDevices:!0};e.Editor=e.lang.Dispatcher.extend({constructor:function(t,n){if(this.textareaElement="string"==typeof t?document.getElementById(t):t,this.config=e.lang.object({}).merge(i).merge(n).get(),this.textarea=new e.views.Textarea(this,this.textareaElement,this.config),this.currentView=this.textarea,this._isCompatible=e.browser.supported(),!this._isCompatible||!this.config.supportTouchDevices&&e.browser.isTouchDevice()){var r=this;return setTimeout(function(){r.fire("beforeload").fire("load")},0),void 0}e.dom.addClass(document.body,this.config.bodyClassName),this.composer=new e.views.Composer(this,this.textareaElement,this.config),this.currentView=this.composer,"function"==typeof this.config.parser&&this._initParser(),this.observe("beforeload",function(){this.synchronizer=new e.views.Synchronizer(this,this.textarea,this.composer),this.config.toolbar&&(this.toolbar=new e.toolbar.Toolbar(this,this.config.toolbar))});try{console.log("Heya! This page is using wysihtml5 for rich text editing. Check out https://github.com/xing/wysihtml5")}catch(o){}},isCompatible:function(){return this._isCompatible},clear:function(){return this.currentView.clear(),this},getValue:function(e){return this.currentView.getValue(e)},setValue:function(e,t){return e?(this.currentView.setValue(e,t),this):this.clear()},focus:function(e){return this.currentView.focus(e),this},disable:function(){return this.currentView.disable(),this},enable:function(){return this.currentView.enable(),this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},parse:function(t){var i=this.config.parser(t,this.config.parserRules,this.composer.sandbox.getDocument(),!0);return"object"==typeof t&&e.quirks.redraw(t),i},_initParser:function(){this.observe("paste:composer",function(){var t=!0,i=this;i.composer.selection.executeAndRestore(function(){e.quirks.cleanPastedHTML(i.composer.element),i.parse(i.composer.element)},t)}),this.observe("paste:textarea",function(){var e,t=this.textarea.getValue();e=this.parse(t),this.textarea.setValue(e)})}})}(wysihtml5),!function(e,t){"use strict";var i={"font-styles":"<li class='dropdown'><a class='btn dropdown-toggle' data-toggle='dropdown' href='#'><i class='icon-font'></i>&nbsp;<span class='current-font'>Normal text</span>&nbsp;<b class='caret'></b></a><ul class='dropdown-menu'><li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='div'>Texte normal</a></li><li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='h1'>Entête 1</a></li><li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='h2'>Entête 2</a></li></ul></li>",emphasis:"<li><div class='btn-group'><a class='btn' data-wysihtml5-command='bold' title='CTRL+B'>Gras</a><a class='btn' data-wysihtml5-command='italic' title='CTRL+I'>Italic</a><a class='btn' data-wysihtml5-command='underline' title='CTRL+U'>Sousligné</a></div></li>",lists:"<li><div class='btn-group'><a class='btn' data-wysihtml5-command='insertUnorderedList' title='Unordered List'><i class='icon-list'></i></a><a class='btn' data-wysihtml5-command='insertOrderedList' title='Ordered List'><i class='icon-th-list'></i></a><a class='btn' data-wysihtml5-command='Outdent' title='Outdent'><i class='icon-indent-right'></i></a><a class='btn' data-wysihtml5-command='Indent' title='Indent'><i class='icon-indent-left'></i></a></div></li>",table:"<li><div class='bootstrap-wysihtml5-insert-table-modal modal hide fade'><div class='modal-header'><a class='close' data-dismiss='modal'>&times;</a><h3>Insert Table</h3></div><div class='modal-body'><input value='2' class='bootstrap-wysihtml5-insert-table-columns input-xlarge'><input value='3' class='bootstrap-wysihtml5-insert-table-rows input-xlarge'></div><div class='modal-footer'><a href='#' class='btn' data-dismiss='modal'>Cancel</a><a href='#' class='btn btn-primary' data-dismiss='modal'>Insert Table</a></div></div><a class='btn' data-wysihtml5-command='insertTable' title='Table'><i class='icon-tasks'></i></a></li>",link:"<li><div class='bootstrap-wysihtml5-insert-link-modal modal hide fade'><div class='modal-header'><a class='close' data-dismiss='modal'>&times;</a><h3>Insert Link</h3></div><div class='modal-body'><input value='http://' class='bootstrap-wysihtml5-insert-link-url input-xlarge'></div><div class='modal-footer'><a href='#' class='btn' data-dismiss='modal'>Cancel</a><a href='#' class='btn btn-primary' data-dismiss='modal'>Insert link</a></div></div><a class='btn' data-wysihtml5-command='createLink' title='Link'><i class='icon-share'></i></a></li>",image:"<li><div class='bootstrap-wysihtml5-insert-image-modal modal hide fade'><div class='modal-header'><a class='close' data-dismiss='modal'>&times;</a><h3>Insert Image</h3></div><div class='modal-body'><input value='http://' class='bootstrap-wysihtml5-insert-image-url input-xlarge'><iframe id='dialog_iframe' frameborder='0' marginheight='0' marginwidth='0' border='0' width='100%' height='100%'></iframe></div><div class='modal-footer'><a href='#' class='btn' data-dismiss='modal'>Cancel</a><a href='#' class='btn btn-primary' data-dismiss='modal'>Insert image</a></div></div><a class='btn' data-wysihtml5-command='insertImage' title='Insert image'><i class='icon-picture'></i></a></li>",html:"<li><div class='btn-group'><a class='btn' data-wysihtml5-action='change_view' title='Edit HTML'><i class='icon-pencil'></i></a></div></li>"},n={"font-styles":!0,emphasis:!0,lists:!0,html:!0,table:!1,link:!1,image:!1,events:{},parserRules:{tags:{b:{},i:{},br:{},ol:{},ul:{},li:{},h1:{},h2:{},blockquote:{},u:1,img:{check_attributes:{width:"numbers",alt:"alt",src:"url",height:"numbers"}},a:{set_attributes:{target:"_blank",rel:"nofollow"},check_attributes:{href:"url"}}}},stylesheets:[]},r=function(t,i){this.el=t,this.toolbar=this.createToolbar(t,i||n),this.editor=this.createEditor(i),window.editor=this.editor,e("iframe.wysihtml5-sandbox").each(function(t,i){e(i.contentWindow).off("focus.wysihtml5").on({"focus.wysihtml5":function(){e("li.dropdown").removeClass("open")}})})};r.prototype={constructor:r,createEditor:function(i){i=e.extend(n,i||{}),i.toolbar=this.toolbar[0];var r=new t.Editor(this.el[0],i);if(i&&i.events)for(var o in i.events)r.on(o,i.events[o]);return r},createToolbar:function(t,r){var o=this,s=e("<ul/>",{"class":"wysihtml5-toolbar",style:"display:none"});for(var a in n){var l=!1;void 0!==r[a]?r[a]===!0&&(l=!0):l=n[a],l===!0&&(s.append(i[a]),"html"==a&&this.initHtml(s),"link"==a&&this.initInsertLink(s),"image"==a&&this.initInsertImage(s),"table"==a&&this.initInsertTable(s))}return s.find("a[data-wysihtml5-command='formatBlock']").click(function(t){var i=e(t.srcElement);o.toolbar.find(".current-font").text(i.html())}),this.el.before(s),s},initHtml:function(e){var t="a[data-wysihtml5-action='change_view']";e.find(t).click(function(){e.find("a.btn").not(t).toggleClass("disabled")})},initInsertTable:function(e){var t=this,i=e.find(".bootstrap-wysihtml5-insert-table-modal"),n=i.find(".bootstrap-wysihtml5-insert-table-columns"),r=i.find(".bootstrap-wysihtml5-insert-table-rows"),o=i.find("a.btn-primary"),s=n.val(),a=r.val(),l=function(){var e=n.val();n.val(s);var i=r.val();r.val(a);for(var o="<tr>",l=0;e>l;l++)o+="<td></td>";o+="</tr>";for(var c="<table class='table'><tbody>",d=0;i>d;d++)c+=o;c+="</tbody></table>",t.editor.composer.commands.exec("insertHTML",c)};o.click(l),i.on("shown",function(){n.focus()}),i.on("hide",function(){t.editor.currentView.element.focus()}),e.find("a[data-wysihtml5-command=insertTable]").click(function(){return i.modal("show"),i.on("click.dismiss.modal",'[data-dismiss="modal"]',function(e){e.stopPropagation()}),!1})},initInsertImage:function(e){var t=this,i=e.find(".bootstrap-wysihtml5-insert-image-modal"),n=i.find(".bootstrap-wysihtml5-insert-image-url"),r=i.find("a.btn-primary"),o=n.val(),s=function(){var e=n.val();n.val(o),t.editor.composer.commands.exec("insertImage",e)};n.keypress(function(e){13==e.which&&(s(),i.modal("hide"))}),r.click(s),i.on("shown",function(){n.focus()}),i.on("hide",function(){t.editor.currentView.element.focus()}),e.find("a[data-wysihtml5-command=insertImage]").click(function(){return i.find("#dialog_iframe").attr("src","/admin/sites/1/images/insert?dialog=true"),i.modal("show"),i.on("click.dismiss.modal",'[data-dismiss="modal"]',function(e){e.stopPropagation()}),!1})},initInsertLink:function(e){var t=this,i=e.find(".bootstrap-wysihtml5-insert-link-modal"),n=i.find(".bootstrap-wysihtml5-insert-link-url"),r=i.find("a.btn-primary"),o=n.val(),s=function(){var e=n.val();n.val(o),t.editor.composer.commands.exec("createLink",{href:e,target:"_blank",rel:"nofollow"})};n.keypress(function(e){13==e.which&&(s(),i.modal("hide"))}),r.click(s),i.on("shown",function(){n.focus()}),i.on("hide",function(){t.editor.currentView.element.focus()}),e.find("a[data-wysihtml5-command=createLink]").click(function(){return i.modal("show"),i.on("click.dismiss.modal",'[data-dismiss="modal"]',function(e){e.stopPropagation()}),!1})}},e.fn.wysihtml5=function(t){return this.each(function(){var i=e(this);i.data("wysihtml5",new r(i,t))})},e.fn.wysihtml5.Constructor=r}(window.jQuery,window.wysihtml5),/*
 * Bootstrap Image Gallery 2.8.1
 * https://github.com/blueimp/Bootstrap-Image-Gallery
 *
 * Copyright 2011, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */
function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","load-image","bootstrap"],e):e(window.jQuery,window.loadImage)}(function(e,t){"use strict";e.extend(e.fn.modal.defaults,{delegate:document,selector:null,filter:"*",index:0,href:null,preloadRange:2,offsetWidth:100,offsetHeight:200,canvas:!1,slideshow:0,imageClickDivision:.5});var i=e.fn.modal.Constructor.prototype.show,n=e.fn.modal.Constructor.prototype.hide;e.extend(e.fn.modal.Constructor.prototype,{initLinks:function(){var t=this,i=this.options,n=i.selector||"a[data-target="+i.target+"]";this.$links=e(i.delegate).find(n).filter(i.filter).each(function(e){t.getUrl(this)===i.href&&(i.index=e)}),this.$links[i.index]||(i.index=0)},getUrl:function(t){return t.href||e(t).data("href")},startSlideShow:function(){var e=this;this.options.slideshow&&(this._slideShow=window.setTimeout(function(){e.next()},this.options.slideshow))},stopSlideShow:function(){window.clearTimeout(this._slideShow)},toggleSlideShow:function(){var e=this.$element.find(".modal-slideshow");this.options.slideshow?(this.options.slideshow=0,this.stopSlideShow()):(this.options.slideshow=e.data("slideshow")||5e3,this.startSlideShow()),e.find("i").toggleClass("icon-play icon-pause")},preloadImages:function(){var t,i,n=this.options,r=n.index+n.preloadRange+1;for(i=n.index-n.preloadRange;r>i;i+=1)t=this.$links[i],t&&i!==n.index&&e("<img>").prop("src",this.getUrl(t))},loadImage:function(){var e,i=this,n=this.$element,r=this.options.index,o=this.getUrl(this.$links[r]);this.abortLoad(),this.stopSlideShow(),n.trigger("beforeLoad"),this._loadingTimeout=window.setTimeout(function(){n.addClass("modal-loading")},100),e=n.find(".modal-image").children().removeClass("in"),window.setTimeout(function(){e.remove()},3e3),n.find(".modal-title").text(this.$links[r].title),n.find(".modal-download").prop("href",o),this._loadingImage=t(o,function(e){i.img=e,window.clearTimeout(i._loadingTimeout),n.removeClass("modal-loading"),n.trigger("load"),i.showImage(e),i.startSlideShow()},this._loadImageOptions),this.preloadImages()},showImage:function(t){var i,n,r=this.$element,o=e.support.transition&&r.hasClass("fade"),s=o?r.animate:r.css,a=r.find(".modal-image");a.css({width:t.width,height:t.height}),r.find(".modal-title").css({width:Math.max(t.width,380)}),o&&(i=r.clone().hide().appendTo(document.body)),e(window).width()>767?s.call(r.stop(),{"margin-top":-((i||r).outerHeight()/2),"margin-left":-((i||r).outerWidth()/2)}):r.css({top:(e(window).height()-(i||r).outerHeight())/2}),i&&i.remove(),a.append(t),n=t.offsetWidth,r.trigger("display"),o?r.is(":visible")?e(t).on(e.support.transition.end,function(i){i.target===t&&(e(t).off(e.support.transition.end),r.trigger("displayed"))}).addClass("in"):(e(t).addClass("in"),r.one("shown",function(){r.trigger("displayed")})):(e(t).addClass("in"),r.trigger("displayed"))},abortLoad:function(){this._loadingImage&&(this._loadingImage.onload=this._loadingImage.onerror=null),window.clearTimeout(this._loadingTimeout)},prev:function(){var e=this.options;e.index-=1,e.index<0&&(e.index=this.$links.length-1),this.loadImage()},next:function(){var e=this.options;e.index+=1,e.index>this.$links.length-1&&(e.index=0),this.loadImage()},keyHandler:function(e){switch(e.which){case 37:case 38:e.preventDefault(),this.prev();break;case 39:case 40:e.preventDefault(),this.next()}},wheelHandler:function(e){e.preventDefault(),e=e.originalEvent,this._wheelCounter=this._wheelCounter||0,this._wheelCounter+=e.wheelDelta||e.detail||0,e.wheelDelta&&this._wheelCounter>=120||!e.wheelDelta&&this._wheelCounter<0?(this.prev(),this._wheelCounter=0):(e.wheelDelta&&this._wheelCounter<=-120||!e.wheelDelta&&this._wheelCounter>0)&&(this.next(),this._wheelCounter=0)},initGalleryEvents:function(){var t=this,i=this.$element;i.find(".modal-image").on("click.modal-gallery",function(i){var n=e(this);1===t.$links.length?t.hide():(i.pageX-n.offset().left)/n.width()<t.options.imageClickDivision?t.prev(i):t.next(i)}),i.find(".modal-prev").on("click.modal-gallery",function(e){t.prev(e)}),i.find(".modal-next").on("click.modal-gallery",function(e){t.next(e)}),i.find(".modal-slideshow").on("click.modal-gallery",function(e){t.toggleSlideShow(e)}),e(document).on("keydown.modal-gallery",function(e){t.keyHandler(e)}).on("mousewheel.modal-gallery, DOMMouseScroll.modal-gallery",function(e){t.wheelHandler(e)})},destroyGalleryEvents:function(){var t=this.$element;this.abortLoad(),this.stopSlideShow(),t.find(".modal-image, .modal-prev, .modal-next, .modal-slideshow").off("click.modal-gallery"),e(document).off("keydown.modal-gallery").off("mousewheel.modal-gallery, DOMMouseScroll.modal-gallery")},show:function(){if(!this.isShown&&this.$element.hasClass("modal-gallery")){var t=this.$element,n=this.options,r=e(window).width(),o=e(window).height();t.hasClass("modal-fullscreen")?(this._loadImageOptions={maxWidth:r,maxHeight:o,canvas:n.canvas},t.hasClass("modal-fullscreen-stretch")&&(this._loadImageOptions.minWidth=r,this._loadImageOptions.minHeight=o)):this._loadImageOptions={maxWidth:r-n.offsetWidth,maxHeight:o-n.offsetHeight,canvas:n.canvas},r>767?t.css({"margin-top":-(t.outerHeight()/2),"margin-left":-(t.outerWidth()/2)}):t.css({top:(e(window).height()-t.outerHeight())/2}),this.initGalleryEvents(),this.initLinks(),this.$links.length&&(t.find(".modal-slideshow, .modal-prev, .modal-next").toggle(1!==this.$links.length),t.toggleClass("modal-single",1===this.$links.length),this.loadImage())}i.apply(this,arguments)},hide:function(){this.isShown&&this.$element.hasClass("modal-gallery")&&(this.options.delegate=document,this.options.href=null,this.destroyGalleryEvents()),n.apply(this,arguments)}}),e(function(){e(document.body).on("click.modal-gallery.data-api",'[data-toggle="modal-gallery"]',function(t){var i,n=e(this),r=n.data(),o=e(r.target),s=o.data("modal");s||(r=e.extend(o.data(),r)),r.selector||(r.selector="a[rel=gallery]"),i=e(t.target).closest(r.selector),i.length&&o.length&&(t.preventDefault(),r.href=i.prop("href")||i.data("href"),r.delegate=i[0]!==this?this:document,s&&e.extend(s.options,r),o.modal(r))})})}),/*
 * JavaScript Canvas to Blob 2.0.5
 * https://github.com/blueimp/JavaScript-Canvas-to-Blob
 *
 * Copyright 2012, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 *
 * Based on stackoverflow user Stoive's code snippet:
 * http://stackoverflow.com/q/4998908
 */
function(e){"use strict";var t=e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype,i=e.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),n=i&&e.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),r=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,o=(i||r)&&e.atob&&e.ArrayBuffer&&e.Uint8Array&&function(e){var t,o,s,a,l,c;for(t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):decodeURIComponent(e.split(",")[1]),o=new ArrayBuffer(t.length),s=new Uint8Array(o),a=0;a<t.length;a+=1)s[a]=t.charCodeAt(a);return l=e.split(",")[0].split(":")[1].split(";")[0],i?new Blob([n?s:o],{type:l}):(c=new r,c.append(o),c.getBlob(l))};e.HTMLCanvasElement&&!t.toBlob&&(t.mozGetAsFile?t.toBlob=function(e,i,n){n&&t.toDataURL&&o?e(o(this.toDataURL(i,n))):e(this.mozGetAsFile("blob",i))}:t.toDataURL&&o&&(t.toBlob=function(e,t,i){e(o(this.toDataURL(t,i)))})),"function"==typeof define&&define.amd?define(function(){return o}):e.dataURLtoBlob=o}(this),/*
 * JavaScript Load Image 1.3.1
 * https://github.com/blueimp/JavaScript-Load-Image
 *
 * Copyright 2011, Sebastian Tschan
 * https://blueimp.net
 *
 * iOS image scaling fixes based on
 * https://github.com/stomita/ios-imagefile-megapixel
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */
function(e){"use strict";var t=function(e,i,n){var r,o,s=document.createElement("img");return s.onerror=i,s.onload=function(){!o||n&&n.noRevoke||t.revokeObjectURL(o),i(t.scale(s,n))},window.Blob&&e instanceof Blob||window.File&&e instanceof File?(r=o=t.createObjectURL(e),s._type=e.type):r=e,r?(s.src=r,s):t.readFile(e,function(e){var t=e.target;t&&t.result?s.src=t.result:i(e)})},i=window.createObjectURL&&window||window.URL&&URL.revokeObjectURL&&URL||window.webkitURL&&webkitURL;t.detectSubsampling=function(e){var t,i,n=e.width,r=e.height;return n*r>1048576?(t=document.createElement("canvas"),t.width=t.height=1,i=t.getContext("2d"),i.drawImage(e,-n+1,0),0===i.getImageData(0,0,1,1).data[3]):!1},t.detectVerticalSquash=function(e,t){var i,n,r,o,s,a=document.createElement("canvas"),l=a.getContext("2d");for(a.width=1,a.height=t,l.drawImage(e,0,0),i=l.getImageData(0,0,1,t).data,n=0,r=t,o=t;o>n;)s=i[4*(o-1)+3],0===s?r=o:n=o,o=r+n>>1;return o/t||1},t.renderImageToCanvas=function(e,i,n,r){var o,s,a,l,c,d,h,u,f=e.width,p=e.height,m=i.getContext("2d"),g=1024,v=document.createElement("canvas");for(m.save(),t.detectSubsampling(e)&&(f/=2,p/=2),o=t.detectVerticalSquash(e,p),v.width=v.height=g,s=v.getContext("2d"),a=Math.ceil(g*n/f),l=Math.ceil(g*r/p/o),d=0,u=0;p>u;){for(c=0,h=0;f>h;)s.clearRect(0,0,g,g),s.drawImage(e,-h,-u),m.drawImage(v,0,0,g,g,c,d,a,l),h+=g,c+=a;u+=g,d+=l}m.restore(),v=s=null},t.scale=function(e,i){i=i||{};var n=document.createElement("canvas"),r=e.width,o=e.height,s=Math.max((i.minWidth||r)/r,(i.minHeight||o)/o);return s>1&&(r=Math.ceil(r*s),o=Math.ceil(o*s)),s=Math.min((i.maxWidth||r)/r,(i.maxHeight||o)/o),1>s&&(r=Math.ceil(r*s),o=Math.ceil(o*s)),e.getContext||i.canvas&&n.getContext?(n.width=r,n.height=o,"image/jpeg"===e._type?t.renderImageToCanvas(e,n,r,o):n.getContext("2d").drawImage(e,0,0,r,o),n):(e.width=r,e.height=o,e)},t.createObjectURL=function(e){return i?i.createObjectURL(e):!1},t.revokeObjectURL=function(e){return i?i.revokeObjectURL(e):!1},t.readFile=function(e,t){if(window.FileReader&&FileReader.prototype.readAsDataURL){var i=new FileReader;return i.onload=i.onerror=t,i.readAsDataURL(e),i}return!1},"function"==typeof define&&define.amd?define(function(){return t}):e.loadImage=t}(this),/*
 * JavaScript Templates 2.1.0
 * https://github.com/blueimp/JavaScript-Templates
 *
 * Copyright 2011, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 *
 * Inspired by John Resig's JavaScript Micro-Templating:
 * http://ejohn.org/blog/javascript-micro-templating/
 */
function(e){"use strict";var t=function(e,i){var n=/[^\w\-\.:]/.test(e)?new Function(t.arg+",tmpl","var _e=tmpl.encode"+t.helper+",_s='"+e.replace(t.regexp,t.func)+"';return _s;"):t.cache[e]=t.cache[e]||t(t.load(e));return i?n(i,t):function(e){return n(e,t)}};t.cache={},t.load=function(e){return document.getElementById(e).innerHTML},t.regexp=/([\s'\\])(?![^%]*%\})|(?:\{%(=|#)([\s\S]+?)%\})|(\{%)|(%\})/g,t.func=function(e,t,i,n,r,o){return t?{"\n":"\\n","\r":"\\r","	":"\\t"," ":" "}[e]||"\\"+e:i?"="===i?"'+_e("+n+")+'":"'+("+n+"||'')+'":r?"';":o?"_s+='":void 0},t.encReg=/[<>&"'\x00]/g,t.encMap={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"},t.encode=function(e){return String(e||"").replace(t.encReg,function(e){return t.encMap[e]||""})},t.arg="o",t.helper=",print=function(s,e){_s+=e&&(s||'')||_e(s);},include=function(s,d){_s+=tmpl(s,d);}","function"==typeof define&&define.amd?define(function(){return t}):e.tmpl=t}(this),/*
 * jQuery Iframe Transport Plugin 1.7
 * https://github.com/blueimp/jQuery-File-Upload
 *
 * Copyright 2011, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */
function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery"],e):e(window.jQuery)}(function(e){"use strict";var t=0;e.ajaxTransport("iframe",function(i){if(i.async){var n,r,o;return{send:function(s,a){n=e('<form style="display:none;"></form>'),n.attr("accept-charset",i.formAcceptCharset),o=/\?/.test(i.url)?"&":"?","DELETE"===i.type?(i.url=i.url+o+"_method=DELETE",i.type="POST"):"PUT"===i.type?(i.url=i.url+o+"_method=PUT",i.type="POST"):"PATCH"===i.type&&(i.url=i.url+o+"_method=PATCH",i.type="POST"),t+=1,r=e('<iframe src="javascript:false;" name="iframe-transport-'+t+'"></iframe>').bind("load",function(){var t,o=e.isArray(i.paramName)?i.paramName:[i.paramName];r.unbind("load").bind("load",function(){var t;try{if(t=r.contents(),!t.length||!t[0].firstChild)throw new Error}catch(i){t=void 0}a(200,"success",{iframe:t}),e('<iframe src="javascript:false;"></iframe>').appendTo(n),window.setTimeout(function(){n.remove()},0)}),n.prop("target",r.prop("name")).prop("action",i.url).prop("method",i.type),i.formData&&e.each(i.formData,function(t,i){e('<input type="hidden"/>').prop("name",i.name).val(i.value).appendTo(n)}),i.fileInput&&i.fileInput.length&&"POST"===i.type&&(t=i.fileInput.clone(),i.fileInput.after(function(e){return t[e]}),i.paramName&&i.fileInput.each(function(t){e(this).prop("name",o[t]||i.paramName)}),n.append(i.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data")),n.submit(),t&&t.length&&i.fileInput.each(function(i,n){var r=e(t[i]);e(n).prop("name",r.prop("name")),r.replaceWith(n)})}),n.append(r).appendTo(document.body)},abort:function(){r&&r.unbind("load").prop("src","javascript".concat(":false;")),n&&n.remove()}}}}),e.ajaxSetup({converters:{"iframe text":function(t){return t&&e(t[0].body).text()},"iframe json":function(t){return t&&e.parseJSON(e(t[0].body).text())},"iframe html":function(t){return t&&e(t[0].body).html()},"iframe xml":function(t){var i=t&&t[0];return i&&e.isXMLDoc(i)?i:e.parseXML(i.XMLDocument&&i.XMLDocument.xml||e(i.body).html())},"iframe script":function(t){return t&&e.globalEval(e(t[0].body).text())}}})}),/*
 * jQuery File Upload Plugin 5.32.6
 * https://github.com/blueimp/jQuery-File-Upload
 *
 * Copyright 2010, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */
function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery.ui.widget"],e):e(window.jQuery)}(function(e){"use strict";e.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||e('<input type="file">').prop("disabled")),e.support.xhrFileUpload=!(!window.XMLHttpRequestUpload||!window.FileReader),e.support.xhrFormDataFileUpload=!!window.FormData,e.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),e.widget("blueimp.fileupload",{options:{dropZone:e(document),pasteZone:e(document),fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(t,i){return t=this.messages[t]||t.toString(),i&&e.each(i,function(e,i){t=t.replace("{"+e+"}",i)}),t},formData:function(e){return e.serializeArray()},add:function(t,i){(i.autoUpload||i.autoUpload!==!1&&e(this).fileupload("option","autoUpload"))&&i.process().done(function(){i.submit()})},processData:!1,contentType:!1,cache:!1},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:e.support.blobSlice&&function(){var e=this.slice||this.webkitSlice||this.mozSlice;return e.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,i){var n=e-this.timestamp;return(!this.bitrate||!i||n>i)&&(this.bitrate=8*(t-this.loaded)*(1e3/n),this.loaded=t,this.timestamp=e),this.bitrate}},_isXHRUpload:function(t){return!t.forceIframeTransport&&(!t.multipart&&e.support.xhrFileUpload||e.support.xhrFormDataFileUpload)},_getFormData:function(t){var i;return"function"==typeof t.formData?t.formData(t.form):e.isArray(t.formData)?t.formData:"object"===e.type(t.formData)?(i=[],e.each(t.formData,function(e,t){i.push({name:e,value:t})}),i):[]},_getTotal:function(t){var i=0;return e.each(t,function(e,t){i+=t.size||1}),i},_initProgressObject:function(t){var i={loaded:0,total:0,bitrate:0};t._progress?e.extend(t._progress,i):t._progress=i},_initResponseObject:function(e){var t;if(e._response)for(t in e._response)e._response.hasOwnProperty(t)&&delete e._response[t];else e._response={}},_onProgress:function(e,t){if(e.lengthComputable){var i,n=Date.now?Date.now():(new Date).getTime();if(t._time&&t.progressInterval&&n-t._time<t.progressInterval&&e.loaded!==e.total)return;t._time=n,i=Math.floor(e.loaded/e.total*(t.chunkSize||t._progress.total))+(t.uploadedBytes||0),this._progress.loaded+=i-t._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(n,this._progress.loaded,t.bitrateInterval),t._progress.loaded=t.loaded=i,t._progress.bitrate=t.bitrate=t._bitrateTimer.getBitrate(n,i,t.bitrateInterval),this._trigger("progress",e,t),this._trigger("progressall",e,this._progress)}},_initProgressListener:function(t){var i=this,n=t.xhr?t.xhr():e.ajaxSettings.xhr();n.upload&&(e(n.upload).bind("progress",function(e){var n=e.originalEvent;e.lengthComputable=n.lengthComputable,e.loaded=n.loaded,e.total=n.total,i._onProgress(e,t)}),t.xhr=function(){return n})},_isInstanceOf:function(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"},_initXHRData:function(t){var i,n=this,r=t.files[0],o=t.multipart||!e.support.xhrFileUpload,s=t.paramName[0];t.headers=e.extend({},t.headers),t.contentRange&&(t.headers["Content-Range"]=t.contentRange),o&&!t.blob&&this._isInstanceOf("File",r)||(t.headers["Content-Disposition"]='attachment; filename="'+encodeURI(r.name)+'"'),o?e.support.xhrFormDataFileUpload&&(t.postMessage?(i=this._getFormData(t),t.blob?i.push({name:s,value:t.blob}):e.each(t.files,function(e,n){i.push({name:t.paramName[e]||s,value:n})})):(n._isInstanceOf("FormData",t.formData)?i=t.formData:(i=new FormData,e.each(this._getFormData(t),function(e,t){i.append(t.name,t.value)})),t.blob?i.append(s,t.blob,r.name):e.each(t.files,function(e,r){(n._isInstanceOf("File",r)||n._isInstanceOf("Blob",r))&&i.append(t.paramName[e]||s,r,r.name)})),t.data=i):(t.contentType=r.type,t.data=t.blob||r),t.blob=null},_initIframeSettings:function(t){var i=e("<a></a>").prop("href",t.url).prop("host");t.dataType="iframe "+(t.dataType||""),t.formData=this._getFormData(t),t.redirect&&i&&i!==location.host&&t.formData.push({name:t.redirectParamName||"redirect",value:t.redirect})},_initDataSettings:function(e){this._isXHRUpload(e)?(this._chunkedUpload(e,!0)||(e.data||this._initXHRData(e),this._initProgressListener(e)),e.postMessage&&(e.dataType="postmessage "+(e.dataType||""))):this._initIframeSettings(e)},_getParamName:function(t){var i=e(t.fileInput),n=t.paramName;return n?e.isArray(n)||(n=[n]):(n=[],i.each(function(){for(var t=e(this),i=t.prop("name")||"files[]",r=(t.prop("files")||[1]).length;r;)n.push(i),r-=1}),n.length||(n=[i.prop("name")||"files[]"])),n},_initFormSettings:function(t){t.form&&t.form.length||(t.form=e(t.fileInput.prop("form")),t.form.length||(t.form=e(this.options.fileInput.prop("form")))),t.paramName=this._getParamName(t),t.url||(t.url=t.form.prop("action")||location.href),t.type=(t.type||"string"===e.type(t.form.prop("method"))&&t.form.prop("method")||"").toUpperCase(),"POST"!==t.type&&"PUT"!==t.type&&"PATCH"!==t.type&&(t.type="POST"),t.formAcceptCharset||(t.formAcceptCharset=t.form.attr("accept-charset"))},_getAJAXSettings:function(t){var i=e.extend({},this.options,t);return this._initFormSettings(i),this._initDataSettings(i),i},_getDeferredState:function(e){return e.state?e.state():e.isResolved()?"resolved":e.isRejected()?"rejected":"pending"},_enhancePromise:function(e){return e.success=e.done,e.error=e.fail,e.complete=e.always,e},_getXHRPromise:function(t,i,n){var r=e.Deferred(),o=r.promise();return i=i||this.options.context||o,t===!0?r.resolveWith(i,n):t===!1&&r.rejectWith(i,n),o.abort=r.promise,this._enhancePromise(o)},_addConvenienceMethods:function(t,i){var n=this,r=function(t){return e.Deferred().resolveWith(n,[t]).promise()};i.process=function(e,t){return(e||t)&&(i._processQueue=this._processQueue=(this._processQueue||r(this)).pipe(e,t)),this._processQueue||r(this)},i.submit=function(){return"pending"!==this.state()&&(i.jqXHR=this.jqXHR=n._trigger("submit",t,this)!==!1&&n._onSend(t,this)),this.jqXHR||n._getXHRPromise()},i.abort=function(){return this.jqXHR?this.jqXHR.abort():n._getXHRPromise()},i.state=function(){return this.jqXHR?n._getDeferredState(this.jqXHR):this._processQueue?n._getDeferredState(this._processQueue):void 0},i.progress=function(){return this._progress},i.response=function(){return this._response}},_getUploadedBytes:function(e){var t=e.getResponseHeader("Range"),i=t&&t.split("-"),n=i&&i.length>1&&parseInt(i[1],10);return n&&n+1},_chunkedUpload:function(t,i){t.uploadedBytes=t.uploadedBytes||0;var n,r,o=this,s=t.files[0],a=s.size,l=t.uploadedBytes,c=t.maxChunkSize||a,d=this._blobSlice,h=e.Deferred(),u=h.promise();return this._isXHRUpload(t)&&d&&(l||a>c)&&!t.data?i?!0:l>=a?(s.error=t.i18n("uploadedBytes"),this._getXHRPromise(!1,t.context,[null,"error",s.error])):(r=function(){var i=e.extend({},t),u=i._progress.loaded;i.blob=d.call(s,l,l+c,s.type),i.chunkSize=i.blob.size,i.contentRange="bytes "+l+"-"+(l+i.chunkSize-1)+"/"+a,o._initXHRData(i),o._initProgressListener(i),n=(o._trigger("chunksend",null,i)!==!1&&e.ajax(i)||o._getXHRPromise(!1,i.context)).done(function(n,s,c){l=o._getUploadedBytes(c)||l+i.chunkSize,u+i.chunkSize-i._progress.loaded&&o._onProgress(e.Event("progress",{lengthComputable:!0,loaded:l-i.uploadedBytes,total:l-i.uploadedBytes}),i),t.uploadedBytes=i.uploadedBytes=l,i.result=n,i.textStatus=s,i.jqXHR=c,o._trigger("chunkdone",null,i),o._trigger("chunkalways",null,i),a>l?r():h.resolveWith(i.context,[n,s,c])}).fail(function(e,t,n){i.jqXHR=e,i.textStatus=t,i.errorThrown=n,o._trigger("chunkfail",null,i),o._trigger("chunkalways",null,i),h.rejectWith(i.context,[e,t,n])})},this._enhancePromise(u),u.abort=function(){return n.abort()},r(),u):!1},_beforeSend:function(e,t){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(t),this._initProgressObject(t),t._progress.loaded=t.loaded=t.uploadedBytes||0,t._progress.total=t.total=this._getTotal(t.files)||1,t._progress.bitrate=t.bitrate=0,this._active+=1,this._progress.loaded+=t.loaded,this._progress.total+=t.total},_onDone:function(t,i,n,r){var o=r._progress.total,s=r._response;r._progress.loaded<o&&this._onProgress(e.Event("progress",{lengthComputable:!0,loaded:o,total:o}),r),s.result=r.result=t,s.textStatus=r.textStatus=i,s.jqXHR=r.jqXHR=n,this._trigger("done",null,r)},_onFail:function(e,t,i,n){var r=n._response;n.recalculateProgress&&(this._progress.loaded-=n._progress.loaded,this._progress.total-=n._progress.total),r.jqXHR=n.jqXHR=e,r.textStatus=n.textStatus=t,r.errorThrown=n.errorThrown=i,this._trigger("fail",null,n)},_onAlways:function(e,t,i,n){this._trigger("always",null,n)},_onSend:function(t,i){i.submit||this._addConvenienceMethods(t,i);var n,r,o,s,a=this,l=a._getAJAXSettings(i),c=function(){return a._sending+=1,l._bitrateTimer=new a._BitrateTimer,n=n||((r||a._trigger("send",t,l)===!1)&&a._getXHRPromise(!1,l.context,r)||a._chunkedUpload(l)||e.ajax(l)).done(function(e,t,i){a._onDone(e,t,i,l)}).fail(function(e,t,i){a._onFail(e,t,i,l)}).always(function(e,t,i){if(a._onAlways(e,t,i,l),a._sending-=1,a._active-=1,l.limitConcurrentUploads&&l.limitConcurrentUploads>a._sending)for(var n=a._slots.shift();n;){if("pending"===a._getDeferredState(n)){n.resolve();break}n=a._slots.shift()}0===a._active&&a._trigger("stop")})};return this._beforeSend(t,l),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(o=e.Deferred(),this._slots.push(o),s=o.pipe(c)):(this._sequence=this._sequence.pipe(c,c),s=this._sequence),s.abort=function(){return r=[void 0,"abort","abort"],n?n.abort():(o&&o.rejectWith(l.context,r),c())},this._enhancePromise(s)):c()},_onAdd:function(t,i){var n,r,o,s,a=this,l=!0,c=e.extend({},this.options,i),d=c.limitMultiFileUploads,h=this._getParamName(c);if((c.singleFileUploads||d)&&this._isXHRUpload(c))if(!c.singleFileUploads&&d)for(o=[],n=[],s=0;s<i.files.length;s+=d)o.push(i.files.slice(s,s+d)),r=h.slice(s,s+d),r.length||(r=h),n.push(r);else n=h;else o=[i.files],n=[h];return i.originalFiles=i.files,e.each(o||i.files,function(r,s){var c=e.extend({},i);return c.files=o?s:[s],c.paramName=n[r],a._initResponseObject(c),a._initProgressObject(c),a._addConvenienceMethods(t,c),l=a._trigger("add",t,c)}),l},_replaceFileInput:function(t){var i=t.clone(!0);e("<form></form>").append(i)[0].reset(),t.after(i).detach(),e.cleanData(t.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(e,n){return n===t[0]?i[0]:n}),t[0]===this.element[0]&&(this.element=i)},_handleFileTreeEntry:function(t,i){var n,r=this,o=e.Deferred(),s=function(e){e&&!e.entry&&(e.entry=t),o.resolve([e])};return i=i||"",t.isFile?t._file?(t._file.relativePath=i,o.resolve(t._file)):t.file(function(e){e.relativePath=i,o.resolve(e)},s):t.isDirectory?(n=t.createReader(),n.readEntries(function(e){r._handleFileTreeEntries(e,i+t.name+"/").done(function(e){o.resolve(e)}).fail(s)},s)):o.resolve([]),o.promise()},_handleFileTreeEntries:function(t,i){var n=this;return e.when.apply(e,e.map(t,function(e){return n._handleFileTreeEntry(e,i)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(t){t=t||{};var i=t.items;return i&&i.length&&(i[0].webkitGetAsEntry||i[0].getAsEntry)?this._handleFileTreeEntries(e.map(i,function(e){var t;return e.webkitGetAsEntry?(t=e.webkitGetAsEntry(),t&&(t._file=e.getAsFile()),t):e.getAsEntry()})):e.Deferred().resolve(e.makeArray(t.files)).promise()},_getSingleFileInputFiles:function(t){t=e(t);var i,n,r=t.prop("webkitEntries")||t.prop("entries");if(r&&r.length)return this._handleFileTreeEntries(r);if(i=e.makeArray(t.prop("files")),i.length)void 0===i[0].name&&i[0].fileName&&e.each(i,function(e,t){t.name=t.fileName,t.size=t.fileSize});else{if(n=t.prop("value"),!n)return e.Deferred().resolve([]).promise();i=[{name:n.replace(/^.*\\/,"")}]}return e.Deferred().resolve(i).promise()},_getFileInputFiles:function(t){return t instanceof e&&1!==t.length?e.when.apply(e,e.map(t,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(t)},_onChange:function(t){var i=this,n={fileInput:e(t.target),form:e(t.target.form)};this._getFileInputFiles(n.fileInput).always(function(e){n.files=e,i.options.replaceFileInput&&i._replaceFileInput(n.fileInput),i._trigger("change",t,n)!==!1&&i._onAdd(t,n)})},_onPaste:function(t){var i=t.originalEvent&&t.originalEvent.clipboardData&&t.originalEvent.clipboardData.items,n={files:[]};i&&i.length&&(e.each(i,function(e,t){var i=t.getAsFile&&t.getAsFile();i&&n.files.push(i)}),this._trigger("paste",t,n)!==!1&&this._onAdd(t,n))},_onDrop:function(e){e.dataTransfer=e.originalEvent&&e.originalEvent.dataTransfer;var t=this,i=e.dataTransfer,n={};i&&i.files&&i.files.length&&(e.preventDefault(),this._getDroppedFiles(i).always(function(i){n.files=i,t._trigger("drop",e,n)!==!1&&t._onAdd(e,n)}))},_onDragOver:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var i=t.dataTransfer,n={dropEffect:"copy",preventDefault:!0};i&&-1!==e.inArray("Files",i.types)&&this._trigger("dragover",t,n)!==!1&&(i.dropEffect=n.dropEffect,n.preventDefault&&t.preventDefault())},_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop}),this._on(this.options.pasteZone,{paste:this._onPaste})),e.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_setOption:function(t,i){var n=-1!==e.inArray(t,this._specialOptions);n&&this._destroyEventHandlers(),this._super(t,i),n&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var t=this.options;void 0===t.fileInput?t.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):t.fileInput instanceof e||(t.fileInput=e(t.fileInput)),t.dropZone instanceof e||(t.dropZone=e(t.dropZone)),t.pasteZone instanceof e||(t.pasteZone=e(t.pasteZone))},_getRegExp:function(e){var t=e.split("/"),i=t.pop();return t.shift(),new RegExp(t.join("/"),i)},_isRegExpOption:function(t,i){return"url"!==t&&"string"===e.type(i)&&/^\/.*\/[igm]{0,3}$/.test(i)},_initDataAttributes:function(){var t=this,i=this.options;e.each(e(this.element[0].cloneNode(!1)).data(),function(e,n){t._isRegExpOption(e,n)&&(n=t._getRegExp(n)),i[e]=n})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(t){var i=this;t&&!this.options.disabled&&(t.fileInput&&!t.files?this._getFileInputFiles(t.fileInput).always(function(e){t.files=e,i._onAdd(null,t)}):(t.files=e.makeArray(t.files),this._onAdd(null,t)))},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var i,n,r=this,o=e.Deferred(),s=o.promise();return s.abort=function(){return n=!0,i?i.abort():(o.reject(null,"abort","abort"),s)},this._getFileInputFiles(t.fileInput).always(function(e){if(!n){if(!e.length)return o.reject(),void 0;t.files=e,i=r._onSend(null,t).then(function(e,t,i){o.resolve(e,t,i)},function(e,t,i){o.reject(e,t,i)})}}),this._enhancePromise(s)}if(t.files=e.makeArray(t.files),t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})}),/*
 * jQuery File Upload Processing Plugin 1.2.2
 * https://github.com/blueimp/jQuery-File-Upload
 *
 * Copyright 2012, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */
function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","./jquery.fileupload"],e):e(window.jQuery)}(function(e){"use strict";var t=e.blueimp.fileupload.prototype.options.add;e.widget("blueimp.fileupload",e.blueimp.fileupload,{options:{processQueue:[],add:function(i,n){var r=e(this);n.process(function(){return r.fileupload("process",n)}),t.call(this,i,n)}},processActions:{},_processFile:function(t){var i=this,n=e.Deferred().resolveWith(i,[t]),r=n.promise();return this._trigger("process",null,t),e.each(t.processQueue,function(e,t){var n=function(e){return i.processActions[t.action].call(i,e,t)};r=r.pipe(n,t.always&&n)}),r.done(function(){i._trigger("processdone",null,t),i._trigger("processalways",null,t)}).fail(function(){i._trigger("processfail",null,t),i._trigger("processalways",null,t)}),r},_transformProcessQueue:function(t){var i=[];e.each(t.processQueue,function(){var n={},r=this.action,o=this.prefix===!0?r:this.prefix;e.each(this,function(i,r){n[i]="string"===e.type(r)&&"@"===r.charAt(0)?t[r.slice(1)||(o?o+i.charAt(0).toUpperCase()+i.slice(1):i)]:r}),i.push(n)}),t.processQueue=i},processing:function(){return this._processing},process:function(t){var i=this,n=e.extend({},this.options,t);return n.processQueue&&n.processQueue.length&&(this._transformProcessQueue(n),0===this._processing&&this._trigger("processstart"),e.each(t.files,function(t){var r=t?e.extend({},n):n,o=function(){return i._processFile(r)};r.index=t,i._processing+=1,i._processingQueue=i._processingQueue.pipe(o,o).always(function(){i._processing-=1,0===i._processing&&i._trigger("processstop")})})),this._processingQueue},_create:function(){this._super(),this._processing=0,this._processingQueue=e.Deferred().resolveWith(this).promise()}})}),/*
 * jQuery File Upload User Interface Plugin 8.8.5
 * https://github.com/blueimp/jQuery-File-Upload
 *
 * Copyright 2010, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */
function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","tmpl","./jquery.fileupload-image","./jquery.fileupload-audio","./jquery.fileupload-video","./jquery.fileupload-validate"],e):e(window.jQuery,window.tmpl)}(function(e,t){"use strict";e.blueimp.fileupload.prototype._specialOptions.push("filesContainer","uploadTemplateId","downloadTemplateId"),e.widget("blueimp.fileupload",e.blueimp.fileupload,{options:{autoUpload:!1,uploadTemplateId:"template-upload",downloadTemplateId:"template-download",filesContainer:void 0,prependFiles:!1,dataType:"json",getNumberOfFiles:function(){return this.filesContainer.children().length},getFilesFromResponse:function(t){return t.result&&e.isArray(t.result.files)?t.result.files:[]},add:function(t,i){var n=e(this),r=n.data("blueimp-fileupload")||n.data("fileupload"),o=r.options,s=i.files;i.process(function(){return n.fileupload("process",i)}).always(function(){i.context=r._renderUpload(s).data("data",i),r._renderPreviews(i),o.filesContainer[o.prependFiles?"prepend":"append"](i.context),r._forceReflow(i.context),r._transition(i.context).done(function(){r._trigger("added",t,i)===!1||!o.autoUpload&&!i.autoUpload||i.autoUpload===!1||i.files.error||i.submit()})})},send:function(t,i){var n=e(this).data("blueimp-fileupload")||e(this).data("fileupload");return i.context&&i.dataType&&"iframe"===i.dataType.substr(0,6)&&i.context.find(".progress").addClass(!e.support.transition&&"progress-animated").attr("aria-valuenow",100).children().first().css("width","100%"),n._trigger("sent",t,i)},done:function(t,i){var n,r,o=e(this).data("blueimp-fileupload")||e(this).data("fileupload"),s=i.getFilesFromResponse||o.options.getFilesFromResponse,a=s(i);i.context?i.context.each(function(s){var l=a[s]||{error:"Empty file upload result"};r=o._addFinishedDeferreds(),o._transition(e(this)).done(function(){var s=e(this);n=o._renderDownload([l]).replaceAll(s),o._forceReflow(n),o._transition(n).done(function(){i.context=e(this),o._trigger("completed",t,i),o._trigger("finished",t,i),r.resolve()})})}):(n=o._renderDownload(a)[o.options.prependFiles?"prependTo":"appendTo"](o.options.filesContainer),o._forceReflow(n),r=o._addFinishedDeferreds(),o._transition(n).done(function(){i.context=e(this),o._trigger("completed",t,i),o._trigger("finished",t,i),r.resolve()}))},fail:function(t,i){var n,r,o=e(this).data("blueimp-fileupload")||e(this).data("fileupload");i.context?i.context.each(function(s){if("abort"!==i.errorThrown){var a=i.files[s];a.error=a.error||i.errorThrown||!0,r=o._addFinishedDeferreds(),o._transition(e(this)).done(function(){var s=e(this);n=o._renderDownload([a]).replaceAll(s),o._forceReflow(n),o._transition(n).done(function(){i.context=e(this),o._trigger("failed",t,i),o._trigger("finished",t,i),r.resolve()})})}else r=o._addFinishedDeferreds(),o._transition(e(this)).done(function(){e(this).remove(),o._trigger("failed",t,i),o._trigger("finished",t,i),r.resolve()})}):"abort"!==i.errorThrown?(i.context=o._renderUpload(i.files)[o.options.prependFiles?"prependTo":"appendTo"](o.options.filesContainer).data("data",i),o._forceReflow(i.context),r=o._addFinishedDeferreds(),o._transition(i.context).done(function(){i.context=e(this),o._trigger("failed",t,i),o._trigger("finished",t,i),r.resolve()})):(o._trigger("failed",t,i),o._trigger("finished",t,i),o._addFinishedDeferreds().resolve())},progress:function(t,i){var n=Math.floor(100*(i.loaded/i.total));i.context&&i.context.each(function(){e(this).find(".progress").attr("aria-valuenow",n).children().first().css("width",n+"%")})},progressall:function(t,i){var n=e(this),r=Math.floor(100*(i.loaded/i.total)),o=n.find(".fileupload-progress"),s=o.find(".progress-extended");s.length&&s.html((n.data("blueimp-fileupload")||n.data("fileupload"))._renderExtendedProgress(i)),o.find(".progress").attr("aria-valuenow",r).children().first().css("width",r+"%")},start:function(t){var i=e(this).data("blueimp-fileupload")||e(this).data("fileupload");i._resetFinishedDeferreds(),i._transition(e(this).find(".fileupload-progress")).done(function(){i._trigger("started",t)})},stop:function(t){var i=e(this).data("blueimp-fileupload")||e(this).data("fileupload"),n=i._addFinishedDeferreds();e.when.apply(e,i._getFinishedDeferreds()).done(function(){i._trigger("stopped",t)}),i._transition(e(this).find(".fileupload-progress")).done(function(){e(this).find(".progress").attr("aria-valuenow","0").children().first().css("width","0%"),e(this).find(".progress-extended").html("&nbsp;"),n.resolve()})},processstart:function(){e(this).addClass("fileupload-processing")},processstop:function(){e(this).removeClass("fileupload-processing")},destroy:function(t,i){var n=e(this).data("blueimp-fileupload")||e(this).data("fileupload"),r=function(){n._transition(i.context).done(function(){e(this).remove(),n._trigger("destroyed",t,i)})};i.url?e.ajax(i).done(r):r()}},_resetFinishedDeferreds:function(){this._finishedUploads=[]},_addFinishedDeferreds:function(t){return t||(t=e.Deferred()),this._finishedUploads.push(t),t},_getFinishedDeferreds:function(){return this._finishedUploads},_enableDragToDesktop:function(){var t=e(this),i=t.prop("href"),n=t.prop("download"),r="application/octet-stream";t.bind("dragstart",function(e){try{e.originalEvent.dataTransfer.setData("DownloadURL",[r,n,i].join(":"))}catch(t){}})},_formatFileSize:function(e){return"number"!=typeof e?"":e>=1e9?(e/1e9).toFixed(2)+" GB":e>=1e6?(e/1e6).toFixed(2)+" MB":(e/1e3).toFixed(2)+" KB"},_formatBitrate:function(e){return"number"!=typeof e?"":e>=1e9?(e/1e9).toFixed(2)+" Gbit/s":e>=1e6?(e/1e6).toFixed(2)+" Mbit/s":e>=1e3?(e/1e3).toFixed(2)+" kbit/s":e.toFixed(2)+" bit/s"},_formatTime:function(e){var t=new Date(1e3*e),i=Math.floor(e/86400);return i=i?i+"d ":"",i+("0"+t.getUTCHours()).slice(-2)+":"+("0"+t.getUTCMinutes()).slice(-2)+":"+("0"+t.getUTCSeconds()).slice(-2)},_formatPercentage:function(e){return(100*e).toFixed(2)+" %"},_renderExtendedProgress:function(e){return this._formatBitrate(e.bitrate)+" | "+this._formatTime(8*(e.total-e.loaded)/e.bitrate)+" | "+this._formatPercentage(e.loaded/e.total)+" | "+this._formatFileSize(e.loaded)+" / "+this._formatFileSize(e.total)},_renderTemplate:function(t,i){if(!t)return e();var n=t({files:i,formatFileSize:this._formatFileSize,options:this.options});return n instanceof e?n:e(this.options.templatesContainer).html(n).children()},_renderPreviews:function(t){t.context.find(".preview").each(function(i,n){e(n).append(t.files[i].preview)})},_renderUpload:function(e){return this._renderTemplate(this.options.uploadTemplate,e)},_renderDownload:function(e){return this._renderTemplate(this.options.downloadTemplate,e).find("a[download]").each(this._enableDragToDesktop).end()},_startHandler:function(t){t.preventDefault();var i=e(t.currentTarget),n=i.closest(".template-upload"),r=n.data("data");r&&r.submit&&!r.jqXHR&&r.submit()&&i.prop("disabled",!0)},_cancelHandler:function(t){t.preventDefault();var i=e(t.currentTarget).closest(".template-upload,.template-download"),n=i.data("data")||{};n.jqXHR?n.jqXHR.abort():(n.context=n.context||i,n.errorThrown="abort",this._trigger("fail",t,n))},_deleteHandler:function(t){t.preventDefault();var i=e(t.currentTarget);this._trigger("destroy",t,e.extend({context:i.closest(".template-download"),type:"DELETE"},i.data()))},_forceReflow:function(t){return e.support.transition&&t.length&&t[0].offsetWidth},_transition:function(t){var i=e.Deferred();return e.support.transition&&t.hasClass("fade")&&t.is(":visible")?t.bind(e.support.transition.end,function(n){n.target===t[0]&&(t.unbind(e.support.transition.end),i.resolveWith(t))}).toggleClass("in"):(t.toggleClass("in"),i.resolveWith(t)),i},_initButtonBarEventHandlers:function(){var t=this.element.find(".fileupload-buttonbar"),i=this.options.filesContainer;this._on(t.find(".start"),{click:function(e){e.preventDefault(),i.find(".start").click()}}),this._on(t.find(".cancel"),{click:function(e){e.preventDefault(),i.find(".cancel").click()}}),this._on(t.find(".delete"),{click:function(e){e.preventDefault(),i.find(".toggle:checked").closest(".template-download").find(".delete").click(),t.find(".toggle").prop("checked",!1)}}),this._on(t.find(".toggle"),{change:function(t){i.find(".toggle").prop("checked",e(t.currentTarget).is(":checked"))}})},_destroyButtonBarEventHandlers:function(){this._off(this.element.find(".fileupload-buttonbar").find(".start, .cancel, .delete"),"click"),this._off(this.element.find(".fileupload-buttonbar .toggle"),"change.")},_initEventHandlers:function(){this._super(),this._on(this.options.filesContainer,{"click .start":this._startHandler,"click .cancel":this._cancelHandler,"click .delete":this._deleteHandler}),this._initButtonBarEventHandlers()},_destroyEventHandlers:function(){this._destroyButtonBarEventHandlers(),this._off(this.options.filesContainer,"click"),this._super()},_enableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!1).parent().removeClass("disabled")},_disableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!0).parent().addClass("disabled")},_initTemplates:function(){var e=this.options;e.templatesContainer=this.document[0].createElement(e.filesContainer.prop("nodeName")),t&&(e.uploadTemplateId&&(e.uploadTemplate=t(e.uploadTemplateId)),e.downloadTemplateId&&(e.downloadTemplate=t(e.downloadTemplateId)))},_initFilesContainer:function(){var t=this.options;void 0===t.filesContainer?t.filesContainer=this.element.find(".files"):t.filesContainer instanceof e||(t.filesContainer=e(t.filesContainer))},_initSpecialOptions:function(){this._super(),this._initFilesContainer(),this._initTemplates()},_create:function(){this._super(),this._resetFinishedDeferreds(),e.support.fileInput||this._disableFileInputButton()},enable:function(){var e=!1;this.options.disabled&&(e=!0),this._super(),e&&(this.element.find("input, button").prop("disabled",!1),this._enableFileInputButton())},disable:function(){this.options.disabled||(this.element.find("input, button").prop("disabled",!0),this._disableFileInputButton()),this._super()}})}),/*
 * jQuery File Upload Plugin Localization Example 6.5.1
 * https://github.com/blueimp/jQuery-File-Upload
 *
 * Copyright 2012, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */
window.locale={fileupload:{errors:{maxFileSize:"File is too big",minFileSize:"File is too small",acceptFileTypes:"Filetype not allowed",maxNumberOfFiles:"Max number of files exceeded",uploadedBytes:"Uploaded bytes exceed file size",emptyResult:"Empty file upload result"},error:"Error",start:"Start",cancel:"Cancel",destroy:"Delete"}},/*
	Redactor v9.0
	Updated: May 30, 2013

	http://imperavi.com/redactor/

	Copyright (c) 2009-2013, Imperavi LLC.
	License: http://imperavi.com/redactor/license/

	Usage: $('#content').redactor();
*/
function(e){function t(e,i){return new t.prototype.init(e,i)}var i=0,n=function(e){return this[0]=e.startOffset,this[1]=e.endOffset,this.range=e,this};n.prototype.equals=function(){return this[0]===this[1]},e.fn.redactor=function(i){var n=[],r=Array.prototype.slice.call(arguments,1);return"string"==typeof i?this.each(function(){var t=e.data(this,"redactor");if("undefined"==typeof t||!e.isFunction(t[i]))return e.error('No such method "'+i+'" for Redactor');var o=t[i].apply(t,r);void 0!==o&&o!==t&&n.push(o)}):this.each(function(){e.data(this,"redactor")||e.data(this,"redactor",t(this,i))}),0===n.length?this:1===n.length?n[0]:n},e.Redactor=t,e.Redactor.opts={initCallback:!1,focusCallback:!1,blurCallback:!1,keydownCallback:!1,keyupCallback:!1,execCommandCallback:!1,autosaveCallback:!1,imageUploadCallback:!1,imageUploadErrorCallback:!1,imageDeleteCallback:!1,fileUploadCallback:!1,fileUploadErrorCallback:!1,rangy:!1,iframe:!1,fullpage:!1,css:!1,lang:"en",direction:"ltr",placeholder:!1,wym:!1,mobile:!0,cleanup:!0,visual:!0,focus:!1,tabindex:!1,autoresize:!0,minHeight:!1,shortcuts:!0,autosave:!1,autosaveInterval:60,plugins:!1,linkAnchor:!1,linkEmail:!1,linkProtocol:"http://",imageGetJson:!1,imageUpload:!1,fileUpload:!1,s3:!1,uploadFields:!1,observeImages:!0,modalOverlay:!0,air:!1,airButtons:["formatting","|","bold","italic","deleted","|","unorderedlist","orderedlist","outdent","indent","|","fontcolor","backcolor"],toolbar:!0,toolbarFixed:!1,toolbarFixedTopOffset:0,toolbarFixedBox:!1,toolbarExternal:!1,buttonSource:!0,buttonSeparator:'<li class="redactor_separator"></li>',buttonsCustom:{},buttonsAdd:[],buttons:["html","|","formatting","|","bold","italic","deleted","|","unorderedlist","orderedlist","outdent","indent","|","image","video","file","table","link","|","fontcolor","backcolor","|","alignment","|","horizontalrule"],colors:["#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646","#ffff00","#f2f2f2","#7f7f7f","#ddd9c3","#c6d9f0","#dbe5f1","#f2dcdb","#ebf1dd","#e5e0ec","#dbeef3","#fdeada","#fff2ca","#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5","#ffe694","#bfbfbf","#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#b7dde8","#fac08f","#f2c314","#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#92cddc","#e36c09","#c09100","#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#31859b","#974806","#7f6000"],activeButtons:["deleted","italic","bold","underline","unorderedlist","orderedlist","alignleft","aligncenter","alignright","justify","table"],activeButtonsStates:{b:"bold",strong:"bold",i:"italic",em:"italic",del:"deleted",strike:"deleted",ul:"unorderedlist",ol:"orderedlist",u:"underline",tr:"table",td:"table",table:"table"},activeButtonsAdd:!1,formattingTags:["p","blockquote","pre","h1","h2","h3","h4"],linebreaks:!1,paragraphy:!0,convertDivs:!0,convertLinks:!0,formattingPre:!1,phpTags:!1,allowedTags:!1,deniedTags:["html","head","link","body","meta","script","style","applet"],boldTag:"strong",italicTag:"em",buffer:[],rebuffer:[],textareamode:!1,emptyHtml:"<p>&#x200b;</p>",invisibleSpace:"&#x200b;",alignmentTags:["H1","H2","H3","H4","H5","H6","P","TD","DIV","BLOCKQUOTE"],ownLine:["area","body","head","hr","i?frame","link","meta","noscript","style","script","table","tbody","thead","tfoot"],contOwnLine:["li","dt","dt","h[1-6]","option","script"],newLevel:["blockquote","div","dl","fieldset","form","frameset","map","ol","p","pre","select","td","th","tr","ul"],blockLevelElements:["P","H1","H2","H3","H4","H5","H6","DD","DL","DT","DIV","LI","BLOCKQUOTE","OUTPUT","FIGCAPTION","PRE","ADDRESS","SECTION","HEADER","FOOTER","ASIDE","ARTICLE"],langs:{en:{html:"HTML",video:"Insert Video",image:"Insert Image",table:"Table",link:"Link",link_insert:"Insert link",unlink:"Unlink",formatting:"Formatting",paragraph:"Normal text",quote:"Quote",code:"Code",header1:"Header 1",header2:"Header 2",header3:"Header 3",header4:"Header 4",bold:"Bold",italic:"Italic",fontcolor:"Font Color",backcolor:"Back Color",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",cancel:"Cancel",insert:"Insert",save:"Save",_delete:"Delete",insert_table:"Insert Table",insert_row_above:"Add Row Above",insert_row_below:"Add Row Below",insert_column_left:"Add Column Left",insert_column_right:"Add Column Right",delete_column:"Delete Column",delete_row:"Delete Row",delete_table:"Delete Table",rows:"Rows",columns:"Columns",add_head:"Add Head",delete_head:"Delete Head",title:"Title",image_position:"Position",none:"None",left:"Left",right:"Right",image_web_link:"Image Web Link",text:"Text",mailto:"Email",web:"URL",video_html_code:"Video Embed Code",file:"Insert File",upload:"Upload",download:"Download",choose:"Choose",or_choose:"Or choose",drop_file_here:"Drop file here",align_left:"Align text to the left",align_center:"Center text",align_right:"Align text to the right",align_justify:"Justify text",horizontalrule:"Insert Horizontal Rule",deleted:"Deleted",anchor:"Anchor",link_new_tab:"Open link in new tab",underline:"Underline",alignment:"Alignment",filename:"Name (optional)"}}},t.fn=e.Redactor.prototype={keyCode:{BACKSPACE:8,DELETE:46,DOWN:40,ENTER:13,ESC:27,TAB:9,CTRL:17,META:91,LEFT:37,LEFT_WIN:91},init:function(t,n){if(this.$element=this.$source=e(t),this.uuid=i++,this.opts=e.extend({},e.Redactor.opts,this.$element.data(),n),this.dropdowns=[],this.sourceHeight=this.$source.css("height"),this.sourceWidth=this.$source.css("width"),this.opts.fullpage&&(this.opts.iframe=!0),this.opts.linebreaks&&(this.opts.paragraphy=!1),this.opts.paragraphy&&(this.opts.linebreaks=!1),this.opts.toolbarFixedBox&&(this.opts.toolbarFixed=!0),this.document=document,this.window=window,this.savedSel=!1,this.cleanlineBefore=new RegExp("^<(/?"+this.opts.ownLine.join("|/?")+"|"+this.opts.contOwnLine.join("|")+")[ >]"),this.cleanlineAfter=new RegExp("^<(br|/?"+this.opts.ownLine.join("|/?")+"|/"+this.opts.contOwnLine.join("|/")+")[ >]"),this.cleannewLevel=new RegExp("^</?("+this.opts.newLevel.join("|")+")[ >]"),this.rTestBlock=new RegExp("^("+this.opts.blockLevelElements.join("|")+")$","i"),this.opts.linebreaks===!1&&(this.opts.allowedTags!==!1&&"-1"===e.inArray("p",this.opts.allowedTags)&&this.opts.allowedTags.push("p"),this.opts.deniedTags!==!1)){var r=e.inArray("p",this.opts.deniedTags);"-1"!==r&&this.opts.deniedTags.splice(r,r)}(this.browser("msie")||this.browser("opera"))&&(this.opts.buttons=this.removeFromArrayByValue(this.opts.buttons,"horizontalrule")),this.opts.curLang=this.opts.langs[this.opts.lang],this.buildStart()},initToolbar:function(e){return{html:{title:e.html,func:"toggle"},formatting:{title:e.formatting,func:"show",dropdown:{p:{title:e.paragraph,func:"formatBlocks"},blockquote:{title:e.quote,func:"formatQuote",className:"redactor_format_blockquote"},pre:{title:e.code,func:"formatBlocks",className:"redactor_format_pre"},h1:{title:e.header1,func:"formatBlocks",className:"redactor_format_h1"},h2:{title:e.header2,func:"formatBlocks",className:"redactor_format_h2"},h3:{title:e.header3,func:"formatBlocks",className:"redactor_format_h3"},h4:{title:e.header4,func:"formatBlocks",className:"redactor_format_h4"}}},bold:{title:e.bold,exec:"bold"},italic:{title:e.italic,exec:"italic"},deleted:{title:e.deleted,exec:"strikethrough"},underline:{title:e.underline,exec:"underline"},unorderedlist:{title:"&bull; "+e.unorderedlist,exec:"insertunorderedlist"},orderedlist:{title:"1. "+e.orderedlist,exec:"insertorderedlist"},outdent:{title:"< "+e.outdent,func:"indentingOutdent"},indent:{title:"> "+e.indent,func:"indentingIndent"},image:{title:e.image,func:"imageShow"},video:{title:e.video,func:"videoShow"},file:{title:e.file,func:"fileShow"},table:{title:e.table,func:"show",dropdown:{insert_table:{title:e.insert_table,func:"tableShow"},separator_drop1:{name:"separator"},insert_row_above:{title:e.insert_row_above,func:"tableAddRowAbove"},insert_row_below:{title:e.insert_row_below,func:"tableAddRowBelow"},insert_column_left:{title:e.insert_column_left,func:"tableAddColumnLeft"},insert_column_right:{title:e.insert_column_right,func:"tableAddColumnRight"},separator_drop2:{name:"separator"},add_head:{title:e.add_head,func:"tableAddHead"},delete_head:{title:e.delete_head,func:"tableDeleteHead"},separator_drop3:{name:"separator"},delete_column:{title:e.delete_column,func:"tableDeleteColumn"},delete_row:{title:e.delete_row,func:"tableDeleteRow"},delete_table:{title:e.delete_table,func:"tableDeleteTable"}}},link:{title:e.link,func:"show",dropdown:{link:{title:e.link_insert,func:"linkShow"},unlink:{title:e.unlink,exec:"unlink"}}},fontcolor:{title:e.fontcolor,func:"show"},backcolor:{title:e.backcolor,func:"show"},alignment:{title:e.alignment,func:"show",dropdown:{alignleft:{title:e.align_left,func:"alignmentLeft"},aligncenter:{title:e.align_center,func:"alignmentCenter"},alignright:{title:e.align_right,func:"alignmentRight"},justify:{title:e.align_justify,func:"alignmentJustify"}}},alignleft:{title:e.align_left,func:"alignmentLeft"},aligncenter:{title:e.align_center,func:"alignmentCenter"},alignright:{title:e.align_right,func:"alignmentRight"},justify:{title:e.align_justify,func:"alignmentJustify"},horizontalrule:{exec:"inserthorizontalrule",title:e.horizontalrule}}},callback:function(t,i,n){var r=this.opts[t+"Callback"];return e.isFunction(r)?i===!1?r.call(this,n):r.call(this,i,n):n},destroy:function(){clearInterval(this.autosaveInterval),e(window).off(".redactor"),this.$element.off(".redactor").removeData("redactor");var t=this.get();if(this.opts.textareamode)this.$box.after(this.$source),this.$box.remove(),this.$source.val(t).show();else{var i=this.$editor;this.opts.iframe&&(i=this.$element),this.$box.after(i),this.$box.remove(),i.removeClass("redactor_editor").removeClass("redactor_editor_wym").removeAttr("contenteditable").html(t).show()}},get:function(){return this.$source.val()},getCodeIframe:function(){this.$editor.removeAttr("contenteditable").removeAttr("dir");var e=this.outerHtml(this.$frame.contents().children());return this.$editor.attr({contenteditable:!0,dir:this.opts.direction}),e},set:function(e,t){e=e.toString(),this.opts.fullpage?this.setCodeIframe(e):this.setEditor(e,t)},setEditor:function(e,t){t!==!1&&(e=this.cleanSavePreCode(e),e=this.cleanStripTags(e),e=this.cleanConvertProtected(e),e=this.cleanConvertInlineTags(e),e=this.opts.linebreaks===!1?this.cleanConverters(e):e.replace(/<p(.*?)>([\w\W]*?)<\/p>/gi,"$2<br>")),e=this.cleanEmpty(e),this.$editor.html(e),this.sync()},setCodeIframe:function(e){var t=this.iframePage();this.$frame[0].src="about:blank",e=this.cleanConvertProtected(e),e=this.cleanConvertInlineTags(e),e=this.cleanRemoveSpaces(e),t.open(),t.write(e),t.close(),this.opts.fullpage&&(this.$editor=this.$frame.contents().find("body").attr({contenteditable:!0,dir:this.opts.direction})),this.sync()},setFullpageOnInit:function(e){e=this.cleanSavePreCode(e,!0),e=this.cleanConverters(e),e=this.cleanEmpty(e),this.$editor.html(e),this.sync()},sync:function(){var t="";this.cleanUnverified(),t=this.opts.fullpage?this.getCodeIframe():this.$editor.html(),t=this.syncClean(t),t=this.cleanRemoveSpaces(t),t=this.cleanRemoveEmptyTags(t),t=t.replace(/<\/li><(ul|ol)>([\w\W]*?)<\/(ul|ol)>/gi,"<$1>$2</$1></li>"),"<br>"===e.trim(t)&&(t=""),""!==t&&(t=this.cleanHtml(t)),t=this.callback("syncBefore",!1,t),this.$source.val(t),"undefined"!=typeof htmlEncode&&e("#"+this.$element[0].id+"_code").html(htmlEncode(t)),this.callback("syncAfter",!1,t)},syncClean:function(t){return this.opts.fullpage||(t=this.cleanStripTags(t)),t=e.trim(t),t=this.placeholderRemoveFromCode(t),t=t.replace(/&#x200b;/gi,""),t=t.replace(/&#8203;/gi,""),t=t.replace(/&nbsp;/gi," "),t=t.replace("<!--?php","<?php"),t=t.replace("?-->","?>"),t=t.replace(/<span(.*?)data-redactor="verified"(.*?)>([\w\W]*?)<\/span>/gi,'<font$1data-redactor="verified"$2>$3</font>'),t=t.replace(/<span(.*?)>([\w\W]*?)<\/span>/gi,"$2"),t=t.replace(/<font(.*?)data-redactor="verified"(.*?)>([\w\W]*?)<\/font>/gi,"<span$1$2>$3</span>"),t=t.replace(/<br\s?\/?>\n?<\/(.*?)>/gi,"</$1>"),t=t.replace(/<span(.*?)data-redactor-inlineMethods=""(.*?)>([\w\W]*?)<\/span>/gi,"<span$1$2>$3</span>"),t=t.replace(/<span\s*?>([\w\W]*?)<\/span>/gi,"$1"),t=t.replace(/<span\s*?id="selection-marker(.*?)"(.*?)>([\w\W]*?)<\/span>/gi,""),t=this.cleanReConvertProtected(t)},buildStart:function(){this.content="",this.$box=e('<div class="redactor_box" />'),"TEXTAREA"===this.$source[0].tagName&&(this.opts.textareamode=!0),this.opts.mobile===!1&&this.isMobile()?this.buildMobile():(this.buildContent(),this.opts.iframe?(this.opts.autoresize=!1,this.iframeStart()):this.opts.textareamode?this.buildFromTextarea():this.buildFromElement(),this.opts.iframe||(this.buildOptions(),this.buildAfter()))},buildMobile:function(){this.opts.textareamode||(this.$editor=this.$source,this.$editor.hide(),this.$source=this.buildCodearea(this.$editor),this.$source.val(this.content)),this.$box.insertAfter(this.$source).append(this.$source)},buildContent:function(){this.content=this.opts.textareamode?e.trim(this.$source.val()):e.trim(this.$source.html())},buildFromTextarea:function(){this.$editor=e("<div />"),this.$box.insertAfter(this.$source).append(this.$editor).append(this.$source),this.buildAddClasses(this.$editor),this.buildEnable()},buildFromElement:function(){this.$editor=this.$source,this.$source=this.buildCodearea(this.$editor),this.$box.insertAfter(this.$editor).append(this.$editor).append(this.$source),this.buildEnable()},buildCodearea:function(t){return e("<textarea />").attr("name",t.attr("id")).css("height",this.sourceHeight)},buildAddClasses:function(t){e.each(this.$source.get(0).className.split(/\s+/),function(e,i){t.addClass("redactor_"+i)})},buildEnable:function(){this.$editor.addClass("redactor_editor").attr({contenteditable:!0,dir:this.opts.direction}),this.$source.attr("dir",this.opts.direction).hide(),this.set(this.content)},buildOptions:function(){var e=this.$editor;this.opts.iframe&&(e=this.$frame),this.opts.tabindex&&e.attr("tabindex",this.opts.tabindex),this.opts.minHeight&&e.css("min-height",this.opts.minHeight+"px"),this.opts.wym&&this.$editor.addClass("redactor_editor_wym"),this.opts.autoresize||e.css("height",this.sourceHeight)},buildAfter:function(){if(this.opts.toolbar&&(this.opts.toolbar=this.initToolbar(this.opts.curLang),this.toolbarBuild()),this.modalTemplatesInit(),this.buildPlugins(),this.browser("opera")||this.pasteInit(),this.buildBindKeyboard(),this.opts.autosave&&this.autosave(),setTimeout(e.proxy(this.observeStart,this),4),this.browser("mozilla"))try{this.document.execCommand("enableObjectResizing",!1,!1),this.document.execCommand("enableInlineTableEditing",!1,!1)}catch(t){}this.opts.focus&&setTimeout(e.proxy(this.focus,this),100),this.opts.visual||setTimeout(e.proxy(function(){this.opts.visual=!0,this.toggle(!1)},this),200),this.callback("init")},buildBindKeyboard:function(){this.$editor.on("keydown.redactor",e.proxy(function(t){var i=t.which,n=t.ctrlKey||t.metaKey,r=this.getParent(),o=this.getCurrent(),s=this.getBlock(),a=!1;if(this.callback("keydown",t),(r&&"PRE"===e(r).get(0).tagName||o&&"PRE"===e(o).get(0).tagName)&&(a=!0,i===this.keyCode.DOWN&&this.insertAfterLastElement(s)),i===this.keyCode.DOWN&&(r&&"BLOCKQUOTE"===e(r).get(0).tagName&&this.insertAfterLastElement(r),o&&"BLOCKQUOTE"===e(o).get(0).tagName&&this.insertAfterLastElement(o)),n&&!t.shiftKey&&this.shortcuts(t,i),n&&90===i&&!t.shiftKey&&!t.altKey)return t.preventDefault(),this.opts.buffer.length?this.bufferUndo():this.document.execCommand("undo",!1,!1),void 0;if(n&&90===i&&t.shiftKey&&!t.altKey)return t.preventDefault(),0!=this.opts.rebuffer.length?this.bufferRedo():this.document.execCommand("redo",!1,!1),void 0;if(n&&(65===i?this.selectall=!0:i==this.keyCode.LEFT_WIN||n||(this.selectall=!1)),i!=this.keyCode.ENTER||t.shiftKey||t.ctrlKey||t.metaKey)i===this.keyCode.ENTER&&(t.ctrlKey||t.shiftKey)&&(this.bufferSet(),t.preventDefault(),this.insertLineBreak());else{if(1==r.nodeType&&("TD"==r.tagName||"TH"==r.tagName))return this.insertNode(document.createElement("br")),t.preventDefault(),void 0;if(a===!0){this.bufferSet(),t.preventDefault();var l=e(o).parent().text();return this.insertNode(document.createTextNode("\n")),-1==l.search(/\s$/)&&this.insertNode(document.createTextNode("\n")),this.sync(),!1}if(!this.opts.linebreaks)if(s&&/^(P|H[1-6]|LI|ADDRESS|SECTION|HEADER|FOOTER|ASIDE|ARTICLE)$/i.test(s.tagName))setTimeout(e.proxy(function(){var t=this.getBlock();if("DIV"===t.tagName&&!e(t).hasClass("redactor_editor")){var i=e("<p>"+this.opts.invisibleSpace+"</p>");e(t).replaceWith(i),this.selectionStart(i)}},this),1);else if(s===!1){var c=e("<p>"+this.opts.invisibleSpace+"</p>");return this.insertNode(c[0]),this.selectionStart(c),!1}if(this.opts.linebreaks){if(!s||!/^(P|H[1-6]|LI|ADDRESS|SECTION|HEADER|FOOTER|ASIDE|ARTICLE)$/i.test(s.tagName))return this.insertLineBreak(),t.preventDefault(),void 0;setTimeout(e.proxy(function(){var t=this.getBlock();"DIV"!==t.tagName&&"P"!==t.tagName||e(t).hasClass("redactor_editor")||this.replaceLineBreak(t)},this),1)}if("BLOCKQUOTE"==s.tagName||"FIGCAPTION"==s.tagName)return this.insertLineBreak(),t.preventDefault(),void 0}if(i===this.keyCode.TAB&&this.opts.shortcuts)return t.preventDefault(),a!==!0||t.shiftKey?(t.shiftKey?this.indentingOutdent():this.indentingIndent(),!1):(this.bufferSet(),this.insertNode(document.createTextNode("	")),this.sync(),!1);if(i===this.keyCode.BACKSPACE){var d=e.trim(o.nodeValue.replace(/[^\u0000-\u007E]/g,""));3===o.nodeType&&8203==o.nodeValue.charCodeAt(0)&&""==d&&o.remove()}},this)),this.$editor.on("keyup.redactor",e.proxy(function(t){var i=t.which,n=this.getParent(),r=this.getCurrent();if(!this.opts.linebreaks&&3==r.nodeType&&(0==n||"BODY"==n.tagName)){var o=e("<p>").append(e(r).clone());e(r).replaceWith(o);var s=e(o).next();"BR"==s[0].tagName&&s.remove(),this.selectionEnd(o)}return this.opts.convertLinks&&i===this.keyCode.ENTER&&this.formatLinkify(this.opts.linkProtocol),this.opts.linebreaks!==!1||i!==this.keyCode.DELETE&&i!==this.keyCode.BACKSPACE?(this.callback("keyup",t),this.sync(),void 0):this.formatEmpty(t)},this)),e.isFunction(this.opts.focusCallback)&&this.$editor.on("focus.redactor",e.proxy(this.opts.focusCallback,this)),e.isFunction(this.opts.blurCallback)&&this.$editor.on("blur.redactor",e.proxy(this.opts.blurCallback,this))},buildPlugins:function(){this.opts.plugins&&e.each(this.opts.plugins,e.proxy(function(t,i){RedactorPlugins[i]&&(e.extend(this,RedactorPlugins[i]),e.isFunction(RedactorPlugins[i].init)&&this.init())},this))},iframeStart:function(){this.iframeCreate(),this.opts.textareamode?this.iframeAppend(this.$source):(this.$sourceOld=this.$source.hide(),this.$source=this.buildCodearea(this.$sourceOld),this.iframeAppend(this.$sourceOld))},iframeAppend:function(e){this.$source.attr("dir",this.opts.direction).hide(),this.$box.insertAfter(e).append(this.$frame).append(this.$source)},iframeCreate:function(){this.$frame=e('<iframe style="width: 100%;" frameborder="0" />').one("load",e.proxy(function(){if(this.opts.fullpage){this.iframePage(),""===this.content&&(this.content=this.opts.invisibleSpace),this.$frame.contents()[0].write(this.content),this.$frame.contents()[0].close();var t=setInterval(e.proxy(function(){this.$frame.contents().find("body").html()&&(clearInterval(t),this.iframeLoad())},this),0)}else this.iframeLoad()},this))},iframeDoc:function(){return this.$frame[0].contentWindow.document},iframePage:function(){var e=this.iframeDoc();return e.documentElement&&e.removeChild(e.documentElement),e},iframeAddCss:function(t){t=t||this.opts.css,this.isString(t)&&this.$frame.contents().find("head").append('<link rel="stylesheet" href="'+t+'" />'),e.isArray(t)&&e.each(t,e.proxy(function(e,t){this.iframeAddCss(t)},this))},iframeLoad:function(){this.$editor=this.$frame.contents().find("body").attr({contenteditable:!0,dir:this.opts.direction}),this.$editor[0]&&(this.document=this.$editor[0].ownerDocument,this.window=this.document.defaultView||window),this.iframeAddCss(),this.opts.fullpage?this.setFullpageOnInit(this.$editor.html()):this.set(this.content),this.buildOptions(),this.buildAfter()},placeholderStart:function(t){return this.isEmpty(t)&&(this.$element.attr("placeholder")&&(this.opts.placeholder=this.$element.attr("placeholder")),""===this.opts.placeholder&&(this.opts.placeholder=!1),this.opts.placeholder!==!1)?(this.opts.focus=!1,this.$editor.one("focus.redactor_placeholder",e.proxy(this.placeholderFocus,this)),e('<span class="redactor_placeholder" data-redactor="verified">').attr("contenteditable",!1).text(this.opts.placeholder)):!1},placeholderFocus:function(){this.$editor.find("span.redactor_placeholder").remove();var e="";this.opts.linebreaks===!1&&(e=this.opts.emptyHtml),this.$editor.off("focus.redactor_placeholder"),this.$editor.html(e),this.opts.linebreaks===!1&&this.selectionStart(this.$editor.children()[0]),this.sync()},placeholderRemove:function(){this.opts.placeholder=!1,this.$editor.find("span.redactor_placeholder").remove(),this.$editor.off("focus.redactor_placeholder")},placeholderRemoveFromCode:function(e){return e.replace(/<span class="redactor_placeholder"(.*?)>(.*?)<\/span>/i,"")},shortcuts:function(e,t){this.opts.shortcuts&&(e.altKey?48===t?this.shortcutsLoadFormat(e,"p"):49===t?this.shortcutsLoadFormat(e,"h1"):50===t?this.shortcutsLoadFormat(e,"h2"):51===t?this.shortcutsLoadFormat(e,"h3"):52===t?this.shortcutsLoadFormat(e,"h4"):53===t?this.shortcutsLoadFormat(e,"h5"):54===t&&this.shortcutsLoadFormat(e,"h6"):77===t?this.shortcutsLoad(e,"removeFormat"):66===t?this.shortcutsLoad(e,"bold"):73===t?this.shortcutsLoad(e,"italic"):74===t?this.shortcutsLoad(e,"insertunorderedlist"):75===t?this.shortcutsLoad(e,"insertorderedlist"):76===t?this.shortcutsLoad(e,"superscript"):72===t&&this.shortcutsLoad(e,"subscript"))},shortcutsLoad:function(e,t){e.preventDefault(),this.execCommand(t,!1)},shortcutsLoadFormat:function(e,t){e.preventDefault(),this.formatBlocks(t)},focus:function(){this.browser("opera")?this.$editor.focus():this.window.setTimeout(e.proxy(this.focusSet,this,!0),1)},focusEnd:function(){this.focusSet()},focusSet:function(e){this.$editor.focus();var t=this.getRange();t.selectNodeContents(this.$editor[0]),t.collapse(e||!1);var i=this.getSelection();i.removeAllRanges(),i.addRange(t)},toggle:function(t){var i;if(this.opts.visual){t!==!1&&this.selectionSave();var n=null;this.opts.iframe?(n=this.$frame.height(),this.opts.fullpage&&this.$editor.removeAttr("contenteditable"),this.$frame.hide()):(n=this.$editor.innerHeight(),this.$editor.hide()),i=this.$source.val(),this.modified=i,this.$source.height(n).show().focus(),this.$source.on("keydown.redactor-textarea",function(t){if(9===t.keyCode){var i=e(this),n=i.get(0).selectionStart;return i.val(i.val().substring(0,n)+"	"+i.val().substring(i.get(0).selectionEnd)),i.get(0).selectionStart=i.get(0).selectionEnd=n+1,!1}}),this.buttonInactiveVisual(),this.buttonActive("html"),this.opts.visual=!1}else i=this.$source.hide().val(),"undefined"!=typeof this.modified&&(this.modified=this.cleanRemoveSpaces(this.modified,!1)!==this.cleanRemoveSpaces(i,!1)),this.modified&&(this.opts.fullpage&&""===i?this.setFullpageOnInit(i):(this.set(i),this.opts.fullpage&&this.buildBindKeyboard())),this.opts.iframe?this.$frame.show():this.$editor.show(),this.opts.fullpage&&this.$editor.attr("contenteditable",!0),this.$source.off("keydown.redactor-textarea"),this.$editor.focus(),this.selectionRestore(),this.observeStart(),this.buttonActiveVisual(),this.buttonInactive("html"),this.opts.visual=!0},autosave:function(){var t=!1;this.autosaveInterval=setInterval(e.proxy(function(){var i=this.get();t!==i&&e.ajax({url:this.opts.autosave,type:"post",data:this.$source.attr("name")+"="+escape(encodeURIComponent(i)),success:e.proxy(function(e){this.callback("autosave",!1,e),t=i},this)})},this),1e3*this.opts.autosaveInterval)},toolbarBuild:function(){if(this.opts.air)this.opts.buttons=this.opts.airButtons;else if(!this.opts.buttonSource){var t=this.opts.buttons.indexOf("html"),i=this.opts.buttons[t+1];this.opts.buttons.splice(t,1),"|"===i&&this.opts.buttons.splice(t,1)}if(e.extend(this.opts.toolbar,this.opts.buttonsCustom),e.each(this.opts.buttonsAdd,e.proxy(function(e,t){this.opts.buttons.push(t)},this)),this.opts.toolbar&&e.each(this.opts.toolbar.formatting.dropdown,e.proxy(function(t){"-1"==e.inArray(t,this.opts.formattingTags)&&delete this.opts.toolbar.formatting.dropdown[t]},this)),0===this.opts.buttons.length)return!1;if(this.airEnable(),this.$toolbar=e("<ul>").addClass("redactor_toolbar").attr("id","redactor_toolbar_"+this.uuid),this.opts.air?(this.$air=e('<div class="redactor_air">').attr("id","redactor_air_"+this.uuid).hide(),this.$air.append(this.$toolbar),e("body").append(this.$air)):this.opts.toolbarExternal?e(this.opts.toolbarExternal).html(this.$toolbar):this.$box.prepend(this.$toolbar),e.each(this.opts.buttons,e.proxy(function(t,i){if("|"===i)this.$toolbar.append(e(this.opts.buttonSeparator));else if(this.opts.toolbar[i]){var n=this.opts.toolbar[i];if(this.opts.fileUpload===!1&&"file"===i)return!0;this.$toolbar.append(e("<li>").append(this.buttonBuild(i,n)))}},this)),this.$toolbar.find("a").attr("tabindex","-1"),this.opts.toolbarFixed&&(this.toolbarObserveScroll(),e(document).on("scroll.redactor",e.proxy(this.toolbarObserveScroll,this))),this.opts.activeButtons){var n=e.proxy(this.buttonActiveObserver,this);this.$editor.on("mouseup.redactor keyup.redactor",n)}},toolbarObserveScroll:function(){var t=e(this.document).scrollTop(),i=this.$box.offset().top,n=0,r=i+this.$box.height()+40;if(t>i){var o="100%";this.opts.toolbarFixedBox&&(n=this.$box.offset().left,o=this.$box.innerWidth(),this.$toolbar.addClass("toolbar_fixed_box")),this.toolbarFixed=!0,this.$toolbar.css({position:"fixed",width:o,zIndex:1005,top:this.opts.toolbarFixedTopOffset+"px",left:n}),r>t?this.$toolbar.css("visibility","visible"):this.$toolbar.css("visibility","hidden")}else this.toolbarFixed=!1,this.$toolbar.css({position:"relative",width:"auto",top:0,left:n}),this.opts.toolbarFixedBox&&this.$toolbar.removeClass("toolbar_fixed_box")},airEnable:function(){this.opts.air&&this.$editor.on("mouseup.redactor keyup.redactor",this,e.proxy(function(t){var i=this.getSelectionText();if("mouseup"===t.type&&""!=i&&this.airShow(t),"keyup"===t.type&&t.shiftKey&&""!=i){var n=e(this.getElement(this.getSelection().focusNode)),r=n.offset();r.height=n.height(),this.airShow(r,!0)}},this))},airShow:function(t,i){if(this.opts.air){var n,r;if(e(".redactor_air").hide(),i)n=t.left,r=t.top+t.height+14,this.opts.iframe&&(r+=this.$box.position().top-e(this.document).scrollTop(),n+=this.$box.position().left);else{var o=this.$air.innerWidth();n=t.clientX,e(this.document).width()<n+o&&(n-=o),r=t.clientY+14,this.opts.iframe?(r+=this.$box.position().top,n+=this.$box.position().left):r+=e(this.document).scrollTop()}this.$air.css({left:n+"px",top:r+"px"}).show(),this.airBindHide()}},airBindHide:function(){if(this.opts.air){var t=e.proxy(function(t){e(t).on("mousedown.redactor",e.proxy(function(i){0===e(i.target).closest(this.$toolbar).length&&(this.$air.fadeOut(100),this.selectionRemove(),e(t).off(i))},this)).on("keydown.redactor",e.proxy(function(i){i.which===this.keyCode.ESC&&this.getSelection().collapseToStart(),this.$air.fadeOut(100),e(t).off(i)},this))},this);t(document),this.opts.iframe&&t(this.document)}},airBindMousemoveHide:function(){if(this.opts.air){var t=e.proxy(function(t){e(t).on("mousemove.redactor",e.proxy(function(i){0===e(i.target).closest(this.$toolbar).length&&(this.$air.fadeOut(100),e(t).off(i))},this))},this);t(document),this.opts.iframe&&t(this.document)}},pickerBuild:function(t,i){t.width(210);var n="color";"backcolor"===i&&(n="background-color");for(var r=this.opts.colors.length,o=this,s=0;r>s;s++){var a=this.opts.colors[s],l=e('<a rel="'+a+'" href="javascript:;" class="redactor_color_link"></a>').css({backgroundColor:a});t.append(l),l.on("click",function(){var t=e(this).attr("rel");"backcolor"===i&&(t=e(this).css("background-color")),o.pickerSet(n,t)})}var c=e('<a href="javascript:;" class="redactor_color_none"></a>').html(this.opts.curLang.none).on("click",function(){o.pickerSet(n,!1)});t.append(c)},pickerSet:function(e,t){this.bufferSet(),this.$editor.focus(),this.inlineRemoveStyle(e),t!==!1&&this.inlineSetStyle(e,t),this.opts.air&&this.$air.fadeOut(100),this.sync()},dropdownBuild:function(t,i){e.each(i,e.proxy(function(i,n){n.className||(n.className="");var r;"separator"===n.name?r=e('<a class="redactor_separator_drop">'):(r=e('<a href="javascript:;" class="'+n.className+'">'+n.title+"</a>"),r.on("click",e.proxy(function(e){e.preventDefault&&e.preventDefault(),this.browser("msie")&&(e.returnValue=!1),n.callback&&n.callback.call(this,i,r,n),n.exec&&this.execCommand(n.exec,i),n.func&&this[n.func](i),this.buttonActiveObserver(),this.opts.air&&this.$air.fadeOut(100)},this))),t.append(r)},this))},dropdownShow:function(t,i,n){if(!this.opts.visual)return t.preventDefault(),!1;if(this.buttonGet(n).hasClass("dropact"))this.dropdownHideAll();else{this.dropdownHideAll(),this.buttonActive(n),this.buttonGet(n).addClass("dropact");var r=this.buttonGet(n).position(),o=r.left+"px",s=29;this.opts.air?i.css({position:"absolute",left:o,top:s+"px"}).show():this.opts.toolbarFixed&&this.toolbarFixed?i.css({position:"fixed",left:o,top:s+"px"}).show():i.css({position:"absolute",left:o,top:r.top+s+"px"}).show()}var a=e.proxy(function(e){this.dropdownHide(e,i)},this);e(document).one("click",a),this.$editor.one("click",a),t.stopPropagation()},dropdownHideAll:function(){this.$toolbar.find("a.dropact").removeClass("redactor_act").removeClass("dropact"),e(".redactor_dropdown").hide()},dropdownHide:function(t,i){e(t.target).hasClass("dropact")||(i.removeClass("dropact"),this.dropdownHideAll())},buttonBuild:function(t,i){var n=e('<a href="javascript:;" title="'+i.title+'" class="redactor_btn redactor_btn_'+t+'"></a>'),r=e('<div class="redactor_dropdown" style="display: none;">');return n.on("click",e.proxy(function(e){return e.preventDefault&&e.preventDefault(),this.browser("msie")&&(e.returnValue=!1),this.opts.visual||"html"===t?(i.exec?(this.execCommand(i.exec,t),this.airBindMousemoveHide()):i.func&&"show"!==i.func?(this[i.func](t),this.airBindMousemoveHide()):i.callback?(i.callback.call(this,t,n,i),this.airBindMousemoveHide()):("backcolor"===t||"fontcolor"===t||i.dropdown)&&this.dropdownShow(e,r,t),this.buttonActiveObserver(),void 0):!1},this)),("backcolor"===t||"fontcolor"===t||i.dropdown)&&(r.appendTo(this.$toolbar),"backcolor"===t||"fontcolor"===t?this.pickerBuild(r,t):this.dropdownBuild(r,i.dropdown)),n},buttonGet:function(t){return this.opts.toolbar?e(this.$toolbar.find("a.redactor_btn_"+t)):!1},buttonActive:function(e){this.buttonGet(e).addClass("redactor_act")},buttonInactive:function(e){this.buttonGet(e).removeClass("redactor_act")},buttonInactiveAll:function(){e.each(this.opts.activeButtons,e.proxy(function(e,t){this.buttonInactive(t)},this))},buttonActiveVisual:function(){this.$toolbar.find("a.redactor_btn").not("a.redactor_btn_html").removeClass("redactor_button_disabled")},buttonInactiveVisual:function(){this.$toolbar.find("a.redactor_btn").not("a.redactor_btn_html").addClass("redactor_button_disabled")},buttonChangeIcon:function(e,t){this.buttonGet(e).addClass("redactor_btn_"+t)},buttonRemoveIcon:function(e,t){this.buttonGet(e).removeClass("redactor_btn_"+t)},buttonAddSeparator:function(){this.$toolbar.append(e(this.opts.buttonSeparator))},buttonAddSeparatorAfter:function(t){this.buttonGet(t).parent().after(e(this.opts.buttonSeparator))},buttonAddSeparatorBefore:function(t){this.buttonGet(t).parent().before(e(this.opts.buttonSeparator))},buttonRemoveSeparatorAfter:function(e){this.buttonGet(e).parent().next().remove()},buttonRemoveSeparatorBefore:function(e){this.buttonGet(e).parent().prev().remove()},buttonSetRight:function(e){this.opts.toolbar&&this.buttonGet(e).parent().addClass("redactor_btn_right")},buttonSetLeft:function(e){this.opts.toolbar&&this.buttonGet(e).parent().removeClass("redactor_btn_right")},buttonAdd:function(t,i,n,r){if(this.opts.toolbar){var o=this.buttonBuild(t,{title:i,callback:n,dropdown:r});this.$toolbar.append(e("<li>").append(o))}},buttonAddFirst:function(t,i,n,r){if(this.opts.toolbar){var o=this.buttonBuild(t,{title:i,callback:n,dropdown:r});this.$toolbar.prepend(e("<li>").append(o))}},buttonAddAfter:function(t,i,n,r,o){if(this.opts.toolbar){var s=this.buttonBuild(i,{title:n,callback:r,dropdown:o}),a=this.buttonGet(t);a.parent().after(e("<li>").append(s))}},buttonAddBefore:function(t,i,n,r,o){if(this.opts.toolbar){var s=this.buttonBuild(i,{title:n,callback:r,dropdown:o}),a=this.buttonGet(t);
a.parent().before(e("<li>").append(s))}},buttonRemove:function(e,t){var i=this.buttonGet(e);t&&i.parent().next().remove(),i.parent().removeClass("redactor_btn_right"),i.remove()},buttonActiveObserver:function(){var t=this.getParent();this.buttonInactiveAll(),this.opts.activeButtonsAdd&&(e.each(this.opts.activeButtonsAdd,e.proxy(function(e,t){this.opts.activeButtons.push(t)},this)),e.extend(this.opts.activeButtonsStates,this.opts.activeButtonsAdd)),e.each(this.opts.activeButtonsStates,e.proxy(function(i,n){0!=e(t).closest(i,this.$editor.get()[0]).length&&this.buttonActive(n)},this));var i=e(t).closest(this.opts.alignmentTags.toString().toLowerCase(),this.$editor[0]);if(i.length){var n=i.css("text-align");switch(n){case"right":this.buttonActive("alignright");break;case"center":this.buttonActive("aligncenter");break;case"justify":this.buttonActive("justify");break;default:this.buttonActive("alignleft")}}},exec:function(e,t,i){"formatblock"===e&&this.browser("msie")&&(t="<"+t+">"),"inserthtml"===e&&this.browser("msie")?(this.$editor.focus(),this.document.selection.createRange().pasteHTML(t)):this.document.execCommand(e,!1,t),i!==!1&&this.sync(),this.callback("execCommand",e,t)},execCommand:function(t,i,n){if(!this.opts.visual)return this.$source.focus(),!1;if("inserthtml"===t)return this.insertHtml(i,n),this.callback("execCommand",t,i),void 0;if(this.currentOrParentIs("PRE")&&!this.opts.formattingPre)return!1;if("insertunorderedlist"===t||"insertorderedlist"===t){var r=this.getParent(),o=e(r).closest("ol, ul"),s=!1;if(o.length){s=!0;var a=o[0].tagName;("insertunorderedlist"===t&&"OL"===a||"insertorderedlist"===t&&"UL"===a)&&(s=!1)}if(s){this.selectionSave();var l=this.getNodes(),c=this.getBlocks(l);"undefined"!=typeof l[0]&&l.length>1&&3==l[0].nodeType&&c.unshift(this.getBlock());var d="",h="";e.each(c,e.proxy(function(t,i){if("LI"==i.tagName){var n=e(i),r=n.clone();r.find("ul","ol").remove(),d+=this.opts.linebreaks===!1?this.outerHtml(e("<p>").append(r.contents())):r.html()+"<br>",0==t?(n.addClass("redactor-replaced").empty(),h=this.outerHtml(n)):n.remove()}},this)),html=this.$editor.html().replace(h,"</"+a+">"+d+"<"+a+">"),this.$editor.html(html),this.$editor.find(a+":empty").remove(),this.selectionRestore()}else{this.selectionSave(),this.document.execCommand(t);var r=this.getParent(),o=e(r).closest("ol, ul");if(o.length){(this.browser("msie")||this.browser("mozilla"))&&"LI"!==r.tagName&&e(r).replaceWith(e(r).html());var u=o.parent();this.isParentRedactor(u)&&this.nodeTestBlocks(u[0])&&u.replaceWith(u.contents())}this.browser("mozilla")&&this.$editor.focus(),this.selectionRestore()}return this.sync(),this.callback("execCommand",t,i),void 0}if("unlink"===t){var r=this.getParent();if("A"===e(r)[0].tagName)return e(r).replaceWith(e(r).text()),this.sync(),this.callback("execCommand",t,i),void 0}this.exec(t,i,n),"inserthorizontalrule"===t&&this.$editor.find("hr").removeAttr("id")},indentingIndent:function(){this.indentingStart("indent")},indentingOutdent:function(){this.indentingStart("outdent")},indentingStart:function(t){if("indent"===t){var i=this.getBlock();if(i&&"LI"==i.tagName){this.selectionSave();var n=this.getParent(),r=e(n).closest("ol, ul"),o=r[0].tagName,s=this.getBlocks();e.each(s,function(t,i){if("LI"==i.tagName){var n=e(i).prev();if(0!=n.size()&&"LI"==n[0].tagName){var r=n.children("ul, ol");0==r.size()?n.append(e("<"+o+">").append(i)):r.append(i)}}}),this.selectionRestore()}}else{this.selectionSave();var i=this.getBlock();if(i&&"LI"==i.tagName){var s=this.getBlocks(),a=0;this.insideOutdent(i,a,s)}this.selectionRestore()}},insideOutdent:function(t,i,n){if(t&&"LI"==t.tagName){var r=e(t).parent().parent();0!=r.size()&&"LI"==r[0].tagName?r.after(t):"undefined"!=typeof n[i]?(t=n[i],i++,this.insideOutdent(t,i,n)):this.execCommand("insertunorderedlist")}},cleanEmpty:function(e){var t=this.placeholderStart(e);return t!==!1?t:(this.opts.linebreaks===!1&&(""===e?e=this.opts.emptyHtml:-1!==e.search(/^<hr\s?\/?>$/gi)&&(e="<hr>"+this.opts.emptyHtml)),e)},cleanConverters:function(e){return this.opts.convertDivs&&(e=e.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p$1>$2</p>")),this.opts.paragraphy&&(e=this.cleanParagraphy(e)),e},cleanConvertProtected:function(e){return e=e.replace(/<script(.*?)>([\w\W]*?)<\/script>/gi,'<title type="text/javascript" style="display: none;" class="redactor-script-tag"$1>$2</title>'),e=e.replace(/<style(.*?)>([\w\W]*?)<\/style>/gi,'<section$1 style="display: none;" rel="redactor-style-tag">$2</section>'),e=e.replace(/<form(.*?)>([\w\W]*?)<\/form>/gi,'<section$1 rel="redactor-form-tag">$2</section>'),e=this.opts.phpTags?e.replace(/<\?php([\w\W]*?)\?>/gi,'<section style="display: none;" rel="redactor-php-tag">$1</section>'):e.replace(/<\?php([\w\W]*?)\?>/gi,"")},cleanReConvertProtected:function(e){return e=e.replace(/<title type="text\/javascript" style="display: none;" class="redactor-script-tag"(.*?)>([\w\W]*?)<\/title>/gi,'<script$1 type="text/javascript">$2</script>'),e=e.replace(/<section(.*?) style="display: none;" rel="redactor-style-tag">([\w\W]*?)<\/section>/gi,"<style$1>$2</style>"),e=e.replace(/<section(.*?)rel="redactor-form-tag"(.*?)>([\w\W]*?)<\/section>/gi,"<form$1$2>$3</form>"),this.opts.phpTags&&(e=e.replace(/<section style="display: none;" rel="redactor-php-tag">([\w\W]*?)<\/section>/gi,"<?php\r\n$1\r\n?>")),e},cleanRemoveSpaces:function(t,i){if(i!==!1){var n,i=[],r=0;n=t.match(/<(pre|style|script|title)(.*?)>([\w\W]*?)<\/(pre|style|script|title)>/gi),null!==n&&e.each(n,function(e,n){r=e,t=t.replace(n,"buffer_"+r),i.push(n)}),this.opts.phpTags&&(n=t.match(/<\?php([\w\W]*?)\?>/gi),null!==n&&e.each(n,function(e,n){r+=e,t=t.replace(n,"buffer_"+e),i.push(n)}))}return t=t.replace(/\n/g," "),t=t.replace(/[\t]*/g,""),t=t.replace(/\n\s*\n/g,"\n"),t=t.replace(/^[\s\n]*/g," "),t=t.replace(/[\s\n]*$/g," "),t=t.replace(/>\s{2,}</g,"><"),i!==!1&&(t=this.cleanReplacer(i,t)),t=t.replace(/\n\n/g,"\n")},cleanReplacer:function(t,i){return t&&e.each(t,function(e,t){i=i.replace("buffer_"+e,t)}),i},cleanRemoveEmptyTags:function(e){e=e.replace(/<span>([\w\W]*?)<\/span>/gi,"$1"),e=e.replace(/[\u200B-\u200D\uFEFF]/g,"");for(var t=["<pre></pre>","<blockquote>\\s*</blockquote>","<dd></dd>","<dt></dt>","<em>\\s*</em>","<ul></ul>","<ol></ol>","<li></li>","<table></table>","<tr></tr>","<span>\\s*<span>","<span>&nbsp;<span>","<b>\\s*</b>","<b>&nbsp;</b>","<p>\\s*</p>","<p></p>","<p>&nbsp;</p>","<p>\\s*<br>\\s*</p>","<div>\\s*</div>","<div>\\s*<br>\\s*</div>"],i=t.length,n=0;i>n;++n)e=e.replace(new RegExp(t[n],"gi"),"");return e},cleanParagraphy:function(t){function i(e,i,n){return t.replace(new RegExp(e,i),n)}if(t=e.trim(t),this.opts.linebreaks===!0)return t;if(""===t||"<p></p>"===t)return this.opts.emptyHtml;t+="\n";var n=[],r=0;-1!==t.search(/<(table|div|pre|object)/gi)&&e.each(t.match(/<(table|div|pre|object)(.*?)>([\w\W]*?)<\/(table|div|pre|object)>/gi),function(e,i){r++,n[r]=i,t=t.replace(i,"{replace"+r+"}\n")}),this.opts.phpTags&&-1!==t.search(/<section(.*?)rel="redactor-php-tag">/gi)&&e.each(t.match(/<section(.*?)rel="redactor-php-tag">([\w\W]*?)<\/section>/gi),function(e,i){r++,n[r]=i,t=t.replace(i,"{replace"+r+"}\n")}),t=t.replace(/<\!\-\-([\w\W]*?)\-\->/gi,"<comment>$1</comment>"),t=t.replace(/<br \/>\s*<br \/>/gi,"\n\n");var o="(comment|html|body|head|title|meta|style|script|link|iframe|table|thead|tfoot|caption|col|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|option|form|map|area|blockquote|address|math|style|p|h[1-6]|hr|fieldset|legend|section|article|aside|hgroup|header|footer|nav|figure|figcaption|details|menu|summary)";t=i("(<"+o+"[^>]*>)","gi","\n$1"),t=i("(</"+o+">)","gi","$1\n\n"),t=i("\r\n","g","\n"),t=i("\r","g","\n"),t=i("/\n\n+/","g","\n\n");var s=t.split(new RegExp("\ns*\n","g"),-1);t="";for(var a in s)s.hasOwnProperty(a)&&(t+=-1==s[a].search("{replace")?"<p>"+s[a].replace(/^\n+|\n+$/g,"")+"</p>":s[a]);return-1!==t.search(/<blockquote/gi)&&e.each(t.match(/<blockquote(.*?)>([\w\W]*?)<\/blockquote>/gi),function(e,i){var n="";n=i.replace("<p>",""),n=n.replace("</p>","<br>"),t=t.replace(i,n)}),t=i("<p>s*</p>","gi",""),t=i("<p>([^<]+)</(div|address|form)>","gi","<p>$1</p></$2>"),t=i("<p>s*(</?"+o+"[^>]*>)s*</p>","gi","$1"),t=i("<p>(<li.+?)</p>","gi","$1"),t=i("<p>s*(</?"+o+"[^>]*>)","gi","$1"),t=i("(</?"+o+"[^>]*>)s*</p>","gi","$1"),t=i("(</?"+o+"[^>]*>)s*<br />","gi","$1"),t=i("<br />(s*</?(?:p|li|div|dl|dd|dt|th|pre|td|ul|ol)[^>]*>)","gi","$1"),t=i("\n</p>","gi","</p>"),t=i("</li><p>","gi","</li>"),t=i("</ul><p>(.*?)</li>","gi","</ul></li>"),t=i("</ol><p>","gi","</ol>"),t=i("<p>	?\n?<p>","gi","<p>"),t=i("</dt><p>","gi","</dt>"),t=i("</dd><p>","gi","</dd>"),t=i("<br></p></blockquote>","gi","</blockquote>"),e.each(n,function(e,i){t=t.replace("{replace"+e+"}",i)}),t=t.replace(/<comment>([\w\W]*?)<\/comment>/gi,"<!--$1-->"),e.trim(t)},cleanConvertInlineTags:function(e){var t="strong";"b"===this.opts.boldTag&&(t="b");var i="em";return"i"===this.opts.italicTag&&(i="i"),e=e.replace(/<span style="font-style: italic;">([\w\W]*?)<\/span>/gi,"<"+i+">$1</"+i+">"),e=e.replace(/<span style="font-weight: bold;">([\w\W]*?)<\/span>/gi,"<"+t+">$1</"+t+">"),e="strong"===this.opts.boldTag?e.replace(/<b>([\w\W]*?)<\/b>/gi,"<strong>$1</strong>"):e.replace(/<strong>([\w\W]*?)<\/strong>/gi,"<b>$1</b>"),e="em"===this.opts.italicTag?e.replace(/<i>([\w\W]*?)<\/i>/gi,"<em>$1</em>"):e.replace(/<em>([\w\W]*?)<\/em>/gi,"<i>$1</i>"),e=e.replace(/<strike>([\w\W]*?)<\/strike>/gi,"<del>$1</del>"),/<span(.*?)data-redactor="verified"(.*?)>([\w\W]*?)<\/span>/gi.test(e)||(e=e.replace(/<span(.*?)(?!data-redactor="verified")(.*?)>([\w\W]*?)<\/span>/gi,'<span$1 data-redactor="verified"$2>$3</span>')),e},cleanStripTags:function(t){if(""==t||"undefined"==typeof t)return t;var i=!1;this.opts.allowedTags!==!1&&(i=!0);var n=i===!0?this.opts.allowedTags:this.opts.deniedTags,r=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return t=t.replace(r,function(t,r){return i===!0?e.inArray(r.toLowerCase(),n)>"-1"?t:"":e.inArray(r.toLowerCase(),n)>"-1"?"":t}),t=this.cleanConvertInlineTags(t)},cleanSavePreCode:function(t,i){var n=t.match(/<(pre|code)(.*?)>([\w\W]*?)<\/(pre|code)>/gi);return null!==n&&e.each(n,e.proxy(function(e,n){var r=n.match(/<(pre|code)(.*?)>([\w\W]*?)<\/(pre|code)>/i);r[3]=r[3].replace(/&nbsp;/g," "),i!==!1&&(r[3]=this.cleanEncodeEntities(r[3])),t=t.replace(n,"<"+r[1]+r[2]+">"+r[3]+"</"+r[1]+">")},this)),t},cleanEncodeEntities:function(e){return e=String(e).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"'),String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},cleanUnverified:function(){var t=this.$editor.find("img, a, b, strong, sub, sup, i, em, u, small, strike, del, span, cite").filter('[style*="font-size"][style*="line-height"]').css("font-size","").css("line-height","");e.each(t,e.proxy(function(e,t){this.removeEmptyAttr(t,"style")},this)),this.$editor.find('div[style="text-align: -webkit-auto;"]').contents().unwrap()},cleanHtml:function(e){var t=0,i=e.length,n=0,r=null,o=null,s="",a="",l="";for(this.cleanlevel=0;i>t;t++){if(n=t,-1==e.substr(t).indexOf("<"))return a+=e.substr(t),this.cleanFinish(a);for(;i>n&&"<"!=e.charAt(n);)n++;for(t!=n&&(l=e.substr(t,n-t),l.match(/^\s{2,}$/g)||("\n"==a.charAt(a.length-1)?a+=this.cleanGetTabs():"\n"==l.charAt(0)&&(a+="\n"+this.cleanGetTabs(),l=l.replace(/^\s+/,"")),a+=l),l.match(/\n/)&&(a+="\n"+this.cleanGetTabs())),r=n;i>n&&">"!=e.charAt(n);)n++;s=e.substr(r,n-r),t=n;var c;if("!--"==s.substr(1,3)){if(!s.match(/--$/)){for(;"-->"!=e.substr(n,3);)n++;n+=2,s=e.substr(r,n-r),t=n}"\n"!=a.charAt(a.length-1)&&(a+="\n"),a+=this.cleanGetTabs(),a+=s+">\n"}else"!"==s[1]?a=this.placeTag(s+">",a):"?"==s[1]?a+=s+">\n":(c=s.match(/^<(script|style|pre)/i))?(c[1]=c[1].toLowerCase(),s=this.cleanTag(s),a=this.placeTag(s,a),o=String(e.substr(t+1)).toLowerCase().indexOf("</"+c[1]),o&&(l=e.substr(t+1,o),t+=o,a+=l)):(s=this.cleanTag(s),a=this.placeTag(s,a))}return this.cleanFinish(a)},cleanGetTabs:function(){for(var e="",t=0;t<this.cleanlevel;t++)e+="	";return e},cleanFinish:function(e){return e=e.replace(/\n\s*\n/g,"\n"),e=e.replace(/^[\s\n]*/,""),e=e.replace(/[\s\n]*$/,""),e=e.replace(/<script(.*?)>\n<\/script>/gi,"<script$1></script>"),this.cleanlevel=0,e},cleanTag:function(e){var t="";e=e.replace(/\n/g," "),e=e.replace(/\s{2,}/g," "),e=e.replace(/^\s+|\s+$/g," ");var i="";e.match(/\/$/)&&(i="/",e=e.replace(/\/+$/,""));for(var n;n=/\s*([^= ]+)(?:=((['"']).*?\3|[^ ]+))?/.exec(e);)n[2]?t+=n[1].toLowerCase()+"="+n[2]:n[1]&&(t+=n[1].toLowerCase()),t+=" ",e=e.substr(n[0].length);return t.replace(/\s*$/,"")+i+">"},placeTag:function(e,t){var i=e.match(this.cleannewLevel);return(e.match(this.cleanlineBefore)||i)&&(t=t.replace(/\s*$/,""),t+="\n"),i&&"/"==e.charAt(1)&&this.cleanlevel--,"\n"==t.charAt(t.length-1)&&(t+=this.cleanGetTabs()),i&&"/"!=e.charAt(1)&&this.cleanlevel++,t+=e,(e.match(this.cleanlineAfter)||e.match(this.cleannewLevel))&&(t=t.replace(/ *$/,""),t+="\n"),t},alignmentLeft:function(){this.alignmentSet("","JustifyLeft")},alignmentRight:function(){this.alignmentSet("right","JustifyRight")},alignmentCenter:function(){this.alignmentSet("center","JustifyCenter")},alignmentJustify:function(){this.alignmentSet("justify","JustifyFull")},alignmentSet:function(t,i){if(this.bufferSet(),this.oldIE())return this.document.execCommand(i,!1,!1),!0;this.selectionSave();var n=this.getBlocks();e.each(n,e.proxy(function(i,n){var r=!1;r=-1!==e.inArray(n.tagName,this.opts.alignmentTags)?e(n):e(n).closest(this.opts.alignmentTags.toString().toLowerCase(),this.$editor[0]),r&&(r.css("text-align",t),this.removeEmptyAttr(r,"style"))},this)),this.selectionRestore(),this.sync()},formatEmpty:function(t){var i=e.trim(this.$editor.html());i=i.replace(/<br\s?\/?>/i,"");var n=i.replace(/<p>\s?<\/p>/gi,"");if(""===i||""===n){t.preventDefault();var r=e(this.opts.emptyHtml).get(0);this.$editor.html(r),this.focus()}this.sync()},formatBlocks:function(t){this.bufferSet();var i=this.getBlocks();this.selectionSave(),e.each(i,e.proxy(function(e,i){"LI"!==i.tagName&&this.formatBlock(t,i)},this)),this.selectionRestore(),this.sync()},formatBlock:function(t,i){if(i===!1&&(i=this.getBlock()),i===!1)return this.opts.linebreaks===!0&&this.execCommand("formatblock",t),!0;var n="";if("pre"!==t?n=e(i).contents():(n=e(i).html(),""===e.trim(n)&&(n='<span id="selection-marker-1"></span>')),"PRE"===i.tagName&&(t="p"),this.opts.linebreaks===!0&&"p"===t)e(i).replaceWith(e("<div>").append(n).html()+"<br>");else{var r=e("<"+t+">").append(n);e(i).replaceWith(r)}},formatChangeTag:function(t,i,n){n!==!1&&this.selectionSave();var r=e("<"+i+"/>");return e(t).replaceWith(function(){return r.append(e(this).contents())}),n!==!1&&this.selectionRestore(),r},formatQuote:function(){if(this.bufferSet(),this.opts.linebreaks===!1){this.selectionSave();var t=this.getBlocks();t&&e.each(t,e.proxy(function(e,t){"BLOCKQUOTE"===t.tagName?this.formatBlock("p",t,!1):"LI"!==t.tagName&&this.formatBlock("blockquote",t,!1)},this)),this.selectionRestore()}else{var i=this.getBlock();if("BLOCKQUOTE"===i.tagName)this.selectionSave(),e(i).replaceWith(e(i).html()+"<br>"),this.selectionRestore();else{var n=this.selectionWrap("blockquote"),r=e(n).html(),o=["ul","ol","table","tr","tbody","thead","tfoot","dl"];e.each(o,function(e,t){r=r.replace(new RegExp("<"+t+"(.*?)>","gi"),""),r=r.replace(new RegExp("</"+t+">","gi"),"")});var s=this.opts.blockLevelElements;s.push("td"),e.each(s,function(e,t){r=r.replace(new RegExp("<"+t+"(.*?)>","gi"),""),r=r.replace(new RegExp("</"+t+">","gi"),"<br>")}),e(n).html(r),this.selectionElement(n);var a=e(n).next();"BR"===a[0].tagName&&a.remove()}}this.sync()},blockRemoveAttr:function(t){var i=this.getBlocks();e(i).removeAttr(t),this.sync()},blockSetAttr:function(t,i){var n=this.getBlocks();e(n).attr(t,i),this.sync()},blockRemoveStyle:function(t){var i=this.getBlocks();e(i).css(t,""),this.removeEmptyAttr(i,"style"),this.sync()},blockSetStyle:function(t,i){var n=this.getBlocks();e(n).css(t,i),this.sync()},blockRemoveClass:function(t){var i=this.getBlocks();e(i).removeClass(t),this.removeEmptyAttr(i,"class"),this.sync()},blockSetClass:function(t){var i=this.getBlocks();e(i).addClass(t),this.sync()},inlineRemoveClass:function(t){this.selectionSave(),this.inlineEachNodes(function(i){e(i).removeClass(t),this.removeEmptyAttr(i,"class")}),this.selectionRestore(),this.sync()},inlineSetClass:function(t){var i=this.getCurrent();e(i).hasClass(t)||this.inlineMethods("addClass",t)},inlineRemoveStyle:function(t){this.selectionSave(),this.inlineEachNodes(function(i){e(i).css(t,""),this.removeEmptyAttr(i,"style")}),this.selectionRestore(),this.sync()},inlineSetStyle:function(e,t){this.inlineMethods("css",e,t)},inlineRemoveAttr:function(t){this.selectionSave();var i=this.getRange(),n=this.getElement(),r=this.getNodes();(i.collapsed||i.startContainer===i.endContainer&&n)&&(r=e(n)),e(r).removeAttr(t),this.inlineUnwrapSpan(),this.selectionRestore(),this.sync()},inlineSetAttr:function(e,t){this.inlineMethods("attr",e,t)},inlineMethods:function(t,i,n){this.selectionSave();var r=this.getRange(),o=this.getElement();if(r.collapsed||r.startContainer===r.endContainer&&o)e(o)[t](i,n);else{this.document.execCommand("fontSize",!1,4);var s=this.$editor.find("font");e.each(s,e.proxy(function(e,r){this.inlineSetMethods(t,r,i,n)},this))}this.selectionRestore(),this.sync()},inlineSetMethods:function(t,i,n,r){var o,s=e(i).parent();return s&&"SPAN"===s[0].tagName?(o=s,e(i).replaceWith(e(i).html())):(o=e('<span data-redactor="verified" data-redactor-inlineMethods>').append(e(i).contents()),e(i).replaceWith(o)),e(o)[t](n,r),o},inlineEachNodes:function(t){var i,n=this.getRange(),r=this.getElement(),o=this.getNodes();(n.collapsed||n.startContainer===n.endContainer&&r)&&(o=e(r),i=!0),e.each(o,e.proxy(function(n,r){if(!i&&"SPAN"!==r.tagName){if("SPAN"!==r.parentNode.tagName||e(r.parentNode).hasClass("redactor_editor"))return;r=r.parentNode}t.call(this,r)},this))},inlineUnwrapSpan:function(){var t=this.$editor.find("span[data-redactor-inlineMethods]");e.each(t,e.proxy(function(t,i){var n=e(i);void 0===n.attr("class")&&void 0===n.attr("style")&&n.contents().unwrap()},this))},inlineFormat:function(t){this.selectionSave(),this.document.execCommand("fontSize",!1,4);var i,n=this.$editor.find("font");e.each(n,function(n,r){var o=e("<"+t+"/>").append(e(r).contents());e(r).replaceWith(o),i=o}),this.selectionRestore(),this.sync()},inlineRemoveFormat:function(t){this.selectionSave();var i=t.toUpperCase(),n=this.getNodes();e.each(n,function(t,n){n.tagName===i&&e(n).replaceWith(e(n).contents())}),this.selectionRestore(),this.sync()},insertHtml:function(t,i){var n=this.getCurrent(),r=n.parentNode;this.$editor.focus(),this.bufferSet();var o=e("<div>").append(e.parseHTML(t));t=o.html(),t=this.cleanRemoveEmptyTags(t),o=e("<div>").append(e.parseHTML(t));var s=this.getBlock(),a=o.contents()[0].tagName;(1==o.contents().length&&"P"!=a&&a==s.tagName||"PRE"==a)&&(t=o.text(),o=e("<div>").append(t)),!this.opts.linebreaks&&1==o.contents().length&&3==o.contents()[0].nodeType&&(this.getRangeSelectedNodes().length>2||!n||"BODY"==n.tagName&&!r||"HTML"==r.tagName)&&(t="<p>"+t+"</p>"),"BLOCKQUOTE"==s.tagName&&-1===t.indexOf("<a")?this.insertText(t):o.contents().length>1&&s||o.contents().is("p, :header, ul, ol, div, table, blockquote, pre, address, section, header, footer, aside, article")?this.browser("msie")?this.document.selection.createRange().pasteHTML(t):this.document.execCommand("inserthtml",!1,t):this.insertHtmlAdvanced(t),this.selectall&&this.window.setTimeout(e.proxy(function(){this.opts.linebreaks?this.focusEnd():this.selectionEnd(this.$editor.contents().last())},this),1),this.observeStart(),i!==!1&&this.sync()},insertHtmlAdvanced:function(e){var t=this.getSelection();if(t.getRangeAt&&t.rangeCount){var i=t.getRangeAt(0);i.deleteContents();var n=this.document.createElement("div");n.innerHTML=e;for(var r,o,s=this.document.createDocumentFragment();r=n.firstChild;)o=s.appendChild(r);i.insertNode(s),o&&(i=i.cloneRange(),i.setStartAfter(o),i.collapse(!0),t.removeAllRanges(),t.addRange(i))}},insertText:function(t){var i=e(e.parseHTML(t));i.length&&(t=i.text()),this.$editor.focus(),this.browser("msie")?this.document.selection.createRange().pasteHTML(t):this.document.execCommand("inserthtml",!1,t),this.sync()},insertNode:function(e){var t=this.getSelection();t.getRangeAt&&t.rangeCount&&(range=t.getRangeAt(0),range.deleteContents(),range.insertNode(e),range.setEndAfter(e),range.setStartAfter(e),t.removeAllRanges(),t.addRange(range))},insertAfterLastElement:function(t){if(this.isEndOfElement()&&this.opts.linebreaks===!1){if(this.$editor.contents().last()[0]!==t)return!1;this.bufferSet();var i=e(this.opts.emptyHtml);e(t).after(i),this.selectionStart(i)}},insertLineBreak:function(){this.selectionSave(),this.$editor.find("#selection-marker-1").before("<br>"+(this.browser("webkit")?this.opts.invisibleSpace:"")),this.selectionRestore()},insertDoubleLineBreak:function(){this.selectionSave(),this.$editor.find("#selection-marker-1").before("<br><br>"+(this.browser("webkit")?this.opts.invisibleSpace:"")),this.selectionRestore()},replaceLineBreak:function(t){var i=e("<br>"+this.opts.invisibleSpace);e(t).replaceWith(i),this.selectionStart(i)},pasteInit:function(){return this.isMobile()?!1:(this.$editor.on("paste.redactor",e.proxy(function(){if(!this.opts.cleanup)return!0;this.selectionSave(),this.selectall||(this.opts.autoresize===!0?(this.$editor.height(this.$editor.height()),this.saveScroll=this.document.body.scrollTop):this.saveScroll=this.$editor.scrollTop());var t=this.extractContent();setTimeout(e.proxy(function(){var e=this.extractContent();this.$editor.append(t),this.selectionRestore();var i=this.getFragmentHtml(e);this.pasteClean(i),this.opts.autoresize===!0&&this.$editor.css("height","auto")},this),1)},this)),void 0)},pasteClean:function(e){if(this.currentOrParentIs("PRE"))return e=this.pastePre(e),this.pasteInsert(e),!0;if(e=e.replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,""),e=e.replace(/(&nbsp;){2,}/gi,"&nbsp;"),e=e.replace(/&nbsp;/gi," "),e=e.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2"),e=this.cleanStripTags(e),e=e.replace(/<td><\/td>/gi,"[td]"),e=e.replace(/<td>&nbsp;<\/td>/gi,"[td]"),e=e.replace(/<td><br><\/td>/gi,"[td]"),e=e.replace(/<a(.*?)href="(.*?)"(.*?)>([\w\W]*?)<\/a>/gi,'[a href="$2"]$4[/a]'),e=e.replace(/<iframe(.*?)>([\w\W]*?)<\/iframe>/gi,"[iframe$1]$2[/iframe]"),e=e.replace(/<video(.*?)>([\w\W]*?)<\/video>/gi,"[video$1]$2[/video]"),e=e.replace(/<audio(.*?)>([\w\W]*?)<\/audio>/gi,"[audio$1]$2[/audio]"),e=e.replace(/<embed(.*?)>([\w\W]*?)<\/embed>/gi,"[embed$1]$2[/embed]"),e=e.replace(/<object(.*?)>([\w\W]*?)<\/object>/gi,"[object$1]$2[/object]"),e=e.replace(/<param(.*?)>/gi,"[param$1]"),e=e.replace(/<img(.*?)style="(.*?)"(.*?)>/gi,"[img$1$3]"),e=e.replace(/<(\w+)([\w\W]*?)>/gi,"<$1>"),e=e.replace(/<[^\/>][^>]*>(\s*|\t*|\n*|&nbsp;|<br>)<\/[^>]+>/gi,""),e=e.replace(/<div>\s*?\t*?\n*?(<ul>|<ol>|<p>)/gi,"$1"),e=e.replace(/\[td\]/gi,"<td>&nbsp;</td>"),e=e.replace(/\[a href="(.*?)"\]([\w\W]*?)\[\/a\]/gi,'<a href="$1">$2</a>'),e=e.replace(/\[iframe(.*?)\]([\w\W]*?)\[\/iframe\]/gi,"<iframe$1>$2</iframe>"),e=e.replace(/\[video(.*?)\]([\w\W]*?)\[\/video\]/gi,"<video$1>$2</video>"),e=e.replace(/\[audio(.*?)\]([\w\W]*?)\[\/audio\]/gi,"<audio$1>$2</audio>"),e=e.replace(/\[embed(.*?)\]([\w\W]*?)\[\/embed\]/gi,"<embed$1>$2</embed>"),e=e.replace(/\[object(.*?)\]([\w\W]*?)\[\/object\]/gi,"<object$1>$2</object>"),e=e.replace(/\[param(.*?)\]/gi,"<param$1>"),e=e.replace(/\[img(.*?)\]/gi,"<img$1>"),this.opts.convertDivs&&(e=e.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p>$2</p>"),e=e.replace(/<\/div><p>/gi,"<p>"),e=e.replace(/<\/p><\/div>/gi,"</p>")),e=this.cleanParagraphy(e),e=e.replace(/<span(.*?)>([\w\W]*?)<\/span>/gi,"$2"),e=e.replace(/<img>/gi,""),e=e.replace(/<[^\/>][^>][^img|param|source]*>(\s*|\t*|\n*|&nbsp;|<br>)<\/[^>]+>/gi,""),e=e.replace(/\n{3,}/gi,"\n"),e=e.replace(/<p><p>/gi,"<p>"),e=e.replace(/<\/p><\/p>/gi,"</p>"),this.opts.linebreaks===!0&&(e=e.replace(/<p(.*?)>([\w\W]*?)<\/p>/gi,"$2<br>")),e=e.replace(/<[^\/>][^>][^img|param|source]*>(\s*|\t*|\n*|&nbsp;|<br>)<\/[^>]+>/gi,""),this.browser("mozilla"))for(;/<br>$/gi.test(e);)e=e.replace(/<br>$/gi,"");for(;/<font>([\w\W]*?)<\/font>/gi.test(e);)e=e.replace(/<font>([\w\W]*?)<\/font>/gi,"$1");this.pasteInsert(e)},pastePre:function(e){e=e.replace(/<br>|<\/H[1-6]>|<\/p>|<\/div>/gi,"\n");var t=this.document.createElement("div");return t.innerHTML=e,this.cleanEncodeEntities(t.textContent||t.innerText)},pasteInsert:function(t){this.selectall&&(this.opts.linebreaks?this.$editor.html(""):this.$editor.html(this.opts.emptyHtml),this.$editor.focus()),this.insertHtml(t),this.selectall=!1,this.opts.autoresize?e(this.document.body).scrollTop(this.saveScroll):this.$editor.scrollTop(this.saveScroll)},bufferSet:function(e){void 0!==e?this.opts.buffer.push(e):(this.selectionSave(),this.opts.buffer.push(this.$editor.html()),this.selectionRemoveMarkers(!0))},bufferUndo:function(){return 0===this.opts.buffer.length?(this.$editor.focus(),void 0):(this.selectionSave(),this.opts.rebuffer.push(this.$editor.html()),this.selectionRestore(!1,!0),this.$editor.html(this.opts.buffer.pop()),this.selectionRestore(),setTimeout(e.proxy(this.observeStart,this),100),void 0)},bufferRedo:function(){return 0===this.opts.rebuffer.length?(this.$editor.focus(),!1):(this.selectionSave(),this.opts.buffer.push(this.$editor.html()),this.selectionRestore(!1,!0),this.$editor.html(this.opts.rebuffer.pop()),this.selectionRestore(!0),setTimeout(e.proxy(this.observeStart,this),4),void 0)},observeStart:function(){this.observeImages(),this.observeTables()},observeTables:function(){this.$editor.find("table").on("click",e.proxy(this.tableObserver,this))},observeImages:function(){return this.opts.observeImages===!1?!1:(this.$editor.find("img").each(e.proxy(function(t,i){this.browser("msie")&&e(i).attr("unselectable","on"),this.imageResize(i)},this)),void 0)},getSelection:function(){return this.opts.rangy?this.opts.iframe?rangy.getSelection(this.$frame[0]):rangy.getSelection():this.document.getSelection()},getRange:function(){if(this.opts.rangy)return this.opts.iframe?rangy.createRange(this.iframeDoc()):rangy.createRange();if(this.document.getSelection){var e=this.document.getSelection();if(e.getRangeAt&&e.rangeCount)return e.getRangeAt(0)}return this.document.createRange()},selectionElement:function(e){this.setCaret(e)},selectionStart:function(e){this.selectionSet(e[0]||e,0,null,0)},selectionEnd:function(e){this.selectionSet(e[0]||e,1,null,1)},selectionSet:function(e,t,i,n){null==i&&(i=e),null==n&&(n=t);var r=this.getSelection();if(r){var o=this.getRange();o.setStart(e,t),o.setEnd(i,n);try{r.removeAllRanges()}catch(s){}r.addRange(o)}},selectionWrap:function(e){e=e.toLowerCase();var t=this.getBlock();if(t){var i=this.formatChangeTag(t,e);return this.sync(),i}var n=this.getSelection(),r=n.getRangeAt(0),i=document.createElement(e);return i.appendChild(r.extractContents()),r.insertNode(i),this.selectionElement(i),i},selectionAll:function(){var e=this.getRange();e.selectNodeContents(this.$editor[0]);var t=this.getSelection();t.removeAllRanges(),t.addRange(e)},selectionRemove:function(){this.getSelection().removeAllRanges()},getCaretOffset:function(t){var i=0,n=this.getSelection().getRangeAt(0),r=n.cloneRange();return r.selectNodeContents(t),r.setEnd(n.endContainer,n.endOffset),i=e.trim(r.toString()).length},getCaretOffsetRange:function(){return new n(this.getSelection().getRangeAt(0))},setCaret:function(e,t,i){"undefined"==typeof i&&(i=t),e=e[0]||e;var n=this.getRange();n.selectNodeContents(e);var r,o=this.getTextNodesIn(e),s=!1,a=0;if(1==o.length&&t)n.setStart(o[0],t),n.setEnd(o[0],i);else for(var l,c=0;l=o[c++];){if(r=a+l.length,!s&&t>=a&&(r>t||t==r&&c<o.length)&&(n.setStart(l,t-a),s=!0),s&&r>=i){n.setEnd(l,i-a);break}a=r}var d=this.getSelection();d.removeAllRanges(),d.addRange(n)},getTextNodesIn:function(e){var t=[];if(3==e.nodeType)t.push(e);else for(var i=e.childNodes,n=0,r=i.length;r>n;++n)t.push.apply(t,this.getTextNodesIn(i[n]));return t},selectionSave:function(){this.isFocused()||this.$editor.focus(),this.opts.rangy?this.savedSel=rangy.saveSelection():this.selectionCreateMarker(this.getRange())},selectionCreateMarker:function(t){if(t){var i=e('<span id="selection-marker-1">'+this.opts.invisibleSpace+"</span>",this.document)[0],n=e('<span id="selection-marker-2">'+this.opts.invisibleSpace+"</span>",this.document)[0];t.collapsed===!0?this.selectionSetMarker(t,i,!0):(this.selectionSetMarker(t,i,!0),this.selectionSetMarker(t,n,!1)),this.savedSel=this.$editor.html(),this.selectionRestore(!1,!1)}},selectionSetMarker:function(e,t,i){var n=e.cloneRange();n.collapse(i),n.insertNode(t),n.detach()},selectionRestore:function(e,t){if(this.opts.rangy)rangy.restoreSelection(this.savedSel);else{e===!0&&this.savedSel&&this.$editor.html(this.savedSel);var i=this.$editor.find("span#selection-marker-1"),n=this.$editor.find("span#selection-marker-2");this.isFocused()||this.$editor.focus(),0!=i.length&&0!=n.length?this.selectionSet(i[0],0,n[0],0):0!=i.length&&this.selectionSet(i[0],0,null,0),t!==!1&&(this.selectionRemoveMarkers(),this.savedSel=!1)}},selectionRemoveMarkers:function(){this.opts.rangy?rangy.removeMarkers(this.savedSel):(this.$editor.find("span#selection-marker-1").remove(),this.$editor.find("span#selection-marker-2").remove())},getCurrent:function(){var e=!1,t=this.getSelection();return t.rangeCount>0&&(e=t.getRangeAt(0).startContainer),this.isParentRedactor(e)},getParent:function(t){return t=t||this.getCurrent(),t?this.isParentRedactor(e(t).parent()[0]):!1},getBlock:function(t){for("undefined"==typeof t&&(t=this.getCurrent());t;){if(this.nodeTestBlocks(t))return e(t).hasClass("redactor_editor")?!1:t;t=t.parentNode}return!1},getBlocks:function(t){var i=[];if("undefined"==typeof t){var n=this.getRange();if(n&&n.collapsed===!0)return[this.getBlock()];var t=this.getNodes(n)}return e.each(t,e.proxy(function(t,n){return this.opts.iframe===!1&&0==e(n).parents("div.redactor_editor").size()?!1:(this.nodeTestBlocks(n)&&i.push(n),void 0)},this)),0===i.length&&(i=[this.getBlock()]),i},nodeTestBlocks:function(e){return 1==e.nodeType&&this.rTestBlock.test(e.nodeName)},tagTestBlock:function(e){return this.rTestBlock.test(e)},getSelectedNodes:function(e){if("undefined"==typeof e||0==e)var e=this.getRange();if(e&&e.collapsed===!0)return[this.getCurrent()];var t=this.getSelection();try{var i=t.getRangeAt(0).cloneContents()}catch(n){return!1}var r=this.document.createElement("span");r.appendChild(i),window.selnodes=r.childNodes;for(var o=selnodes.length,s=[],a=0,l=o;l>a;a++)s.push(selnodes[a]);return 0==s.length&&s.push(this.getCurrent()),s},getNodes:function(t,i){if(this.opts.linebreaks)return this.getSelectedNodes(t);if("undefined"==typeof t||0==t)var t=this.getRange();if(t&&t.collapsed===!0){if("undefined"==typeof i&&this.tagTestBlock(i)){var n=this.getBlock();return n.tagName==i?[n]:[]}return[this.getCurrent()]}var r=[],o=[],s=this.document.getSelection();if(s.isCollapsed||(r=this.getRangeSelectedNodes(s.getRangeAt(0))),e.each(r,e.proxy(function(t,n){return this.opts.iframe===!1&&0==e(n).parents("div.redactor_editor").size()?!1:("undefined"==typeof i?""!=e.trim(n.textContent)&&o.push(n):n.tagName==i&&o.push(n),void 0)},this)),0==o.length){if("undefined"==typeof i&&this.tagTestBlock(i)){var n=this.getBlock();return n.tagName==i?o.push(n):[]}o.push(this.getCurrent())}return o},getElement:function(t){for(t||(t=this.getCurrent());t;){if(1==t.nodeType)return e(t).hasClass("redactor_editor")?!1:t;t=t.parentNode}return!1},getRangeSelectedNodes:function(e){e=e||this.getRange();var t=e.startContainer,i=e.endContainer;if(t==i)return[t];for(var n=[];t&&t!=i;)n.push(t=this.nextNode(t));for(t=e.startContainer;t&&t!=e.commonAncestorContainer;)n.unshift(t),t=t.parentNode;return n},nextNode:function(e){if(e.hasChildNodes())return e.firstChild;for(;e&&!e.nextSibling;)e=e.parentNode;return e?e.nextSibling:null},getSelectionText:function(){return this.getSelection().toString()},getSelectionHtml:function(){var e="",t=this.getSelection();if(t.rangeCount){for(var i=this.document.createElement("div"),n=t.rangeCount,r=0;n>r;++r)i.appendChild(t.getRangeAt(r).cloneContents());e=i.innerHTML}return this.syncClean(e)},tableShow:function(){this.selectionSave(),this.modalInit(this.opts.curLang.table,this.opts.modal_table,300,e.proxy(function(){e("#redactor_insert_table_btn").click(e.proxy(this.tableInsert,this)),setTimeout(function(){e("#redactor_table_rows").focus()},200)},this))},tableInsert:function(){var t,i,n,r,o=e("#redactor_table_rows").val(),s=e("#redactor_table_columns").val(),a=e("<div></div>"),l=Math.floor(99999*Math.random()),c=e('<table id="table'+l+'"><tbody></tbody></table>');
for(t=0;o>t;t++){for(i=e("<tr></tr>"),n=0;s>n;n++)r=e("<td>"+this.opts.invisibleSpace+"</td>"),0===t&&0===n&&r.append('<span id="selection-marker-1">'+this.opts.invisibleSpace+"</span>"),e(i).append(r);c.append(i)}a.append(c);var d=a.html();this.modalClose(),this.selectionRestore();var h=this.getBlock()||this.getCurrent();h?e(h).after(d):this.insertHtmlAdvanced(d),this.selectionRestore();var u=this.$editor.find("#table"+l);this.tableObserver(u),this.buttonActiveObserver(),u.removeAttr("id"),this.sync()},tableObserver:function(t){this.$table=e(t.target||t).closest("table"),this.$tbody=e(t.target).closest("tbody"),this.$thead=this.$table.find("thead"),this.$current_td=e(t.target||this.$table.find("td").first()),this.$current_tr=e(t.target||this.$table.find("tr").first()).closest("tr")},tableDeleteTable:function(){this.bufferSet(),this.$table.remove(),this.$table=!1,this.sync()},tableDeleteRow:function(){this.bufferSet();var e=this.$current_tr.prev().length?this.$current_tr.prev():this.$current_tr.next();if(e.length){var t=e.children("td").first();t.length&&(t.prepend('<span id="selection-marker-1">'+this.opts.invisibleSpace+"</span>"),this.selectionRestore())}this.$current_tr.remove(),this.sync()},tableDeleteColumn:function(){this.bufferSet();var t=this.$current_td.get(0).cellIndex;this.$table.find("tr").each(e.proxy(function(i,n){var r=0>t-1?t+1:t-1;0===i&&(e(n).find("td").eq(r).prepend('<span id="selection-marker-1">'+this.opts.invisibleSpace+"</span>"),this.selectionRestore()),e(n).find("td").eq(t).remove()},this)),this.sync()},tableAddHead:function(){if(this.bufferSet(),0!==this.$table.find("thead").size())this.tableDeleteHead();else{var t=this.$table.find("tr").first().clone();t.find("td").html(this.opts.invisibleSpace),this.$thead=e("<thead></thead>"),this.$thead.append(t),this.$table.prepend(this.$thead),this.sync()}},tableDeleteHead:function(){this.bufferSet(),e(this.$thead).remove(),this.$thead=!1,this.sync()},tableAddRowAbove:function(){this.tableAddRow("before")},tableAddRowBelow:function(){this.tableAddRow("after")},tableAddColumnLeft:function(){this.tableAddColumn("before")},tableAddColumnRight:function(){this.tableAddColumn("after")},tableAddRow:function(e){this.bufferSet();var t=this.$current_tr.clone();t.find("td").html(this.opts.invisibleSpace),"after"===e?this.$current_tr.after(t):this.$current_tr.before(t),this.sync()},tableAddColumn:function(t){this.bufferSet();var i=0;this.$current_tr.find("td").each(e.proxy(function(t,n){e(n)[0]===this.$current_td[0]&&(i=t)},this)),this.$table.find("tr").each(e.proxy(function(n,r){var o=e(r).find("td").eq(i),s=o.clone();s.html(this.opts.invisibleSpace),"after"===t?o.after(s):o.before(s)},this)),this.sync()},videoShow:function(){this.selectionSave(),this.modalInit(this.opts.curLang.video,this.opts.modal_video,600,e.proxy(function(){e("#redactor_insert_video_btn").click(e.proxy(this.videoInsert,this)),setTimeout(function(){e("#redactor_insert_video_area").focus()},200)},this))},videoInsert:function(){var t=e("#redactor_insert_video_area").val();t=this.cleanStripTags(t),this.selectionRestore();var i=this.getBlock()||this.getCurrent();i?(e(i).after(t),this.sync()):this.insertHtmlAdvanced(t),this.modalClose()},linkShow:function(){this.selectionSave();var t=e.proxy(function(){this.insert_link_node=!1;var t=this.getSelection(),i="",n="",r="";t.anchorNode.parentNode;var o=this.getParent();o&&"A"===o.tagName?(i=o.href,n=e(o).text(),r=o.target,""===t.toString()&&(this.insert_link_node=o)):n=t.toString(),e(".redactor_link_text").val(n);var s=self.location.href.replace(/\/$/i,""),a=i.replace(s,""),l=e("#redactor_tabs").find("a");this.opts.linkEmail===!1&&l.eq(1).remove(),this.opts.linkAnchor===!1&&l.eq(2).remove(),this.opts.linkEmail===!1&&this.opts.linkAnchor===!1?(e("#redactor_tabs").remove(),e("#redactor_link_url").val(a)):0===i.search("mailto:")?(this.modalSetTab.call(this,2),e("#redactor_tab_selected").val(2),e("#redactor_link_mailto").val(i.replace("mailto:",""))):0===a.search(/^#/gi)?(this.modalSetTab.call(this,3),e("#redactor_tab_selected").val(3),e("#redactor_link_anchor").val(a.replace(/^#/gi,""))):e("#redactor_link_url").val(a),"_blank"===r&&e("#redactor_link_blank").prop("checked",!0),e("#redactor_insert_link_btn").click(e.proxy(this.linkProcess,this)),setTimeout(function(){e("#redactor_link_url").focus()},200)},this);this.modalInit(this.opts.curLang.link,this.opts.modal_link,460,t)},linkProcess:function(){var t=e("#redactor_tab_selected").val(),i="",n="",r="",o="";if("1"===t){i=e("#redactor_link_url").val(),n=e("#redactor_link_url_text").val(),e("#redactor_link_blank").prop("checked")&&(r=' target="_blank"',o="_blank");var s="((xn--)?[a-z0-9]+(-[a-z0-9]+)*.)+[a-z]{2,}",a=new RegExp("^(http|ftp|https)://"+s,"i"),l=new RegExp("^"+s,"i");-1==i.search(a)&&0==i.search(l)&&this.opts.linkProtocol&&(i=this.opts.linkProtocol+i)}else"2"===t?(i="mailto:"+e("#redactor_link_mailto").val(),n=e("#redactor_link_mailto_text").val()):"3"===t&&(i="#"+e("#redactor_link_anchor").val(),n=e("#redactor_link_anchor_text").val());this.linkInsert('<a href="'+i+'"'+r+">"+n+"</a>",e.trim(n),i,o)},linkInsert:function(t,i,n,r){this.selectionRestore(),""!==i&&(this.insert_link_node?(this.bufferSet(),e(this.insert_link_node).text(i).attr("href",n),""!==r?e(this.insert_link_node).attr("target",r):e(this.insert_link_node).removeAttr("target"),this.sync()):this.exec("inserthtml",t)),this.modalClose()},fileShow:function(){this.selectionSave();var t=e.proxy(function(){var t=this.getSelection(),i="";i=this.oldIE()?t.text:t.toString(),e("#redactor_filename").val(i),this.isMobile()||this.draguploadInit("#redactor_file",{url:this.opts.fileUpload,uploadFields:this.opts.uploadFields,success:e.proxy(this.fileCallback,this),error:e.proxy(function(e,t){this.callback("fileUploadError",t)},this)}),this.uploadInit("redactor_file",{auto:!0,url:this.opts.fileUpload,success:e.proxy(this.fileCallback,this),error:e.proxy(function(e,t){this.callback("fileUploadError",t)},this)})},this);this.modalInit(this.opts.curLang.file,this.opts.modal_file,500,t)},fileCallback:function(t){if(this.selectionRestore(),t!==!1){var i=e("#redactor_filename").val();""===i&&(i=t.filename);var n='<a href="'+t.filelink+'" id="filelink-marker">'+i+"</a>";this.browser("webkit")&&this.window.chrome&&(n+="&nbsp;"),this.execCommand("inserthtml",n,!1);var r=e(this.$editor.find("a#filelink-marker"));0!=r.size()?r.removeAttr("id"):r=!1,this.sync(),this.callback("fileUpload",r,t)}this.modalClose()},imageShow:function(){this.selectionSave();var t=e.proxy(function(){if(this.opts.imageGetJson?e.getJSON(this.opts.imageGetJson,e.proxy(function(t){var i={},n=0;e.each(t,e.proxy(function(e,t){"undefined"!=typeof t.folder&&(n++,i[t.folder]=n)},this));var r=!1;if(e.each(t,e.proxy(function(t,n){var o="";"undefined"!=typeof n.title&&(o=n.title);var s=0;e.isEmptyObject(i)||"undefined"==typeof n.folder||(s=i[n.folder],r===!1&&(r=".redactorfolder"+s));var a=e('<img src="'+n.thumb+'" class="redactorfolder redactorfolder'+s+'" rel="'+n.image+'" title="'+o+'" />');e("#redactor_image_box").append(a),e(a).click(e.proxy(this.imageThumbClick,this))},this)),!e.isEmptyObject(i)){e(".redactorfolder").hide(),e(r).show();var o=function(t){e(".redactorfolder").hide(),e(".redactorfolder"+e(t.target).val()).show()},s=e('<select id="redactor_image_box_select">');e.each(i,function(t,i){s.append(e('<option value="'+i+'">'+t+"</option>"))}),e("#redactor_image_box").before(s),s.change(o)}},this)):e("#redactor_tabs").find("a").eq(1).remove(),this.opts.imageUpload||this.opts.s3)this.isMobile()||this.opts.s3!==!1||e("#redactor_file").length&&this.draguploadInit("#redactor_file",{url:this.opts.imageUpload,uploadFields:this.opts.uploadFields,success:e.proxy(this.imageCallback,this),error:e.proxy(function(e,t){this.callback("imageUploadError",t)},this)}),this.opts.s3===!1?this.uploadInit("redactor_file",{auto:!0,url:this.opts.imageUpload,success:e.proxy(this.imageCallback,this),error:e.proxy(function(e,t){this.callback("imageUploadError",t)},this)}):e("#redactor_file").on("change.redactor",e.proxy(this.s3handleFileSelect,this));else if(e(".redactor_tab").hide(),this.opts.imageGetJson){var t=e("#redactor_tabs").find("a");t.eq(0).remove(),t.eq(1).addClass("redactor_tabs_act"),e("#redactor_tab2").show()}else e("#redactor_tabs").remove(),e("#redactor_tab3").show();e("#redactor_upload_btn").click(e.proxy(this.imageCallbackLink,this)),this.opts.imageUpload||this.opts.imageGetJson||setTimeout(function(){e("#redactor_file_link").focus()},200)},this);this.modalInit(this.opts.curLang.image,this.opts.modal_image,610,t)},imageEdit:function(t){var i=e(t.target),n=i.parent(),r=e.proxy(function(){e("#redactor_file_alt").val(i.attr("alt")),e("#redactor_image_edit_src").attr("href",i.attr("src")),e("#redactor_form_image_align").val(i.css("float")),"A"===e(n).get(0).tagName&&e("#redactor_file_link").val(e(n).attr("href")),e("#redactor_image_delete_btn").click(e.proxy(function(){this.imageRemove(i)},this)),e("#redactorSaveBtn").click(e.proxy(function(){this.imageSave(i)},this))},this);this.modalInit(this.opts.curLang.image,this.opts.modal_image_edit,380,r)},imageRemove:function(t){var i=e(t).parent();e(t).remove(),i.length&&"P"===i[0].tagName&&(this.$editor.focus(),this.selectionStart(i)),this.callback("imageDelete",t),this.modalClose(),this.sync()},imageSave:function(t){var i=e(t).parent();e(t).attr("alt",e("#redactor_file_alt").val());var n=e("#redactor_form_image_align").val();"left"===n?e(t).css({"float":"left",margin:"0 10px 10px 0"}):"right"===n?e(t).css({"float":"right",margin:"0 0 10px 10px"}):e(t).css({"float":"none",margin:"0"});var r=e.trim(e("#redactor_file_link").val());""!==r?"A"!==e(i).get(0).tagName?e(t).replaceWith('<a href="'+r+'">'+this.outerHtml(t)+"</a>"):e(i).attr("href",r):"A"===e(i).get(0).tagName&&e(i).replaceWith(this.outerHtml(t)),this.modalClose(),this.observeImages(),this.sync()},imageResize:function(t){var i,n,r=e(t),o=!1,s=!1,a=r.width()/r.height(),l=10;r.off("hover mousedown mouseup click mousemove"),r.hover(function(){r.css("cursor","nw-resize")},function(){r.css("cursor",""),o=!1}),r.mousedown(function(e){e.preventDefault(),a=r.width()/r.height(),o=!0,s=!0,i=Math.round(e.pageX-r.eq(0).offset().left),n=Math.round(e.pageY-r.eq(0).offset().top)}),r.mouseup(e.proxy(function(){o=!1,r.css("cursor",""),this.sync()},this)),r.click(e.proxy(function(e){s&&this.imageEdit(e)},this)),r.mousemove(function(t){if(o){s=!1,Math.round(t.pageX-e(this).eq(0).offset().left)-i;var c=Math.round(t.pageY-e(this).eq(0).offset().top)-n,d=r.height(),h=parseInt(d,10)+c,u=Math.round(h*a);u>l&&r.width(u),i=Math.round(t.pageX-e(this).eq(0).offset().left),n=Math.round(t.pageY-e(this).eq(0).offset().top)}})},imageThumbClick:function(t){var i='<img id="image-marker" src="'+e(t.target).attr("rel")+'" alt="'+e(t.target).attr("title")+'" />';this.opts.paragraphy&&(i="<p>"+i+"</p>"),this.imageInsert(i,!0)},imageCallbackLink:function(){var t=e("#redactor_file_link").val();if(""!==t){var i='<img id="image-marker" src="'+t+'" />';this.opts.linebreaks===!1&&(i="<p>"+i+"</p>"),this.imageInsert(i,!0)}else this.modalClose()},imageCallback:function(e){this.imageInsert(e)},imageInsert:function(t,i){if(this.selectionRestore(),t!==!1){var n="";i!==!0?(n='<img id="image-marker" src="'+t.filelink+'" />',this.opts.paragraphy&&(n="<p>"+n+"</p>")):n=t,this.execCommand("inserthtml",n,!1);var r=e(this.$editor.find("img#image-marker"));r.length?r.removeAttr("id"):r=!1,this.sync(),i!==!0&&this.callback("imageUpload",r,t)}this.modalClose(),this.observeImages()},modalTemplatesInit:function(){e.extend(this.opts,{modal_file:String()+"<section>"+'<div id="redactor-progress" class="redactor-progress redactor-progress-striped" style="display: none;">'+'<div id="redactor-progress-bar" class="redactor-progress-bar" style="width: 100%;"></div>'+"</div>"+'<form id="redactorUploadFileForm" method="post" action="" enctype="multipart/form-data">'+"<label>"+this.opts.curLang.filename+"</label>"+'<input type="text" id="redactor_filename" class="redactor_input" />'+'<div style="margin-top: 7px;">'+'<input type="file" id="redactor_file" name="file" />'+"</div>"+"</form>"+"</section>",modal_image_edit:String()+"<section>"+"<label>"+this.opts.curLang.title+"</label>"+'<input id="redactor_file_alt" class="redactor_input" />'+"<label>"+this.opts.curLang.link+"</label>"+'<input id="redactor_file_link" class="redactor_input" />'+"<label>"+this.opts.curLang.image_position+"</label>"+'<select id="redactor_form_image_align">'+'<option value="none">'+this.opts.curLang.none+"</option>"+'<option value="left">'+this.opts.curLang.left+"</option>"+'<option value="right">'+this.opts.curLang.right+"</option>"+"</select>"+"</section>"+"<footer>"+'<a href="#" id="redactor_image_delete_btn" class="redactor_modal_btn">'+this.opts.curLang._delete+"</a>&nbsp;&nbsp;&nbsp;"+'<a href="#" class="redactor_modal_btn redactor_btn_modal_close">'+this.opts.curLang.cancel+"</a>"+'<input type="button" name="save" class="redactor_modal_btn" id="redactorSaveBtn" value="'+this.opts.curLang.save+'" />'+"</footer>",modal_image:String()+"<section>"+'<div id="redactor_tabs">'+'<a href="#" class="redactor_tabs_act">'+this.opts.curLang.upload+"</a>"+'<a href="#">'+this.opts.curLang.choose+"</a>"+'<a href="#">'+this.opts.curLang.link+"</a>"+"</div>"+'<div id="redactor-progress" class="redactor-progress redactor-progress-striped" style="display: none;">'+'<div id="redactor-progress-bar" class="redactor-progress-bar" style="width: 100%;"></div>'+"</div>"+'<form id="redactorInsertImageForm" method="post" action="" enctype="multipart/form-data">'+'<div id="redactor_tab1" class="redactor_tab">'+'<input type="file" id="redactor_file" name="file" />'+"</div>"+'<div id="redactor_tab2" class="redactor_tab" style="display: none;">'+'<div id="redactor_image_box"></div>'+"</div>"+"</form>"+'<div id="redactor_tab3" class="redactor_tab" style="display: none;">'+"<label>"+this.opts.curLang.image_web_link+"</label>"+'<input type="text" name="redactor_file_link" id="redactor_file_link" class="redactor_input"  />'+"</div>"+"</section>"+"<footer>"+'<a href="#" class="redactor_modal_btn redactor_btn_modal_close">'+this.opts.curLang.cancel+"</a>"+'<input type="button" name="upload" class="redactor_modal_btn" id="redactor_upload_btn" value="'+this.opts.curLang.insert+'" />'+"</footer>",modal_link:String()+"<section>"+'<form id="redactorInsertLinkForm" method="post" action="">'+'<div id="redactor_tabs">'+'<a href="#" class="redactor_tabs_act">URL</a>'+'<a href="#">Email</a>'+'<a href="#">'+this.opts.curLang.anchor+"</a>"+"</div>"+'<input type="hidden" id="redactor_tab_selected" value="1" />'+'<div class="redactor_tab" id="redactor_tab1">'+"<label>URL</label>"+'<input type="text" id="redactor_link_url" class="redactor_input"  />'+"<label>"+this.opts.curLang.text+"</label>"+'<input type="text" class="redactor_input redactor_link_text" id="redactor_link_url_text" />'+'<label><input type="checkbox" id="redactor_link_blank"> '+this.opts.curLang.link_new_tab+"</label>"+"</div>"+'<div class="redactor_tab" id="redactor_tab2" style="display: none;">'+"<label>Email</label>"+'<input type="text" id="redactor_link_mailto" class="redactor_input" />'+"<label>"+this.opts.curLang.text+"</label>"+'<input type="text" class="redactor_input redactor_link_text" id="redactor_link_mailto_text" />'+"</div>"+'<div class="redactor_tab" id="redactor_tab3" style="display: none;">'+"<label>"+this.opts.curLang.anchor+"</label>"+'<input type="text" class="redactor_input" id="redactor_link_anchor"  />'+"<label>"+this.opts.curLang.text+"</label>"+'<input type="text" class="redactor_input redactor_link_text" id="redactor_link_anchor_text" />'+"</div>"+"</form>"+"</section>"+"<footer>"+'<a href="#" class="redactor_modal_btn redactor_btn_modal_close">'+this.opts.curLang.cancel+"</a>"+'<input type="button" class="redactor_modal_btn" id="redactor_insert_link_btn" value="'+this.opts.curLang.insert+'" />'+"</footer>",modal_table:String()+"<section>"+"<label>"+this.opts.curLang.rows+"</label>"+'<input type="text" size="5" value="2" id="redactor_table_rows" />'+"<label>"+this.opts.curLang.columns+"</label>"+'<input type="text" size="5" value="3" id="redactor_table_columns" />'+"</section>"+"<footer>"+'<a href="#" class="redactor_modal_btn redactor_btn_modal_close">'+this.opts.curLang.cancel+"</a>"+'<input type="button" name="upload" class="redactor_modal_btn" id="redactor_insert_table_btn" value="'+this.opts.curLang.insert+'" />'+"</footer>",modal_video:String()+"<section>"+'<form id="redactorInsertVideoForm">'+"<label>"+this.opts.curLang.video_html_code+"</label>"+'<textarea id="redactor_insert_video_area" style="width: 99%; height: 160px;"></textarea>'+"</form>"+"</section>"+"<footer>"+'<a href="javascript:void(null);" class="redactor_modal_btn redactor_btn_modal_close">'+this.opts.curLang.cancel+"</a>"+'<input type="button" class="redactor_modal_btn" id="redactor_insert_video_btn" value="'+this.opts.curLang.insert+'" />'+"</footer>"})},modalInit:function(t,i,n,r){var o=e("#redactor_modal_overlay");o.length||(this.$overlay=o=e('<div id="redactor_modal_overlay" style="display: none;"></div>'),e("body").prepend(this.$overlay)),this.opts.modalOverlay&&o.show().on("click",e.proxy(this.modalClose,this));var s=e("#redactor_modal");s.length||(this.$modal=s=e('<div id="redactor_modal" style="display: none;"><div id="redactor_modal_close">&times;</div><header id="redactor_modal_header"></header><div id="redactor_modal_inner"></div></div>'),e("body").append(this.$modal)),e("#redactor_modal_close").on("click",e.proxy(this.modalClose,this)),this.hdlModalClose=e.proxy(function(e){return e.keyCode===this.keyCode.ESC?(this.modalClose(),!1):void 0},this),e(document).keyup(this.hdlModalClose),this.$editor.keyup(this.hdlModalClose),this.modalcontent=!1,0==i.indexOf("#")?(this.modalcontent=e(i),e("#redactor_modal_inner").empty().append(this.modalcontent.html()),this.modalcontent.html("")):e("#redactor_modal_inner").empty().append(i),s.find("#redactor_modal_header").html(t),"undefined"!=typeof e.fn.draggable&&(s.draggable({handle:"#redactor_modal_header"}),s.find("#redactor_modal_header").css("cursor","move"));var a=e("#redactor_tabs");if(a.length){var l=this;a.find("a").each(function(t,i){t++,e(i).on("click",function(i){if(i.preventDefault(),a.find("a").removeClass("redactor_tabs_act"),e(this).addClass("redactor_tabs_act"),e(".redactor_tab").hide(),e("#redactor_tab"+t).show(),e("#redactor_tab_selected").val(t),l.isMobile()===!1){var n=s.outerHeight();s.css("margin-top","-"+(n+10)/2+"px")}})})}s.find(".redactor_btn_modal_close").on("click",e.proxy(this.modalClose,this)),this.isMobile()===!1?(s.css({position:"fixed",top:"-2000px",left:"50%",width:n+"px",marginLeft:"-"+n/2+"px"}).show(),this.modalSaveBodyOveflow=e(document.body).css("overflow"),e(document.body).css("overflow","hidden")):s.css({position:"fixed",width:"100%",height:"100%",top:"0",left:"0",margin:"0",minHeight:"300px"}).show(),"function"==typeof r&&r(),this.isMobile()===!1&&setTimeout(function(){var e=s.outerHeight();s.css({top:"50%",height:"auto",minHeight:"auto",marginTop:"-"+(e+10)/2+"px"})},20)},modalClose:function(){return e("#redactor_modal_close").off("click",this.modalClose),e("#redactor_modal").fadeOut("fast",e.proxy(function(){var t=e("#redactor_modal_inner");this.modalcontent!==!1&&(this.modalcontent.html(t.html()),this.modalcontent=!1),t.html(""),this.opts.modalOverlay&&e("#redactor_modal_overlay").hide().off("click",this.modalClose),e(document).unbind("keyup",this.hdlModalClose),this.$editor.unbind("keyup",this.hdlModalClose)},this)),this.isMobile()===!1&&e(document.body).css("overflow",this.modalSaveBodyOveflow?this.modalSaveBodyOveflow:"visible"),!1},modalSetTab:function(t){e(".redactor_tab").hide(),e("#redactor_tabs").find("a").removeClass("redactor_tabs_act").eq(t-1).addClass("redactor_tabs_act"),e("#redactor_tab"+t).show()},s3handleFileSelect:function(e){for(var t,i=e.target.files,n=0;t=i[n];n++)this.s3uploadFile(t)},s3uploadFile:function(t){this.s3executeOnSignedUrl(t,e.proxy(function(e){this.s3uploadToS3(t,e)},this))},s3executeOnSignedUrl:function(t,i){var n=new XMLHttpRequest;n.open("GET",this.opts.s3+"?name="+t.name+"&type="+t.type,!0),n.overrideMimeType("text/plain; charset=x-user-defined"),n.onreadystatechange=function(){4==this.readyState&&200==this.status?(e("#redactor-progress").fadeIn(),i(decodeURIComponent(this.responseText))):4==this.readyState&&200!=this.status},n.send()},s3createCORSRequest:function(e,t){var i=new XMLHttpRequest;return"withCredentials"in i?i.open(e,t,!0):"undefined"!=typeof XDomainRequest?(i=new XDomainRequest,i.open(e,t)):i=null,i},s3uploadToS3:function(t,i){var n=this.s3createCORSRequest("PUT",i);n&&(n.onload=e.proxy(function(){if(200==n.status){e("#redactor-progress").hide();var t=i.split("?");if(!t[0])return!1;this.selectionRestore();var r="";r='<img id="image-marker" src="'+t[0]+'" />',this.opts.paragraphy&&(r="<p>"+r+"</p>"),this.execCommand("inserthtml",r,!1);var o=e(this.$editor.find("img#image-marker"));o.length?o.removeAttr("id"):o=!1,this.sync(),this.callback("imageUpload",o,!1),this.modalClose(),this.observeImages()}},this),n.onerror=function(){},n.upload.onprogress=function(){},n.setRequestHeader("Content-Type",t.type),n.setRequestHeader("x-amz-acl","public-read"),n.send(t))},uploadInit:function(t,i){this.uploadOptions={url:!1,success:!1,error:!1,start:!1,trigger:!1,auto:!1,input:!1},e.extend(this.uploadOptions,i);var n=e("#"+t);n.length&&"INPUT"===n[0].tagName?(this.uploadOptions.input=n,this.el=e(n[0].form)):this.el=n,this.element_action=this.el.attr("action"),this.uploadOptions.auto?e(this.uploadOptions.input).change(e.proxy(function(e){this.el.submit(function(){return!1}),this.uploadSubmit(e)},this)):this.uploadOptions.trigger&&e("#"+this.uploadOptions.trigger).click(e.proxy(this.uploadSubmit,this))},uploadSubmit:function(){e("#redactor-progress").fadeIn(),this.uploadForm(this.element,this.uploadFrame())},uploadFrame:function(){this.id="f"+Math.floor(99999*Math.random());var t=this.document.createElement("div"),i='<iframe style="display:none" id="'+this.id+'" name="'+this.id+'"></iframe>';return t.innerHTML=i,e(t).appendTo("body"),this.uploadOptions.start&&this.uploadOptions.start(),e("#"+this.id).load(e.proxy(this.uploadLoaded,this)),this.id},uploadForm:function(t,i){if(this.uploadOptions.input){var n="redactorUploadForm"+this.id,r="redactorUploadFile"+this.id;this.form=e('<form  action="'+this.uploadOptions.url+'" method="POST" target="'+i+'" name="'+n+'" id="'+n+'" enctype="multipart/form-data" />'),this.opts.uploadFields!==!1&&"object"==typeof this.opts.uploadFields&&e.each(this.opts.uploadFields,e.proxy(function(t,i){0===i.toString().indexOf("#")&&(i=e(i).val());var n=e("<input/>",{type:"hidden",name:t,value:i});e(this.form).append(n)},this));var o=this.uploadOptions.input,s=e(o).clone();e(o).attr("id",r).before(s).appendTo(this.form),e(this.form).css("position","absolute").css("top","-2000px").css("left","-2000px").appendTo("body"),this.form.submit()}else t.attr("target",i).attr("method","POST").attr("enctype","multipart/form-data").attr("action",this.uploadOptions.url),this.element.submit()},uploadLoaded:function(){var t,i=e("#"+this.id)[0];if(t=i.contentDocument?i.contentDocument:i.contentWindow?i.contentWindow.document:window.frames[this.id].document,this.uploadOptions.success)if(e("#redactor-progress").hide(),"undefined"!=typeof t){var n=t.body.innerHTML,r=n.match(/\{(.|\n)*\}/)[0];r=r.replace(/^\[/,""),r=r.replace(/\]$/,"");var o=e.parseJSON(r);"undefined"==typeof o.error?this.uploadOptions.success(o):(this.uploadOptions.error(this,o),this.modalClose())}else this.modalClose(),alert("Upload failed!");this.el.attr("action",this.element_action),this.el.attr("target","")},draguploadInit:function(t,i){return this.draguploadOptions=e.extend({url:!1,success:!1,error:!1,preview:!1,uploadFields:!1,text:this.opts.curLang.drop_file_here,atext:this.opts.curLang.or_choose},i),void 0===window.FormData?!1:(this.droparea=e('<div class="redactor_droparea"></div>'),this.dropareabox=e('<div class="redactor_dropareabox">'+this.draguploadOptions.text+"</div>"),this.dropalternative=e('<div class="redactor_dropalternative">'+this.draguploadOptions.atext+"</div>"),this.droparea.append(this.dropareabox),e(t).before(this.droparea),e(t).before(this.dropalternative),this.dropareabox.on("dragover",e.proxy(function(){return this.draguploadOndrag()},this)),this.dropareabox.on("dragleave",e.proxy(function(){return this.draguploadOndragleave()},this)),this.dropareabox.get(0).ondrop=e.proxy(function(e){e.preventDefault(),this.dropareabox.removeClass("hover").addClass("drop"),this.draguploadUpload(e.dataTransfer.files[0])},this),void 0)},draguploadUpload:function(t){var i=jQuery.ajaxSettings.xhr();i.upload&&i.upload.addEventListener("progress",e.proxy(this.uploadProgress,this),!1);var n=function(){return i},r=new FormData;this.draguploadOptions.uploadFields!==!1&&"object"==typeof this.draguploadOptions.uploadFields&&e.each(this.draguploadOptions.uploadFields,e.proxy(function(t,i){0===i.toString().indexOf("#")&&(i=e(i).val()),r.append(t,i)},this)),r.append("file",t),e.ajax({url:this.draguploadOptions.url,dataType:"html",data:r,xhr:n,cache:!1,contentType:!1,processData:!1,type:"POST",success:e.proxy(function(t){t=t.replace(/^\[/,""),t=t.replace(/\]$/,"");var i=e.parseJSON(t);"undefined"==typeof i.error?this.draguploadOptions.success(i):(this.draguploadOptions.error(this,i),this.draguploadOptions.success(!1))},this)})},draguploadOndrag:function(){return this.dropareabox.addClass("hover"),!1},draguploadOndragleave:function(){return this.dropareabox.removeClass("hover"),!1},uploadProgress:function(e,t){var i=e.loaded?parseInt(100*(e.loaded/e.total),10):e;this.dropareabox.text("Loading "+i+"% "+(t||""))},isMobile:function(){return/(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent)},outerHtml:function(t){return e("<div>").append(e(t).eq(0).clone()).html()},isString:function(e){return"[object String]"==Object.prototype.toString.call(e)},isEmpty:function(e){return e=e.replace(/&#x200b;|<br>|<br\/>|&nbsp;/gi,""),e=e.replace(/\s/g,""),e=e.replace(/^<p>[^\w\d]*?<\/p>$/i,""),""==e},browser:function(e){var t=navigator.userAgent.toLowerCase(),i=/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[];return"version"==e?i[2]:"webkit"==e?"chrome"==i[1]||"webkit"==i[1]:i[1]==e},oldIE:function(){return this.browser("msie")&&parseInt(this.browser("version"),10)<9?!0:!1},getFragmentHtml:function(e){var t=e.cloneNode(!0),i=this.document.createElement("div");return i.appendChild(t),i.innerHTML},extractContent:function(){for(var e,t=this.$editor[0],i=this.document.createDocumentFragment();e=t.firstChild;)i.appendChild(e);return i},isParentRedactor:function(t){return t?this.opts.iframe?t:0==e(t).parents("div.redactor_editor").length||e(t).hasClass("redactor_editor")?!1:t:!1},currentOrParentIs:function(e){var t=this.getParent(),i=this.getCurrent();return t&&t.tagName===e?t:i&&i.tagName===e?i:!1},isEndOfElement:function(){var t=this.getBlock(),i=this.getCaretOffset(t),n=e.trim(e(t).text()).replace(/\n\r\n/g,""),r=n.length;return i==r?!0:!1},isFocused:function(){var t,i=this.getSelection();return i.rangeCount>0&&(t=i.getRangeAt(0).startContainer),t?this.opts.iframe?this.getCaretOffsetRange().equals()?!this.$editor.is(t):!0:0!=e(t).closest("div.redactor_editor").length:!1},removeEmptyAttr:function(t,i){""==e(t).attr(i)&&e(t).removeAttr(i)},removeFromArrayByValue:function(e,t){for(var i=null;-1!==(i=e.indexOf(t));)e.splice(i,1);return e}},t.prototype.init.prototype=t.prototype,e.Redactor.fn.formatLinkify=function(t){for(var i=/(^|&lt;|\s)(www\..+?\..+?)(\s|&gt;|$)/g,n=/(^|&lt;|\s)(((https?|ftp):\/\/|mailto:).+?)(\s|&gt;|$)/g,r=(this.$editor?this.$editor.get(0):this).childNodes,o=r.length;o--;){var s=r[o];if(3===s.nodeType){var a=s.nodeValue;a&&(a.match(i)||a.match(n))&&(a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(i,'$1<a href="'+t+'$2">$2</a>$3').replace(n,'$1<a href="$2">$2</a>$5'),e(s).after(a).remove())}else 1!==s.nodeType||/^(a|button|textarea)$/i.test(s.tagName)||e.Redactor.fn.formatLinkify.call(s,t)}}}(jQuery),function(e){e.Redactor.opts.langs.fr={html:"Code HTML",video:"Insérer une vidéo...",image:"Insérer une image...",table:"Tableau",link:"Lien",link_insert:"Insérer un lien...",link_edit:"Edit link",unlink:"Supprimer le lien",formatting:"Styles",paragraph:"Paragraphe",quote:"Citation",code:"Code",header1:"Titre 1",header2:"Titre 2",header3:"Titre 3",header4:"Titre 4",bold:"Gras",italic:"Italique",fontcolor:"Couleur du texte",backcolor:"Couleur d'arrière plan du texte",unorderedlist:"Liste à puces",orderedlist:"Liste numérotée",outdent:"Diminuer le trait",indent:"Augmenter le trait",cancel:"Annuler",insert:"Insérer",save:"Sauvegarder",_delete:"Supprimer",insert_table:"Insérer un tableau...",insert_row_above:"Ajouter une rangée au-dessus",insert_row_below:"Ajouter une rangée en-dessous",insert_column_left:"Ajouter une colonne à gauche",insert_column_right:"Ajouter une colonne à droite",delete_column:"Supprimer la colonne",delete_row:"Supprimer la rangée",delete_table:"Supprimer le tableau",rows:"Rangées",columns:"Colonnes",add_head:"Ajouter un en-tête",delete_head:"Supprimer l'en-tête",title:"Titre",image_position:"Position",none:"Aucun",left:"Gauche",right:"Droite",image_web_link:"Adresse URL de l'image",text:"Texte",mailto:"Courriel",web:"Adresse URL",video_html_code:"Code d'intégration du vidéo",file:"Insérer un fichier...",upload:"Téléverser",download:"Télécharger",choose:"Choisir",or_choose:"Ou choisissez",drop_file_here:"Déposez le fichier ici",align_left:"Aligner à gauche",align_center:"Aligner au centre",align_right:"Aligner à droite",align_justify:"Justifier",horizontalrule:"Insérer une ligne horizontale",deleted:"Supprimé",anchor:"Ancre",link_new_tab:"Ouvrir le lien dans un nouvel onglet",underline:"Underline",alignment:"Alignment",filename:"Name (optional)"}}(jQuery),!RedactorPlugins)var RedactorPlugins={};RedactorPlugins.clips={init:function(){var e=$.proxy(function(){$("#redactor_modal").find(".redactor_clip_link").each($.proxy(function(e,t){$(t).click($.proxy(function(){return this.insertClip($(t).next().html()),!1},this))},this)),this.selectionSave(),this.bufferSet()},this);this.buttonAdd("clips","Clips",function(){this.modalInit("Clips","#clipsmodal",500,e)})},insertClip:function(e){this.selectionRestore(),this.insertHtml($.trim(e)),this.modalClose()}},/*
 * HTML5 Sortable jQuery Plugin
 * http://farhadi.ir/projects/html5sortable
 * 
 * Copyright 2012, Ali Farhadi
 * Released under the MIT license.
 */
function(e){var t,i=e();e.fn.sortable=function(n){var r=String(n);return n=e.extend({connectWith:!1},n),this.each(function(){if(/^enable|disable|destroy$/.test(r)){var o=e(this).children(e(this).data("items")).attr("draggable","enable"==r);return"destroy"==r&&o.add(this).removeData("connectWith items").off("dragstart.h5s dragend.h5s selectstart.h5s dragover.h5s dragenter.h5s drop.h5s"),void 0}var s,a,o=e(this).children(n.items),l=e("<"+(/^ul|ol$/i.test(this.tagName)?"li":"div")+' class="sortable-placeholder">');o.find(n.handle).mousedown(function(){s=!0}).mouseup(function(){s=!1}),e(this).data("items",n.items),i=i.add(l),n.connectWith&&e(n.connectWith).add(this).data("connectWith",n.connectWith),o.attr("draggable","true").on("dragstart.h5s",function(i){if(n.handle&&!s)return!1;s=!1;var r=i.originalEvent.dataTransfer;r.effectAllowed="move",r.setData("Text","dummy"),a=(t=e(this)).addClass("sortable-dragging").index()}).on("dragend.h5s",function(){t&&(t.removeClass("sortable-dragging").show(),i.detach(),a!=t.index()&&t.parent().trigger("sortupdate",{item:t}),t=null)}).not("a[href], img").on("selectstart.h5s",function(){return this.dragDrop&&this.dragDrop(),!1}).end().add([this,l]).on("dragover.h5s dragenter.h5s drop.h5s",function(r){return o.is(t)||n.connectWith===e(t).parent().data("connectWith")?"drop"==r.type?(r.stopPropagation(),i.filter(":visible").after(t),t.trigger("dragend.h5s"),!1):(r.preventDefault(),r.originalEvent.dataTransfer.dropEffect="move",o.is(this)?(n.forcePlaceholderSize&&l.height(t.outerHeight()),t.hide(),e(this)[l.index()<e(this).index()?"after":"before"](l),i.not(l).detach()):i.is(this)||e(this).children(n.items).length||(i.detach(),e(this).append(l)),!1):!0})})}}(jQuery),function(e){e.fn.dndPageScroll=function(t){t||(t={});var i={topId:"top_scroll_page",bottomId:"bottom_scroll_page",delay:50},t=e.extend(i,t),n=e("#"+t.topId);n.length||(n=e('<div id="top_scroll_page">&nbsp;</div>').appendTo("body"));var r=e("#"+t.bottomId);r.length||(r=e('<div id="bottom_scroll_page">&nbsp;</div>').appendTo("body"));var o=e("#top_scroll_page, #bottom_scroll_page");o.hide(),o.css({position:"fixed",left:0,right:0,height:20,zIndex:999999}),n.css({top:0}),r.css({bottom:0});var s,a;o.bind("dragenter",function(){return e(this).attr("id")==t.topId?"up":"down",!0}),o.bind("dragover",function(){if(e("html,body").is(":animated"))return!0;var i=e(window).scrollTop(),n=e(this).attr("id")==t.topId?-1:1,r=-1==n?s:a,o=-1==n?i:e(document).height()-(i+e(window).height());if(void 0!=r&&r==o&&o>0){var l=i+50*n;e("html,body").animate({scrollTop:l},t.delay,"linear")}return-1==n?s=o:a=o,!0});var l=function(){return o.hide(),timestamp=void 0,scrolltop=0,scrollbottom=0,!0};e(document).bind("dragstart",function(){return o.show(),!0}),e(document).bind("dragend",l),o.bind("mouseover",l)}}(jQuery),parseURL=function(e){var t={href:e},i=e.replace("//","/").split("/");return t.protocol=i[0],t.host=i[1],i[1]=i[1].split(":"),t.hostname=i[1][0],t.port=i[1].length>1?i[1][1]:"",i.splice(0,2),t.pathname="/"+i.join("/"),t.pathname=t.pathname.split("#"),t.hash=t.pathname.length>1?"#"+t.pathname[1]:"",t.pathname=t.pathname[0],t.pathname=t.pathname.split("?"),t.search=t.pathname.length>1?"?"+t.pathname[1]:"",t.pathname=t.pathname[0],t},iframed=function(){return parent&&parent.document.location.href!=document.location.href&&$.isFunction(parent.$)},attachLoading=function(e,t,i,n){"undefined"==typeof e&&(e="body"),container=$(e),"undefined"==typeof n&&(n=function(){}),"undefined"==typeof i&&(i=500),"undefined"==typeof t&&(t="Please wait..."),loader=$(e+" .gko-loader"),loader.length>0?loader.fadeIn(n):(container.append("<div class='gko-loader'><div class='progress progress-striped active'><div class='bar' style='width: 100%;'></div></div></div>"),loader=$(e+" .loader"),loader.css({"z-index":1e4,top:100}),loader.hide().fadeIn(i,n)),$("html").addClass("loading")},removeLoading=function(e,t,i){"undefined"==typeof e&&(e="body"),void 0==typeof t&&(t=500),"undefined"==typeof i&&(i=function(){$(this).remove()}),$(e+" .gko-loader").fadeOut(t,i),$("html").removeClass("loading")},parseValue=function(e){if("number"==typeof e)return e;if("string"==typeof e){var t=e.match(/\-?\d/g);return t&&t.constructor===Array?parseInt(t.join(""),10):0}return 0},timestamp=function(){return(new Date).getTime()},get_number_from_string=function(e){return e.replace(/[^\d]+/g,"")},getScreenSize=function(){var e=window.innerHeight>window.innerWidth?"landscape":"portrait",t="portrait"===e,i=t?480:320,n=t?320:480,r=t?screen.availHeight:screen.availWidth,o=t?screen.availWidth:screen.availHeight,s=Math.max(i,$(window).height()),a=Math.max(n,$(window).width()),l={width:Math.min(o,a),height:Math.min(r,s)};return l},init_navigation=function(){var e=$(".sidebar-nav");$("body").click(function(){$(this).hasClass("sidebar-open")&&$(this).removeClass("sidebar-open")}),e.click(function(e){e.stopPropagation()}),$("#sidebar-toggler").click(function(e){e.stopPropagation(),$("body").toggleClass("sidebar-open")}),$(window).resize(function(){$(this).width()>769&&$("body.sidebar-open").removeClass("sidebar-open")})},init_images=function(){$(".change-upload-file-btn").bind("click",function(e){e.preventDefault();var t=$(this).find(".ui-btn-text:first");t.length||(t=$(this));var i=t.html(),n=$(this).attr("data-text");t.html(n),$(this).attr("data-text",i),$(this).parent().parent().find(".js-file-preview:first").toggle("fast").parent().find(".file-field:first").slideToggle("fast")}),$(".delete-file-btn").bind("click",function(e){e.preventDefault(),$(this).parent().parent().find(".js-file-preview:first").toggle("fast").parent().find(".file-field:first").slideToggle("fast").find("input.file").val("")}),$("ol#image_folders_nested_set li a").on("click",function(){$("ol#image_folders_nested_set li").removeClass("ui-selected"),$(this).parent().addClass("ui-selected")})},init_text_editor=function(){$(".redactor").each(function(){var e=$(this),t=e.attr("data-redactor-image-upload"),i=e.attr("data-image-browser-url"),n=e.attr("data-link-browser-url"),r=e.attr("data-file-browser-url"),o=(e.attr("data-redactor-get-images"),$("meta[name=csrf-token]").attr("content")),s=$("meta[name=csrf-param]").attr("content"),a="modal=true";void 0!==s&&void 0!==o&&(a=a+"&"+s+"="+encodeURIComponent(o)),t+="?"+a,e.redactor({lang:"fr",linkEmail:!0,linkAnchor:!0,wym:!0,minHeight:200,formattingTags:["p","blockquote","h2","h3","h4"],shortcuts:!1,convertDivs:!1,plugins:["clips"],path:"/assets",imageGetJson:!1,uploadFields:{cl:"#cl",attachable_id:"#attachable_id",attachable_type:"#attachable_type",folder_ids:"#folder_ids"},buttons:["html","|","formatting","|","bold","italic","deleted","|","unorderedlist","orderedlist","outdent","indent","|","gkoimage","video","gkofile","table","gkolink","|","|","alignment","|","horizontalrule"],fileBrowserUrl:r,linkBrowserUrl:n,imageBrowserUrl:i,imageUpload:t,buttonsCustom:{gkoimage:{title:"Image",callback:function(){this.getCurrent()||this.focusEnd(),$.ajax({url:this.opts.imageBrowserUrl,dataType:"script",success:function(){console.log("hello image")}})}},gkolink:{title:"Link",dropdown:{link:{title:"lang.link_insert",func:"linkShow"},unlink:{title:"lang.unlink",exec:"unlink"}},callback:function(){this.getCurrent()||alert("Please select a text before "+this.opts.linkBrowserUrl),$.ajax({url:this.opts.linkBrowserUrl,dataType:"script",success:function(){console.log("hello link")}})}},gkofile:{title:"File",callback:function(){this.getCurrent()||this.focusEnd(),$.ajax({url:this.opts.fileBrowserUrl,dataType:"script",success:function(){console.log("hello file")}})}}},imageShowCallBack:function(){console.log("imageShowCallBack")},imageUploadCallback:function(){console.log("imageUploadCallback")},imageUploadErrorCallback:function(e){console.log(e.error)},fileUpload:"/file_upload.php",fileUploadCallback:function(){console.log("fileUploadCallback")},fileUploadErrorCallback:function(e){console.log(e.error)}})})};var images_dialog={init:function(){$("#image-dialog-size-container ul li a").on("click",function(e){$("#image-dialog-size-container ul li").removeClass("active"),$(this).parent().addClass("active"),e.preventDefault()}),$("#insert-images-modal").on("click",".selectable-thumbnail",function(e){e.preventDefault();var t=$(this),i=$("#image_assignments_form");if(i.length>0){var n=t.closest(".thumbnail-wrapper").attr("id"),r=parseValue(n);$("#image_assignment_image_id").val(r),i.submit()}else{var o=$(".redactor").redactor("getCurrent");o||$(".redactor").redactor("focusEnd"),$(".redactor").redactor("imageThumbClick",e),$("#insert-images-modal").modal("toggle")}}),this.initialised=!0,images_dialog.update()},update:function(){$("#insert-images-modal .pagination a").attr("data-remote","true")}},documents_dialog={init:function(){this.initialised||$("#documents-list > li").on("click","a.preview",function(e){e.preventDefault();var t=$(this),i=$("#document-assignments-form");if(i.length>0){var n=parseValue(t.closest("li").attr("id"));$("#document_assignment_document_id").val(n),i.live("ajax:beforeSend.rails",function(){attachLoading("body#dialog_container")}).live("ajax:complete.rails",function(){removeLoading("body#dialog_container")}).submit()}return!1})}},link_dialog={initialised:!1,init:function(){this.initialised||(this.init_close(),this.page_tab(),this.web_tab(),this.email_tab(),this.document_tab(),this.initialised=!0)},init_close:function(){parent&&parent.document.location.href!=document.location.href&&null!=parent.document.getElementById("wym_dialog_submit")&&$("#dialog_container input#insert_link_submit").click(function(e){e.preventDefault(),$(parent.document.getElementById("wym_dialog_submit")).click()})},page_tab:function(){$("#link_to_page").on("click",".selectable",function(e){var t=$(this),i=t.parent();i.parent(),e.preventDefault(),$("#link_to_page ul.selection").find(".ui-selected").removeClass("ui-selected"),i.addClass("ui-selected"),link_dialog.update_parent(t.attr("href"),t.html()),$(parent.document.getElementById("wym_dialog_submit")).click()})},document_tab:function(){$("#link_to_document li a").click(function(e){e.preventDefault(),link_dialog.update_parent($(this).attr("href")),$(parent.document.getElementById("wym_dialog_submit")).click()})},web_tab:function(){$("#web_address_text").change(function(){link_dialog.update_parent($("#web_address_text").val(),null,"_blank")})},email_tab:function(){$("#email_address_text, #email_default_subject_text, #email_default_body_text").change(function(){var e=$("#email_default_subject_text").val(),t=$("#email_default_body_text").val(),i="mailto:"+$("#email_address_text").val(),n="?";e.length>0&&(i+=n+"subject="+e,n="&"),t.length>0&&(i+=n+"body="+t,n="&"),link_dialog.update_parent(i,i.replace("mailto:",""))})},update_parent:function(e,t,i){null!=parent&&(null!=(wym_href=parent.document.getElementById("wym_href"))&&(wym_href.value=e),null!=(wym_title=parent.document.getElementById("wym_title"))&&(wym_title.value=t),null!=(wym_target=parent.document.getElementById("wym_target"))&&(wym_target.value=i||""))}},pages_modal={initialised:!1,init:function(){this.initialised||($("#page_selection_modal").on("click","a.selectable",function(e){var t=$(this).parent();t.parent().find("> .ui-selected").removeClass("ui-selected"),t.addClass("ui-selected"),e.preventDefault()}),$("#page_selection_modal").on("click","a#validate_page_selection_btn",function(){var e=$("li.ui-selected:first"),t=e.data("type"),i=parseValue(e.attr("id")),n=e.find("a.selectable:first").html();$("#owner_name").html(n),$("#owner_id").val(i),$("#owner_type").val(t),$("#page_selection_modal").modal("hide")}),this.initialised=!0)}};selectable_list=function(){$.fn.selectAllRows=function(e){var t,i,n;return t=$.extend({column:"first",selectTip:"Click to Select All",unselectTip:"Click to Un-Select All"},e||{}),isNaN(t.column)?(i=$("thead tr th:"+t.column+"-child input:checkbox",this),n=$("tbody tr td:"+t.column+"-child input:checkbox",this)):(i=$("thead tr th:nth-child("+t.column+") input:checkbox",this),n=$("tbody tr td:nth-child("+t.column+") input:checkbox",this)),i.attr("title",t.selectTip),i.click(function(){var e=this.checked;n.each(function(){this.checked=e}),1==e?$(this).attr("title",t.unselectTip):$(this).attr("title",t.selectTip)}),$(this)}},make_sortable=function(e){var t=e.data("sortable-url"),i=e.data("sortable-handle");if(e.get(0))var n="UL"==e.get(0).tagName?"li":"tr";e.sortable().on("sortupdate",function(e,r){var o=$(r.item);$.ajax({type:"GET",url:t,items:n,handle:i,data:{position:o.prevAll().length+1,id:parseValue(o.attr("id"))},beforeSend:function(){attachLoading()},success:function(){},complete:function(){removeLoading()}})})},dnd_join_list=function(e,t,i){$.event.props.push("dataTransfer"),Modernizr.draganddrop&&($().dndPageScroll(),t.find("li").each(function(){$(this).attr("draggable","true")}),t.on({dragenter:function(e){e.stopPropagation(),e.preventDefault(),$(this).toggleClass("dragover")},dragover:function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},dragleave:function(e){e.stopPropagation(),e.preventDefault(),$(this).toggleClass("dragover")},drop:function(e){e.stopPropagation(),e.preventDefault();var t=$(this),n=e.dataTransfer.getData("Text"),r=get_number_from_string(n),o=get_number_from_string(t.attr("id"));t.removeClass("dragover"),jQuery.ajax({type:"POST",url:i,data:{image_id:r,id:o},dataType:"script",beforeSend:function(){attachLoading("body")},error:function(e,t,i){alert(i)},complete:function(){removeLoading("body")}})}},"li"),e.on({dragstart:function(e){var t=$(this);t.css("opacity","0.5"),e.dataTransfer.effectAllowed="copy",e.dataTransfer.setData("text/plain",t.attr("id"))},dragend:function(e){e.stopPropagation(),e.preventDefault(),$(this).css("opacity","1")}},"li"))};