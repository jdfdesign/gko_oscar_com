!function(t,e){var i=function(){var e=t(document).data("events");return e&&e.click&&t.grep(e.click,function(t){return"rails"===t.namespace}).length};i()&&t.error("jquery-ujs has already been loaded!");var n;t.rails=n={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote], a[data-disable-with]",inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type])",disableSelector:"input[data-disable-with], button[data-disable-with], textarea[data-disable-with]",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled",requiredInputSelector:"input[name][required]:not([disabled]),textarea[name][required]:not([disabled])",fileInputSelector:"input:file",linkDisableSelector:"a[data-disable-with]",CSRFProtection:function(e){var i=t('meta[name="csrf-token"]').attr("content");i&&e.setRequestHeader("X-CSRF-Token",i)},fire:function(e,i,n){var r=t.Event(i);return e.trigger(r,n),r.result!==!1},confirm:function(t){return confirm(t)},ajax:function(e){return t.ajax(e)},href:function(t){return t.attr("href")},handleRemote:function(i){var r,o,s,a,l,c,d,h;if(n.fire(i,"ajax:before")){if(a=i.data("cross-domain"),l=a===e?null:a,c=i.data("with-credentials")||null,d=i.data("type")||t.ajaxSettings&&t.ajaxSettings.dataType,i.is("form")){r=i.attr("method"),o=i.attr("action"),s=i.serializeArray();var u=i.data("ujs:submit-button");u&&(s.push(u),i.data("ujs:submit-button",null))}else i.is(n.inputChangeSelector)?(r=i.data("method"),o=i.data("url"),s=i.serialize(),i.data("params")&&(s=s+"&"+i.data("params"))):(r=i.data("method"),o=n.href(i),s=i.data("params")||null);h={type:r||"GET",data:s,dataType:d,beforeSend:function(t,r){return r.dataType===e&&t.setRequestHeader("accept","*/*;q=0.5, "+r.accepts.script),n.fire(i,"ajax:beforeSend",[t,r])},success:function(t,e,n){i.trigger("ajax:success",[t,e,n])},complete:function(t,e){i.trigger("ajax:complete",[t,e])},error:function(t,e,n){i.trigger("ajax:error",[t,e,n])},xhrFields:{withCredentials:c},crossDomain:l},o&&(h.url=o);var f=n.ajax(h);return i.trigger("ajax:send",f),f}return!1},handleMethod:function(i){var r=n.href(i),o=i.data("method"),s=i.attr("target"),a=t("meta[name=csrf-token]").attr("content"),l=t("meta[name=csrf-param]").attr("content"),c=t('<form method="post" action="'+r+'"></form>'),d='<input name="_method" value="'+o+'" type="hidden" />';l!==e&&a!==e&&(d+='<input name="'+l+'" value="'+a+'" type="hidden" />'),s&&c.attr("target",s),c.hide().append(d).appendTo("body"),c.submit()},disableFormElements:function(e){e.find(n.disableSelector).each(function(){var e=t(this),i=e.is("button")?"html":"val";e.data("ujs:enable-with",e[i]()),e[i](e.data("disable-with")),e.prop("disabled",!0)})},enableFormElements:function(e){e.find(n.enableSelector).each(function(){var e=t(this),i=e.is("button")?"html":"val";e.data("ujs:enable-with")&&e[i](e.data("ujs:enable-with")),e.prop("disabled",!1)})},allowAction:function(t){var e,i=t.data("confirm"),r=!1;return i?(n.fire(t,"confirm")&&(r=n.confirm(i),e=n.fire(t,"confirm:complete",[r])),r&&e):!0},blankInputs:function(e,i,n){var r,o,s=t(),a=i||"input,textarea";return e.find(a).each(function(){r=t(this),o=r.is(":checkbox,:radio")?r.is(":checked"):r.val(),o==!!n&&(s=s.add(r))}),s.length?s:!1},nonBlankInputs:function(t,e){return n.blankInputs(t,e,!0)},stopEverything:function(e){return t(e.target).trigger("ujs:everythingStopped"),e.stopImmediatePropagation(),!1},callFormSubmitBindings:function(i,n){var r=i.data("events"),o=!0;return r!==e&&r.submit!==e&&t.each(r.submit,function(t,e){return"function"==typeof e.handler?o=e.handler(n):void 0}),o},disableElement:function(t){t.data("ujs:enable-with",t.html()),t.html(t.data("disable-with")),t.bind("click.railsDisable",function(t){return n.stopEverything(t)})},enableElement:function(t){t.data("ujs:enable-with")!==e&&(t.html(t.data("ujs:enable-with")),t.data("ujs:enable-with",!1)),t.unbind("click.railsDisable")}},n.fire(t(document),"rails:attachBindings")&&(t.ajaxPrefilter(function(t,e,i){t.crossDomain||n.CSRFProtection(i)}),t(document).delegate(n.linkDisableSelector,"ajax:complete",function(){n.enableElement(t(this))}),t(document).delegate(n.linkClickSelector,"click.rails",function(i){var r=t(this),o=r.data("method"),s=r.data("params");return n.allowAction(r)?(r.is(n.linkDisableSelector)&&n.disableElement(r),r.data("remote")!==e?!i.metaKey&&!i.ctrlKey||o&&"GET"!==o||s?(n.handleRemote(r)===!1&&n.enableElement(r),!1):!0:r.data("method")?(n.handleMethod(r),!1):void 0):n.stopEverything(i)}),t(document).delegate(n.inputChangeSelector,"change.rails",function(e){var i=t(this);return n.allowAction(i)?(n.handleRemote(i),!1):n.stopEverything(e)}),t(document).delegate(n.formSubmitSelector,"submit.rails",function(i){var r=t(this),o=r.data("remote")!==e,s=n.blankInputs(r,n.requiredInputSelector),a=n.nonBlankInputs(r,n.fileInputSelector);return n.allowAction(r)?s&&r.attr("novalidate")==e&&n.fire(r,"ajax:aborted:required",[s])?n.stopEverything(i):o?a?(setTimeout(function(){n.disableFormElements(r)},13),n.fire(r,"ajax:aborted:file",[a])):!t.support.submitBubbles&&t().jquery<"1.7"&&n.callFormSubmitBindings(r,i)===!1?n.stopEverything(i):(n.handleRemote(r),!1):(setTimeout(function(){n.disableFormElements(r)},13),void 0):n.stopEverything(i)}),t(document).delegate(n.formInputClickSelector,"click.rails",function(e){var i=t(this);if(!n.allowAction(i))return n.stopEverything(e);var r=i.attr("name"),o=r?{name:r,value:i.val()}:null;i.closest("form").data("ujs:submit-button",o)}),t(document).delegate(n.formSubmitSelector,"ajax:beforeSend.rails",function(e){this==e.target&&n.disableFormElements(t(this))}),t(document).delegate(n.formSubmitSelector,"ajax:complete.rails",function(e){this==e.target&&n.enableFormElements(t(this))}),t(function(){csrf_token=t("meta[name=csrf-token]").attr("content"),csrf_param=t("meta[name=csrf-param]").attr("content"),t('form input[name="'+csrf_param+'"]').val(csrf_token)}))}(jQuery),/*! jQuery UI - v1.10.3 - 2013-09-25
* http://jqueryui.com
* Includes: jquery.ui.core.js, jquery.ui.widget.js, jquery.ui.mouse.js, jquery.ui.position.js, jquery.ui.draggable.js, jquery.ui.droppable.js, jquery.ui.resizable.js, jquery.ui.selectable.js, jquery.ui.sortable.js
* Copyright 2013 jQuery Foundation and other contributors; Licensed MIT */
function(t,e){function i(e,i){var r,o,s,a=e.nodeName.toLowerCase();return"area"===a?(r=e.parentNode,o=r.name,e.href&&o&&"map"===r.nodeName.toLowerCase()?(s=t("img[usemap=#"+o+"]")[0],!!s&&n(s)):!1):(/input|select|textarea|button|object/.test(a)?!e.disabled:"a"===a?e.href||i:i)&&n(e)}function n(e){return t.expr.filters.visible(e)&&!t(e).parents().addBack().filter(function(){return"hidden"===t.css(this,"visibility")}).length}var r=0,o=/^ui-id-\d+$/;t.ui=t.ui||{},t.extend(t.ui,{version:"1.10.3",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),t.fn.extend({focus:function(e){return function(i,n){return"number"==typeof i?this.each(function(){var e=this;setTimeout(function(){t(e).focus(),n&&n.call(e)},i)}):e.apply(this,arguments)}}(t.fn.focus),scrollParent:function(){var e;return e=t.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(t.css(this,"position"))&&/(auto|scroll)/.test(t.css(this,"overflow")+t.css(this,"overflow-y")+t.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(t.css(this,"overflow")+t.css(this,"overflow-y")+t.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!e.length?t(document):e},zIndex:function(i){if(i!==e)return this.css("zIndex",i);if(this.length)for(var n,r,o=t(this[0]);o.length&&o[0]!==document;){if(n=o.css("position"),("absolute"===n||"relative"===n||"fixed"===n)&&(r=parseInt(o.css("zIndex"),10),!isNaN(r)&&0!==r))return r;o=o.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++r)})},removeUniqueId:function(){return this.each(function(){o.test(this.id)&&t(this).removeAttr("id")})}}),t.extend(t.expr[":"],{data:t.expr.createPseudo?t.expr.createPseudo(function(e){return function(i){return!!t.data(i,e)}}):function(e,i,n){return!!t.data(e,n[3])},focusable:function(e){return i(e,!isNaN(t.attr(e,"tabindex")))},tabbable:function(e){var n=t.attr(e,"tabindex"),r=isNaN(n);return(r||n>=0)&&i(e,!r)}}),t("<a>").outerWidth(1).jquery||t.each(["Width","Height"],function(i,n){function r(e,i,n,r){return t.each(o,function(){i-=parseFloat(t.css(e,"padding"+this))||0,n&&(i-=parseFloat(t.css(e,"border"+this+"Width"))||0),r&&(i-=parseFloat(t.css(e,"margin"+this))||0)}),i}var o="Width"===n?["Left","Right"]:["Top","Bottom"],s=n.toLowerCase(),a={innerWidth:t.fn.innerWidth,innerHeight:t.fn.innerHeight,outerWidth:t.fn.outerWidth,outerHeight:t.fn.outerHeight};t.fn["inner"+n]=function(i){return i===e?a["inner"+n].call(this):this.each(function(){t(this).css(s,r(this,i)+"px")})},t.fn["outer"+n]=function(e,i){return"number"!=typeof e?a["outer"+n].call(this,e):this.each(function(){t(this).css(s,r(this,e,!0,i)+"px")})}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(t.fn.removeData=function(e){return function(i){return arguments.length?e.call(this,t.camelCase(i)):e.call(this)}}(t.fn.removeData)),t.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),t.support.selectstart="onselectstart"in document.createElement("div"),t.fn.extend({disableSelection:function(){return this.bind((t.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(t){t.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),t.extend(t.ui,{plugin:{add:function(e,i,n){var r,o=t.ui[e].prototype;for(r in n)o.plugins[r]=o.plugins[r]||[],o.plugins[r].push([i,n[r]])},call:function(t,e,i){var n,r=t.plugins[e];if(r&&t.element[0].parentNode&&11!==t.element[0].parentNode.nodeType)for(n=0;n<r.length;n++)t.options[r[n][0]]&&r[n][1].apply(t.element,i)}},hasScroll:function(e,i){if("hidden"===t(e).css("overflow"))return!1;var n=i&&"left"===i?"scrollLeft":"scrollTop",r=!1;return e[n]>0?!0:(e[n]=1,r=e[n]>0,e[n]=0,r)}})}(jQuery),function(t,e){var i=0,n=Array.prototype.slice,r=t.cleanData;t.cleanData=function(e){for(var i,n=0;null!=(i=e[n]);n++)try{t(i).triggerHandler("remove")}catch(o){}r(e)},t.widget=function(e,i,n){var r,o,s,a,l={},c=e.split(".")[0];e=e.split(".")[1],r=c+"-"+e,n||(n=i,i=t.Widget),t.expr[":"][r.toLowerCase()]=function(e){return!!t.data(e,r)},t[c]=t[c]||{},o=t[c][e],s=t[c][e]=function(t,e){return this._createWidget?(arguments.length&&this._createWidget(t,e),void 0):new s(t,e)},t.extend(s,o,{version:n.version,_proto:t.extend({},n),_childConstructors:[]}),a=new i,a.options=t.widget.extend({},a.options),t.each(n,function(e,n){return t.isFunction(n)?(l[e]=function(){var t=function(){return i.prototype[e].apply(this,arguments)},r=function(t){return i.prototype[e].apply(this,t)};return function(){var e,i=this._super,o=this._superApply;return this._super=t,this._superApply=r,e=n.apply(this,arguments),this._super=i,this._superApply=o,e}}(),void 0):(l[e]=n,void 0)}),s.prototype=t.widget.extend(a,{widgetEventPrefix:o?a.widgetEventPrefix:e},l,{constructor:s,namespace:c,widgetName:e,widgetFullName:r}),o?(t.each(o._childConstructors,function(e,i){var n=i.prototype;t.widget(n.namespace+"."+n.widgetName,s,i._proto)}),delete o._childConstructors):i._childConstructors.push(s),t.widget.bridge(e,s)},t.widget.extend=function(i){for(var r,o,s=n.call(arguments,1),a=0,l=s.length;l>a;a++)for(r in s[a])o=s[a][r],s[a].hasOwnProperty(r)&&o!==e&&(i[r]=t.isPlainObject(o)?t.isPlainObject(i[r])?t.widget.extend({},i[r],o):t.widget.extend({},o):o);return i},t.widget.bridge=function(i,r){var o=r.prototype.widgetFullName||i;t.fn[i]=function(s){var a="string"==typeof s,l=n.call(arguments,1),c=this;return s=!a&&l.length?t.widget.extend.apply(null,[s].concat(l)):s,a?this.each(function(){var n,r=t.data(this,o);return r?t.isFunction(r[s])&&"_"!==s.charAt(0)?(n=r[s].apply(r,l),n!==r&&n!==e?(c=n&&n.jquery?c.pushStack(n.get()):n,!1):void 0):t.error("no such method '"+s+"' for "+i+" widget instance"):t.error("cannot call methods on "+i+" prior to initialization; "+"attempted to call method '"+s+"'")}):this.each(function(){var e=t.data(this,o);e?e.option(s||{})._init():t.data(this,o,new r(s,this))}),c}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(e,n){n=t(n||this.defaultElement||this)[0],this.element=t(n),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this.bindings=t(),this.hoverable=t(),this.focusable=t(),n!==this&&(t.data(n,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===n&&this.destroy()}}),this.document=t(n.style?n.ownerDocument:n.document||n),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:t.noop,_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(t.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:t.noop,widget:function(){return this.element},option:function(i,n){var r,o,s,a=i;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof i)if(a={},r=i.split("."),i=r.shift(),r.length){for(o=a[i]=t.widget.extend({},this.options[i]),s=0;s<r.length-1;s++)o[r[s]]=o[r[s]]||{},o=o[r[s]];if(i=r.pop(),n===e)return o[i]===e?null:o[i];o[i]=n}else{if(n===e)return this.options[i]===e?null:this.options[i];a[i]=n}return this._setOptions(a),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return this.options[t]=e,"disabled"===t&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!e).attr("aria-disabled",e),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(e,i,n){var r,o=this;"boolean"!=typeof e&&(n=i,i=e,e=!1),n?(i=r=t(i),this.bindings=this.bindings.add(i)):(n=i,i=this.element,r=this.widget()),t.each(n,function(n,s){function a(){return e||o.options.disabled!==!0&&!t(this).hasClass("ui-state-disabled")?("string"==typeof s?o[s]:s).apply(o,arguments):void 0}"string"!=typeof s&&(a.guid=s.guid=s.guid||a.guid||t.guid++);var l=n.match(/^(\w+)\s*(.*)$/),c=l[1]+o.eventNamespace,d=l[2];d?r.delegate(d,c,a):i.bind(c,a)})},_off:function(t,e){e=(e||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(e).undelegate(e)},_delay:function(t,e){function i(){return("string"==typeof t?n[t]:t).apply(n,arguments)}var n=this;return setTimeout(i,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){t(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){t(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){t(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){t(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,i,n){var r,o,s=this.options[e];if(n=n||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],o=i.originalEvent)for(r in o)r in i||(i[r]=o[r]);return this.element.trigger(i,n),!(t.isFunction(s)&&s.apply(this.element[0],[i].concat(n))===!1||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(n,r,o){"string"==typeof r&&(r={effect:r});var s,a=r?r===!0||"number"==typeof r?i:r.effect||i:e;r=r||{},"number"==typeof r&&(r={duration:r}),s=!t.isEmptyObject(r),r.complete=o,r.delay&&n.delay(r.delay),s&&t.effects&&t.effects.effect[a]?n[e](r):a!==e&&n[a]?n[a](r.duration,r.easing,o):n.queue(function(i){t(this)[e](),o&&o.call(n[0]),i()})}})}(jQuery),function(t){var e=!1;t(document).mouseup(function(){e=!1}),t.widget("ui.mouse",{version:"1.10.3",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.bind("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).bind("click."+this.widgetName,function(i){return!0===t.data(i.target,e.widgetName+".preventClickEvent")?(t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&t(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(i){if(!e){this._mouseStarted&&this._mouseUp(i),this._mouseDownEvent=i;var n=this,r=1===i.which,o="string"==typeof this.options.cancel&&i.target.nodeName?t(i.target).closest(this.options.cancel).length:!1;return r&&!o&&this._mouseCapture(i)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){n.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(i)&&this._mouseDelayMet(i)&&(this._mouseStarted=this._mouseStart(i)!==!1,!this._mouseStarted)?(i.preventDefault(),!0):(!0===t.data(i.target,this.widgetName+".preventClickEvent")&&t.removeData(i.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return n._mouseMove(t)},this._mouseUpDelegate=function(t){return n._mouseUp(t)},t(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),i.preventDefault(),e=!0,!0)):!0}},_mouseMove:function(e){return t.ui.ie&&(!document.documentMode||document.documentMode<9)&&!e.button?this._mouseUp(e):this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1,this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){return t(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),!1},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(t,e){function i(t,e,i){return[parseFloat(t[0])*(f.test(t[0])?e/100:1),parseFloat(t[1])*(f.test(t[1])?i/100:1)]}function n(e,i){return parseInt(t.css(e,i),10)||0}function r(e){var i=e[0];return 9===i.nodeType?{width:e.width(),height:e.height(),offset:{top:0,left:0}}:t.isWindow(i)?{width:e.width(),height:e.height(),offset:{top:e.scrollTop(),left:e.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:e.outerWidth(),height:e.outerHeight(),offset:e.offset()}}t.ui=t.ui||{};var o,s=Math.max,a=Math.abs,l=Math.round,c=/left|center|right/,d=/top|center|bottom/,h=/[\+\-]\d+(\.[\d]+)?%?/,u=/^\w+/,f=/%$/,p=t.fn.position;t.position={scrollbarWidth:function(){if(o!==e)return o;var i,n,r=t("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),s=r.children()[0];return t("body").append(r),i=s.offsetWidth,r.css("overflow","scroll"),n=s.offsetWidth,i===n&&(n=r[0].clientWidth),r.remove(),o=i-n},getScrollInfo:function(e){var i=e.isWindow?"":e.element.css("overflow-x"),n=e.isWindow?"":e.element.css("overflow-y"),r="scroll"===i||"auto"===i&&e.width<e.element[0].scrollWidth,o="scroll"===n||"auto"===n&&e.height<e.element[0].scrollHeight;return{width:o?t.position.scrollbarWidth():0,height:r?t.position.scrollbarWidth():0}},getWithinInfo:function(e){var i=t(e||window),n=t.isWindow(i[0]);return{element:i,isWindow:n,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:n?i.width():i.outerWidth(),height:n?i.height():i.outerHeight()}}},t.fn.position=function(e){if(!e||!e.of)return p.apply(this,arguments);e=t.extend({},e);var o,f,m,g,v,b,y=t(e.of),w=t.position.getWithinInfo(e.within),_=t.position.getScrollInfo(w),x=(e.collision||"flip").split(" "),C={};return b=r(y),y[0].preventDefault&&(e.at="left top"),f=b.width,m=b.height,g=b.offset,v=t.extend({},g),t.each(["my","at"],function(){var t,i,n=(e[this]||"").split(" ");1===n.length&&(n=c.test(n[0])?n.concat(["center"]):d.test(n[0])?["center"].concat(n):["center","center"]),n[0]=c.test(n[0])?n[0]:"center",n[1]=d.test(n[1])?n[1]:"center",t=h.exec(n[0]),i=h.exec(n[1]),C[this]=[t?t[0]:0,i?i[0]:0],e[this]=[u.exec(n[0])[0],u.exec(n[1])[0]]}),1===x.length&&(x[1]=x[0]),"right"===e.at[0]?v.left+=f:"center"===e.at[0]&&(v.left+=f/2),"bottom"===e.at[1]?v.top+=m:"center"===e.at[1]&&(v.top+=m/2),o=i(C.at,f,m),v.left+=o[0],v.top+=o[1],this.each(function(){var r,c,d=t(this),h=d.outerWidth(),u=d.outerHeight(),p=n(this,"marginLeft"),b=n(this,"marginTop"),S=h+p+n(this,"marginRight")+_.width,k=u+b+n(this,"marginBottom")+_.height,T=t.extend({},v),E=i(C.my,d.outerWidth(),d.outerHeight());"right"===e.my[0]?T.left-=h:"center"===e.my[0]&&(T.left-=h/2),"bottom"===e.my[1]?T.top-=u:"center"===e.my[1]&&(T.top-=u/2),T.left+=E[0],T.top+=E[1],t.support.offsetFractions||(T.left=l(T.left),T.top=l(T.top)),r={marginLeft:p,marginTop:b},t.each(["left","top"],function(i,n){t.ui.position[x[i]]&&t.ui.position[x[i]][n](T,{targetWidth:f,targetHeight:m,elemWidth:h,elemHeight:u,collisionPosition:r,collisionWidth:S,collisionHeight:k,offset:[o[0]+E[0],o[1]+E[1]],my:e.my,at:e.at,within:w,elem:d})}),e.using&&(c=function(t){var i=g.left-T.left,n=i+f-h,r=g.top-T.top,o=r+m-u,l={target:{element:y,left:g.left,top:g.top,width:f,height:m},element:{element:d,left:T.left,top:T.top,width:h,height:u},horizontal:0>n?"left":i>0?"right":"center",vertical:0>o?"top":r>0?"bottom":"middle"};h>f&&a(i+n)<f&&(l.horizontal="center"),u>m&&a(r+o)<m&&(l.vertical="middle"),l.important=s(a(i),a(n))>s(a(r),a(o))?"horizontal":"vertical",e.using.call(this,t,l)}),d.offset(t.extend(T,{using:c}))})},t.ui.position={fit:{left:function(t,e){var i,n=e.within,r=n.isWindow?n.scrollLeft:n.offset.left,o=n.width,a=t.left-e.collisionPosition.marginLeft,l=r-a,c=a+e.collisionWidth-o-r;e.collisionWidth>o?l>0&&0>=c?(i=t.left+l+e.collisionWidth-o-r,t.left+=l-i):t.left=c>0&&0>=l?r:l>c?r+o-e.collisionWidth:r:l>0?t.left+=l:c>0?t.left-=c:t.left=s(t.left-a,t.left)},top:function(t,e){var i,n=e.within,r=n.isWindow?n.scrollTop:n.offset.top,o=e.within.height,a=t.top-e.collisionPosition.marginTop,l=r-a,c=a+e.collisionHeight-o-r;e.collisionHeight>o?l>0&&0>=c?(i=t.top+l+e.collisionHeight-o-r,t.top+=l-i):t.top=c>0&&0>=l?r:l>c?r+o-e.collisionHeight:r:l>0?t.top+=l:c>0?t.top-=c:t.top=s(t.top-a,t.top)}},flip:{left:function(t,e){var i,n,r=e.within,o=r.offset.left+r.scrollLeft,s=r.width,l=r.isWindow?r.scrollLeft:r.offset.left,c=t.left-e.collisionPosition.marginLeft,d=c-l,h=c+e.collisionWidth-s-l,u="left"===e.my[0]?-e.elemWidth:"right"===e.my[0]?e.elemWidth:0,f="left"===e.at[0]?e.targetWidth:"right"===e.at[0]?-e.targetWidth:0,p=-2*e.offset[0];0>d?(i=t.left+u+f+p+e.collisionWidth-s-o,(0>i||i<a(d))&&(t.left+=u+f+p)):h>0&&(n=t.left-e.collisionPosition.marginLeft+u+f+p-l,(n>0||a(n)<h)&&(t.left+=u+f+p))},top:function(t,e){var i,n,r=e.within,o=r.offset.top+r.scrollTop,s=r.height,l=r.isWindow?r.scrollTop:r.offset.top,c=t.top-e.collisionPosition.marginTop,d=c-l,h=c+e.collisionHeight-s-l,u="top"===e.my[1],f=u?-e.elemHeight:"bottom"===e.my[1]?e.elemHeight:0,p="top"===e.at[1]?e.targetHeight:"bottom"===e.at[1]?-e.targetHeight:0,m=-2*e.offset[1];0>d?(n=t.top+f+p+m+e.collisionHeight-s-o,t.top+f+p+m>d&&(0>n||n<a(d))&&(t.top+=f+p+m)):h>0&&(i=t.top-e.collisionPosition.marginTop+f+p+m-l,t.top+f+p+m>h&&(i>0||a(i)<h)&&(t.top+=f+p+m))}},flipfit:{left:function(){t.ui.position.flip.left.apply(this,arguments),t.ui.position.fit.left.apply(this,arguments)},top:function(){t.ui.position.flip.top.apply(this,arguments),t.ui.position.fit.top.apply(this,arguments)}}},function(){var e,i,n,r,o,s=document.getElementsByTagName("body")[0],a=document.createElement("div");e=document.createElement(s?"div":"body"),n={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},s&&t.extend(n,{position:"absolute",left:"-1000px",top:"-1000px"});for(o in n)e.style[o]=n[o];e.appendChild(a),i=s||document.documentElement,i.insertBefore(e,i.firstChild),a.style.cssText="position: absolute; left: 10.7432222px;",r=t(a).offset().left,t.support.offsetFractions=r>10&&11>r,e.innerHTML="",i.removeChild(e)}()}(jQuery),function(t){t.widget("ui.draggable",t.ui.mouse,{version:"1.10.3",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(e){var i=this.options;return this.helper||i.disabled||t(e.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(e),this.handle?(t(i.iframeFix===!0?"iframe":i.iframeFix).each(function(){t("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(t(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(e){var i=this.options;return this.helper=this._createHelper(e),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",e)===!1?(this._clear(),!1):(this._cacheHelperProportions(),t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this._mouseDrag(e,!0),t.ui.ddmanager&&t.ui.ddmanager.dragStart(this,e),!0)},_mouseDrag:function(e,i){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),!i){var n=this._uiHash();if(this._trigger("drag",e,n)===!1)return this._mouseUp({}),!1;this.position=n.position}return this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var i=this,n=!1;return t.ui.ddmanager&&!this.options.dropBehaviour&&(n=t.ui.ddmanager.drop(this,e)),this.dropped&&(n=this.dropped,this.dropped=!1),"original"!==this.options.helper||t.contains(this.element[0].ownerDocument,this.element[0])?("invalid"===this.options.revert&&!n||"valid"===this.options.revert&&n||this.options.revert===!0||t.isFunction(this.options.revert)&&this.options.revert.call(this.element,n)?t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",e)!==!1&&i._clear()}):this._trigger("stop",e)!==!1&&this._clear(),!1):!1},_mouseUp:function(e){return t("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),t.ui.ddmanager&&t.ui.ddmanager.dragStop(this,e),t.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(e){return this.options.handle?!!t(e.target).closest(this.element.find(this.options.handle)).length:!0},_createHelper:function(e){var i=this.options,n=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.element.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,n,r=this.options;return r.containment?"window"===r.containment?(this.containment=[t(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,t(window).scrollLeft()+t(window).width()-this.helperProportions.width-this.margins.left,t(window).scrollTop()+(t(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):"document"===r.containment?(this.containment=[0,0,t(document).width()-this.helperProportions.width-this.margins.left,(t(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):r.containment.constructor===Array?(this.containment=r.containment,void 0):("parent"===r.containment&&(r.containment=this.helper[0].parentNode),i=t(r.containment),n=i[0],n&&(e="hidden"!==i.css("overflow"),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(e?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=i),void 0):(this.containment=null,void 0)},_convertPositionTo:function(e,i){i||(i=this.position);var n="absolute"===e?1:-1,r="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;return this.offset.scroll||(this.offset.scroll={top:r.scrollTop(),left:r.scrollLeft()}),{top:i.top+this.offset.relative.top*n+this.offset.parent.top*n-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top)*n,left:i.left+this.offset.relative.left*n+this.offset.parent.left*n-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)*n}},_generatePosition:function(e){var i,n,r,o,s=this.options,a="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=e.pageX,c=e.pageY;return this.offset.scroll||(this.offset.scroll={top:a.scrollTop(),left:a.scrollLeft()}),this.originalPosition&&(this.containment&&(this.relative_container?(n=this.relative_container.offset(),i=[this.containment[0]+n.left,this.containment[1]+n.top,this.containment[2]+n.left,this.containment[3]+n.top]):i=this.containment,e.pageX-this.offset.click.left<i[0]&&(l=i[0]+this.offset.click.left),e.pageY-this.offset.click.top<i[1]&&(c=i[1]+this.offset.click.top),e.pageX-this.offset.click.left>i[2]&&(l=i[2]+this.offset.click.left),e.pageY-this.offset.click.top>i[3]&&(c=i[3]+this.offset.click.top)),s.grid&&(r=s.grid[1]?this.originalPageY+Math.round((c-this.originalPageY)/s.grid[1])*s.grid[1]:this.originalPageY,c=i?r-this.offset.click.top>=i[1]||r-this.offset.click.top>i[3]?r:r-this.offset.click.top>=i[1]?r-s.grid[1]:r+s.grid[1]:r,o=s.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/s.grid[0])*s.grid[0]:this.originalPageX,l=i?o-this.offset.click.left>=i[0]||o-this.offset.click.left>i[2]?o:o-this.offset.click.left>=i[0]?o-s.grid[0]:o+s.grid[0]:o)),{top:c-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(e,i,n){return n=n||this._uiHash(),t.ui.plugin.call(this,e,[i,n]),"drag"===e&&(this.positionAbs=this._convertPositionTo("absolute")),t.Widget.prototype._trigger.call(this,e,i,n)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),t.ui.plugin.add("draggable","connectToSortable",{start:function(e,i){var n=t(this).data("ui-draggable"),r=n.options,o=t.extend({},i,{item:n.element});n.sortables=[],t(r.connectToSortable).each(function(){var i=t.data(this,"ui-sortable");i&&!i.options.disabled&&(n.sortables.push({instance:i,shouldRevert:i.options.revert}),i.refreshPositions(),i._trigger("activate",e,o))})},stop:function(e,i){var n=t(this).data("ui-draggable"),r=t.extend({},i,{item:n.element});t.each(n.sortables,function(){this.instance.isOver?(this.instance.isOver=0,n.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(e),this.instance.options.helper=this.instance.options._helper,"original"===n.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",e,r))})},drag:function(e,i){var n=t(this).data("ui-draggable"),r=this;t.each(n.sortables,function(){var o=!1,s=this;this.instance.positionAbs=n.positionAbs,this.instance.helperProportions=n.helperProportions,this.instance.offset.click=n.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(o=!0,t.each(n.sortables,function(){return this.instance.positionAbs=n.positionAbs,this.instance.helperProportions=n.helperProportions,this.instance.offset.click=n.offset.click,this!==s&&this.instance._intersectsWith(this.instance.containerCache)&&t.contains(s.instance.element[0],this.instance.element[0])&&(o=!1),o})),o?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=t(r).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return i.helper[0]},e.target=this.instance.currentItem[0],this.instance._mouseCapture(e,!0),this.instance._mouseStart(e,!0,!0),this.instance.offset.click.top=n.offset.click.top,this.instance.offset.click.left=n.offset.click.left,this.instance.offset.parent.left-=n.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=n.offset.parent.top-this.instance.offset.parent.top,n._trigger("toSortable",e),n.dropped=this.instance.element,n.currentItem=n.element,this.instance.fromOutside=n),this.instance.currentItem&&this.instance._mouseDrag(e)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",e,this.instance._uiHash(this.instance)),this.instance._mouseStop(e,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),n._trigger("fromSortable",e),n.dropped=!1)})}}),t.ui.plugin.add("draggable","cursor",{start:function(){var e=t("body"),i=t(this).data("ui-draggable").options;
e.css("cursor")&&(i._cursor=e.css("cursor")),e.css("cursor",i.cursor)},stop:function(){var e=t(this).data("ui-draggable").options;e._cursor&&t("body").css("cursor",e._cursor)}}),t.ui.plugin.add("draggable","opacity",{start:function(e,i){var n=t(i.helper),r=t(this).data("ui-draggable").options;n.css("opacity")&&(r._opacity=n.css("opacity")),n.css("opacity",r.opacity)},stop:function(e,i){var n=t(this).data("ui-draggable").options;n._opacity&&t(i.helper).css("opacity",n._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function(){var e=t(this).data("ui-draggable");e.scrollParent[0]!==document&&"HTML"!==e.scrollParent[0].tagName&&(e.overflowOffset=e.scrollParent.offset())},drag:function(e){var i=t(this).data("ui-draggable"),n=i.options,r=!1;i.scrollParent[0]!==document&&"HTML"!==i.scrollParent[0].tagName?(n.axis&&"x"===n.axis||(i.overflowOffset.top+i.scrollParent[0].offsetHeight-e.pageY<n.scrollSensitivity?i.scrollParent[0].scrollTop=r=i.scrollParent[0].scrollTop+n.scrollSpeed:e.pageY-i.overflowOffset.top<n.scrollSensitivity&&(i.scrollParent[0].scrollTop=r=i.scrollParent[0].scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(i.overflowOffset.left+i.scrollParent[0].offsetWidth-e.pageX<n.scrollSensitivity?i.scrollParent[0].scrollLeft=r=i.scrollParent[0].scrollLeft+n.scrollSpeed:e.pageX-i.overflowOffset.left<n.scrollSensitivity&&(i.scrollParent[0].scrollLeft=r=i.scrollParent[0].scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(e.pageY-t(document).scrollTop()<n.scrollSensitivity?r=t(document).scrollTop(t(document).scrollTop()-n.scrollSpeed):t(window).height()-(e.pageY-t(document).scrollTop())<n.scrollSensitivity&&(r=t(document).scrollTop(t(document).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(e.pageX-t(document).scrollLeft()<n.scrollSensitivity?r=t(document).scrollLeft(t(document).scrollLeft()-n.scrollSpeed):t(window).width()-(e.pageX-t(document).scrollLeft())<n.scrollSensitivity&&(r=t(document).scrollLeft(t(document).scrollLeft()+n.scrollSpeed)))),r!==!1&&t.ui.ddmanager&&!n.dropBehaviour&&t.ui.ddmanager.prepareOffsets(i,e)}}),t.ui.plugin.add("draggable","snap",{start:function(){var e=t(this).data("ui-draggable"),i=e.options;e.snapElements=[],t(i.snap.constructor!==String?i.snap.items||":data(ui-draggable)":i.snap).each(function(){var i=t(this),n=i.offset();this!==e.element[0]&&e.snapElements.push({item:this,width:i.outerWidth(),height:i.outerHeight(),top:n.top,left:n.left})})},drag:function(e,i){var n,r,o,s,a,l,c,d,h,u,f=t(this).data("ui-draggable"),p=f.options,m=p.snapTolerance,g=i.offset.left,v=g+f.helperProportions.width,b=i.offset.top,y=b+f.helperProportions.height;for(h=f.snapElements.length-1;h>=0;h--)a=f.snapElements[h].left,l=a+f.snapElements[h].width,c=f.snapElements[h].top,d=c+f.snapElements[h].height,a-m>v||g>l+m||c-m>y||b>d+m||!t.contains(f.snapElements[h].item.ownerDocument,f.snapElements[h].item)?(f.snapElements[h].snapping&&f.options.snap.release&&f.options.snap.release.call(f.element,e,t.extend(f._uiHash(),{snapItem:f.snapElements[h].item})),f.snapElements[h].snapping=!1):("inner"!==p.snapMode&&(n=Math.abs(c-y)<=m,r=Math.abs(d-b)<=m,o=Math.abs(a-v)<=m,s=Math.abs(l-g)<=m,n&&(i.position.top=f._convertPositionTo("relative",{top:c-f.helperProportions.height,left:0}).top-f.margins.top),r&&(i.position.top=f._convertPositionTo("relative",{top:d,left:0}).top-f.margins.top),o&&(i.position.left=f._convertPositionTo("relative",{top:0,left:a-f.helperProportions.width}).left-f.margins.left),s&&(i.position.left=f._convertPositionTo("relative",{top:0,left:l}).left-f.margins.left)),u=n||r||o||s,"outer"!==p.snapMode&&(n=Math.abs(c-b)<=m,r=Math.abs(d-y)<=m,o=Math.abs(a-g)<=m,s=Math.abs(l-v)<=m,n&&(i.position.top=f._convertPositionTo("relative",{top:c,left:0}).top-f.margins.top),r&&(i.position.top=f._convertPositionTo("relative",{top:d-f.helperProportions.height,left:0}).top-f.margins.top),o&&(i.position.left=f._convertPositionTo("relative",{top:0,left:a}).left-f.margins.left),s&&(i.position.left=f._convertPositionTo("relative",{top:0,left:l-f.helperProportions.width}).left-f.margins.left)),!f.snapElements[h].snapping&&(n||r||o||s||u)&&f.options.snap.snap&&f.options.snap.snap.call(f.element,e,t.extend(f._uiHash(),{snapItem:f.snapElements[h].item})),f.snapElements[h].snapping=n||r||o||s||u)}}),t.ui.plugin.add("draggable","stack",{start:function(){var e,i=this.data("ui-draggable").options,n=t.makeArray(t(i.stack)).sort(function(e,i){return(parseInt(t(e).css("zIndex"),10)||0)-(parseInt(t(i).css("zIndex"),10)||0)});n.length&&(e=parseInt(t(n[0]).css("zIndex"),10)||0,t(n).each(function(i){t(this).css("zIndex",e+i)}),this.css("zIndex",e+n.length))}}),t.ui.plugin.add("draggable","zIndex",{start:function(e,i){var n=t(i.helper),r=t(this).data("ui-draggable").options;n.css("zIndex")&&(r._zIndex=n.css("zIndex")),n.css("zIndex",r.zIndex)},stop:function(e,i){var n=t(this).data("ui-draggable").options;n._zIndex&&t(i.helper).css("zIndex",n._zIndex)}})}(jQuery),function(t){function e(t,e,i){return t>e&&e+i>t}t.widget("ui.droppable",{version:"1.10.3",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var e=this.options,i=e.accept;this.isover=!1,this.isout=!0,this.accept=t.isFunction(i)?i:function(t){return t.is(i)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},t.ui.ddmanager.droppables[e.scope]=t.ui.ddmanager.droppables[e.scope]||[],t.ui.ddmanager.droppables[e.scope].push(this),e.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){for(var e=0,i=t.ui.ddmanager.droppables[this.options.scope];e<i.length;e++)i[e]===this&&i.splice(e,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(e,i){"accept"===e&&(this.accept=t.isFunction(i)?i:function(t){return t.is(i)}),t.Widget.prototype._setOption.apply(this,arguments)},_activate:function(e){var i=t.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger("activate",e,this.ui(i))},_deactivate:function(e){var i=t.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger("deactivate",e,this.ui(i))},_over:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",e,this.ui(i)))},_out:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",e,this.ui(i)))},_drop:function(e,i){var n=i||t.ui.ddmanager.current,r=!1;return n&&(n.currentItem||n.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var e=t.data(this,"ui-droppable");return e.options.greedy&&!e.options.disabled&&e.options.scope===n.options.scope&&e.accept.call(e.element[0],n.currentItem||n.element)&&t.ui.intersect(n,t.extend(e,{offset:e.element.offset()}),e.options.tolerance)?(r=!0,!1):void 0}),r?!1:this.accept.call(this.element[0],n.currentItem||n.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",e,this.ui(n)),this.element):!1):!1},ui:function(t){return{draggable:t.currentItem||t.element,helper:t.helper,position:t.position,offset:t.positionAbs}}}),t.ui.intersect=function(t,i,n){if(!i.offset)return!1;var r,o,s=(t.positionAbs||t.position.absolute).left,a=s+t.helperProportions.width,l=(t.positionAbs||t.position.absolute).top,c=l+t.helperProportions.height,d=i.offset.left,h=d+i.proportions.width,u=i.offset.top,f=u+i.proportions.height;switch(n){case"fit":return s>=d&&h>=a&&l>=u&&f>=c;case"intersect":return d<s+t.helperProportions.width/2&&a-t.helperProportions.width/2<h&&u<l+t.helperProportions.height/2&&c-t.helperProportions.height/2<f;case"pointer":return r=(t.positionAbs||t.position.absolute).left+(t.clickOffset||t.offset.click).left,o=(t.positionAbs||t.position.absolute).top+(t.clickOffset||t.offset.click).top,e(o,u,i.proportions.height)&&e(r,d,i.proportions.width);case"touch":return(l>=u&&f>=l||c>=u&&f>=c||u>l&&c>f)&&(s>=d&&h>=s||a>=d&&h>=a||d>s&&a>h);default:return!1}},t.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(e,i){var n,r,o=t.ui.ddmanager.droppables[e.options.scope]||[],s=i?i.type:null,a=(e.currentItem||e.element).find(":data(ui-droppable)").addBack();t:for(n=0;n<o.length;n++)if(!(o[n].options.disabled||e&&!o[n].accept.call(o[n].element[0],e.currentItem||e.element))){for(r=0;r<a.length;r++)if(a[r]===o[n].element[0]){o[n].proportions.height=0;continue t}o[n].visible="none"!==o[n].element.css("display"),o[n].visible&&("mousedown"===s&&o[n]._activate.call(o[n],i),o[n].offset=o[n].element.offset(),o[n].proportions={width:o[n].element[0].offsetWidth,height:o[n].element[0].offsetHeight})}},drop:function(e,i){var n=!1;return t.each((t.ui.ddmanager.droppables[e.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&t.ui.intersect(e,this,this.options.tolerance)&&(n=this._drop.call(this,i)||n),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],e.currentItem||e.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),n},dragStart:function(e,i){e.element.parentsUntil("body").bind("scroll.droppable",function(){e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)})},drag:function(e,i){e.options.refreshPositions&&t.ui.ddmanager.prepareOffsets(e,i),t.each(t.ui.ddmanager.droppables[e.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var n,r,o,s=t.ui.intersect(e,this,this.options.tolerance),a=!s&&this.isover?"isout":s&&!this.isover?"isover":null;a&&(this.options.greedy&&(r=this.options.scope,o=this.element.parents(":data(ui-droppable)").filter(function(){return t.data(this,"ui-droppable").options.scope===r}),o.length&&(n=t.data(o[0],"ui-droppable"),n.greedyChild="isover"===a)),n&&"isover"===a&&(n.isover=!1,n.isout=!0,n._out.call(n,i)),this[a]=!0,this["isout"===a?"isover":"isout"]=!1,this["isover"===a?"_over":"_out"].call(this,i),n&&"isout"===a&&(n.isout=!1,n.isover=!0,n._over.call(n,i)))}})},dragStop:function(e,i){e.element.parentsUntil("body").unbind("scroll.droppable"),e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)}}}(jQuery),function(t){function e(t){return parseInt(t,10)||0}function i(t){return!isNaN(parseInt(t,10))}t.widget("ui.resizable",t.ui.mouse,{version:"1.10.3",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_create:function(){var e,i,n,r,o,s=this,a=this.options;if(this.element.addClass("ui-resizable"),t.extend(this,{_aspectRatio:!!a.aspectRatio,aspectRatio:a.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:a.helper||a.ghost||a.animate?a.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(t("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.data("ui-resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=a.handles||(t(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),e=this.handles.split(","),this.handles={},i=0;i<e.length;i++)n=t.trim(e[i]),o="ui-resizable-"+n,r=t("<div class='ui-resizable-handle "+o+"'></div>"),r.css({zIndex:a.zIndex}),"se"===n&&r.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[n]=".ui-resizable-"+n,this.element.append(r);this._renderAxis=function(e){var i,n,r,o;e=e||this.element;for(i in this.handles)this.handles[i].constructor===String&&(this.handles[i]=t(this.handles[i],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(n=t(this.handles[i],this.element),o=/sw|ne|nw|se|n|s/.test(i)?n.outerHeight():n.outerWidth(),r=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),e.css(r,o),this._proportionallyResize()),t(this.handles[i]).length},this._renderAxis(this.element),this._handles=t(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){s.resizing||(this.className&&(r=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),s.axis=r&&r[1]?r[1]:"se")}),a.autoHide&&(this._handles.hide(),t(this.element).addClass("ui-resizable-autohide").mouseenter(function(){a.disabled||(t(this).removeClass("ui-resizable-autohide"),s._handles.show())}).mouseleave(function(){a.disabled||s.resizing||(t(this).addClass("ui-resizable-autohide"),s._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var e,i=function(e){t(e).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),e=this.element,this.originalElement.css({position:e.css("position"),width:e.outerWidth(),height:e.outerHeight(),top:e.css("top"),left:e.css("left")}).insertAfter(e),e.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_mouseCapture:function(e){var i,n,r=!1;for(i in this.handles)n=t(this.handles[i])[0],(n===e.target||t.contains(n,e.target))&&(r=!0);return!this.options.disabled&&r},_mouseStart:function(i){var n,r,o,s=this.options,a=this.element.position(),l=this.element;return this.resizing=!0,/absolute/.test(l.css("position"))?l.css({position:"absolute",top:l.css("top"),left:l.css("left")}):l.is(".ui-draggable")&&l.css({position:"absolute",top:a.top,left:a.left}),this._renderProxy(),n=e(this.helper.css("left")),r=e(this.helper.css("top")),s.containment&&(n+=t(s.containment).scrollLeft()||0,r+=t(s.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:n,top:r},this.size=this._helper?{width:l.outerWidth(),height:l.outerHeight()}:{width:l.width(),height:l.height()},this.originalSize=this._helper?{width:l.outerWidth(),height:l.outerHeight()}:{width:l.width(),height:l.height()},this.originalPosition={left:n,top:r},this.sizeDiff={width:l.outerWidth()-l.width(),height:l.outerHeight()-l.height()},this.originalMousePosition={left:i.pageX,top:i.pageY},this.aspectRatio="number"==typeof s.aspectRatio?s.aspectRatio:this.originalSize.width/this.originalSize.height||1,o=t(".ui-resizable-"+this.axis).css("cursor"),t("body").css("cursor","auto"===o?this.axis+"-resize":o),l.addClass("ui-resizable-resizing"),this._propagate("start",i),!0},_mouseDrag:function(e){var i,n=this.helper,r={},o=this.originalMousePosition,s=this.axis,a=this.position.top,l=this.position.left,c=this.size.width,d=this.size.height,h=e.pageX-o.left||0,u=e.pageY-o.top||0,f=this._change[s];return f?(i=f.apply(this,[e,h,u]),this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(i=this._updateRatio(i,e)),i=this._respectSize(i,e),this._updateCache(i),this._propagate("resize",e),this.position.top!==a&&(r.top=this.position.top+"px"),this.position.left!==l&&(r.left=this.position.left+"px"),this.size.width!==c&&(r.width=this.size.width+"px"),this.size.height!==d&&(r.height=this.size.height+"px"),n.css(r),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),t.isEmptyObject(r)||this._trigger("resize",e,this.ui()),!1):!1},_mouseStop:function(e){this.resizing=!1;var i,n,r,o,s,a,l,c=this.options,d=this;return this._helper&&(i=this._proportionallyResizeElements,n=i.length&&/textarea/i.test(i[0].nodeName),r=n&&t.ui.hasScroll(i[0],"left")?0:d.sizeDiff.height,o=n?0:d.sizeDiff.width,s={width:d.helper.width()-o,height:d.helper.height()-r},a=parseInt(d.element.css("left"),10)+(d.position.left-d.originalPosition.left)||null,l=parseInt(d.element.css("top"),10)+(d.position.top-d.originalPosition.top)||null,c.animate||this.element.css(t.extend(s,{top:l,left:a})),d.helper.height(d.size.height),d.helper.width(d.size.width),this._helper&&!c.animate&&this._proportionallyResize()),t("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",e),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(t){var e,n,r,o,s,a=this.options;s={minWidth:i(a.minWidth)?a.minWidth:0,maxWidth:i(a.maxWidth)?a.maxWidth:1/0,minHeight:i(a.minHeight)?a.minHeight:0,maxHeight:i(a.maxHeight)?a.maxHeight:1/0},(this._aspectRatio||t)&&(e=s.minHeight*this.aspectRatio,r=s.minWidth/this.aspectRatio,n=s.maxHeight*this.aspectRatio,o=s.maxWidth/this.aspectRatio,e>s.minWidth&&(s.minWidth=e),r>s.minHeight&&(s.minHeight=r),n<s.maxWidth&&(s.maxWidth=n),o<s.maxHeight&&(s.maxHeight=o)),this._vBoundaries=s},_updateCache:function(t){this.offset=this.helper.offset(),i(t.left)&&(this.position.left=t.left),i(t.top)&&(this.position.top=t.top),i(t.height)&&(this.size.height=t.height),i(t.width)&&(this.size.width=t.width)},_updateRatio:function(t){var e=this.position,n=this.size,r=this.axis;return i(t.height)?t.width=t.height*this.aspectRatio:i(t.width)&&(t.height=t.width/this.aspectRatio),"sw"===r&&(t.left=e.left+(n.width-t.width),t.top=null),"nw"===r&&(t.top=e.top+(n.height-t.height),t.left=e.left+(n.width-t.width)),t},_respectSize:function(t){var e=this._vBoundaries,n=this.axis,r=i(t.width)&&e.maxWidth&&e.maxWidth<t.width,o=i(t.height)&&e.maxHeight&&e.maxHeight<t.height,s=i(t.width)&&e.minWidth&&e.minWidth>t.width,a=i(t.height)&&e.minHeight&&e.minHeight>t.height,l=this.originalPosition.left+this.originalSize.width,c=this.position.top+this.size.height,d=/sw|nw|w/.test(n),h=/nw|ne|n/.test(n);return s&&(t.width=e.minWidth),a&&(t.height=e.minHeight),r&&(t.width=e.maxWidth),o&&(t.height=e.maxHeight),s&&d&&(t.left=l-e.minWidth),r&&d&&(t.left=l-e.maxWidth),a&&h&&(t.top=c-e.minHeight),o&&h&&(t.top=c-e.maxHeight),t.width||t.height||t.left||!t.top?t.width||t.height||t.top||!t.left||(t.left=null):t.top=null,t},_proportionallyResize:function(){if(this._proportionallyResizeElements.length){var t,e,i,n,r,o=this.helper||this.element;for(t=0;t<this._proportionallyResizeElements.length;t++){if(r=this._proportionallyResizeElements[t],!this.borderDif)for(this.borderDif=[],i=[r.css("borderTopWidth"),r.css("borderRightWidth"),r.css("borderBottomWidth"),r.css("borderLeftWidth")],n=[r.css("paddingTop"),r.css("paddingRight"),r.css("paddingBottom"),r.css("paddingLeft")],e=0;e<i.length;e++)this.borderDif[e]=(parseInt(i[e],10)||0)+(parseInt(n[e],10)||0);r.css({height:o.height()-this.borderDif[0]-this.borderDif[2]||0,width:o.width()-this.borderDif[1]-this.borderDif[3]||0})}}},_renderProxy:function(){var e=this.element,i=this.options;this.elementOffset=e.offset(),this._helper?(this.helper=this.helper||t("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(t,e){return{width:this.originalSize.width+e}},w:function(t,e){var i=this.originalSize,n=this.originalPosition;return{left:n.left+e,width:i.width-e}},n:function(t,e,i){var n=this.originalSize,r=this.originalPosition;return{top:r.top+i,height:n.height-i}},s:function(t,e,i){return{height:this.originalSize.height+i}},se:function(e,i,n){return t.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,i,n]))},sw:function(e,i,n){return t.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,i,n]))},ne:function(e,i,n){return t.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,i,n]))},nw:function(e,i,n){return t.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,i,n]))}},_propagate:function(e,i){t.ui.plugin.call(this,e,[i,this.ui()]),"resize"!==e&&this._trigger(e,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),t.ui.plugin.add("resizable","animate",{stop:function(e){var i=t(this).data("ui-resizable"),n=i.options,r=i._proportionallyResizeElements,o=r.length&&/textarea/i.test(r[0].nodeName),s=o&&t.ui.hasScroll(r[0],"left")?0:i.sizeDiff.height,a=o?0:i.sizeDiff.width,l={width:i.size.width-a,height:i.size.height-s},c=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,d=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(t.extend(l,d&&c?{top:d,left:c}:{}),{duration:n.animateDuration,easing:n.animateEasing,step:function(){var n={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};r&&r.length&&t(r[0]).css({width:n.width,height:n.height}),i._updateCache(n),i._propagate("resize",e)}})}}),t.ui.plugin.add("resizable","containment",{start:function(){var i,n,r,o,s,a,l,c=t(this).data("ui-resizable"),d=c.options,h=c.element,u=d.containment,f=u instanceof t?u.get(0):/parent/.test(u)?h.parent().get(0):u;f&&(c.containerElement=t(f),/document/.test(u)||u===document?(c.containerOffset={left:0,top:0},c.containerPosition={left:0,top:0},c.parentData={element:t(document),left:0,top:0,width:t(document).width(),height:t(document).height()||document.body.parentNode.scrollHeight}):(i=t(f),n=[],t(["Top","Right","Left","Bottom"]).each(function(t,r){n[t]=e(i.css("padding"+r))}),c.containerOffset=i.offset(),c.containerPosition=i.position(),c.containerSize={height:i.innerHeight()-n[3],width:i.innerWidth()-n[1]},r=c.containerOffset,o=c.containerSize.height,s=c.containerSize.width,a=t.ui.hasScroll(f,"left")?f.scrollWidth:s,l=t.ui.hasScroll(f)?f.scrollHeight:o,c.parentData={element:f,left:r.left,top:r.top,width:a,height:l}))},resize:function(e){var i,n,r,o,s=t(this).data("ui-resizable"),a=s.options,l=s.containerOffset,c=s.position,d=s._aspectRatio||e.shiftKey,h={top:0,left:0},u=s.containerElement;u[0]!==document&&/static/.test(u.css("position"))&&(h=l),c.left<(s._helper?l.left:0)&&(s.size.width=s.size.width+(s._helper?s.position.left-l.left:s.position.left-h.left),d&&(s.size.height=s.size.width/s.aspectRatio),s.position.left=a.helper?l.left:0),c.top<(s._helper?l.top:0)&&(s.size.height=s.size.height+(s._helper?s.position.top-l.top:s.position.top),d&&(s.size.width=s.size.height*s.aspectRatio),s.position.top=s._helper?l.top:0),s.offset.left=s.parentData.left+s.position.left,s.offset.top=s.parentData.top+s.position.top,i=Math.abs((s._helper?s.offset.left-h.left:s.offset.left-h.left)+s.sizeDiff.width),n=Math.abs((s._helper?s.offset.top-h.top:s.offset.top-l.top)+s.sizeDiff.height),r=s.containerElement.get(0)===s.element.parent().get(0),o=/relative|absolute/.test(s.containerElement.css("position")),r&&o&&(i-=s.parentData.left),i+s.size.width>=s.parentData.width&&(s.size.width=s.parentData.width-i,d&&(s.size.height=s.size.width/s.aspectRatio)),n+s.size.height>=s.parentData.height&&(s.size.height=s.parentData.height-n,d&&(s.size.width=s.size.height*s.aspectRatio))},stop:function(){var e=t(this).data("ui-resizable"),i=e.options,n=e.containerOffset,r=e.containerPosition,o=e.containerElement,s=t(e.helper),a=s.offset(),l=s.outerWidth()-e.sizeDiff.width,c=s.outerHeight()-e.sizeDiff.height;e._helper&&!i.animate&&/relative/.test(o.css("position"))&&t(this).css({left:a.left-r.left-n.left,width:l,height:c}),e._helper&&!i.animate&&/static/.test(o.css("position"))&&t(this).css({left:a.left-r.left-n.left,width:l,height:c})}}),t.ui.plugin.add("resizable","alsoResize",{start:function(){var e=t(this).data("ui-resizable"),i=e.options,n=function(e){t(e).each(function(){var e=t(this);e.data("ui-resizable-alsoresize",{width:parseInt(e.width(),10),height:parseInt(e.height(),10),left:parseInt(e.css("left"),10),top:parseInt(e.css("top"),10)})})};"object"!=typeof i.alsoResize||i.alsoResize.parentNode?n(i.alsoResize):i.alsoResize.length?(i.alsoResize=i.alsoResize[0],n(i.alsoResize)):t.each(i.alsoResize,function(t){n(t)})},resize:function(e,i){var n=t(this).data("ui-resizable"),r=n.options,o=n.originalSize,s=n.originalPosition,a={height:n.size.height-o.height||0,width:n.size.width-o.width||0,top:n.position.top-s.top||0,left:n.position.left-s.left||0},l=function(e,n){t(e).each(function(){var e=t(this),r=t(this).data("ui-resizable-alsoresize"),o={},s=n&&n.length?n:e.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];t.each(s,function(t,e){var i=(r[e]||0)+(a[e]||0);i&&i>=0&&(o[e]=i||null)}),e.css(o)})};"object"!=typeof r.alsoResize||r.alsoResize.nodeType?l(r.alsoResize):t.each(r.alsoResize,function(t,e){l(t,e)})},stop:function(){t(this).removeData("resizable-alsoresize")}}),t.ui.plugin.add("resizable","ghost",{start:function(){var e=t(this).data("ui-resizable"),i=e.options,n=e.size;e.ghost=e.originalElement.clone(),e.ghost.css({opacity:.25,display:"block",position:"relative",height:n.height,width:n.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof i.ghost?i.ghost:""),e.ghost.appendTo(e.helper)},resize:function(){var e=t(this).data("ui-resizable");e.ghost&&e.ghost.css({position:"relative",height:e.size.height,width:e.size.width})},stop:function(){var e=t(this).data("ui-resizable");e.ghost&&e.helper&&e.helper.get(0).removeChild(e.ghost.get(0))}}),t.ui.plugin.add("resizable","grid",{resize:function(){var e=t(this).data("ui-resizable"),i=e.options,n=e.size,r=e.originalSize,o=e.originalPosition,s=e.axis,a="number"==typeof i.grid?[i.grid,i.grid]:i.grid,l=a[0]||1,c=a[1]||1,d=Math.round((n.width-r.width)/l)*l,h=Math.round((n.height-r.height)/c)*c,u=r.width+d,f=r.height+h,p=i.maxWidth&&i.maxWidth<u,m=i.maxHeight&&i.maxHeight<f,g=i.minWidth&&i.minWidth>u,v=i.minHeight&&i.minHeight>f;i.grid=a,g&&(u+=l),v&&(f+=c),p&&(u-=l),m&&(f-=c),/^(se|s|e)$/.test(s)?(e.size.width=u,e.size.height=f):/^(ne)$/.test(s)?(e.size.width=u,e.size.height=f,e.position.top=o.top-h):/^(sw)$/.test(s)?(e.size.width=u,e.size.height=f,e.position.left=o.left-d):(e.size.width=u,e.size.height=f,e.position.top=o.top-h,e.position.left=o.left-d)}})}(jQuery),function(t){t.widget("ui.selectable",t.ui.mouse,{version:"1.10.3",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var e,i=this;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){e=t(i.options.filter,i.element[0]),e.addClass("ui-selectee"),e.each(function(){var e=t(this),i=e.offset();t.data(this,"selectable-item",{element:this,$element:e,left:i.left,top:i.top,right:i.left+e.outerWidth(),bottom:i.top+e.outerHeight(),startselected:!1,selected:e.hasClass("ui-selected"),selecting:e.hasClass("ui-selecting"),unselecting:e.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=e.addClass("ui-selectee"),this._mouseInit(),this.helper=t("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(e){var i=this,n=this.options;this.opos=[e.pageX,e.pageY],this.options.disabled||(this.selectees=t(n.filter,this.element[0]),this._trigger("start",e),t(n.appendTo).append(this.helper),this.helper.css({left:e.pageX,top:e.pageY,width:0,height:0}),n.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var n=t.data(this,"selectable-item");n.startselected=!0,e.metaKey||e.ctrlKey||(n.$element.removeClass("ui-selected"),n.selected=!1,n.$element.addClass("ui-unselecting"),n.unselecting=!0,i._trigger("unselecting",e,{unselecting:n.element}))}),t(e.target).parents().addBack().each(function(){var n,r=t.data(this,"selectable-item");return r?(n=!e.metaKey&&!e.ctrlKey||!r.$element.hasClass("ui-selected"),r.$element.removeClass(n?"ui-unselecting":"ui-selected").addClass(n?"ui-selecting":"ui-unselecting"),r.unselecting=!n,r.selecting=n,r.selected=n,n?i._trigger("selecting",e,{selecting:r.element}):i._trigger("unselecting",e,{unselecting:r.element}),!1):void 0}))},_mouseDrag:function(e){if(this.dragged=!0,!this.options.disabled){var i,n=this,r=this.options,o=this.opos[0],s=this.opos[1],a=e.pageX,l=e.pageY;return o>a&&(i=a,a=o,o=i),s>l&&(i=l,l=s,s=i),this.helper.css({left:o,top:s,width:a-o,height:l-s}),this.selectees.each(function(){var i=t.data(this,"selectable-item"),c=!1;i&&i.element!==n.element[0]&&("touch"===r.tolerance?c=!(i.left>a||i.right<o||i.top>l||i.bottom<s):"fit"===r.tolerance&&(c=i.left>o&&i.right<a&&i.top>s&&i.bottom<l),c?(i.selected&&(i.$element.removeClass("ui-selected"),i.selected=!1),i.unselecting&&(i.$element.removeClass("ui-unselecting"),i.unselecting=!1),i.selecting||(i.$element.addClass("ui-selecting"),i.selecting=!0,n._trigger("selecting",e,{selecting:i.element}))):(i.selecting&&((e.metaKey||e.ctrlKey)&&i.startselected?(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.$element.addClass("ui-selected"),i.selected=!0):(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.startselected&&(i.$element.addClass("ui-unselecting"),i.unselecting=!0),n._trigger("unselecting",e,{unselecting:i.element}))),i.selected&&(e.metaKey||e.ctrlKey||i.startselected||(i.$element.removeClass("ui-selected"),i.selected=!1,i.$element.addClass("ui-unselecting"),i.unselecting=!0,n._trigger("unselecting",e,{unselecting:i.element})))))}),!1}},_mouseStop:function(e){var i=this;return this.dragged=!1,t(".ui-unselecting",this.element[0]).each(function(){var n=t.data(this,"selectable-item");n.$element.removeClass("ui-unselecting"),n.unselecting=!1,n.startselected=!1,i._trigger("unselected",e,{unselected:n.element})}),t(".ui-selecting",this.element[0]).each(function(){var n=t.data(this,"selectable-item");n.$element.removeClass("ui-selecting").addClass("ui-selected"),n.selecting=!1,n.selected=!0,n.startselected=!0,i._trigger("selected",e,{selected:n.element})}),this._trigger("stop",e),this.helper.remove(),!1}})}(jQuery),function(t){function e(t,e,i){return t>e&&e+i>t}function i(t){return/left|right/.test(t.css("float"))||/inline|table-cell/.test(t.css("display"))}t.widget("ui.sortable",t.ui.mouse,{version:"1.10.3",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var t=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===t.axis||i(this.items[0].item):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();
for(var t=this.items.length-1;t>=0;t--)this.items[t].item.removeData(this.widgetName+"-item");return this},_setOption:function(e,i){"disabled"===e?(this.options[e]=i,this.widget().toggleClass("ui-sortable-disabled",!!i)):t.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(e,i){var n=null,r=!1,o=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(e),t(e.target).parents().each(function(){return t.data(this,o.widgetName+"-item")===o?(n=t(this),!1):void 0}),t.data(e.target,o.widgetName+"-item")===o&&(n=t(e.target)),n?!this.options.handle||i||(t(this.options.handle,n).find("*").addBack().each(function(){this===e.target&&(r=!0)}),r)?(this.currentItem=n,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function(e,i,n){var r,o,s=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,s.cursorAt&&this._adjustOffsetFromHelper(s.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),s.containment&&this._setContainment(),s.cursor&&"auto"!==s.cursor&&(o=this.document.find("body"),this.storedCursor=o.css("cursor"),o.css("cursor",s.cursor),this.storedStylesheet=t("<style>*{ cursor: "+s.cursor+" !important; }</style>").appendTo(o)),s.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",s.opacity)),s.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",s.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!n)for(r=this.containers.length-1;r>=0;r--)this.containers[r]._trigger("activate",e,this._uiHash(this));return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!s.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){var i,n,r,o,s=this.options,a=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<s.scrollSensitivity?this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop+s.scrollSpeed:e.pageY-this.overflowOffset.top<s.scrollSensitivity&&(this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop-s.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<s.scrollSensitivity?this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft+s.scrollSpeed:e.pageX-this.overflowOffset.left<s.scrollSensitivity&&(this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft-s.scrollSpeed)):(e.pageY-t(document).scrollTop()<s.scrollSensitivity?a=t(document).scrollTop(t(document).scrollTop()-s.scrollSpeed):t(window).height()-(e.pageY-t(document).scrollTop())<s.scrollSensitivity&&(a=t(document).scrollTop(t(document).scrollTop()+s.scrollSpeed)),e.pageX-t(document).scrollLeft()<s.scrollSensitivity?a=t(document).scrollLeft(t(document).scrollLeft()-s.scrollSpeed):t(window).width()-(e.pageX-t(document).scrollLeft())<s.scrollSensitivity&&(a=t(document).scrollLeft(t(document).scrollLeft()+s.scrollSpeed))),a!==!1&&t.ui.ddmanager&&!s.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(n=this.items[i],r=n.item[0],o=this._intersectsWithPointer(n),o&&n.instance===this.currentContainer&&r!==this.currentItem[0]&&this.placeholder[1===o?"next":"prev"]()[0]!==r&&!t.contains(this.placeholder[0],r)&&("semi-dynamic"===this.options.type?!t.contains(this.element[0],r):!0)){if(this.direction=1===o?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(n))break;this._rearrange(e,n),this._trigger("change",e,this._uiHash());break}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,i){if(e){if(t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert){var n=this,r=this.placeholder.offset(),o=this.options.axis,s={};o&&"x"!==o||(s.left=r.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),o&&"y"!==o||(s.top=r.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,t(this.helper).animate(s,parseInt(this.options.revert,10)||500,function(){n._clear(e)})}else this._clear(e,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(e){var i=this._getItemsAsjQuery(e&&e.connected),n=[];return e=e||{},t(i).each(function(){var i=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[\-=_](.+)/);i&&n.push((e.key||i[1]+"[]")+"="+(e.key&&e.expression?i[1]:i[2]))}),!n.length&&e.key&&n.push(e.key+"="),n.join("&")},toArray:function(e){var i=this._getItemsAsjQuery(e&&e.connected),n=[];return e=e||{},i.each(function(){n.push(t(e.item||this).attr(e.attribute||"id")||"")}),n},_intersectsWith:function(t){var e=this.positionAbs.left,i=e+this.helperProportions.width,n=this.positionAbs.top,r=n+this.helperProportions.height,o=t.left,s=o+t.width,a=t.top,l=a+t.height,c=this.offset.click.top,d=this.offset.click.left,h="x"===this.options.axis||n+c>a&&l>n+c,u="y"===this.options.axis||e+d>o&&s>e+d,f=h&&u;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?f:o<e+this.helperProportions.width/2&&i-this.helperProportions.width/2<s&&a<n+this.helperProportions.height/2&&r-this.helperProportions.height/2<l},_intersectsWithPointer:function(t){var i="x"===this.options.axis||e(this.positionAbs.top+this.offset.click.top,t.top,t.height),n="y"===this.options.axis||e(this.positionAbs.left+this.offset.click.left,t.left,t.width),r=i&&n,o=this._getDragVerticalDirection(),s=this._getDragHorizontalDirection();return r?this.floating?s&&"right"===s||"down"===o?2:1:o&&("down"===o?2:1):!1},_intersectsWithSides:function(t){var i=e(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),n=e(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),r=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return this.floating&&o?"right"===o&&n||"left"===o&&!n:r&&("down"===r&&i||"up"===r&&!i)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!==t&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!==t&&(t>0?"right":"left")},refresh:function(t){return this._refreshItems(t),this.refreshPositions(),this},_connectWith:function(){var t=this.options;return t.connectWith.constructor===String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(e){var i,n,r,o,s=[],a=[],l=this._connectWith();if(l&&e)for(i=l.length-1;i>=0;i--)for(r=t(l[i]),n=r.length-1;n>=0;n--)o=t.data(r[n],this.widgetFullName),o&&o!==this&&!o.options.disabled&&a.push([t.isFunction(o.options.items)?o.options.items.call(o.element):t(o.options.items,o.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),o]);for(a.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),i=a.length-1;i>=0;i--)a[i][0].each(function(){s.push(this)});return t(s)},_removeCurrentsFromItems:function(){var e=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=t.grep(this.items,function(t){for(var i=0;i<e.length;i++)if(e[i]===t.item[0])return!1;return!0})},_refreshItems:function(e){this.items=[],this.containers=[this];var i,n,r,o,s,a,l,c,d=this.items,h=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],u=this._connectWith();if(u&&this.ready)for(i=u.length-1;i>=0;i--)for(r=t(u[i]),n=r.length-1;n>=0;n--)o=t.data(r[n],this.widgetFullName),o&&o!==this&&!o.options.disabled&&(h.push([t.isFunction(o.options.items)?o.options.items.call(o.element[0],e,{item:this.currentItem}):t(o.options.items,o.element),o]),this.containers.push(o));for(i=h.length-1;i>=0;i--)for(s=h[i][1],a=h[i][0],n=0,c=a.length;c>n;n++)l=t(a[n]),l.data(this.widgetName+"-item",s),d.push({item:l,instance:s,width:0,height:0,left:0,top:0})},refreshPositions:function(e){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,n,r,o;for(i=this.items.length-1;i>=0;i--)n=this.items[i],n.instance!==this.currentContainer&&this.currentContainer&&n.item[0]!==this.currentItem[0]||(r=this.options.toleranceElement?t(this.options.toleranceElement,n.item):n.item,e||(n.width=r.outerWidth(),n.height=r.outerHeight()),o=r.offset(),n.left=o.left,n.top=o.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)o=this.containers[i].element.offset(),this.containers[i].containerCache.left=o.left,this.containers[i].containerCache.top=o.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(e){e=e||this;var i,n=e.options;n.placeholder&&n.placeholder.constructor!==String||(i=n.placeholder,n.placeholder={element:function(){var n=e.currentItem[0].nodeName.toLowerCase(),r=t("<"+n+">",e.document[0]).addClass(i||e.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===n?e.currentItem.children().each(function(){t("<td>&#160;</td>",e.document[0]).attr("colspan",t(this).attr("colspan")||1).appendTo(r)}):"img"===n&&r.attr("src",e.currentItem.attr("src")),i||r.css("visibility","hidden"),r},update:function(t,r){(!i||n.forcePlaceholderSize)&&(r.height()||r.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),r.width()||r.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10)))}}),e.placeholder=t(n.placeholder.element.call(e.element,e.currentItem)),e.currentItem.after(e.placeholder),n.placeholder.update(e,e.placeholder)},_contactContainers:function(n){var r,o,s,a,l,c,d,h,u,f,p=null,m=null;for(r=this.containers.length-1;r>=0;r--)if(!t.contains(this.currentItem[0],this.containers[r].element[0]))if(this._intersectsWith(this.containers[r].containerCache)){if(p&&t.contains(this.containers[r].element[0],p.element[0]))continue;p=this.containers[r],m=r}else this.containers[r].containerCache.over&&(this.containers[r]._trigger("out",n,this._uiHash(this)),this.containers[r].containerCache.over=0);if(p)if(1===this.containers.length)this.containers[m].containerCache.over||(this.containers[m]._trigger("over",n,this._uiHash(this)),this.containers[m].containerCache.over=1);else{for(s=1e4,a=null,f=p.floating||i(this.currentItem),l=f?"left":"top",c=f?"width":"height",d=this.positionAbs[l]+this.offset.click[l],o=this.items.length-1;o>=0;o--)t.contains(this.containers[m].element[0],this.items[o].item[0])&&this.items[o].item[0]!==this.currentItem[0]&&(!f||e(this.positionAbs.top+this.offset.click.top,this.items[o].top,this.items[o].height))&&(h=this.items[o].item.offset()[l],u=!1,Math.abs(h-d)>Math.abs(h+this.items[o][c]-d)&&(u=!0,h+=this.items[o][c]),Math.abs(h-d)<s&&(s=Math.abs(h-d),a=this.items[o],this.direction=u?"up":"down"));if(!a&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[m])return;a?this._rearrange(n,a,null,!0):this._rearrange(n,null,this.containers[m].element,!0),this._trigger("change",n,this._uiHash()),this.containers[m]._trigger("change",n,this._uiHash(this)),this.currentContainer=this.containers[m],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[m]._trigger("over",n,this._uiHash(this)),this.containers[m].containerCache.over=1}},_createHelper:function(e){var i=this.options,n=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return n.parents("body").length||t("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(n[0]),n[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!n[0].style.width||i.forceHelperSize)&&n.width(this.currentItem.width()),(!n[0].style.height||i.forceHelperSize)&&n.height(this.currentItem.height()),n},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,n,r=this.options;"parent"===r.containment&&(r.containment=this.helper[0].parentNode),("document"===r.containment||"window"===r.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,t("document"===r.containment?document:window).width()-this.helperProportions.width-this.margins.left,(t("document"===r.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(r.containment)||(e=t(r.containment)[0],i=t(r.containment).offset(),n="hidden"!==t(e).css("overflow"),this.containment=[i.left+(parseInt(t(e).css("borderLeftWidth"),10)||0)+(parseInt(t(e).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(t(e).css("borderTopWidth"),10)||0)+(parseInt(t(e).css("paddingTop"),10)||0)-this.margins.top,i.left+(n?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(t(e).css("borderLeftWidth"),10)||0)-(parseInt(t(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(n?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(t(e).css("borderTopWidth"),10)||0)-(parseInt(t(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(e,i){i||(i=this.position);var n="absolute"===e?1:-1,r="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(r[0].tagName);return{top:i.top+this.offset.relative.top*n+this.offset.parent.top*n-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():o?0:r.scrollTop())*n,left:i.left+this.offset.relative.left*n+this.offset.parent.left*n-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():o?0:r.scrollLeft())*n}},_generatePosition:function(e){var i,n,r=this.options,o=e.pageX,s=e.pageY,a="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=/(html|body)/i.test(a[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(o=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(s=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(o=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(s=this.containment[3]+this.offset.click.top)),r.grid&&(i=this.originalPageY+Math.round((s-this.originalPageY)/r.grid[1])*r.grid[1],s=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-r.grid[1]:i+r.grid[1]:i,n=this.originalPageX+Math.round((o-this.originalPageX)/r.grid[0])*r.grid[0],o=this.containment?n-this.offset.click.left>=this.containment[0]&&n-this.offset.click.left<=this.containment[2]?n:n-this.offset.click.left>=this.containment[0]?n-r.grid[0]:n+r.grid[0]:n)),{top:s-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():l?0:a.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():l?0:a.scrollLeft())}},_rearrange:function(t,e,i,n){i?i[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var r=this.counter;this._delay(function(){r===this.counter&&this.refreshPositions(!n)})},_clear:function(t,e){this.reverting=!1;var i,n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(i in this._storedCSS)("auto"===this._storedCSS[i]||"static"===this._storedCSS[i])&&(this._storedCSS[i]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!e&&n.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||e||n.push(function(t){this._trigger("update",t,this._uiHash())}),this!==this.currentContainer&&(e||(n.push(function(t){this._trigger("remove",t,this._uiHash())}),n.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer)))),i=this.containers.length-1;i>=0;i--)e||n.push(function(t){return function(e){t._trigger("deactivate",e,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over&&(n.push(function(t){return function(e){t._trigger("out",e,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!e){for(this._trigger("beforeStop",t,this._uiHash()),i=0;i<n.length;i++)n[i].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!1}if(e||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!e){for(i=0;i<n.length;i++)n[i].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){t.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(e){var i=e||this;return{helper:i.helper,placeholder:i.placeholder||t([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:e?e.element:null}}})}(jQuery);var I18n=I18n||{};I18n.defaultLocale="en",I18n.locale=I18n.locale||null,I18n.lookup=function(t,e){var i=this.prepareOptions(I18n.translations),n=i[I18n.currentLocale()];if(e=this.prepareOptions(e),n){for("object"==typeof t&&(t=t.join(".")),e.scope&&(t=e.scope.toString()+"."+t),t=t.split(".");t.length>0;){var r=t.shift();if(n=n[r],!n)break}return n||null==e.defaultValue||void 0==e.defaultValue||(n=e.defaultValue),n}},I18n.prepareOptions=function(){for(var t,e={},i=arguments.length,n=0;i>n;n++)if(t=arguments[n])for(var r in t)(void 0==e[r]||null==e[r])&&(e[r]=t[r]);return e},I18n.interpolate=function(t,e){e=e||{};var i=/\{\{(.*?)\}\}/gm,n=t.match(i);if(!n)return t;for(var r,o,s,a=0;r=n[a];a++)s=r.replace(/\{\{(.*?)\}\}/gm,"$1"),o=e[s],(null==e[s]||void 0==e[s])&&(o="[missing "+r+" value]"),i=new RegExp(r.replace(/\{/gm,"\\{").replace(/\}/gm,"\\}")),t=t.replace(i,o);return t},I18n.translate=function(t,e){e=this.prepareOptions(e);var i=this.lookup(t,e);try{return"object"==typeof i?"number"==typeof e.count?this.pluralize(e.count,t,e):i:this.interpolate(i,e)}catch(n){return this.missingTranslation(t)}},I18n.localize=function(t,e){switch(t){case"currency":return this.toCurrency(e);case"number":return t=this.lookup("number.format"),this.toNumber(e,t);default:return t.match(/^(date|time)/)?this.toTime(t,e):e.toString()}},I18n.parseDate=function(t){var e,i;if(e=t.toString().match(/(\d{4})-(\d{2})-(\d{2})(?:[ |T](\d{2}):(\d{2}):(\d{2}))?(Z)?/)){for(var n=1;6>=n;n++)e[n]=void 0==e[n]?0:parseInt(e[n],10);e[2]=e[2]-1,i=e[7]?new Date(Date.UTC(e[1],e[2],e[3],e[4],e[5],e[6])):isNaN(e[4])?new Date(e[1],e[2],e[3]):new Date(e[1],e[2],e[3],e[4],e[5],e[6])}else"number"==typeof t?(i=new Date,i.setTime(t)):(i=new Date,i.setTime(Date.parse(t)));return i},I18n.toTime=function(t,e){var i=this.parseDate(e),n=this.lookup(t);return i.toString().match(/invalid/i)?i.toString():n?this.strftime(i,n):i.toString()},I18n.strftime=function(t,e){var i=this.lookup("date");if(!i)return t.toString();var n=t.getDay(),r=t.getDate(),o=t.getFullYear(),s=t.getMonth()+1,a=t.getHours(),l=a,c=a>12?"PM":"AM",d=t.getSeconds(),h=t.getMinutes(),u=t.getTimezoneOffset(),f=Math.floor(Math.abs(u/60)),p=Math.abs(u)-60*f,m=(u>0?"-":"+")+(f.toString().length<2?"0"+f:f)+(p.toString().length<2?"0"+p:p);l>12&&(l-=12);var g=function(t){var e="0"+t.toString();return e.substr(e.length-2)},v=e;return v=v.replace("%a",i.abbr_day_names[n]),v=v.replace("%A",i.day_names[n]),v=v.replace("%b",i.abbr_month_names[s]),v=v.replace("%B",i.month_names[s]),v=v.replace("%d",g(r)),v=v.replace("%-d",r),v=v.replace("%H",g(a)),v=v.replace("%-H",a),v=v.replace("%I",g(l)),v=v.replace("%-I",l),v=v.replace("%m",g(s)),v=v.replace("%-m",s),v=v.replace("%M",g(h)),v=v.replace("%-M",h),v=v.replace("%p",c),v=v.replace("%S",g(d)),v=v.replace("%-S",d),v=v.replace("%w",n),v=v.replace("%y",g(o)),v=v.replace("%-y",g(o).replace(/^0+/,"")),v=v.replace("%Y",o),v=v.replace("%z",m)},I18n.toNumber=function(t,e){e=this.prepareOptions(e,this.lookup("number.format"),{precision:3,separator:".",delimiter:","});var i=t.toFixed(e.precision).toString(),n=i.split(".");t=n[0],n[1];for(var r=[];t.length>0;)r.unshift(t.substr(Math.max(0,t.length-3),3)),t=t.substr(0,t.length-3);var o=r.join(e.delimiter);return e.precision>0&&(o+=e.separator+n[1]),o},I18n.toCurrency=function(t,e){return e=this.prepareOptions(e,this.lookup("number.currency.format"),this.lookup("number.format"),{unit:"$",precision:2,format:"%u%n",delimiter:",",separator:"."}),t=this.toNumber(t,e),t=e.format.replace("%u",e.unit).replace("%n",t)},I18n.toPercentage=function(t,e){return e=this.prepareOptions(e,this.lookup("number.percentage.format"),this.lookup("number.format"),{precision:3,separator:".",delimiter:""}),t=this.toNumber(t,e),t+"%"},I18n.pluralize=function(t,e,i){var n,r=this.lookup(e,i);switch(i=i||{},i.count=t.toString(),Math.abs(t)){case 0:n=r.zero||r.none||r.other||this.missingTranslation(e,"zero");break;case 1:n=r.one||this.missingTranslation(e,"one");break;default:n=r.other||this.missingTranslation(e,"other")}return this.interpolate(n,i)},I18n.missingTranslation=function(){for(var t='[missing "'+this.currentLocale(),e=arguments.length,i=0;e>i;i++)t+="."+arguments[i];return t+='" translation]'},I18n.currentLocale=function(){return I18n.locale||I18n.defaultLocale},I18n.t=I18n.translate,I18n.l=I18n.localize,I18n.p=I18n.pluralize,I18n.locale="en";var I18n=I18n||{};I18n.translations={},window.bootbox=window.bootbox||function t(e,i){"use strict";function n(t){var e=b[g.locale];return e?e[t]:b.en[t]}function r(t,i,n){t.preventDefault();var r=e.isFunction(n)&&n(t)===!1;r||i.modal("hide")}function o(t){var e,i=0;for(e in t)i++;return i}function s(t,i){var n=0;e.each(t,function(t,e){i(t,e,n++)})}function a(t){var i,n;if("object"!=typeof t)throw new Error("Please supply an object of options");if(!t.message)throw new Error("Please specify a message");return t=e.extend({},g,t),t.buttons||(t.buttons={}),t.backdrop=t.backdrop?"static":!1,i=t.buttons,n=o(i),s(i,function(t,r,o){if(e.isFunction(r)&&(r=i[t]={callback:r}),"object"!==e.type(r))throw new Error("button with key "+t+" must be an object");r.label||(r.label=t),r.className||(r.className=2>=n&&o===n-1?"btn-primary":"btn-default")}),t}function l(t,e){var i=t.length,n={};if(1>i||i>2)throw new Error("Invalid argument length");return 2===i||"string"==typeof t[0]?(n[e[0]]=t[0],n[e[1]]=t[1]):n=t[0],n}function c(t,i,n){return e.extend(!0,{},t,l(i,n))}function d(t,e,i){return f(c(u.apply(null,t),e,i),t)}function h(){for(var t={},e=0,i=arguments.length;i>e;e++){var r=arguments[e],o=r.toLowerCase(),s=r.toUpperCase();t[o]={label:n(s)}}return t}function u(){return{buttons:h.apply(null,arguments)}}function f(t,e){var n={};return s(e,function(t,e){n[e]=!0}),s(t.buttons,function(t){if(n[t]===i)throw new Error("button key "+t+" is not allowed (options are "+e.join("\n")+")")}),t}var p={dialog:"<div class='bootbox modal' tabindex='-1' role='dialog'><div class='modal-dialog'><div class='modal-content'><div class='modal-body'><div class='bootbox-body'></div></div></div></div></div>",header:"<div class='modal-header'><h4 class='modal-title'></h4></div>",footer:"<div class='modal-footer'></div>",closeButton:"<button type='button' class='bootbox-close-button close'>&times;</button>",form:"<form class='bootbox-form'></form>",inputs:{text:"<input class='bootbox-input form-control' autocomplete=off type=text />"}},m=e("body"),g={locale:"en",backdrop:!0,animate:!0,className:null,closeButton:!0,show:!0},v={};v.alert=function(){var t;if(t=d(["ok"],arguments,["message","callback"]),t.callback&&!e.isFunction(t.callback))throw new Error("alert requires callback property to be a function when provided");return t.buttons.ok.callback=t.onEscape=function(){return e.isFunction(t.callback)?t.callback():!0},v.dialog(t)},v.confirm=function(){var t;if(t=d(["cancel","confirm"],arguments,["message","callback"]),t.buttons.cancel.callback=t.onEscape=function(){return t.callback(!1)},t.buttons.confirm.callback=function(){return t.callback(!0)},!e.isFunction(t.callback))throw new Error("confirm requires a callback");return v.dialog(t)},v.prompt=function(){var t,n,r,o,s,a;if(o=e(p.form),n={buttons:h("cancel","confirm"),value:""},t=f(c(n,arguments,["title","callback"]),["cancel","confirm"]),a=t.show===i?!0:t.show,t.message=o,t.buttons.cancel.callback=t.onEscape=function(){return t.callback(null)},t.buttons.confirm.callback=function(){return t.callback(s.val())},t.show=!1,!t.title)throw new Error("prompt requires a title");if(!e.isFunction(t.callback))throw new Error("prompt requires a callback");return s=e(p.inputs.text),s.val(t.value),t.placeholder&&s.attr("placeholder",t.placeholder),o.append(s),o.on("submit",function(t){t.preventDefault(),r.find(".btn-primary").click()}),r=v.dialog(t),r.off("shown.bs.modal"),r.on("shown.bs.modal",function(){s.focus()}),a===!0&&r.modal("show"),r},v.dialog=function(t){t=a(t);var i=e(p.dialog),n=i.find(".modal-body"),o=t.buttons,l="",c={onEscape:t.onEscape};if(s(o,function(t,e){l+="<button data-bb-handler='"+t+"' type='button' class='btn "+e.className+"'>"+e.label+"</button>",c[t]=e.callback}),n.find(".bootbox-body").html(t.message),t.animate===!0&&i.addClass("fade"),t.className&&i.addClass(t.className),t.title&&n.before(p.header),t.closeButton){var d=e(p.closeButton);t.title?i.find(".modal-header").prepend(d):d.css("margin-top","-10px").prependTo(n)}return t.title&&i.find(".modal-title").html(t.title),l.length&&(n.after(p.footer),i.find(".modal-footer").html(l)),i.on("hidden.bs.modal",function(t){t.target===this&&i.remove()}),i.on("shown.bs.modal",function(){i.find(".btn-primary:first").focus()}),i.on("escape.close.bb",function(t){c.onEscape&&r(t,i,c.onEscape)}),i.on("click",".modal-footer button",function(t){var n=e(this).data("bb-handler");r(t,i,c[n])}),i.on("click",".bootbox-close-button",function(t){r(t,i,c.onEscape)}),i.on("keyup",function(t){27===t.which&&i.trigger("escape.close.bb")}),m.append(i),i.modal({backdrop:t.backdrop,keyboard:!1,show:!1}),t.show&&i.modal("show"),i},v.setDefaults=function(t){e.extend(g,t)},v.hideAll=function(){e(".bootbox").modal("hide")};var b={br:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Sim"},da:{OK:"OK",CANCEL:"Annuller",CONFIRM:"Accepter"},de:{OK:"OK",CANCEL:"Abbrechen",CONFIRM:"Akzeptieren"},en:{OK:"OK",CANCEL:"Cancel",CONFIRM:"OK"},es:{OK:"OK",CANCEL:"Cancelar",CONFIRM:"Aceptar"},fi:{OK:"OK",CANCEL:"Peruuta",CONFIRM:"OK"},fr:{OK:"OK",CANCEL:"Annuler",CONFIRM:"D'accord"},it:{OK:"OK",CANCEL:"Annulla",CONFIRM:"Conferma"},nl:{OK:"OK",CANCEL:"Annuleren",CONFIRM:"Accepteren"},no:{OK:"OK",CANCEL:"Avbryt",CONFIRM:"OK"},pl:{OK:"OK",CANCEL:"Anuluj",CONFIRM:"Potwierd"},ru:{OK:"OK",CANCEL:"",CONFIRM:""},zh_CN:{OK:"OK",CANCEL:"",CONFIRM:""},zh_TW:{OK:"OK",CANCEL:"",CONFIRM:""}};
return v.init=function(i){window.bootbox=t(i||e)},v}(window.jQuery);/**
 * @license wysihtml5 v0.3.0
 * https://github.com/xing/wysihtml5
 *
 * Author: Christopher Blum (https://github.com/tiff)
 *
 * Copyright (C) 2012 XING AG
 * Licensed under the MIT license (MIT)
 *
 */
var wysihtml5={version:"0.3.0",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},INVISIBLE_SPACE:"",EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,DELETE_KEY:46};/**
 * @license Rangy, a cross-browser JavaScript range and selection library
 * http://code.google.com/p/rangy/
 *
 * Copyright 2011, Tim Down
 * Licensed under the MIT license.
 * Version: 1.2.2
 * Build date: 13 November 2011
 */
window.rangy=function(){function t(t,e){var i=typeof t[e];return i==h||!(i!=d||!t[e])||"unknown"==i}function e(t,e){return!(typeof t[e]!=d||!t[e])}function i(t,e){return typeof t[e]!=u}function n(t){return function(e,i){for(var n=i.length;n--;)if(!t(e,i[n]))return!1;return!0}}function r(t){return t&&v(t,g)&&y(t,m)}function o(t){window.alert("Rangy not supported in your browser. Reason: "+t),w.initialized=!0,w.supported=!1}function s(t){var e="Rangy warning: "+t;w.config.alertOnWarn?window.alert(e):typeof window.console!=u&&typeof window.console.log!=u&&window.console.log(e)}function a(){if(!w.initialized){var i,n=!1,s=!1;t(document,"createRange")&&(i=document.createRange(),v(i,p)&&y(i,f)&&(n=!0),i.detach());var a=e(document,"body")?document.body:document.getElementsByTagName("body")[0];a&&t(a,"createTextRange")&&(i=a.createTextRange(),r(i)&&(s=!0)),n||s||o("Neither Range nor TextRange are implemented"),w.initialized=!0,w.features={implementsDomRange:n,implementsTextRange:s};for(var l=x.concat(_),c=0,d=l.length;d>c;++c)try{l[c](w)}catch(h){e(window,"console")&&t(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",h)}}}function l(t){t=t||window,a();for(var e=0,i=C.length;i>e;++e)C[e](t)}function c(t){this.name=t,this.initialized=!1,this.supported=!1}var d="object",h="function",u="undefined",f=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"],p=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],m=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],g=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"],v=n(t),b=n(e),y=n(i),w={version:"1.2.2",initialized:!1,supported:!0,util:{isHostMethod:t,isHostObject:e,isHostProperty:i,areHostMethods:v,areHostObjects:b,areHostProperties:y,isTextRange:r},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};w.fail=o,w.warn=s,{}.hasOwnProperty?w.util.extend=function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])}:o("hasOwnProperty not supported");var _=[],x=[];w.init=a,w.addInitListener=function(t){w.initialized?t(w):_.push(t)};var C=[];w.addCreateMissingNativeApiListener=function(t){C.push(t)},w.createMissingNativeApi=l,c.prototype.fail=function(t){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+t)},c.prototype.warn=function(t){w.warn("Module "+this.name+": "+t)},c.prototype.createError=function(t){return new Error("Error in Rangy "+this.name+" module: "+t)},w.createModule=function(t,e){var i=new c(t);w.modules[t]=i,x.push(function(t){e(t,i),i.initialized=!0,i.supported=!0})},w.requireModules=function(t){for(var e,i,n=0,r=t.length;r>n;++n){if(i=t[n],e=w.modules[i],!(e&&e instanceof c))throw new Error("Module '"+i+"' not found");if(!e.supported)throw new Error("Module '"+i+"' not supported")}};var S=!1,k=function(){S||(S=!0,w.initialized||a())};return typeof window==u?(o("No window found"),void 0):typeof document==u?(o("No document found"),void 0):(t(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",k,!1),t(window,"addEventListener")?window.addEventListener("load",k,!1):t(window,"attachEvent")?window.attachEvent("onload",k):o("Window does not have required addEventListener or attachEvent method"),w)}(),rangy.createModule("DomUtil",function(t,e){function i(t){var e;return typeof t.namespaceURI==k||null===(e=t.namespaceURI)||"http://www.w3.org/1999/xhtml"==e}function n(t){var e=t.parentNode;return 1==e.nodeType?e:null}function r(t){for(var e=0;t=t.previousSibling;)e++;return e}function o(t){var e;return c(t)?t.length:(e=t.childNodes)?e.length:0}function s(t,e){var i,n=[];for(i=t;i;i=i.parentNode)n.push(i);for(i=e;i;i=i.parentNode)if(L(n,i))return i;return null}function a(t,e,i){for(var n=i?e:e.parentNode;n;){if(n===t)return!0;n=n.parentNode}return!1}function l(t,e,i){for(var n,r=i?t:t.parentNode;r;){if(n=r.parentNode,n===e)return r;r=n}return null}function c(t){var e=t.nodeType;return 3==e||4==e||8==e}function d(t,e){var i=e.nextSibling,n=e.parentNode;return i?n.insertBefore(t,i):n.appendChild(t),t}function h(t,e){var i=t.cloneNode(!1);return i.deleteData(0,e),t.deleteData(e,t.length-e),d(i,t),i}function u(t){if(9==t.nodeType)return t;if(typeof t.ownerDocument!=k)return t.ownerDocument;if(typeof t.document!=k)return t.document;if(t.parentNode)return u(t.parentNode);throw new Error("getDocument: no document found for node")}function f(t){var e=u(t);if(typeof e.defaultView!=k)return e.defaultView;if(typeof e.parentWindow!=k)return e.parentWindow;throw new Error("Cannot get a window object for node")}function p(t){if(typeof t.contentDocument!=k)return t.contentDocument;if(typeof t.contentWindow!=k)return t.contentWindow.document;throw new Error("getIframeWindow: No Document object found for iframe element")}function m(t){if(typeof t.contentWindow!=k)return t.contentWindow;if(typeof t.contentDocument!=k)return t.contentDocument.defaultView;throw new Error("getIframeWindow: No Window object found for iframe element")}function g(t){return T.isHostObject(t,"body")?t.body:t.getElementsByTagName("body")[0]}function v(t){for(var e;e=t.parentNode;)t=e;return t}function b(t,e,i,n){var o,a,c,d,h;if(t==i)return e===n?0:n>e?-1:1;if(o=l(i,t,!0))return e<=r(o)?-1:1;if(o=l(t,i,!0))return r(o)<n?-1:1;if(a=s(t,i),c=t===a?a:l(t,a,!0),d=i===a?a:l(i,a,!0),c===d)throw new Error("comparePoints got to case 4 and childA and childB are the same!");for(h=a.firstChild;h;){if(h===c)return-1;if(h===d)return 1;h=h.nextSibling}throw new Error("Should not be here!")}function y(t){for(var e,i=u(t).createDocumentFragment();e=t.firstChild;)i.appendChild(e);return i}function w(t){if(!t)return"[No node]";if(c(t))return'"'+t.data+'"';if(1==t.nodeType){var e=t.id?' id="'+t.id+'"':"";return"<"+t.nodeName+e+">["+t.childNodes.length+"]"}return t.nodeName}function _(t){this.root=t,this._next=t}function x(t){return new _(t)}function C(t,e){this.node=t,this.offset=e}function S(t){this.code=this[t],this.codeName=t,this.message="DOMException: "+this.codeName}var k="undefined",T=t.util;T.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||e.fail("document missing a Node creation method"),T.isHostMethod(document,"getElementsByTagName")||e.fail("document missing getElementsByTagName method");var E=document.createElement("div");T.areHostMethods(E,["insertBefore","appendChild","cloneNode"]||!T.areHostObjects(E,["previousSibling","nextSibling","childNodes","parentNode"]))||e.fail("Incomplete Element implementation"),T.isHostProperty(E,"innerHTML")||e.fail("Element is missing innerHTML property");var N=document.createTextNode("test");T.areHostMethods(N,["splitText","deleteData","insertData","appendData","cloneNode"]||!T.areHostObjects(E,["previousSibling","nextSibling","childNodes","parentNode"])||!T.areHostProperties(N,["data"]))||e.fail("Incomplete Text Node implementation");var L=function(t,e){for(var i=t.length;i--;)if(t[i]===e)return!0;return!1};_.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var t,e,i=this._current=this._next;if(this._current)if(t=i.firstChild)this._next=t;else{for(e=null;i!==this.root&&!(e=i.nextSibling);)i=i.parentNode;this._next=e}return this._current},detach:function(){this._current=this._next=this.root=null}},C.prototype={equals:function(t){return this.node===t.node&this.offset==t.offset},inspect:function(){return"[DomPosition("+w(this.node)+":"+this.offset+")]"}},S.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},S.prototype.toString=function(){return this.message},t.dom={arrayContains:L,isHtmlNamespace:i,parentElement:n,getNodeIndex:r,getNodeLength:o,getCommonAncestor:s,isAncestorOf:a,getClosestAncestorIn:l,isCharacterDataNode:c,insertAfter:d,splitDataNode:h,getDocument:u,getWindow:f,getIframeWindow:m,getIframeDocument:p,getBody:g,getRootContainer:v,comparePoints:b,inspectNode:w,fragmentFromNodeChildren:y,createIterator:x,DomPosition:C},t.DOMException=S}),rangy.createModule("DomRange",function(t){function e(t,e){return 3!=t.nodeType&&(M.isAncestorOf(t,e.startContainer,!0)||M.isAncestorOf(t,e.endContainer,!0))}function i(t){return M.getDocument(t.startContainer)}function n(t,e,i){var n=t._listeners[e];if(n)for(var r=0,o=n.length;o>r;++r)n[r].call(t,{target:t,args:i})}function r(t){return new H(t.parentNode,M.getNodeIndex(t))}function o(t){return new H(t.parentNode,M.getNodeIndex(t)+1)}function s(t,e,i){var n=11==t.nodeType?t.firstChild:t;return M.isCharacterDataNode(e)?i==e.length?M.insertAfter(t,e):e.parentNode.insertBefore(t,0==i?e:M.splitDataNode(e,i)):i>=e.childNodes.length?e.appendChild(t):e.insertBefore(t,e.childNodes[i]),n}function a(t){for(var e,n,r,o=i(t.range).createDocumentFragment();n=t.next();){if(e=t.isPartiallySelectedSubtree(),n=n.cloneNode(!e),e&&(r=t.getSubtreeIterator(),n.appendChild(a(r)),r.detach(!0)),10==n.nodeType)throw new $("HIERARCHY_REQUEST_ERR");o.appendChild(n)}return o}function l(t,e,i){var n,r;i=i||{stop:!1};for(var o,s;o=t.next();)if(t.isPartiallySelectedSubtree()){if(e(o)===!1)return i.stop=!0,void 0;if(s=t.getSubtreeIterator(),l(s,e,i),s.detach(!0),i.stop)return}else for(n=M.createIterator(o);r=n.next();)if(e(r)===!1)return i.stop=!0,void 0}function c(t){for(var e;t.next();)t.isPartiallySelectedSubtree()?(e=t.getSubtreeIterator(),c(e),e.detach(!0)):t.remove()}function d(t){for(var e,n,r=i(t.range).createDocumentFragment();e=t.next();){if(t.isPartiallySelectedSubtree()?(e=e.cloneNode(!1),n=t.getSubtreeIterator(),e.appendChild(d(n)),n.detach(!0)):t.remove(),10==e.nodeType)throw new $("HIERARCHY_REQUEST_ERR");r.appendChild(e)}return r}function h(t,e,i){var n,r=!(!e||!e.length),o=!!i;r&&(n=new RegExp("^("+e.join("|")+")$"));var s=[];return l(new f(t,!1),function(t){r&&!n.test(t.nodeType)||o&&!i(t)||s.push(t)}),s}function u(t){var e="undefined"==typeof t.getName?"Range":t.getName();return"["+e+"("+M.inspectNode(t.startContainer)+":"+t.startOffset+", "+M.inspectNode(t.endContainer)+":"+t.endOffset+")]"}function f(t,e){if(this.range=t,this.clonePartiallySelectedTextNodes=e,!t.collapsed){this.sc=t.startContainer,this.so=t.startOffset,this.ec=t.endContainer,this.eo=t.endOffset;var i=t.commonAncestorContainer;this.sc===this.ec&&M.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==i||M.isCharacterDataNode(this.sc)?M.getClosestAncestorIn(this.sc,i,!0):this.sc.childNodes[this.so],this._last=this.ec!==i||M.isCharacterDataNode(this.ec)?M.getClosestAncestorIn(this.ec,i,!0):this.ec.childNodes[this.eo-1])}}function p(t){this.code=this[t],this.codeName=t,this.message="RangeException: "+this.codeName}function m(t,e,i){this.nodes=h(t,e,i),this._next=this.nodes[0],this._position=0}function g(t){return function(e,i){for(var n,r=i?e:e.parentNode;r;){if(n=r.nodeType,M.arrayContains(t,n))return r;r=r.parentNode}return null}}function v(t,e){if(K(t,e))throw new p("INVALID_NODE_TYPE_ERR")}function b(t){if(!t.startContainer)throw new $("INVALID_STATE_ERR")}function y(t,e){if(!M.arrayContains(e,t.nodeType))throw new p("INVALID_NODE_TYPE_ERR")}function w(t,e){if(0>e||e>(M.isCharacterDataNode(t)?t.length:t.childNodes.length))throw new $("INDEX_SIZE_ERR")}function _(t,e){if(q(t,!0)!==q(e,!0))throw new $("WRONG_DOCUMENT_ERR")}function x(t){if(V(t,!0))throw new $("NO_MODIFICATION_ALLOWED_ERR")}function C(t,e){if(!t)throw new $(e)}function S(t){return!M.arrayContains(W,t.nodeType)&&!q(t,!0)}function k(t,e){return e<=(M.isCharacterDataNode(t)?t.length:t.childNodes.length)}function T(t){if(b(t),S(t.startContainer)||S(t.endContainer)||!k(t.startContainer,t.startOffset)||!k(t.endContainer,t.endOffset))throw new Error("Range error: Range is no longer valid after DOM mutation ("+t.inspect()+")")}function E(){}function N(t){t.START_TO_START=J,t.START_TO_END=te,t.END_TO_END=ee,t.END_TO_START=ie,t.NODE_BEFORE=ne,t.NODE_AFTER=re,t.NODE_BEFORE_AND_AFTER=oe,t.NODE_INSIDE=se}function L(t){N(t),N(t.prototype)}function I(t,e){return function(){T(this);var i,n,r=this.startContainer,s=this.startOffset,a=this.commonAncestorContainer,c=new f(this,!0);r!==a&&(i=M.getClosestAncestorIn(r,a,!0),n=o(i),r=n.node,s=n.offset),l(c,x),c.reset();var d=t(c);return c.detach(),e(this,r,s,r,s),d}}function R(i,n,s){function a(t,e){return function(i){b(this),y(i,z),y(U(i),W);var n=(t?r:o)(i);(e?l:h)(this,n.node,n.offset)}}function l(t,e,i){var r=t.endContainer,o=t.endOffset;(e!==t.startContainer||i!==t.startOffset)&&((U(e)!=U(r)||1==M.comparePoints(e,i,r,o))&&(r=e,o=i),n(t,e,i,r,o))}function h(t,e,i){var r=t.startContainer,o=t.startOffset;(e!==t.endContainer||i!==t.endOffset)&&((U(e)!=U(r)||-1==M.comparePoints(e,i,r,o))&&(r=e,o=i),n(t,r,o,e,i))}function u(t,e,i){(e!==t.startContainer||i!==t.startOffset||e!==t.endContainer||i!==t.endOffset)&&n(t,e,i,e,i)}i.prototype=new E,t.util.extend(i.prototype,{setStart:function(t,e){b(this),v(t,!0),w(t,e),l(this,t,e)},setEnd:function(t,e){b(this),v(t,!0),w(t,e),h(this,t,e)},setStartBefore:a(!0,!0),setStartAfter:a(!1,!0),setEndBefore:a(!0,!1),setEndAfter:a(!1,!1),collapse:function(t){T(this),t?n(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):n(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(t){b(this),v(t,!0),n(this,t,0,t,M.getNodeLength(t))},selectNode:function(t){b(this),v(t,!1),y(t,z);var e=r(t),i=o(t);n(this,e.node,e.offset,i.node,i.offset)},extractContents:I(d,n),deleteContents:I(c,n),canSurroundContents:function(){T(this),x(this.startContainer),x(this.endContainer);var t=new f(this,!0),i=t._first&&e(t._first,this)||t._last&&e(t._last,this);return t.detach(),!i},detach:function(){s(this)},splitBoundaries:function(){T(this);var t=this.startContainer,e=this.startOffset,i=this.endContainer,r=this.endOffset,o=t===i;M.isCharacterDataNode(i)&&r>0&&r<i.length&&M.splitDataNode(i,r),M.isCharacterDataNode(t)&&e>0&&e<t.length&&(t=M.splitDataNode(t,e),o?(r-=e,i=t):i==t.parentNode&&r>=M.getNodeIndex(t)&&r++,e=0),n(this,t,e,i,r)},normalizeBoundaries:function(){T(this);var t=this.startContainer,e=this.startOffset,i=this.endContainer,r=this.endOffset,o=function(t){var e=t.nextSibling;e&&e.nodeType==t.nodeType&&(i=t,r=t.length,t.appendData(e.data),e.parentNode.removeChild(e))},s=function(n){var o=n.previousSibling;if(o&&o.nodeType==n.nodeType){t=n;var s=n.length;if(e=o.length,n.insertData(0,o.data),o.parentNode.removeChild(o),t==i)r+=e,i=t;else if(i==n.parentNode){var a=M.getNodeIndex(n);r==a?(i=n,r=s):r>a&&r--}}},a=!0;if(M.isCharacterDataNode(i))i.length==r&&o(i);else{if(r>0){var l=i.childNodes[r-1];l&&M.isCharacterDataNode(l)&&o(l)}a=!this.collapsed}if(a){if(M.isCharacterDataNode(t))0==e&&s(t);else if(e<t.childNodes.length){var c=t.childNodes[e];c&&M.isCharacterDataNode(c)&&s(c)}}else t=i,e=r;n(this,t,e,i,r)},collapseToPoint:function(t,e){b(this),v(t,!0),w(t,e),u(this,t,e)}}),L(i)}function A(t){t.collapsed=t.startContainer===t.endContainer&&t.startOffset===t.endOffset,t.commonAncestorContainer=t.collapsed?t.startContainer:M.getCommonAncestor(t.startContainer,t.endContainer)}function D(t,e,i,r,o){var s=t.startContainer!==e||t.startOffset!==i,a=t.endContainer!==r||t.endOffset!==o;t.startContainer=e,t.startOffset=i,t.endContainer=r,t.endOffset=o,A(t),n(t,"boundarychange",{startMoved:s,endMoved:a})}function O(t){b(t),t.startContainer=t.startOffset=t.endContainer=t.endOffset=null,t.collapsed=t.commonAncestorContainer=null,n(t,"detach",null),t._listeners=null}function P(t){this.startContainer=t,this.startOffset=0,this.endContainer=t,this.endOffset=0,this._listeners={boundarychange:[],detach:[]},A(this)}t.requireModules(["DomUtil"]);var M=t.dom,H=M.DomPosition,$=t.DOMException;f.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var t=this._current=this._next;return t&&(this._next=t!==this._last?t.nextSibling:null,M.isCharacterDataNode(t)&&this.clonePartiallySelectedTextNodes&&(t===this.ec&&(t=t.cloneNode(!0)).deleteData(this.eo,t.length-this.eo),this._current===this.sc&&(t=t.cloneNode(!0)).deleteData(0,this.so))),t},remove:function(){var t,e,i=this._current;!M.isCharacterDataNode(i)||i!==this.sc&&i!==this.ec?i.parentNode&&i.parentNode.removeChild(i):(t=i===this.sc?this.so:0,e=i===this.ec?this.eo:i.length,t!=e&&i.deleteData(t,e-t))},isPartiallySelectedSubtree:function(){var t=this._current;return e(t,this.range)},getSubtreeIterator:function(){var t;if(this.isSingleCharacterDataNode)t=this.range.cloneRange(),t.collapse();else{t=new P(i(this.range));var e=this._current,n=e,r=0,o=e,s=M.getNodeLength(e);M.isAncestorOf(e,this.sc,!0)&&(n=this.sc,r=this.so),M.isAncestorOf(e,this.ec,!0)&&(o=this.ec,s=this.eo),D(t,n,r,o,s)}return new f(t,this.clonePartiallySelectedTextNodes)},detach:function(t){t&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},p.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},p.prototype.toString=function(){return this.message},m.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){return this._current=this._next,this._next=this.nodes[++this._position],this._current},detach:function(){this._current=this._next=this.nodes=null}};var z=[1,3,4,5,7,8,10],W=[2,9,11],B=[5,6,10,12],j=[1,3,4,5,7,8,10,11],F=[1,3,4,5,7,8],U=M.getRootContainer,q=g([9,11]),V=g(B),K=g([6,10,12]),Q=document.createElement("style"),X=!1;try{Q.innerHTML="<b>x</b>",X=3==Q.firstChild.nodeType}catch(G){}t.features.htmlParsingConforms=X;var Y=X?function(t){var e=this.startContainer,i=M.getDocument(e);if(!e)throw new $("INVALID_STATE_ERR");var n=null;return 1==e.nodeType?n=e:M.isCharacterDataNode(e)&&(n=M.parentElement(e)),n=null===n||"HTML"==n.nodeName&&M.isHtmlNamespace(M.getDocument(n).documentElement)&&M.isHtmlNamespace(n)?i.createElement("body"):n.cloneNode(!1),n.innerHTML=t,M.fragmentFromNodeChildren(n)}:function(t){b(this);var e=i(this),n=e.createElement("body");return n.innerHTML=t,M.fragmentFromNodeChildren(n)},Z=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],J=0,te=1,ee=2,ie=3,ne=0,re=1,oe=2,se=3;E.prototype={attachListener:function(t,e){this._listeners[t].push(e)},compareBoundaryPoints:function(t,e){T(this),_(this.startContainer,e.startContainer);var i,n,r,o,s=t==ie||t==J?"start":"end",a=t==te||t==J?"start":"end";return i=this[s+"Container"],n=this[s+"Offset"],r=e[a+"Container"],o=e[a+"Offset"],M.comparePoints(i,n,r,o)},insertNode:function(t){if(T(this),y(t,j),x(this.startContainer),M.isAncestorOf(t,this.startContainer,!0))throw new $("HIERARCHY_REQUEST_ERR");var e=s(t,this.startContainer,this.startOffset);this.setStartBefore(e)},cloneContents:function(){T(this);var t,e;if(this.collapsed)return i(this).createDocumentFragment();if(this.startContainer===this.endContainer&&M.isCharacterDataNode(this.startContainer))return t=this.startContainer.cloneNode(!0),t.data=t.data.slice(this.startOffset,this.endOffset),e=i(this).createDocumentFragment(),e.appendChild(t),e;var n=new f(this,!0);return t=a(n),n.detach(),t},canSurroundContents:function(){T(this),x(this.startContainer),x(this.endContainer);var t=new f(this,!0),i=t._first&&e(t._first,this)||t._last&&e(t._last,this);return t.detach(),!i},surroundContents:function(t){if(y(t,F),!this.canSurroundContents())throw new p("BAD_BOUNDARYPOINTS_ERR");var e=this.extractContents();if(t.hasChildNodes())for(;t.lastChild;)t.removeChild(t.lastChild);s(t,this.startContainer,this.startOffset),t.appendChild(e),this.selectNode(t)},cloneRange:function(){T(this);for(var t,e=new P(i(this)),n=Z.length;n--;)t=Z[n],e[t]=this[t];return e},toString:function(){T(this);var t=this.startContainer;if(t===this.endContainer&&M.isCharacterDataNode(t))return 3==t.nodeType||4==t.nodeType?t.data.slice(this.startOffset,this.endOffset):"";var e=[],i=new f(this,!0);return l(i,function(t){(3==t.nodeType||4==t.nodeType)&&e.push(t.data)}),i.detach(),e.join("")},compareNode:function(t){T(this);var e=t.parentNode,i=M.getNodeIndex(t);if(!e)throw new $("NOT_FOUND_ERR");var n=this.comparePoint(e,i),r=this.comparePoint(e,i+1);return 0>n?r>0?oe:ne:r>0?re:se},comparePoint:function(t,e){return T(this),C(t,"HIERARCHY_REQUEST_ERR"),_(t,this.startContainer),M.comparePoints(t,e,this.startContainer,this.startOffset)<0?-1:M.comparePoints(t,e,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:Y,toHtml:function(){T(this);var t=i(this).createElement("div");return t.appendChild(this.cloneContents()),t.innerHTML},intersectsNode:function(t,e){if(T(this),C(t,"NOT_FOUND_ERR"),M.getDocument(t)!==i(this))return!1;var n=t.parentNode,r=M.getNodeIndex(t);C(n,"NOT_FOUND_ERR");var o=M.comparePoints(n,r,this.endContainer,this.endOffset),s=M.comparePoints(n,r+1,this.startContainer,this.startOffset);return e?0>=o&&s>=0:0>o&&s>0},isPointInRange:function(t,e){return T(this),C(t,"HIERARCHY_REQUEST_ERR"),_(t,this.startContainer),M.comparePoints(t,e,this.startContainer,this.startOffset)>=0&&M.comparePoints(t,e,this.endContainer,this.endOffset)<=0},intersectsRange:function(t,e){if(T(this),i(t)!=i(this))throw new $("WRONG_DOCUMENT_ERR");var n=M.comparePoints(this.startContainer,this.startOffset,t.endContainer,t.endOffset),r=M.comparePoints(this.endContainer,this.endOffset,t.startContainer,t.startOffset);return e?0>=n&&r>=0:0>n&&r>0},intersection:function(t){if(this.intersectsRange(t)){var e=M.comparePoints(this.startContainer,this.startOffset,t.startContainer,t.startOffset),i=M.comparePoints(this.endContainer,this.endOffset,t.endContainer,t.endOffset),n=this.cloneRange();return-1==e&&n.setStart(t.startContainer,t.startOffset),1==i&&n.setEnd(t.endContainer,t.endOffset),n}return null},union:function(t){if(this.intersectsRange(t,!0)){var e=this.cloneRange();return-1==M.comparePoints(t.startContainer,t.startOffset,this.startContainer,this.startOffset)&&e.setStart(t.startContainer,t.startOffset),1==M.comparePoints(t.endContainer,t.endOffset,this.endContainer,this.endOffset)&&e.setEnd(t.endContainer,t.endOffset),e}throw new p("Ranges do not intersect")},containsNode:function(t,e){return e?this.intersectsNode(t,!1):this.compareNode(t)==se},containsNodeContents:function(t){return this.comparePoint(t,0)>=0&&this.comparePoint(t,M.getNodeLength(t))<=0},containsRange:function(t){return this.intersection(t).equals(t)},containsNodeText:function(t){var e=this.cloneRange();e.selectNode(t);var i=e.getNodes([3]);if(i.length>0){e.setStart(i[0],0);var n=i.pop();e.setEnd(n,n.length);var r=this.containsRange(e);return e.detach(),r}return this.containsNodeContents(t)},createNodeIterator:function(t,e){return T(this),new m(this,t,e)},getNodes:function(t,e){return T(this),h(this,t,e)},getDocument:function(){return i(this)},collapseBefore:function(t){b(this),this.setEndBefore(t),this.collapse(!1)},collapseAfter:function(t){b(this),this.setStartAfter(t),this.collapse(!0)},getName:function(){return"DomRange"},equals:function(t){return P.rangesEqual(this,t)},inspect:function(){return u(this)}},R(P,D,O),t.rangePrototype=E.prototype,P.rangeProperties=Z,P.RangeIterator=f,P.copyComparisonConstants=L,P.createPrototypeRange=R,P.inspect=u,P.getRangeDocument=i,P.rangesEqual=function(t,e){return t.startContainer===e.startContainer&&t.startOffset===e.startOffset&&t.endContainer===e.endContainer&&t.endOffset===e.endOffset},t.DomRange=P,t.RangeException=p}),rangy.createModule("WrappedRange",function(t){function e(t){var e=t.parentElement(),i=t.duplicate();i.collapse(!0);var n=i.parentElement();i=t.duplicate(),i.collapse(!1);var r=i.parentElement(),o=n==r?n:s.getCommonAncestor(n,r);return o==e?o:s.getCommonAncestor(e,o)}function i(t){return 0==t.compareEndPoints("StartToEnd",t)}function n(t,e,i,n){var r=t.duplicate();r.collapse(i);var o=r.parentElement();if(s.isAncestorOf(e,o,!0)||(o=e),!o.canHaveHTML)return new a(o.parentNode,s.getNodeIndex(o));var l,c,d,h,u,f=s.getDocument(o).createElement("span"),p=i?"StartToStart":"StartToEnd";do o.insertBefore(f,f.previousSibling),r.moveToElementText(f);while((l=r.compareEndPoints(p,t))>0&&f.previousSibling);if(u=f.nextSibling,-1==l&&u&&s.isCharacterDataNode(u)){r.setEndPoint(i?"EndToStart":"EndToEnd",t);var m;if(/[\r\n]/.test(u.data)){var g=r.duplicate(),v=g.text.replace(/\r\n/g,"\r").length;for(m=g.moveStart("character",v);-1==(l=g.compareEndPoints("StartToEnd",g));)m++,g.moveStart("character",1)}else m=r.text.length;h=new a(u,m)}else c=(n||!i)&&f.previousSibling,d=(n||i)&&f.nextSibling,h=d&&s.isCharacterDataNode(d)?new a(d,0):c&&s.isCharacterDataNode(c)?new a(c,c.length):new a(o,s.getNodeIndex(f));return f.parentNode.removeChild(f),h}function r(t,e){var i,n,r,o,a=t.offset,l=s.getDocument(t.node),c=l.body.createTextRange(),d=s.isCharacterDataNode(t.node);return d?(i=t.node,n=i.parentNode):(o=t.node.childNodes,i=a<o.length?o[a]:null,n=t.node),r=l.createElement("span"),r.innerHTML="&#feff;",i?n.insertBefore(r,i):n.appendChild(r),c.moveToElementText(r),c.collapse(!e),n.removeChild(r),d&&c[e?"moveStart":"moveEnd"]("character",a),c}t.requireModules(["DomUtil","DomRange"]);var o,s=t.dom,a=s.DomPosition,l=t.DomRange;if(!t.features.implementsDomRange||t.features.implementsTextRange&&t.config.preferTextRange){if(t.features.implementsTextRange){o=function(t){this.textRange=t,this.refresh()},o.prototype=new l(document),o.prototype.refresh=function(){var t,r,o=e(this.textRange);i(this.textRange)?r=t=n(this.textRange,o,!0,!0):(t=n(this.textRange,o,!0,!1),r=n(this.textRange,o,!1,!1)),this.setStart(t.node,t.offset),this.setEnd(r.node,r.offset)},l.copyComparisonConstants(o);var c=function(){return this}();"undefined"==typeof c.Range&&(c.Range=o),t.createNativeRange=function(t){return t=t||document,t.body.createTextRange()}}}else!function(){function e(t){for(var e,i=d.length;i--;)e=d[i],t[e]=t.nativeRange[e]}function i(t,e,i,n,r){var o=t.startContainer!==e||t.startOffset!=i,s=t.endContainer!==n||t.endOffset!=r;(o||s)&&(t.setEnd(n,r),t.setStart(e,i))}function n(t){t.nativeRange.detach(),t.detached=!0;for(var e,i=d.length;i--;)e=d[i],t[e]=null}var r,a,c,d=l.rangeProperties;o=function(t){if(!t)throw new Error("Range must be specified");this.nativeRange=t,e(this)},l.createPrototypeRange(o,i,n),r=o.prototype,r.selectNode=function(t){this.nativeRange.selectNode(t),e(this)},r.deleteContents=function(){this.nativeRange.deleteContents(),e(this)},r.extractContents=function(){var t=this.nativeRange.extractContents();return e(this),t},r.cloneContents=function(){return this.nativeRange.cloneContents()},r.surroundContents=function(t){this.nativeRange.surroundContents(t),e(this)},r.collapse=function(t){this.nativeRange.collapse(t),e(this)},r.cloneRange=function(){return new o(this.nativeRange.cloneRange())},r.refresh=function(){e(this)},r.toString=function(){return this.nativeRange.toString()};var h=document.createTextNode("test");s.getBody(document).appendChild(h);var u=document.createRange();u.setStart(h,0),u.setEnd(h,0);try{u.setStart(h,1),a=!0,r.setStart=function(t,i){this.nativeRange.setStart(t,i),e(this)},r.setEnd=function(t,i){this.nativeRange.setEnd(t,i),e(this)},c=function(t){return function(i){this.nativeRange[t](i),e(this)}}}catch(f){a=!1,r.setStart=function(t,i){try{this.nativeRange.setStart(t,i)}catch(n){this.nativeRange.setEnd(t,i),this.nativeRange.setStart(t,i)}e(this)},r.setEnd=function(t,i){try{this.nativeRange.setEnd(t,i)}catch(n){this.nativeRange.setStart(t,i),this.nativeRange.setEnd(t,i)}e(this)},c=function(t,i){return function(n){try{this.nativeRange[t](n)}catch(r){this.nativeRange[i](n),this.nativeRange[t](n)}e(this)}}}r.setStartBefore=c("setStartBefore","setEndBefore"),r.setStartAfter=c("setStartAfter","setEndAfter"),r.setEndBefore=c("setEndBefore","setStartBefore"),r.setEndAfter=c("setEndAfter","setStartAfter"),u.selectNodeContents(h),r.selectNodeContents=u.startContainer==h&&u.endContainer==h&&0==u.startOffset&&u.endOffset==h.length?function(t){this.nativeRange.selectNodeContents(t),e(this)}:function(t){this.setStart(t,0),this.setEnd(t,l.getEndOffset(t))},u.selectNodeContents(h),u.setEnd(h,3);var p=document.createRange();p.selectNodeContents(h),p.setEnd(h,4),p.setStart(h,2),r.compareBoundaryPoints=-1==u.compareBoundaryPoints(u.START_TO_END,p)&1==u.compareBoundaryPoints(u.END_TO_START,p)?function(t,e){return e=e.nativeRange||e,t==e.START_TO_END?t=e.END_TO_START:t==e.END_TO_START&&(t=e.START_TO_END),this.nativeRange.compareBoundaryPoints(t,e)}:function(t,e){return this.nativeRange.compareBoundaryPoints(t,e.nativeRange||e)},t.util.isHostMethod(u,"createContextualFragment")&&(r.createContextualFragment=function(t){return this.nativeRange.createContextualFragment(t)}),s.getBody(document).removeChild(h),u.detach(),p.detach()}(),t.createNativeRange=function(t){return t=t||document,t.createRange()};t.features.implementsTextRange&&(o.rangeToTextRange=function(t){if(t.collapsed){var e=r(new a(t.startContainer,t.startOffset),!0);return e}var i=r(new a(t.startContainer,t.startOffset),!0),n=r(new a(t.endContainer,t.endOffset),!1),o=s.getDocument(t.startContainer).body.createTextRange();return o.setEndPoint("StartToStart",i),o.setEndPoint("EndToEnd",n),o}),o.prototype.getName=function(){return"WrappedRange"},t.WrappedRange=o,t.createRange=function(e){return e=e||document,new o(t.createNativeRange(e))},t.createRangyRange=function(t){return t=t||document,new l(t)},t.createIframeRange=function(e){return t.createRange(s.getIframeDocument(e))},t.createIframeRangyRange=function(e){return t.createRangyRange(s.getIframeDocument(e))},t.addCreateMissingNativeApiListener(function(e){var i=e.document;"undefined"==typeof i.createRange&&(i.createRange=function(){return t.createRange(this)}),i=e=null})}),rangy.createModule("WrappedSelection",function(t,e){function i(t){return(t||window).getSelection()}function n(t){return(t||window).document.selection}function r(t,e,i){var n=i?"end":"start",r=i?"start":"end";t.anchorNode=e[n+"Container"],t.anchorOffset=e[n+"Offset"],t.focusNode=e[r+"Container"],t.focusOffset=e[r+"Offset"]}function o(t){var e=t.nativeSelection;t.anchorNode=e.anchorNode,t.anchorOffset=e.anchorOffset,t.focusNode=e.focusNode,t.focusOffset=e.focusOffset}function s(t){t.anchorNode=t.focusNode=null,t.anchorOffset=t.focusOffset=0,t.rangeCount=0,t.isCollapsed=!0,t._ranges.length=0}function a(e){var i;return e instanceof S?(i=e._selectionNativeRange,i||(i=t.createNativeRange(x.getDocument(e.startContainer)),i.setEnd(e.endContainer,e.endOffset),i.setStart(e.startContainer,e.startOffset),e._selectionNativeRange=i,e.attachListener("detach",function(){this._selectionNativeRange=null}))):e instanceof k?i=e.nativeRange:t.features.implementsDomRange&&e instanceof x.getWindow(e.startContainer).Range&&(i=e),i}function l(t){if(!t.length||1!=t[0].nodeType)return!1;for(var e=1,i=t.length;i>e;++e)if(!x.isAncestorOf(t[0],t[e]))return!1;return!0}function c(t){var e=t.getNodes();if(!l(e))throw new Error("getSingleElementFromRange: range "+t.inspect()+" did not consist of a single element");return e[0]}function d(t){return!!t&&"undefined"!=typeof t.text}function h(t,e){var i=new k(e);t._ranges=[i],r(t,i,!1),t.rangeCount=1,t.isCollapsed=i.collapsed}function u(e){if(e._ranges.length=0,"None"==e.docSelection.type)s(e);else{var i=e.docSelection.createRange();if(d(i))h(e,i);else{e.rangeCount=i.length;for(var n,o=x.getDocument(i.item(0)),a=0;a<e.rangeCount;++a)n=t.createRange(o),n.selectNode(i.item(a)),e._ranges.push(n);e.isCollapsed=1==e.rangeCount&&e._ranges[0].collapsed,r(e,e._ranges[e.rangeCount-1],!1)}}}function f(t,e){for(var i=t.docSelection.createRange(),n=c(e),r=x.getDocument(i.item(0)),o=x.getBody(r).createControlRange(),s=0,a=i.length;a>s;++s)o.add(i.item(s));try{o.add(n)}catch(l){throw new Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}o.select(),u(t)}function p(t,e,i){this.nativeSelection=t,this.docSelection=e,this._ranges=[],this.win=i,this.refresh()}function m(t,e){for(var i,n=x.getDocument(e[0].startContainer),r=x.getBody(n).createControlRange(),o=0;rangeCount>o;++o){i=c(e[o]);try{r.add(i)}catch(s){throw new Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")
}}r.select(),u(t)}function g(t,e){if(t.anchorNode&&x.getDocument(t.anchorNode)!==x.getDocument(e))throw new T("WRONG_DOCUMENT_ERR")}function v(t){var e=[],i=new E(t.anchorNode,t.anchorOffset),n=new E(t.focusNode,t.focusOffset),r="function"==typeof t.getName?t.getName():"Selection";if("undefined"!=typeof t.rangeCount)for(var o=0,s=t.rangeCount;s>o;++o)e[o]=S.inspect(t.getRangeAt(o));return"["+r+"(Ranges: "+e.join(", ")+")(anchor: "+i.inspect()+", focus: "+n.inspect()+"]"}t.requireModules(["DomUtil","DomRange","WrappedRange"]),t.config.checkSelectionRanges=!0;var b,y,w="boolean",_="_rangySelection",x=t.dom,C=t.util,S=t.DomRange,k=t.WrappedRange,T=t.DOMException,E=x.DomPosition,N="Control",L=t.util.isHostMethod(window,"getSelection"),I=t.util.isHostObject(document,"selection"),R=I&&(!L||t.config.preferTextRange);R?(b=n,t.isSelectionValid=function(t){var e=(t||window).document,i=e.selection;return"None"!=i.type||x.getDocument(i.createRange().parentElement())==e}):L?(b=i,t.isSelectionValid=function(){return!0}):e.fail("Neither document.selection or window.getSelection() detected."),t.getNativeSelection=b;var A=b(),D=t.createNativeRange(document),O=x.getBody(document),P=C.areHostObjects(A,["anchorNode","focusNode"]&&C.areHostProperties(A,["anchorOffset","focusOffset"]));t.features.selectionHasAnchorAndFocus=P;var M=C.isHostMethod(A,"extend");t.features.selectionHasExtend=M;var H="number"==typeof A.rangeCount;t.features.selectionHasRangeCount=H;var $=!1,z=!0;C.areHostMethods(A,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof A.rangeCount&&t.features.implementsDomRange&&!function(){var t=document.createElement("iframe");O.appendChild(t);var e=x.getIframeDocument(t);e.open(),e.write("<html><head></head><body>12</body></html>"),e.close();var i=x.getIframeWindow(t).getSelection(),n=e.documentElement,r=n.lastChild,o=r.firstChild,s=e.createRange();s.setStart(o,1),s.collapse(!0),i.addRange(s),z=1==i.rangeCount,i.removeAllRanges();var a=s.cloneRange();s.setStart(o,0),a.setEnd(o,2),i.addRange(s),i.addRange(a),$=2==i.rangeCount,s.detach(),a.detach(),O.removeChild(t)}(),t.features.selectionSupportsMultipleRanges=$,t.features.collapsedNonEditableSelectionsSupported=z;var W,B=!1;O&&C.isHostMethod(O,"createControlRange")&&(W=O.createControlRange(),C.areHostProperties(W,["item","add"])&&(B=!0)),t.features.implementsControlRange=B,y=P?function(t){return t.anchorNode===t.focusNode&&t.anchorOffset===t.focusOffset}:function(t){return t.rangeCount?t.getRangeAt(t.rangeCount-1).collapsed:!1};var j;C.isHostMethod(A,"getRangeAt")?j=function(t,e){try{return t.getRangeAt(e)}catch(i){return null}}:P&&(j=function(e){var i=x.getDocument(e.anchorNode),n=t.createRange(i);return n.setStart(e.anchorNode,e.anchorOffset),n.setEnd(e.focusNode,e.focusOffset),n.collapsed!==this.isCollapsed&&(n.setStart(e.focusNode,e.focusOffset),n.setEnd(e.anchorNode,e.anchorOffset)),n}),t.getSelection=function(t){t=t||window;var e=t[_],i=b(t),r=I?n(t):null;return e?(e.nativeSelection=i,e.docSelection=r,e.refresh(t)):(e=new p(i,r,t),t[_]=e),e},t.getIframeSelection=function(e){return t.getSelection(x.getIframeWindow(e))};var F=p.prototype;if(!R&&P&&C.areHostMethods(A,["removeAllRanges","addRange"])){F.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),s(this)};var U=function(e,i){var n=S.getRangeDocument(i),r=t.createRange(n);r.collapseToPoint(i.endContainer,i.endOffset),e.nativeSelection.addRange(a(r)),e.nativeSelection.extend(i.startContainer,i.startOffset),e.refresh()};F.addRange=H?function(e,i){if(B&&I&&this.docSelection.type==N)f(this,e);else if(i&&M)U(this,e);else{var n;if($?n=this.rangeCount:(this.removeAllRanges(),n=0),this.nativeSelection.addRange(a(e)),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==n+1){if(t.config.checkSelectionRanges){var o=j(this.nativeSelection,this.rangeCount-1);o&&!S.rangesEqual(o,e)&&(e=new k(o))}this._ranges[this.rangeCount-1]=e,r(this,e,K(this.nativeSelection)),this.isCollapsed=y(this)}else this.refresh()}}:function(t,e){e&&M?U(this,t):(this.nativeSelection.addRange(a(t)),this.refresh())},F.setRanges=function(t){if(B&&t.length>1)m(this,t);else{this.removeAllRanges();for(var e=0,i=t.length;i>e;++e)this.addRange(t[e])}}}else{if(!(C.isHostMethod(A,"empty")&&C.isHostMethod(D,"select")&&B&&R))return e.fail("No means of selecting a Range or TextRange was found"),!1;F.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var t;if(this.anchorNode)t=x.getDocument(this.anchorNode);else if(this.docSelection.type==N){var e=this.docSelection.createRange();e.length&&(t=x.getDocument(e.item(0)).body.createTextRange())}if(t){var i=t.body.createTextRange();i.select(),this.docSelection.empty()}}}catch(n){}s(this)},F.addRange=function(t){this.docSelection.type==N?f(this,t):(k.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,r(this,t,!1))},F.setRanges=function(t){this.removeAllRanges();var e=t.length;e>1?m(this,t):e&&this.addRange(t[0])}}F.getRangeAt=function(t){if(0>t||t>=this.rangeCount)throw new T("INDEX_SIZE_ERR");return this._ranges[t]};var q;if(R)q=function(e){var i;t.isSelectionValid(e.win)?i=e.docSelection.createRange():(i=x.getBody(e.win.document).createTextRange(),i.collapse(!0)),e.docSelection.type==N?u(e):d(i)?h(e,i):s(e)};else if(C.isHostMethod(A,"getRangeAt")&&"number"==typeof A.rangeCount)q=function(e){if(B&&I&&e.docSelection.type==N)u(e);else if(e._ranges.length=e.rangeCount=e.nativeSelection.rangeCount,e.rangeCount){for(var i=0,n=e.rangeCount;n>i;++i)e._ranges[i]=new t.WrappedRange(e.nativeSelection.getRangeAt(i));r(e,e._ranges[e.rangeCount-1],K(e.nativeSelection)),e.isCollapsed=y(e)}else s(e)};else{if(!P||typeof A.isCollapsed!=w||typeof D.collapsed!=w||!t.features.implementsDomRange)return e.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;q=function(t){var e,i=t.nativeSelection;i.anchorNode?(e=j(i,0),t._ranges=[e],t.rangeCount=1,o(t),t.isCollapsed=y(t)):s(t)}}F.refresh=function(t){var e=t?this._ranges.slice(0):null;if(q(this),t){var i=e.length;if(i!=this._ranges.length)return!1;for(;i--;)if(!S.rangesEqual(e[i],this._ranges[i]))return!1;return!0}};var V=function(t,e){var i=t.getAllRanges(),n=!1;t.removeAllRanges();for(var r=0,o=i.length;o>r;++r)n||e!==i[r]?t.addRange(i[r]):n=!0;t.rangeCount||s(t)};F.removeRange=B?function(t){if(this.docSelection.type==N){for(var e,i=this.docSelection.createRange(),n=c(t),r=x.getDocument(i.item(0)),o=x.getBody(r).createControlRange(),s=!1,a=0,l=i.length;l>a;++a)e=i.item(a),e!==n||s?o.add(i.item(a)):s=!0;o.select(),u(this)}else V(this,t)}:function(t){V(this,t)};var K;!R&&P&&t.features.implementsDomRange?(K=function(t){var e=!1;return t.anchorNode&&(e=1==x.comparePoints(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)),e},F.isBackwards=function(){return K(this)}):K=F.isBackwards=function(){return!1},F.toString=function(){for(var t=[],e=0,i=this.rangeCount;i>e;++e)t[e]=""+this._ranges[e];return t.join("")},F.collapse=function(e,i){g(this,e);var n=t.createRange(x.getDocument(e));n.collapseToPoint(e,i),this.removeAllRanges(),this.addRange(n),this.isCollapsed=!0},F.collapseToStart=function(){if(!this.rangeCount)throw new T("INVALID_STATE_ERR");var t=this._ranges[0];this.collapse(t.startContainer,t.startOffset)},F.collapseToEnd=function(){if(!this.rangeCount)throw new T("INVALID_STATE_ERR");var t=this._ranges[this.rangeCount-1];this.collapse(t.endContainer,t.endOffset)},F.selectAllChildren=function(e){g(this,e);var i=t.createRange(x.getDocument(e));i.selectNodeContents(e),this.removeAllRanges(),this.addRange(i)},F.deleteFromDocument=function(){if(B&&I&&this.docSelection.type==N){for(var t,e=this.docSelection.createRange();e.length;)t=e.item(0),e.remove(t),t.parentNode.removeChild(t);this.refresh()}else if(this.rangeCount){var i=this.getAllRanges();this.removeAllRanges();for(var n=0,r=i.length;r>n;++n)i[n].deleteContents();this.addRange(i[r-1])}},F.getAllRanges=function(){return this._ranges.slice(0)},F.setSingleRange=function(t){this.setRanges([t])},F.containsNode=function(t,e){for(var i=0,n=this._ranges.length;n>i;++i)if(this._ranges[i].containsNode(t,e))return!0;return!1},F.toHtml=function(){var t="";if(this.rangeCount){for(var e=S.getRangeDocument(this._ranges[0]).createElement("div"),i=0,n=this._ranges.length;n>i;++i)e.appendChild(this._ranges[i].cloneContents());t=e.innerHTML}return t},F.getName=function(){return"WrappedSelection"},F.inspect=function(){return v(this)},F.detach=function(){this.win[_]=null,this.win=this.anchorNode=this.focusNode=null},p.inspect=v,t.Selection=p,t.selectionPrototype=F,t.addCreateMissingNativeApiListener(function(e){"undefined"==typeof e.getSelection&&(e.getSelection=function(){return t.getSelection(this)}),e=null})});/*
	Base.js, version 1.1a
	Copyright 2006-2010, Dean Edwards
	License: http://www.opensource.org/licenses/mit-license.php
*/
var Base=function(){};if(Base.extend=function(t,e){var i=Base.prototype.extend;Base._prototyping=!0;var n=new this;i.call(n,t),n.base=function(){},delete Base._prototyping;var r=n.constructor,o=n.constructor=function(){if(!Base._prototyping)if(this._constructing||this.constructor==o)this._constructing=!0,r.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||i).call(arguments[0],n)};return o.ancestor=this,o.extend=this.extend,o.forEach=this.forEach,o.implement=this.implement,o.prototype=n,o.toString=this.toString,o.valueOf=function(t){return"object"==t?o:r.valueOf()},i.call(o,e),"function"==typeof o.init&&o.init(),o},Base.prototype={extend:function(t,e){if(arguments.length>1){var i=this[t];if(i&&"function"==typeof e&&(!i.valueOf||i.valueOf()!=e.valueOf())&&/\bbase\b/.test(e)){var n=e.valueOf();e=function(){var t=this.base||Base.prototype.base;this.base=i;var e=n.apply(this,arguments);return this.base=t,e},e.valueOf=function(t){return"object"==t?e:n},e.toString=Base.toString}this[t]=e}else if(t){var r=Base.prototype.extend;Base._prototyping||"function"==typeof this||(r=this.extend||r);for(var o={toSource:null},s=["constructor","toString","valueOf"],a=Base._prototyping?0:1;l=s[a++];)t[l]!=o[l]&&r.call(this,l,t[l]);for(var l in t)o[l]||r.call(this,l,t[l])}return this}},Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(t,e,i){for(var n in t)void 0===this.prototype[n]&&e.call(i,t[n],n,t)},implement:function(){for(var t=0;t<arguments.length;t++)"function"==typeof arguments[t]?arguments[t](this.prototype):this.prototype.extend(arguments[t]);return this},toString:function(){return String(this.valueOf())}}),wysihtml5.browser=function(){function t(t){return(/ipad|iphone|ipod/.test(t)&&t.match(/ os (\d+).+? like mac os x/)||[,0])[1]}var e=navigator.userAgent,i=document.createElement("div"),n=-1!==e.indexOf("MSIE")&&-1===e.indexOf("Opera"),r=-1!==e.indexOf("Gecko")&&-1===e.indexOf("KHTML"),o=-1!==e.indexOf("AppleWebKit/"),s=-1!==e.indexOf("Chrome/"),a=-1!==e.indexOf("Opera/");return{USER_AGENT:e,supported:function(){var e=this.USER_AGENT.toLowerCase(),n="contentEditable"in i,r=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,o=document.querySelector&&document.querySelectorAll,s=this.isIos()&&t(e)<5||-1!==e.indexOf("opera mobi")||-1!==e.indexOf("hpwos/");return n&&r&&o&&!s},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){var t=this.USER_AGENT.toLowerCase();return-1!==t.indexOf("webkit")&&-1!==t.indexOf("mobile")},supportsSandboxedIframes:function(){return n},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return!("querySelector"in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return!r},hasCurrentStyleProperty:function(){return"currentStyle"in i},insertsLineBreaksOnReturn:function(){return r},supportsPlaceholderAttributeOn:function(t){return"placeholder"in t},supportsEvent:function(t){return"on"+t in i||function(){return i.setAttribute("on"+t,"return;"),"function"==typeof i["on"+t]}()},supportsEventsInIframeCorrectly:function(){return!a},firesOnDropOnlyWhenOnDragOverIsCancelled:function(){return o||r},supportsDataTransfer:function(){try{return o&&(window.Clipboard||window.DataTransfer).prototype.getData}catch(t){return!1}},supportsHTML5Tags:function(t){var e=t.createElement("div"),i="<article>foo</article>";return e.innerHTML=i,e.innerHTML.toLowerCase()===i},supportsCommand:function(){var t={formatBlock:n,insertUnorderedList:n||a||o,insertOrderedList:n||a||o},e={insertHTML:r};return function(i,n){var r=t[n];if(!r){try{return i.queryCommandSupported(n)}catch(o){}try{return i.queryCommandEnabled(n)}catch(s){return!!e[n]}}return!1}}(),doesAutoLinkingInContentEditable:function(){return n},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return r||a||o},supportsGetAttributeCorrectly:function(){var t=document.createElement("td");return"1"!=t.getAttribute("rowspan")},canSelectImagesInContentEditable:function(){return r||n||a},clearsListsInContentEditableCorrectly:function(){return r||n||o},autoScrollsToCaret:function(){return!o},autoClosesUnclosedTags:function(){var t,e,n=i.cloneNode(!1);return n.innerHTML="<p><div></div>",e=n.innerHTML.toLowerCase(),t="<p></p><div></div>"===e||"<p><div></div></p>"===e,this.autoClosesUnclosedTags=function(){return t},t},supportsNativeGetElementsByClassName:function(){return-1!==String(document.getElementsByClassName).indexOf("[native code]")},supportsSelectionModify:function(){return"getSelection"in window&&"modify"in window.getSelection()},supportsClassList:function(){return"classList"in i},needsSpaceAfterLineBreak:function(){return a},supportsSpeechApiOn:function(t){var i=e.match(/Chrome\/(\d+)/)||[,0];return i[1]>=11&&("onwebkitspeechchange"in t||"speech"in t)},crashesWhenDefineProperty:function(t){return n&&("XMLHttpRequest"===t||"XDomainRequest"===t)},doesAsyncFocus:function(){return n},hasProblemsSettingCaretAfterImg:function(){return n},hasUndoInContextMenu:function(){return r||s||a}}}(),wysihtml5.lang.array=function(t){return{contains:function(e){if(t.indexOf)return-1!==t.indexOf(e);for(var i=0,n=t.length;n>i;i++)if(t[i]===e)return!0;return!1},without:function(e){e=wysihtml5.lang.array(e);for(var i=[],n=0,r=t.length;r>n;n++)e.contains(t[n])||i.push(t[n]);return i},get:function(){for(var e=0,i=t.length,n=[];i>e;e++)n.push(t[e]);return n}}},wysihtml5.lang.Dispatcher=Base.extend({observe:function(t,e){return this.events=this.events||{},this.events[t]=this.events[t]||[],this.events[t].push(e),this},on:function(){return this.observe.apply(this,wysihtml5.lang.array(arguments).get())},fire:function(t,e){this.events=this.events||{};for(var i=this.events[t]||[],n=0;n<i.length;n++)i[n].call(this,e);return this},stopObserving:function(t,e){this.events=this.events||{};var i,n,r=0;if(t){for(i=this.events[t]||[],n=[];r<i.length;r++)i[r]!==e&&e&&n.push(i[r]);this.events[t]=n}else this.events={};return this}}),wysihtml5.lang.object=function(t){return{merge:function(e){for(var i in e)t[i]=e[i];return this},get:function(){return t},clone:function(){var e,i={};for(e in t)i[e]=t[e];return i},isArray:function(){return"[object Array]"===Object.prototype.toString.call(t)}}},function(){var t=/^\s+/,e=/\s+$/;wysihtml5.lang.string=function(i){return i=String(i),{trim:function(){return i.replace(t,"").replace(e,"")},interpolate:function(t){for(var e in t)i=this.replace("#{"+e+"}").by(t[e]);return i},replace:function(t){return{by:function(e){return i.split(t).join(e)}}}}}}(),function(t){function e(t){return o(t)?t:(t===t.ownerDocument.documentElement&&(t=t.ownerDocument.body),s(t))}function i(t){return t.replace(l,function(t,e){var i=(e.match(c)||[])[1]||"",n=h[i];e=e.replace(c,""),e.split(n).length>e.split(i).length&&(e+=i,i="");var r=e,o=e;return e.length>d&&(o=o.substr(0,d)+"..."),"www."===r.substr(0,4)&&(r="http://"+r),'<a href="'+r+'">'+o+"</a>"+i})}function n(t){var e=t._wysihtml5_tempElement;return e||(e=t._wysihtml5_tempElement=t.createElement("div")),e}function r(t){var e=t.parentNode,r=n(e.ownerDocument);for(r.innerHTML="<span></span>"+i(t.data),r.removeChild(r.firstChild);r.firstChild;)e.insertBefore(r.firstChild,t);e.removeChild(t)}function o(t){for(var e;t.parentNode;){if(t=t.parentNode,e=t.nodeName,a.contains(e))return!0;if("body"===e)return!1}return!1}function s(e){if(!a.contains(e.nodeName)){if(e.nodeType===t.TEXT_NODE&&e.data.match(l))return r(e),void 0;for(var i=t.lang.array(e.childNodes).get(),n=i.length,o=0;n>o;o++)s(i[o]);return e}}var a=t.lang.array(["CODE","PRE","A","SCRIPT","HEAD","TITLE","STYLE"]),l=/((https?:\/\/|www\.)[^\s<]{3,})/gi,c=/([^\w\/\-](,?))$/i,d=100,h={")":"(","]":"[","}":"{"};t.dom.autoLink=e,t.dom.autoLink.URL_REG_EXP=l}(wysihtml5),function(t){var e=t.browser.supportsClassList(),i=t.dom;i.addClass=function(t,n){return e?t.classList.add(n):(i.hasClass(t,n)||(t.className+=" "+n),void 0)},i.removeClass=function(t,i){return e?t.classList.remove(i):(t.className=t.className.replace(new RegExp("(^|\\s+)"+i+"(\\s+|$)")," "),void 0)},i.hasClass=function(t,i){if(e)return t.classList.contains(i);var n=t.className;return n.length>0&&(n==i||new RegExp("(^|\\s)"+i+"(\\s|$)").test(n))}}(wysihtml5),wysihtml5.dom.contains=function(){var t=document.documentElement;return t.contains?function(t,e){return e.nodeType!==wysihtml5.ELEMENT_NODE&&(e=e.parentNode),t!==e&&t.contains(e)}:t.compareDocumentPosition?function(t,e){return!!(16&t.compareDocumentPosition(e))}:void 0}(),wysihtml5.dom.convertToList=function(){function t(t,e){var i=t.createElement("li");return e.appendChild(i),i}function e(t,e){return t.createElement(e)}function i(i,n){if("UL"===i.nodeName||"OL"===i.nodeName||"MENU"===i.nodeName)return i;var r,o,s,a,l,c,d,h,u,f=i.ownerDocument,p=e(f,n),m=i.querySelectorAll("br"),g=m.length;for(u=0;g>u;u++)for(a=m[u];(l=a.parentNode)&&l!==i&&l.lastChild===a;){if("block"===wysihtml5.dom.getStyle("display").from(l)){l.removeChild(a);break}wysihtml5.dom.insert(a).after(a.parentNode)}for(r=wysihtml5.lang.array(i.childNodes).get(),o=r.length,u=0;o>u;u++)h=h||t(f,p),s=r[u],c="block"===wysihtml5.dom.getStyle("display").from(s),d="BR"===s.nodeName,c?(h=h.firstChild?t(f,p):h,h.appendChild(s),h=null):d?h=h.firstChild?null:h:h.appendChild(s);return i.parentNode.replaceChild(p,i),p}return i}(),wysihtml5.dom.copyAttributes=function(t){return{from:function(e){return{to:function(i){for(var n,r=0,o=t.length;o>r;r++)n=t[r],"undefined"!=typeof e[n]&&""!==e[n]&&(i[n]=e[n]);return{andTo:arguments.callee}}}}}},function(t){var e=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"],i=function(e){return n(e)?parseInt(t.getStyle("width").from(e),10)<e.offsetWidth:!1},n=function(i){for(var n=0,r=e.length;r>n;n++)if("border-box"===t.getStyle(e[n]).from(i))return e[n]};t.copyStyles=function(n){return{from:function(r){i(r)&&(n=wysihtml5.lang.array(n).without(e));for(var o,s="",a=n.length,l=0;a>l;l++)o=n[l],s+=o+":"+t.getStyle(o).from(r)+";";return{to:function(e){return t.setStyles(s).on(e),{andTo:arguments.callee}}}}}}}(wysihtml5.dom),function(t){t.dom.delegate=function(e,i,n,r){return t.dom.observe(e,n,function(n){for(var o=n.target,s=t.lang.array(e.querySelectorAll(i));o&&o!==e;){if(s.contains(o)){r.call(o,n);break}o=o.parentNode}})}}(wysihtml5),wysihtml5.dom.getAsDom=function(){var t=function(t,e){var i=e.createElement("div");i.style.display="none",e.body.appendChild(i);try{i.innerHTML=t}catch(n){}return e.body.removeChild(i),i},e=function(t){if(!t._wysihtml5_supportsHTML5Tags){for(var e=0,n=i.length;n>e;e++)t.createElement(i[e]);t._wysihtml5_supportsHTML5Tags=!0}},i=["abbr","article","aside","audio","bdi","canvas","command","datalist","details","figcaption","figure","footer","header","hgroup","keygen","mark","meter","nav","output","progress","rp","rt","ruby","svg","section","source","summary","time","track","video","wbr"];return function(i,n){n=n||document;var r;return"object"==typeof i&&i.nodeType?(r=n.createElement("div"),r.appendChild(i)):wysihtml5.browser.supportsHTML5Tags(n)?(r=n.createElement("div"),r.innerHTML=i):(e(n),r=t(i,n)),r}}(),wysihtml5.dom.getParentElement=function(){function t(t,e){return e&&e.length?"string"==typeof e?t===e:wysihtml5.lang.array(e).contains(t):!0}function e(t){return t.nodeType===wysihtml5.ELEMENT_NODE}function i(t,e,i){var n=(t.className||"").match(i)||[];return e?n[n.length-1]===e:!!n.length}function n(e,i,n){for(;n--&&e&&"BODY"!==e.nodeName;){if(t(e.nodeName,i))return e;e=e.parentNode}return null}function r(n,r,o,s,a){for(;a--&&n&&"BODY"!==n.nodeName;){if(e(n)&&t(n.nodeName,r)&&i(n,o,s))return n;n=n.parentNode}return null}return function(t,e,i){return i=i||50,e.className||e.classRegExp?r(t,e.nodeName,e.className,e.classRegExp,i):n(t,e.nodeName,i)}}(),wysihtml5.dom.getStyle=function(){function t(t){return t.replace(i,function(t){return t.charAt(1).toUpperCase()})}var e={"float":"styleFloat"in document.createElement("div").style?"styleFloat":"cssFloat"},i=/\-[a-z]/g;return function(i){return{from:function(n){if(n.nodeType===wysihtml5.ELEMENT_NODE){var r=n.ownerDocument,o=e[i]||t(i),s=n.style,a=n.currentStyle,l=s[o];if(l)return l;if(a)try{return a[o]}catch(c){}var d,h,u=r.defaultView||r.parentWindow,f=("height"===i||"width"===i)&&"TEXTAREA"===n.nodeName;return u.getComputedStyle?(f&&(d=s.overflow,s.overflow="hidden"),h=u.getComputedStyle(n,null).getPropertyValue(i),f&&(s.overflow=d||""),h):void 0}}}}}(),wysihtml5.dom.hasElementWithTagName=function(){function t(t){return t._wysihtml5_identifier||(t._wysihtml5_identifier=i++)}var e={},i=1;return function(i,n){var r=t(i)+":"+n,o=e[r];return o||(o=e[r]=i.getElementsByTagName(n)),o.length>0}}(),function(t){function e(t){return t._wysihtml5_identifier||(t._wysihtml5_identifier=n++)}var i={},n=1;t.dom.hasElementWithClassName=function(n,r){if(!t.browser.supportsNativeGetElementsByClassName())return!!n.querySelector("."+r);var o=e(n)+":"+r,s=i[o];return s||(s=i[o]=n.getElementsByClassName(r)),s.length>0}}(wysihtml5),wysihtml5.dom.insert=function(t){return{after:function(e){e.parentNode.insertBefore(t,e.nextSibling)},before:function(e){e.parentNode.insertBefore(t,e)},into:function(e){e.appendChild(t)}}},wysihtml5.dom.insertCSS=function(t){return t=t.join("\n"),{into:function(e){var i=e.head||e.getElementsByTagName("head")[0],n=e.createElement("style");n.type="text/css",n.styleSheet?n.styleSheet.cssText=t:n.appendChild(e.createTextNode(t)),i&&i.appendChild(n)}}},wysihtml5.dom.observe=function(t,e,i){e="string"==typeof e?[e]:e;for(var n,r,o=0,s=e.length;s>o;o++)r=e[o],t.addEventListener?t.addEventListener(r,i,!1):(n=function(e){"target"in e||(e.target=e.srcElement),e.preventDefault=e.preventDefault||function(){this.returnValue=!1},e.stopPropagation=e.stopPropagation||function(){this.cancelBubble=!0},i.call(t,e)},t.attachEvent("on"+r,n));return{stop:function(){for(var r,o=0,s=e.length;s>o;o++)r=e[o],t.removeEventListener?t.removeEventListener(r,i,!1):t.detachEvent("on"+r,n)}}},wysihtml5.dom.parse=function(){function t(t,i,n,r){wysihtml5.lang.object(h).merge(d).merge(i).get(),n=n||t.ownerDocument||document;var o,s,a,l=n.createDocumentFragment(),c="string"==typeof t;for(o=c?wysihtml5.dom.getAsDom(t,n):t;o.firstChild;)a=o.firstChild,o.removeChild(a),s=e(a,r),s&&l.appendChild(s);return o.innerHTML="",o.appendChild(l),c?wysihtml5.quirks.getCorrectInnerHTML(o):o}function e(t,i){var n,r=t.nodeType,o=t.childNodes,s=o.length,c=a[r],d=0;if(n=c&&c(t),!n)return null;for(d=0;s>d;d++)newChild=e(o[d],i),newChild&&n.appendChild(newChild);return i&&n.childNodes.length<=1&&n.nodeName.toLowerCase()===l&&!n.attributes.length?n.firstChild:n}function i(t){var e,i,r=h.tags,o=t.nodeName.toLowerCase(),s=t.scopeName;if(t._wysihtml5)return null;if(t._wysihtml5=1,"wysihtml5-temp"===t.className)return null;if(s&&"HTML"!=s&&(o=s+":"+o),"outerHTML"in t&&(wysihtml5.browser.autoClosesUnclosedTags()||"P"!==t.nodeName||"</p>"===t.outerHTML.slice(-4).toLowerCase()||(o="div")),o in r){if(e=r[o],!e||e.remove)return null;e="string"==typeof e?{rename_tag:e}:e}else{if(!t.firstChild)return null;e={rename_tag:l}}return i=t.ownerDocument.createElement(e.rename_tag||o),n(t,i,e),t=null,i}function n(t,e,i){var n,o,s,a,l,d,u,m={},g=i.set_class,v=i.add_class,b=i.set_attributes,y=i.check_attributes,w=h.classes,_=0,x=[],C=[],S=[],k=[];if(b&&(m=wysihtml5.lang.object(b).clone()),y)for(l in y)u=f[y[l]],u&&(d=u(r(t,l)),"string"==typeof d&&(m[l]=d));if(g&&x.push(g),v)for(l in v)u=p[v[l]],u&&(a=u(r(t,l)),"string"==typeof a&&x.push(a));for(w["_wysihtml5-temp-placeholder"]=1,k=t.getAttribute("class"),k&&(x=x.concat(k.split(c))),n=x.length;n>_;_++)s=x[_],w[s]&&C.push(s);for(o=C.length;o--;)s=C[o],wysihtml5.lang.array(S).contains(s)||S.unshift(s);S.length&&(m["class"]=S.join(" "));for(l in m)try{e.setAttribute(l,m[l])}catch(T){}m.src&&("undefined"!=typeof m.width&&e.setAttribute("width",m.width),"undefined"!=typeof m.height&&e.setAttribute("height",m.height))}function r(t,e){e=e.toLowerCase();var i=t.nodeName;if("IMG"==i&&"src"==e&&o(t)===!0)return t.src;if(u&&"outerHTML"in t){var n=t.outerHTML.toLowerCase(),r=-1!=n.indexOf(" "+e+"=");return r?t.getAttribute(e):null}return t.getAttribute(e)}function o(t){try{return t.complete&&!t.mozMatchesSelector(":-moz-broken")}catch(e){if(t.complete&&"complete"===t.readyState)return!0}}function s(t){return t.ownerDocument.createTextNode(t.data)}var a={1:i,3:s},l="span",c=/\s+/,d={tags:{},classes:{}},h={},u=!wysihtml5.browser.supportsGetAttributeCorrectly(),f={url:function(){var t=/^https?:\/\//i;return function(e){return e&&e.match(t)?e.replace(t,function(t){return t.toLowerCase()}):null}}(),alt:function(){var t=/[^ a-z0-9_\-]/gi;return function(e){return e?e.replace(t,""):""}}(),numbers:function(){var t=/\D/g;return function(e){return e=(e||"").replace(t,""),e||null}}()},p={align_img:function(){var t={left:"wysiwyg-float-left",right:"wysiwyg-float-right"};return function(e){return t[String(e).toLowerCase()]}}(),align_text:function(){var t={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"};return function(e){return t[String(e).toLowerCase()]}}(),clear_br:function(){var t={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"};return function(e){return t[String(e).toLowerCase()]}}(),size_font:function(){var t={1:"wysiwyg-font-size-xx-small",2:"wysiwyg-font-size-small",3:"wysiwyg-font-size-medium",4:"wysiwyg-font-size-large",5:"wysiwyg-font-size-x-large",6:"wysiwyg-font-size-xx-large",7:"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"};return function(e){return t[String(e).charAt(0)]}}()};return t}(),wysihtml5.dom.removeEmptyTextNodes=function(t){for(var e,i=wysihtml5.lang.array(t.childNodes).get(),n=i.length,r=0;n>r;r++)e=i[r],e.nodeType===wysihtml5.TEXT_NODE&&""===e.data&&e.parentNode.removeChild(e)},wysihtml5.dom.renameElement=function(t,e){for(var i,n=t.ownerDocument.createElement(e);i=t.firstChild;)n.appendChild(i);return wysihtml5.dom.copyAttributes(["align","className"]).from(t).to(n),t.parentNode.replaceChild(n,t),n},wysihtml5.dom.replaceWithChildNodes=function(t){if(t.parentNode){if(!t.firstChild)return t.parentNode.removeChild(t),void 0;for(var e=t.ownerDocument.createDocumentFragment();t.firstChild;)e.appendChild(t.firstChild);t.parentNode.replaceChild(e,t),t=e=null}},function(t){function e(e){return"block"===t.getStyle("display").from(e)}function i(t){return"BR"===t.nodeName}function n(t){var e=t.ownerDocument.createElement("br");t.appendChild(e)}function r(t){if("MENU"===t.nodeName||"UL"===t.nodeName||"OL"===t.nodeName){var r,o,s,a,l,c=t.ownerDocument,d=c.createDocumentFragment(),h=t.previousElementSibling||t.previousSibling;for(h&&!e(h)&&n(d);l=t.firstChild;){for(o=l.lastChild;r=l.firstChild;)s=r===o,a=s&&!e(r)&&!i(r),d.appendChild(r),a&&n(d);l.parentNode.removeChild(l)}t.parentNode.replaceChild(d,t)}}t.resolveList=r}(wysihtml5.dom),function(t){var e=document,i=["parent","top","opener","frameElement","frames","localStorage","globalStorage","sessionStorage","indexedDB"],n=["open","close","openDialog","showModalDialog","alert","confirm","prompt","openDatabase","postMessage","XMLHttpRequest","XDomainRequest"],r=["referrer","write","open","close"];t.dom.Sandbox=Base.extend({constructor:function(e,i){this.callback=e||t.EMPTY_FUNCTION,this.config=t.lang.object({}).merge(i).get(),this.iframe=this._createIframe()},insertInto:function(t){"string"==typeof t&&(t=e.getElementById(t)),t.appendChild(this.iframe)},getIframe:function(){return this.iframe},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var t=this.getIframe();t.parentNode.removeChild(t)},_readyError:function(){throw new Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet")},_createIframe:function(){var i=this,n=e.createElement("iframe");return n.className="wysihtml5-sandbox",t.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(n),t.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()&&(n.src="javascript:'<html></html>'"),n.onload=function(){n.onreadystatechange=n.onload=null,i._onLoadIframe(n)},n.onreadystatechange=function(){/loaded|complete/.test(n.readyState)&&(n.onreadystatechange=n.onload=null,i._onLoadIframe(n))},n},_onLoadIframe:function(o){if(t.dom.contains(e.documentElement,o)){var s=this,a=o.contentWindow,l=o.contentWindow.document,c=e.characterSet||e.charset||"utf-8",d=this._getHtml({charset:c,stylesheets:this.config.stylesheets});if(l.open("text/html","replace"),l.write(d),l.close(),this.getWindow=function(){return o.contentWindow},this.getDocument=function(){return o.contentWindow.document},a.onerror=function(t,e,i){throw new Error("wysihtml5.Sandbox: "+t,e,i)},!t.browser.supportsSandboxedIframes()){var h,u;for(h=0,u=i.length;u>h;h++)this._unset(a,i[h]);for(h=0,u=n.length;u>h;h++)this._unset(a,n[h],t.EMPTY_FUNCTION);for(h=0,u=r.length;u>h;h++)this._unset(l,r[h]);this._unset(l,"cookie","",!0)}this.loaded=!0,setTimeout(function(){s.callback(s)},0)}},_getHtml:function(e){var i,n=e.stylesheets,r="",o=0;if(n="string"==typeof n?[n]:n)for(i=n.length;i>o;o++)r+='<link rel="stylesheet" href="'+n[o]+'">';return e.stylesheets=r,t.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}</head><body></body></html>').interpolate(e)},_unset:function(e,i,n,r){try{e[i]=n}catch(o){}try{e.__defineGetter__(i,function(){return n})}catch(o){}if(r)try{e.__defineSetter__(i,function(){})}catch(o){}if(!t.browser.crashesWhenDefineProperty(i))try{var s={get:function(){return n}};r&&(s.set=function(){}),Object.defineProperty(e,i,s)}catch(o){}}})}(wysihtml5),function(){var t={className:"class"};wysihtml5.dom.setAttributes=function(e){return{on:function(i){for(var n in e)i.setAttribute(t[n]||n,e[n])}}}}(),wysihtml5.dom.setStyles=function(t){return{on:function(e){var i=e.style;if("string"==typeof t)return i.cssText+=";"+t,void 0;for(var n in t)"float"===n?(i.cssFloat=t[n],i.styleFloat=t[n]):i[n]=t[n]}}},function(t){t.simulatePlaceholder=function(e,i,n){var r="placeholder",o=function(){i.hasPlaceholderSet()&&i.clear(),t.removeClass(i.element,r)},s=function(){i.isEmpty()&&(i.setValue(n),t.addClass(i.element,r))};e.observe("set_placeholder",s).observe("unset_placeholder",o).observe("focus:composer",o).observe("paste:composer",o).observe("blur:composer",s),s()}}(wysihtml5.dom),function(t){var e=document.documentElement;"textContent"in e?(t.setTextContent=function(t,e){t.textContent=e},t.getTextContent=function(t){return t.textContent}):"innerText"in e?(t.setTextContent=function(t,e){t.innerText=e},t.getTextContent=function(t){return t.innerText}):(t.setTextContent=function(t,e){t.nodeValue=e},t.getTextContent=function(t){return t.nodeValue})}(wysihtml5.dom),wysihtml5.quirks.cleanPastedHTML=function(){function t(t,i,n){i=i||e,n=n||t.ownerDocument||document;var r,o,s,a,l,c="string"==typeof t,d=0;r=c?wysihtml5.dom.getAsDom(t,n):t;for(l in i)for(s=r.querySelectorAll(l),o=i[l],a=s.length;a>d;d++)o(s[d]);return s=t=i=null,c?r.innerHTML:r}var e={"a u":wysihtml5.dom.replaceWithChildNodes};return t}(),function(t){var e=t.dom;t.quirks.ensureProperClearing=function(){var t=function(){var t=this;setTimeout(function(){var e=t.innerHTML.toLowerCase();("<p>&nbsp;</p>"==e||"<p>&nbsp;</p><p>&nbsp;</p>"==e)&&(t.innerHTML="")},0)};return function(i){e.observe(i.element,["cut","keydown"],t)}}(),t.quirks.ensureProperClearingOfLists=function(){var i=["OL","UL","MENU"],n=function(n,r){if(r.firstChild&&t.lang.array(i).contains(r.firstChild.nodeName)){var o=e.getParentElement(n,{nodeName:i});if(o){var s=o==r.firstChild;if(s){var a=o.childNodes.length<=1;if(a){var l=o.firstChild?""===o.firstChild.innerHTML:!0;l&&o.parentNode.removeChild(o)}}}}};return function(i){e.observe(i.element,"keydown",function(e){if(e.keyCode===t.BACKSPACE_KEY){var r=i.selection.getSelectedNode();n(r,i.element)}})}}()}(wysihtml5),function(t){var e="%7E";t.quirks.getCorrectInnerHTML=function(i){var n=i.innerHTML;if(-1===n.indexOf(e))return n;var r,o,s,a,l=i.querySelectorAll("[href*='~'], [src*='~']");for(a=0,s=l.length;s>a;a++)r=l[a].href||l[a].src,o=t.lang.string(r).replace("~").by(e),n=t.lang.string(n).replace(o).by(r);return n}}(wysihtml5),function(t){var e=t.dom,i=["LI","P","H1","H2","H3","H4","H5","H6"],n=["UL","OL","MENU"];t.quirks.insertLineBreakOnReturn=function(r){function o(i){var n=e.getParentElement(i,{nodeName:["P","DIV"]},2);if(n){var o=document.createTextNode(t.INVISIBLE_SPACE);e.insert(o).before(n),e.replaceWithChildNodes(n),r.selection.selectNode(o)}}function s(s){var a=s.keyCode;if(!(s.shiftKey||a!==t.ENTER_KEY&&a!==t.BACKSPACE_KEY)){var l=(s.target,r.selection.getSelectedNode()),c=e.getParentElement(l,{nodeName:i},4);return c?("LI"!==c.nodeName||a!==t.ENTER_KEY&&a!==t.BACKSPACE_KEY?c.nodeName.match(/H[1-6]/)&&a===t.ENTER_KEY&&setTimeout(function(){o(r.selection.getSelectedNode())},0):setTimeout(function(){var t,i=r.selection.getSelectedNode();i&&(t=e.getParentElement(i,{nodeName:n},2),t||o(i))},0),void 0):(a!==t.ENTER_KEY||t.browser.insertsLineBreaksOnReturn()||(r.commands.exec("insertLineBreak"),s.preventDefault()),void 0)}}e.observe(r.element.ownerDocument,"keydown",s)}}(wysihtml5),function(t){var e="wysihtml5-quirks-redraw";t.quirks.redraw=function(i){t.dom.addClass(i,e),t.dom.removeClass(i,e);try{var n=i.ownerDocument;n.execCommand("italic",!1,null),n.execCommand("italic",!1,null)}catch(r){}}}(wysihtml5),function(t){function e(t){var e=0;if(t.parentNode)do e+=t.offsetTop||0,t=t.offsetParent;while(t);return e}var i=t.dom;t.Selection=Base.extend({constructor:function(t){window.rangy.init(),this.editor=t,this.composer=t.composer,this.doc=this.composer.doc},getBookmark:function(){var t=this.getRange();return t&&t.cloneRange()},setBookmark:function(t){t&&this.setSelection(t)},setBefore:function(t){var e=rangy.createRange(this.doc);return e.setStartBefore(t),e.setEndBefore(t),this.setSelection(e)},setAfter:function(t){var e=rangy.createRange(this.doc);return e.setStartAfter(t),e.setEndAfter(t),this.setSelection(e)},selectNode:function(e){var n=rangy.createRange(this.doc),r=e.nodeType===t.ELEMENT_NODE,o="canHaveHTML"in e?e.canHaveHTML:"IMG"!==e.nodeName,s=r?e.innerHTML:e.data,a=""===s||s===t.INVISIBLE_SPACE,l=i.getStyle("display").from(e),c="block"===l||"list-item"===l;if(a&&r&&o)try{e.innerHTML=t.INVISIBLE_SPACE}catch(d){}o?n.selectNodeContents(e):n.selectNode(e),o&&a&&r?n.collapse(c):o&&a&&(n.setStartAfter(e),n.setEndAfter(e)),this.setSelection(n)},getSelectedNode:function(t){var e,i;return t&&this.doc.selection&&"Control"===this.doc.selection.type&&(i=this.doc.selection.createRange(),i&&i.length)?i.item(0):(e=this.getSelection(this.doc),e.focusNode===e.anchorNode?e.focusNode:(i=this.getRange(this.doc),i?i.commonAncestorContainer:this.doc.body))},executeAndRestore:function(e,i){var n,r=this.doc.body,o=i&&r.scrollTop,s=i&&r.scrollLeft,a="_wysihtml5-temp-placeholder",l='<span class="'+a+'">'+t.INVISIBLE_SPACE+"</span>",c=this.getRange(this.doc);if(!c)return e(r,r),void 0;var d=c.createContextualFragment(l);c.insertNode(d);try{e(c.startContainer,c.endContainer)}catch(h){setTimeout(function(){throw h},0)}caretPlaceholder=this.doc.querySelector("."+a),caretPlaceholder?(n=rangy.createRange(this.doc),n.selectNode(caretPlaceholder),n.deleteContents(),this.setSelection(n)):r.focus(),i&&(r.scrollTop=o,r.scrollLeft=s);try{caretPlaceholder.parentNode.removeChild(caretPlaceholder)}catch(u){}},executeAndRestoreSimple:function(t){var e,i,n,r,o,s=this.getRange(),a=this.doc.body;if(!s)return t(a,a),void 0;r=s.getNodes([3]),i=r[0]||s.startContainer,n=r[r.length-1]||s.endContainer,o={collapsed:s.collapsed,startContainer:i,startOffset:i===s.startContainer?s.startOffset:0,endContainer:n,endOffset:n===s.endContainer?s.endOffset:n.length};try{t(s.startContainer,s.endContainer)}catch(l){setTimeout(function(){throw l},0)}e=rangy.createRange(this.doc);try{e.setStart(o.startContainer,o.startOffset)}catch(c){}try{e.setEnd(o.endContainer,o.endOffset)}catch(d){}try{this.setSelection(e)}catch(h){}},insertHTML:function(t){var e=rangy.createRange(this.doc),i=e.createContextualFragment(t),n=i.lastChild;this.insertNode(i),n&&this.setAfter(n)},insertNode:function(t){var e=this.getRange();e&&e.insertNode(t)},surround:function(t){var e=this.getRange();if(e)try{e.surroundContents(t),this.selectNode(t)}catch(i){t.appendChild(e.extractContents()),e.insertNode(t)}},scrollIntoView:function(){var i,n=this.doc,r=n.documentElement.scrollHeight>n.documentElement.offsetHeight,o=n._wysihtml5ScrollIntoViewElement=n._wysihtml5ScrollIntoViewElement||function(){var e=n.createElement("span");return e.innerHTML=t.INVISIBLE_SPACE,e}();r&&(this.insertNode(o),i=e(o),o.parentNode.removeChild(o),i>n.body.scrollTop&&(n.body.scrollTop=i))},selectLine:function(){t.browser.supportsSelectionModify()?this._selectLine_W3C():this.doc.selection&&this._selectLine_MSIE()},_selectLine_W3C:function(){var t=this.doc.defaultView,e=t.getSelection();e.modify("extend","left","lineboundary"),e.modify("extend","right","lineboundary")},_selectLine_MSIE:function(){var t,e,i,n,r,o=this.doc.selection.createRange(),s=o.boundingTop,a=(o.boundingHeight,this.doc.body.scrollWidth);if(o.moveToPoint){for(0===s&&(i=this.doc.createElement("span"),this.insertNode(i),s=i.offsetTop,i.parentNode.removeChild(i)),s+=1,n=-10;a>n;n+=2)try{o.moveToPoint(n,s);break}catch(l){}for(t=s,e=this.doc.selection.createRange(),r=a;r>=0;r--)try{e.moveToPoint(r,t);break}catch(c){}o.setEndPoint("EndToEnd",e),o.select()}},getText:function(){var t=this.getSelection();return t?t.toString():""},getNodes:function(t,e){var i=this.getRange();return i?i.getNodes([t],e):[]},getRange:function(){var t=this.getSelection();return t&&t.rangeCount&&t.getRangeAt(0)},getSelection:function(){return rangy.getSelection(this.doc.defaultView||this.doc.parentWindow)},setSelection:function(t){var e=this.doc.defaultView||this.doc.parentWindow,i=rangy.getSelection(e);return i.setSingleRange(t)}})}(wysihtml5),function(t,e){function i(t,e,i){if(!t.className)return!1;var n=t.className.match(i)||[];return n[n.length-1]===e}function n(t,e,i){t.className?(r(t,i),t.className+=" "+e):t.className=e}function r(t,e){t.className&&(t.className=t.className.replace(e,""))}function o(t,e){return t.className.replace(f," ")==e.className.replace(f," ")}function s(t){for(var e=t.parentNode;t.firstChild;)e.insertBefore(t.firstChild,t);e.removeChild(t)}function a(t,e){if(t.attributes.length!=e.attributes.length)return!1;for(var i,n,r,o=0,s=t.attributes.length;s>o;++o)if(i=t.attributes[o],r=i.name,"class"!=r){if(n=e.attributes.getNamedItem(r),i.specified!=n.specified)return!1;if(i.specified&&i.nodeValue!==n.nodeValue)return!1}return!0}function l(t,i){return e.dom.isCharacterDataNode(t)?0==i?!!t.previousSibling:i==t.length?!!t.nextSibling:!0:i>0&&i<t.childNodes.length}function c(t,i,n){var r;if(e.dom.isCharacterDataNode(i)&&(0==n?(n=e.dom.getNodeIndex(i),i=i.parentNode):n==i.length?(n=e.dom.getNodeIndex(i)+1,i=i.parentNode):r=e.dom.splitDataNode(i,n)),!r){r=i.cloneNode(!1),r.id&&r.removeAttribute("id");for(var o;o=i.childNodes[n];)r.appendChild(o);e.dom.insertAfter(r,i)}return i==t?r:c(t,r.parentNode,e.dom.getNodeIndex(r))}function d(e){this.isElementMerge=e.nodeType==t.ELEMENT_NODE,this.firstTextNode=this.isElementMerge?e.lastChild:e,this.textNodes=[this.firstTextNode]}function h(t,e,i,n){this.tagNames=t||[u],this.cssClass=e||"",this.similarClassRegExp=i,this.normalize=n,this.applyToAnyTagName=!1}var u="span",f=/\s+/g;d.prototype={doMerge:function(){for(var t,e,i,n=[],r=0,o=this.textNodes.length;o>r;++r)t=this.textNodes[r],e=t.parentNode,n[r]=t.data,r&&(e.removeChild(t),e.hasChildNodes()||e.parentNode.removeChild(e));return this.firstTextNode.data=i=n.join(""),i},getLength:function(){for(var t=this.textNodes.length,e=0;t--;)e+=this.textNodes[t].length;return e},toString:function(){for(var t=[],e=0,i=this.textNodes.length;i>e;++e)t[e]="'"+this.textNodes[e].data+"'";return"[Merge("+t.join(",")+")]"}},h.prototype={getAncestorWithClass:function(n){for(var r;n;){if(r=this.cssClass?i(n,this.cssClass,this.similarClassRegExp):!0,n.nodeType==t.ELEMENT_NODE&&e.dom.arrayContains(this.tagNames,n.tagName.toLowerCase())&&r)return n;n=n.parentNode}return!1},postApply:function(t,e){for(var i,n,r,o=t[0],s=t[t.length-1],a=[],l=o,c=s,h=0,u=s.length,f=0,p=t.length;p>f;++f)n=t[f],r=this.getAdjacentMergeableTextNode(n.parentNode,!1),r?(i||(i=new d(r),a.push(i)),i.textNodes.push(n),n===o&&(l=i.firstTextNode,h=l.length),n===s&&(c=i.firstTextNode,u=i.getLength())):i=null;
var m=this.getAdjacentMergeableTextNode(s.parentNode,!0);if(m&&(i||(i=new d(s),a.push(i)),i.textNodes.push(m)),a.length){for(f=0,p=a.length;p>f;++f)a[f].doMerge();e.setStart(l,h),e.setEnd(c,u)}},getAdjacentMergeableTextNode:function(e,i){var n,r=e.nodeType==t.TEXT_NODE,o=r?e.parentNode:e,s=i?"nextSibling":"previousSibling";if(r){if(n=e[s],n&&n.nodeType==t.TEXT_NODE)return n}else if(n=o[s],n&&this.areElementsMergeable(e,n))return n[i?"firstChild":"lastChild"];return null},areElementsMergeable:function(t,i){return e.dom.arrayContains(this.tagNames,(t.tagName||"").toLowerCase())&&e.dom.arrayContains(this.tagNames,(i.tagName||"").toLowerCase())&&o(t,i)&&a(t,i)},createContainer:function(t){var e=t.createElement(this.tagNames[0]);return this.cssClass&&(e.className=this.cssClass),e},applyToTextNode:function(t){var i=t.parentNode;if(1==i.childNodes.length&&e.dom.arrayContains(this.tagNames,i.tagName.toLowerCase()))this.cssClass&&n(i,this.cssClass,this.similarClassRegExp);else{var r=this.createContainer(e.dom.getDocument(t));t.parentNode.insertBefore(r,t),r.appendChild(t)}},isRemovable:function(i){return e.dom.arrayContains(this.tagNames,i.tagName.toLowerCase())&&t.lang.string(i.className).trim()==this.cssClass},undoToTextNode:function(t,e,i){if(!e.containsNode(i)){var n=e.cloneRange();n.selectNode(i),n.isPointInRange(e.endContainer,e.endOffset)&&l(e.endContainer,e.endOffset)&&(c(i,e.endContainer,e.endOffset),e.setEndAfter(i)),n.isPointInRange(e.startContainer,e.startOffset)&&l(e.startContainer,e.startOffset)&&(i=c(i,e.startContainer,e.startOffset))}this.similarClassRegExp&&r(i,this.similarClassRegExp),this.isRemovable(i)&&s(i)},applyToRange:function(e){var i=e.getNodes([t.TEXT_NODE]);if(!i.length)try{var n=this.createContainer(e.endContainer.ownerDocument);return e.surroundContents(n),this.selectNode(e,n),void 0}catch(r){}if(e.splitBoundaries(),i=e.getNodes([t.TEXT_NODE]),i.length){for(var o,s=0,a=i.length;a>s;++s)o=i[s],this.getAncestorWithClass(o)||this.applyToTextNode(o);e.setStart(i[0],0),o=i[i.length-1],e.setEnd(o,o.length),this.normalize&&this.postApply(i,e)}},undoToRange:function(e){var i,n,r=e.getNodes([t.TEXT_NODE]);if(r.length)e.splitBoundaries(),r=e.getNodes([t.TEXT_NODE]);else{var o=e.endContainer.ownerDocument,s=o.createTextNode(t.INVISIBLE_SPACE);e.insertNode(s),e.selectNode(s),r=[s]}for(var a=0,l=r.length;l>a;++a)i=r[a],n=this.getAncestorWithClass(i),n&&this.undoToTextNode(i,e,n);1==l?this.selectNode(e,r[0]):(e.setStart(r[0],0),i=r[r.length-1],e.setEnd(i,i.length),this.normalize&&this.postApply(r,e))},selectNode:function(e,i){var n=i.nodeType===t.ELEMENT_NODE,r="canHaveHTML"in i?i.canHaveHTML:!0,o=n?i.innerHTML:i.data,s=""===o||o===t.INVISIBLE_SPACE;if(s&&n&&r)try{i.innerHTML=t.INVISIBLE_SPACE}catch(a){}e.selectNodeContents(i),s&&n?e.collapse(!1):s&&(e.setStartAfter(i),e.setEndAfter(i))},getTextSelectedByRange:function(t,e){var i=e.cloneRange();i.selectNodeContents(t);var n=i.intersection(e),r=n?n.toString():"";return i.detach(),r},isAppliedToRange:function(e){var i,n=[],r=e.getNodes([t.TEXT_NODE]);if(!r.length)return i=this.getAncestorWithClass(e.startContainer),i?[i]:!1;for(var o,s=0,a=r.length;a>s;++s){if(o=this.getTextSelectedByRange(r[s],e),i=this.getAncestorWithClass(r[s]),""!=o&&!i)return!1;n.push(i)}return n},toggleRange:function(t){this.isAppliedToRange(t)?this.undoToRange(t):this.applyToRange(t)}},t.selection.HTMLApplier=h}(wysihtml5,rangy),wysihtml5.Commands=Base.extend({constructor:function(t){this.editor=t,this.composer=t.composer,this.doc=this.composer.doc},support:function(t){return wysihtml5.browser.supportsCommand(this.doc,t)},exec:function(t,e){var i=wysihtml5.commands[t],n=wysihtml5.lang.array(arguments).get(),r=i&&i.exec,o=null;if(this.editor.fire("beforecommand:composer"),r)n.unshift(this.composer),o=r.apply(i,n);else try{o=this.doc.execCommand(t,!1,e)}catch(s){}return this.editor.fire("aftercommand:composer"),o},state:function(t){var e=wysihtml5.commands[t],i=wysihtml5.lang.array(arguments).get(),n=e&&e.state;if(n)return i.unshift(this.composer),n.apply(e,i);try{return this.doc.queryCommandState(t)}catch(r){return!1}},value:function(t){var e=wysihtml5.commands[t],i=e&&e.value;if(i)return i.call(e,this.composer,t);try{return this.doc.queryCommandValue(t)}catch(n){return null}}}),function(t){var e;t.commands.bold={exec:function(e,i){return t.commands.formatInline.exec(e,i,"b")},state:function(e,i){return t.commands.formatInline.state(e,i,"b")},value:function(){return e}}}(wysihtml5),function(t){function e(t,e){for(var i,n,r,s=e.length,a=0;s>a;a++)i=e[a],n=o.getParentElement(i,{nodeName:"code"}),r=o.getTextContent(i),r.match(o.autoLink.URL_REG_EXP)&&!n?n=o.renameElement(i,"code"):o.replaceWithChildNodes(i)}function i(e,i){var s,a,l,c,d,h,u,f,p,m=e.doc,g="_wysihtml5-temp-"+ +new Date,v=/non-matching-class/g,b=0;for(t.commands.formatInline.exec(e,n,r,g,v),a=m.querySelectorAll(r+"."+g),s=a.length;s>b;b++){l=a[b],l.removeAttribute("class");for(p in i)l.setAttribute(p,i[p])}h=l,1===s&&(u=o.getTextContent(l),c=!!l.querySelector("*"),d=""===u||u===t.INVISIBLE_SPACE,!c&&d&&(o.setTextContent(l,i.text||l.href),f=m.createTextNode(" "),e.selection.setAfter(l),e.selection.insertNode(f),h=f)),e.selection.setAfter(h)}var n,r="A",o=t.dom;t.commands.createLink={exec:function(t,n,r){var o=this.state(t,n);o?t.selection.executeAndRestore(function(){e(t,o)}):(r="object"==typeof r?r:{href:r},i(t,r))},state:function(e,i){return t.commands.formatInline.state(e,i,"A")},value:function(){return n}}}(wysihtml5),function(t){var e,i=/wysiwyg-font-size-[a-z\-]+/g;t.commands.fontSize={exec:function(e,n,r){return t.commands.formatInline.exec(e,n,"span","wysiwyg-font-size-"+r,i)},state:function(e,n,r){return t.commands.formatInline.state(e,n,"span","wysiwyg-font-size-"+r,i)},value:function(){return e}}}(wysihtml5),function(t){var e,i=/wysiwyg-color-[a-z]+/g;t.commands.foreColor={exec:function(e,n,r){return t.commands.formatInline.exec(e,n,"span","wysiwyg-color-"+r,i)},state:function(e,n,r){return t.commands.formatInline.state(e,n,"span","wysiwyg-color-"+r,i)},value:function(){return e}}}(wysihtml5),function(t){function e(t,e,n){t.className?(i(t,n),t.className+=" "+e):t.className=e}function i(t,e){t.className=t.className.replace(e,"")}function n(e){return e.nodeType===t.TEXT_NODE&&!t.lang.string(e.data).trim()}function r(t){for(var e=t.previousSibling;e&&n(e);)e=e.previousSibling;return e}function o(t){for(var e=t.nextSibling;e&&n(e);)e=e.nextSibling;return e}function s(t){var e=t.ownerDocument,i=o(t),n=r(t);i&&!d(i)&&t.parentNode.insertBefore(e.createElement("br"),i),n&&!d(n)&&t.parentNode.insertBefore(e.createElement("br"),t)}function a(t){var e=o(t),i=r(t);e&&c(e)&&e.parentNode.removeChild(e),i&&c(i)&&i.parentNode.removeChild(i)}function l(t){var e=t.lastChild;e&&c(e)&&e.parentNode.removeChild(e)}function c(t){return"BR"===t.nodeName}function d(t){return c(t)?!0:"block"===m.getStyle("display").from(t)?!0:!1}function h(e,i,n,r){if(r)var o=m.observe(e,"DOMNodeInserted",function(e){var i,n=e.target;n.nodeType===t.ELEMENT_NODE&&(i=m.getStyle("display").from(n),"inline"!==i.substr(0,6)&&(n.className+=" "+r))});e.execCommand(i,!1,n),o&&o.stop()}function u(t,e){t.selection.selectLine(),t.selection.surround(e),a(e),l(e),t.selection.selectNode(e)}function f(e){return!!t.lang.string(e.className).trim()}var p,m=t.dom,g="DIV",v=["H1","H2","H3","H4","H5","H6","P","BLOCKQUOTE",g];t.commands.formatBlock={exec:function(n,r,o,a,l){var c,d=n.doc,p=this.state(n,r,o,a,l);return o="string"==typeof o?o.toUpperCase():o,p?(n.selection.executeAndRestoreSimple(function(){l&&i(p,l);var t=f(p);t||p.nodeName!==(o||g)?t&&m.renameElement(p,g):(s(p),m.replaceWithChildNodes(p))}),void 0):(null===o||t.lang.array(v).contains(o))&&(c=n.selection.getSelectedNode(),p=m.getParentElement(c,{nodeName:v}))?(n.selection.executeAndRestoreSimple(function(){o&&(p=m.renameElement(p,o)),a&&e(p,a,l)}),void 0):n.commands.support(r)?(h(d,r,o||g,a),void 0):(p=d.createElement(o||g),a&&(p.className=a),u(n,p),void 0)},state:function(t,e,i,n,r){i="string"==typeof i?i.toUpperCase():i;var o=t.selection.getSelectedNode();return m.getParentElement(o,{nodeName:i,className:n,classRegExp:r})},value:function(){return p}}}(wysihtml5),function(t){function e(t){var e=r[t];return e?[t.toLowerCase(),e.toLowerCase()]:[t.toLowerCase()]}function i(i,n,r){var s=i+":"+n;return o[s]||(o[s]=new t.selection.HTMLApplier(e(i),n,r,!0)),o[s]}var n,r={strong:"b",em:"i",b:"strong",i:"em"},o={};t.commands.formatInline={exec:function(t,e,n,r,o){var s=t.selection.getRange();return s?(i(n,r,o).toggleRange(s),t.selection.setSelection(s),void 0):!1},state:function(e,n,o,s,a){var l,c=e.doc,d=r[o]||o;return t.dom.hasElementWithTagName(c,o)||t.dom.hasElementWithTagName(c,d)?s&&!t.dom.hasElementWithClassName(c,s)?!1:(l=e.selection.getRange(),l?i(o,s,a).isAppliedToRange(l):!1):!1},value:function(){return n}}}(wysihtml5),function(t){var e;t.commands.insertHTML={exec:function(t,e,i){t.commands.support(e)?t.doc.execCommand(e,!1,i):t.selection.insertHTML(i)},state:function(){return!1},value:function(){return e}}}(wysihtml5),function(t){var e="IMG";t.commands.insertImage={exec:function(i,n,r){r="object"==typeof r?r:{src:r};var o,s,a,l=i.doc,c=this.state(i);if(c)return i.selection.setBefore(c),a=c.parentNode,a.removeChild(c),t.dom.removeEmptyTextNodes(a),"A"!==a.nodeName||a.firstChild||(i.selection.setAfter(a),a.parentNode.removeChild(a)),t.quirks.redraw(i.element),void 0;c=l.createElement(e);for(s in r)c[s]=r[s];i.selection.insertNode(c),t.browser.hasProblemsSettingCaretAfterImg()?(o=l.createTextNode(t.INVISIBLE_SPACE),i.selection.insertNode(o),i.selection.setAfter(o)):i.selection.setAfter(c)},state:function(i){var n,r,o,s=i.doc;return t.dom.hasElementWithTagName(s,e)?(n=i.selection.getSelectedNode())?n.nodeName===e?n:n.nodeType!==t.ELEMENT_NODE?!1:(r=i.selection.getText(),(r=t.lang.string(r).trim())?!1:(o=i.selection.getNodes(t.ELEMENT_NODE,function(t){return"IMG"===t.nodeName}),1!==o.length?!1:o[0])):!1:!1},value:function(t){var e=this.state(t);return e&&e.src}}}(wysihtml5),function(t){var e,i="<br>"+(t.browser.needsSpaceAfterLineBreak()?" ":"");t.commands.insertLineBreak={exec:function(e,n){e.commands.support(n)?(e.doc.execCommand(n,!1,null),t.browser.autoScrollsToCaret()||e.selection.scrollIntoView()):e.commands.exec("insertHTML",i)},state:function(){return!1},value:function(){return e}}}(wysihtml5),function(t){var e;t.commands.insertOrderedList={exec:function(e,i){var n,r,o=e.doc,s=e.selection.getSelectedNode(),a=t.dom.getParentElement(s,{nodeName:"OL"}),l=t.dom.getParentElement(s,{nodeName:"UL"}),c="_wysihtml5-temp-"+(new Date).getTime();return e.commands.support(i)?(o.execCommand(i,!1,null),void 0):(a?e.selection.executeAndRestoreSimple(function(){t.dom.resolveList(a)}):l?e.selection.executeAndRestoreSimple(function(){t.dom.renameElement(l,"ol")}):(e.commands.exec("formatBlock","div",c),r=o.querySelector("."+c),n=""===r.innerHTML||r.innerHTML===t.INVISIBLE_SPACE,e.selection.executeAndRestoreSimple(function(){a=t.dom.convertToList(r,"ol")}),n&&e.selection.selectNode(a.querySelector("li"))),void 0)},state:function(e){var i=e.selection.getSelectedNode();return t.dom.getParentElement(i,{nodeName:"OL"})},value:function(){return e}}}(wysihtml5),function(t){var e;t.commands.insertUnorderedList={exec:function(e,i){var n,r,o=e.doc,s=e.selection.getSelectedNode(),a=t.dom.getParentElement(s,{nodeName:"UL"}),l=t.dom.getParentElement(s,{nodeName:"OL"}),c="_wysihtml5-temp-"+(new Date).getTime();return e.commands.support(i)?(o.execCommand(i,!1,null),void 0):(a?e.selection.executeAndRestoreSimple(function(){t.dom.resolveList(a)}):l?e.selection.executeAndRestoreSimple(function(){t.dom.renameElement(l,"ul")}):(e.commands.exec("formatBlock","div",c),r=o.querySelector("."+c),n=""===r.innerHTML||r.innerHTML===t.INVISIBLE_SPACE,e.selection.executeAndRestoreSimple(function(){a=t.dom.convertToList(r,"ul")}),n&&e.selection.selectNode(a.querySelector("li"))),void 0)},state:function(e){var i=e.selection.getSelectedNode();return t.dom.getParentElement(i,{nodeName:"UL"})},value:function(){return e}}}(wysihtml5),function(t){var e;t.commands.italic={exec:function(e,i){return t.commands.formatInline.exec(e,i,"i")},state:function(e,i){return t.commands.formatInline.state(e,i,"i")},value:function(){return e}}}(wysihtml5),function(t){var e,i="wysiwyg-text-align-center",n=/wysiwyg-text-align-[a-z]+/g;t.commands.justifyCenter={exec:function(e){return t.commands.formatBlock.exec(e,"formatBlock",null,i,n)},state:function(e){return t.commands.formatBlock.state(e,"formatBlock",null,i,n)},value:function(){return e}}}(wysihtml5),function(t){var e,i="wysiwyg-text-align-left",n=/wysiwyg-text-align-[a-z]+/g;t.commands.justifyLeft={exec:function(e){return t.commands.formatBlock.exec(e,"formatBlock",null,i,n)},state:function(e){return t.commands.formatBlock.state(e,"formatBlock",null,i,n)},value:function(){return e}}}(wysihtml5),function(t){var e,i="wysiwyg-text-align-right",n=/wysiwyg-text-align-[a-z]+/g;t.commands.justifyRight={exec:function(e){return t.commands.formatBlock.exec(e,"formatBlock",null,i,n)},state:function(e){return t.commands.formatBlock.state(e,"formatBlock",null,i,n)},value:function(){return e}}}(wysihtml5),function(t){var e;t.commands.underline={exec:function(e,i){return t.commands.formatInline.exec(e,i,"u")},state:function(e,i){return t.commands.formatInline.state(e,i,"u")},value:function(){return e}}}(wysihtml5),function(t){function e(t){for(var e;e=t.querySelector("._wysihtml5-temp");)e.parentNode.removeChild(e)}var i=90,n=89,r=8,o=46,s=40,a='<span id="_wysihtml5-undo" class="_wysihtml5-temp">'+t.INVISIBLE_SPACE+"</span>",l='<span id="_wysihtml5-redo" class="_wysihtml5-temp">'+t.INVISIBLE_SPACE+"</span>",c=t.dom;t.UndoManager=t.lang.Dispatcher.extend({constructor:function(t){this.editor=t,this.composer=t.composer,this.element=this.composer.element,this.history=[this.composer.getValue()],this.position=1,this.composer.commands.support("insertHTML")&&this._observe()},_observe:function(){var s,d=this,h=this.composer.sandbox.getDocument();if(c.observe(this.element,"keydown",function(t){if(!t.altKey&&(t.ctrlKey||t.metaKey)){var e=t.keyCode,r=e===i&&!t.shiftKey,o=e===i&&t.shiftKey||e===n;r?(d.undo(),t.preventDefault()):o&&(d.redo(),t.preventDefault())}}),c.observe(this.element,"keydown",function(t){var e=t.keyCode;e!==s&&(s=e,(e===r||e===o)&&d.transact())}),t.browser.hasUndoInContextMenu()){var u,f,p=function(){e(h),clearInterval(u)};c.observe(this.element,"contextmenu",function(){p(),d.composer.selection.executeAndRestoreSimple(function(){d.element.lastChild&&d.composer.selection.setAfter(d.element.lastChild),h.execCommand("insertHTML",!1,a),h.execCommand("insertHTML",!1,l),h.execCommand("undo",!1,null)}),u=setInterval(function(){h.getElementById("_wysihtml5-redo")?(p(),d.redo()):h.getElementById("_wysihtml5-undo")||(p(),d.undo())},400),f||(f=!0,c.observe(document,"mousedown",p),c.observe(h,["mousedown","paste","cut","copy"],p))})}this.editor.observe("newword:composer",function(){d.transact()}).observe("beforecommand:composer",function(){d.transact()})},transact:function(){var t=this.history[this.position-1],e=this.composer.getValue();if(e!=t){var i=this.history.length=this.position;i>s&&(this.history.shift(),this.position--),this.position++,this.history.push(e)}},undo:function(){this.transact(),this.position<=1||(this.set(this.history[--this.position-1]),this.editor.fire("undo:composer"))},redo:function(){this.position>=this.history.length||(this.set(this.history[++this.position-1]),this.editor.fire("redo:composer"))},set:function(t){this.composer.setValue(t),this.editor.focus(!0)}})}(wysihtml5),wysihtml5.views.View=Base.extend({constructor:function(t,e,i){this.parent=t,this.element=e,this.config=i,this._observeViewChange()},_observeViewChange:function(){var t=this;this.parent.observe("beforeload",function(){t.parent.observe("change_view",function(e){e===t.name?(t.parent.currentView=t,t.show(),setTimeout(function(){t.focus()},0)):t.hide()})})},focus:function(){if(this.element.ownerDocument.querySelector(":focus")!==this.element)try{this.element.focus()}catch(t){}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}}),function(t){var e=t.dom,i=t.browser;t.views.Composer=t.views.View.extend({name:"composer",CARET_HACK:"<br>",constructor:function(t,e,i){this.base(t,e,i),this.textarea=this.parent.textarea,this._initSandbox()},clear:function(){this.element.innerHTML=i.displaysCaretInEmptyContentEditableCorrectly()?"":this.CARET_HACK},getValue:function(e){var i=this.isEmpty()?"":t.quirks.getCorrectInnerHTML(this.element);return e&&(i=this.parent.parse(i)),i=t.lang.string(i).replace(t.INVISIBLE_SPACE).by("")},setValue:function(t,e){e&&(t=this.parent.parse(t)),this.element.innerHTML=t},show:function(){this.iframe.style.display=this._displayStyle||"",this.disable(),this.enable()},hide:function(){this._displayStyle=e.getStyle("display").from(this.iframe),"none"===this._displayStyle&&(this._displayStyle=null),this.iframe.style.display="none"},disable:function(){this.element.removeAttribute("contentEditable"),this.base()},enable:function(){this.element.setAttribute("contentEditable","true"),this.base()},focus:function(e){t.browser.doesAsyncFocus()&&this.hasPlaceholderSet()&&this.clear(),this.base();var i=this.element.lastChild;e&&i&&("BR"===i.nodeName?this.selection.setBefore(this.element.lastChild):this.selection.setAfter(this.element.lastChild))},getTextContent:function(){return e.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==this.textarea.element.getAttribute("placeholder")},isEmpty:function(){var t=this.element.innerHTML,e="blockquote, ul, ol, img, embed, object, table, iframe, svg, video, audio, button, input, select, textarea";return""===t||t===this.CARET_HACK||this.hasPlaceholderSet()||""===this.getTextContent()&&!this.element.querySelector(e)},_initSandbox:function(){var t=this;this.sandbox=new e.Sandbox(function(){t._create()},{stylesheets:this.config.stylesheets}),this.iframe=this.sandbox.getIframe();var i=document.createElement("input");i.type="hidden",i.name="_wysihtml5_mode",i.value=1;var n=this.textarea.element;e.insert(this.iframe).after(n),e.insert(i).after(n)},_create:function(){var n=this;this.doc=this.sandbox.getDocument(),this.element=this.doc.body,this.textarea=this.parent.textarea,this.element.innerHTML=this.textarea.getValue(!0),this.enable(),this.selection=new t.Selection(this.parent),this.commands=new t.Commands(this.parent),e.copyAttributes(["className","spellcheck","title","lang","dir","accessKey"]).from(this.textarea.element).to(this.element),e.addClass(this.element,this.config.composerClassName),this.config.style&&this.style(),this.observe();var r=this.config.name;r&&(e.addClass(this.element,r),e.addClass(this.iframe,r));var o="string"==typeof this.config.placeholder?this.config.placeholder:this.textarea.element.getAttribute("placeholder");o&&e.simulatePlaceholder(this.parent,this,o),this.commands.exec("styleWithCSS",!1),this._initAutoLinking(),this._initObjectResizing(),this._initUndoManager(),(this.textarea.element.hasAttribute("autofocus")||document.querySelector(":focus")==this.textarea.element)&&setTimeout(function(){n.focus()},100),t.quirks.insertLineBreakOnReturn(this),i.clearsContentEditableCorrectly()||t.quirks.ensureProperClearing(this),i.clearsListsInContentEditableCorrectly()||t.quirks.ensureProperClearingOfLists(this),this.initSync&&this.config.sync&&this.initSync(),this.textarea.hide(),this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var n=this,r=i.canDisableAutoLinking(),o=i.doesAutoLinkingInContentEditable();if(r&&this.commands.exec("autoUrlDetect",!1),this.config.autoLink){(!o||o&&r)&&this.parent.observe("newword:composer",function(){n.selection.executeAndRestore(function(t,i){e.autoLink(i.parentNode)})});var s=this.sandbox.getDocument().getElementsByTagName("a"),a=e.autoLink.URL_REG_EXP,l=function(i){var n=t.lang.string(e.getTextContent(i)).trim();return"www."===n.substr(0,4)&&(n="http://"+n),n};e.observe(this.element,"keydown",function(t){if(s.length){var i,r=n.selection.getSelectedNode(t.target.ownerDocument),o=e.getParentElement(r,{nodeName:"A"},4);o&&(i=l(o),setTimeout(function(){var t=l(o);t!==i&&t.match(a)&&o.setAttribute("href",t)},0))}})}},_initObjectResizing:function(){var n=["width","height"],r=n.length,o=this.element;this.commands.exec("enableObjectResizing",this.config.allowObjectResizing),this.config.allowObjectResizing?i.supportsEvent("resizeend")&&e.observe(o,"resizeend",function(e){for(var i,s=e.target||e.srcElement,a=s.style,l=0;r>l;l++)i=n[l],a[i]&&(s.setAttribute(i,parseInt(a[i],10)),a[i]="");t.quirks.redraw(o)}):i.supportsEvent("resizestart")&&e.observe(o,"resizestart",function(t){t.preventDefault()})},_initUndoManager:function(){new t.UndoManager(this.parent)}})}(wysihtml5),function(t){var e=t.dom,i=document,n=window,r=i.createElement("div"),o=["background-color","color","cursor","font-family","font-size","font-style","font-variant","font-weight","line-height","letter-spacing","text-align","text-decoration","text-indent","text-rendering","word-break","word-wrap","word-spacing"],s=["background-color","border-collapse","border-bottom-color","border-bottom-style","border-bottom-width","border-left-color","border-left-style","border-left-width","border-right-color","border-right-style","border-right-width","border-top-color","border-top-style","border-top-width","clear","display","float","margin-bottom","margin-left","margin-right","margin-top","outline-color","outline-offset","outline-width","outline-style","padding-left","padding-right","padding-top","padding-bottom","position","top","left","right","bottom","z-index","vertical-align","text-align","-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing","-webkit-box-shadow","-moz-box-shadow","-ms-box-shadow","box-shadow","-webkit-border-top-right-radius","-moz-border-radius-topright","border-top-right-radius","-webkit-border-bottom-right-radius","-moz-border-radius-bottomright","border-bottom-right-radius","-webkit-border-bottom-left-radius","-moz-border-radius-bottomleft","border-bottom-left-radius","-webkit-border-top-left-radius","-moz-border-radius-topleft","border-top-left-radius","width","height"],a=["width","height","top","left","right","bottom"],l=["html             { height: 100%; }","body             { min-height: 100%; padding: 0; margin: 0; margin-top: -1px; padding-top: 1px; }","._wysihtml5-temp { display: none; }",t.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","body[disabled]   { background-color: #eee !important; color: #999 !important; cursor: default !important; }","img:-moz-broken  { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"],c=function(t){if(t.setActive)try{t.setActive()}catch(r){}else{var o=t.style,s=i.documentElement.scrollTop||i.body.scrollTop,a=i.documentElement.scrollLeft||i.body.scrollLeft,l={position:o.position,top:o.top,left:o.left,WebkitUserSelect:o.WebkitUserSelect};e.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(t),t.focus(),e.setStyles(l).on(t),n.scrollTo&&n.scrollTo(a,s)}};t.views.Composer.prototype.style=function(){var d=this,h=i.querySelector(":focus"),u=this.textarea.element,f=u.hasAttribute("placeholder"),p=f&&u.getAttribute("placeholder");this.focusStylesHost=this.focusStylesHost||r.cloneNode(!1),this.blurStylesHost=this.blurStylesHost||r.cloneNode(!1),f&&u.removeAttribute("placeholder"),u===h&&u.blur(),e.copyStyles(s).from(u).to(this.iframe).andTo(this.blurStylesHost),e.copyStyles(o).from(u).to(this.element).andTo(this.blurStylesHost),e.insertCSS(l).into(this.element.ownerDocument),c(u),e.copyStyles(s).from(u).to(this.focusStylesHost),e.copyStyles(o).from(u).to(this.focusStylesHost);var m=t.lang.array(s).without(["display"]);if(h?h.focus():u.blur(),f&&u.setAttribute("placeholder",p),!t.browser.hasCurrentStyleProperty())var g=e.observe(n,"resize",function(){if(!e.contains(document.documentElement,d.iframe))return g.stop(),void 0;var t=e.getStyle("display").from(u),i=e.getStyle("display").from(d.iframe);u.style.display="",d.iframe.style.display="none",e.copyStyles(a).from(u).to(d.iframe).andTo(d.focusStylesHost).andTo(d.blurStylesHost),d.iframe.style.display=i,u.style.display=t});return this.parent.observe("focus:composer",function(){e.copyStyles(m).from(d.focusStylesHost).to(d.iframe),e.copyStyles(o).from(d.focusStylesHost).to(d.element)}),this.parent.observe("blur:composer",function(){e.copyStyles(m).from(d.blurStylesHost).to(d.iframe),e.copyStyles(o).from(d.blurStylesHost).to(d.element)}),this}}(wysihtml5),function(t){var e=t.dom,i=t.browser,n={66:"bold",73:"italic",85:"underline"};t.views.Composer.prototype.observe=function(){var r=this,o=this.getValue(),s=this.sandbox.getIframe(),a=this.element,l=i.supportsEventsInIframeCorrectly()?a:this.sandbox.getWindow(),c=i.supportsEvent("drop")?["drop","paste"]:["dragdrop","paste"];e.observe(s,"DOMNodeRemoved",function(){clearInterval(d),r.parent.fire("destroy:composer")});var d=setInterval(function(){e.contains(document.documentElement,s)||(clearInterval(d),r.parent.fire("destroy:composer"))},250);e.observe(l,"focus",function(){r.parent.fire("focus").fire("focus:composer"),setTimeout(function(){o=r.getValue()},0)}),e.observe(l,"blur",function(){o!==r.getValue()&&r.parent.fire("change").fire("change:composer"),r.parent.fire("blur").fire("blur:composer")}),t.browser.isIos()&&e.observe(a,"blur",function(){var t=a.ownerDocument.createElement("input"),e=document.documentElement.scrollTop||document.body.scrollTop,i=document.documentElement.scrollLeft||document.body.scrollLeft;try{r.selection.insertNode(t)}catch(n){a.appendChild(t)}t.focus(),t.parentNode.removeChild(t),window.scrollTo(i,e)}),e.observe(a,"dragenter",function(){r.parent.fire("unset_placeholder")}),i.firesOnDropOnlyWhenOnDragOverIsCancelled()&&e.observe(a,["dragover","dragenter"],function(t){t.preventDefault()}),e.observe(a,c,function(t){var e,n=t.dataTransfer;n&&i.supportsDataTransfer()&&(e=n.getData("text/html")||n.getData("text/plain")),e?(a.focus(),r.commands.exec("insertHTML",e),r.parent.fire("paste").fire("paste:composer"),t.stopPropagation(),t.preventDefault()):setTimeout(function(){r.parent.fire("paste").fire("paste:composer")},0)}),e.observe(a,"keyup",function(e){var i=e.keyCode;(i===t.SPACE_KEY||i===t.ENTER_KEY)&&r.parent.fire("newword:composer")}),this.parent.observe("paste:composer",function(){setTimeout(function(){r.parent.fire("newword:composer")},0)}),i.canSelectImagesInContentEditable()||e.observe(a,"mousedown",function(t){var e=t.target;"IMG"===e.nodeName&&(r.selection.selectNode(e),t.preventDefault())}),e.observe(a,"keydown",function(t){var e=t.keyCode,i=n[e];(t.ctrlKey||t.metaKey)&&!t.altKey&&i&&(r.commands.exec(i),t.preventDefault())}),e.observe(a,"keydown",function(e){var i,n=r.selection.getSelectedNode(!0),o=e.keyCode;!n||"IMG"!==n.nodeName||o!==t.BACKSPACE_KEY&&o!==t.DELETE_KEY||(i=n.parentNode,i.removeChild(n),"A"!==i.nodeName||i.firstChild||i.parentNode.removeChild(i),setTimeout(function(){t.quirks.redraw(a)},0),e.preventDefault())});var h={IMG:"Image: ",A:"Link: "};e.observe(a,"mouseover",function(t){var e,i=t.target,n=i.nodeName;if("A"===n||"IMG"===n){var r=i.hasAttribute("title");r||(e=h[n]+(i.getAttribute("href")||i.getAttribute("src")),i.setAttribute("title",e))}})}}(wysihtml5),function(t){var e=400;t.views.Synchronizer=Base.extend({constructor:function(t,e,i){this.editor=t,this.textarea=e,this.composer=i,this._observe()},fromComposerToTextarea:function(e){this.textarea.setValue(t.lang.string(this.composer.getValue()).trim(),e)},fromTextareaToComposer:function(t){var e=this.textarea.getValue();e?this.composer.setValue(e,t):(this.composer.clear(),this.editor.fire("set_placeholder"))},sync:function(t){"textarea"===this.editor.currentView.name?this.fromTextareaToComposer(t):this.fromComposerToTextarea(t)},_observe:function(){var i,n=this,r=this.textarea.element.form,o=function(){i=setInterval(function(){n.fromComposerToTextarea()},e)},s=function(){clearInterval(i),i=null};o(),r&&(t.dom.observe(r,"submit",function(){n.sync(!0)}),t.dom.observe(r,"reset",function(){setTimeout(function(){n.fromTextareaToComposer()},0)})),this.editor.observe("change_view",function(t){"composer"!==t||i?"textarea"===t&&(n.fromComposerToTextarea(!0),s()):(n.fromTextareaToComposer(!0),o())}),this.editor.observe("destroy:composer",s)}})}(wysihtml5),wysihtml5.views.Textarea=wysihtml5.views.View.extend({name:"textarea",constructor:function(t,e,i){this.base(t,e,i),this._observe()},clear:function(){this.element.value=""},getValue:function(t){var e=this.isEmpty()?"":this.element.value;return t&&(e=this.parent.parse(e)),e},setValue:function(t,e){e&&(t=this.parent.parse(t)),this.element.value=t},hasPlaceholderSet:function(){var t=wysihtml5.browser.supportsPlaceholderAttributeOn(this.element),e=this.element.getAttribute("placeholder")||null,i=this.element.value,n=!i;return t&&n||i===e},isEmpty:function(){return!wysihtml5.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var t=this.element,e=this.parent,i={focusin:"focus",focusout:"blur"},n=wysihtml5.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];e.observe("beforeload",function(){wysihtml5.dom.observe(t,n,function(t){var n=i[t.type]||t.type;e.fire(n).fire(n+":textarea")}),wysihtml5.dom.observe(t,["paste","drop"],function(){setTimeout(function(){e.fire("paste").fire("paste:textarea")},0)})})}}),function(t){var e=t.dom,i="wysihtml5-command-dialog-opened",n="input, select, textarea",r="[data-wysihtml5-dialog-field]",o="data-wysihtml5-dialog-field";t.toolbar.Dialog=t.lang.Dispatcher.extend({constructor:function(t,e){this.link=t,this.container=e},_observe:function(){if(!this._observed){var r=this,o=function(t){var e=r._serialize();e==r.elementToChange?r.fire("edit",e):r.fire("save",e),r.hide(),t.preventDefault(),t.stopPropagation()};e.observe(r.link,"click",function(){e.hasClass(r.link,i)&&setTimeout(function(){r.hide()},0)}),e.observe(this.container,"keydown",function(e){var i=e.keyCode;i===t.ENTER_KEY&&o(e),i===t.ESCAPE_KEY&&r.hide()}),e.delegate(this.container,"[data-wysihtml5-dialog-action=save]","click",o),e.delegate(this.container,"[data-wysihtml5-dialog-action=cancel]","click",function(t){r.fire("cancel"),r.hide(),t.preventDefault(),t.stopPropagation()});for(var s=this.container.querySelectorAll(n),a=0,l=s.length,c=function(){clearInterval(r.interval)};l>a;a++)e.observe(s[a],"change",c);this._observed=!0}},_serialize:function(){for(var t=this.elementToChange||{},e=this.container.querySelectorAll(r),i=e.length,n=0;i>n;n++)t[e[n].getAttribute(o)]=e[n].value;return t},_interpolate:function(t){for(var e,i,n,s=document.querySelector(":focus"),a=this.container.querySelectorAll(r),l=a.length,c=0;l>c;c++)e=a[c],e!==s&&(t&&"hidden"===e.type||(i=e.getAttribute(o),n=this.elementToChange?this.elementToChange[i]||"":e.defaultValue,e.value=n))},show:function(t){var r=this,o=this.container.querySelector(n);if(this.elementToChange=t,this._observe(),this._interpolate(),t&&(this.interval=setInterval(function(){r._interpolate(!0)},500)),e.addClass(this.link,i),this.container.style.display="",this.fire("show"),o&&!t)try{o.focus()}catch(s){}},hide:function(){clearInterval(this.interval),this.elementToChange=null,e.removeClass(this.link,i),this.container.style.display="none",this.fire("hide")}})}(wysihtml5),function(t){var e=t.dom,i={position:"relative"},n={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1},r={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"},o={"x-webkit-speech":"",speech:""};t.toolbar.Speech=function(s,a){var l=document.createElement("input");if(!t.browser.supportsSpeechApiOn(l))return a.style.display="none",void 0;var c=document.createElement("div");t.lang.object(n).merge({width:a.offsetWidth+"px",height:a.offsetHeight+"px"}),e.insert(l).into(c),e.insert(c).into(a),e.setStyles(r).on(l),e.setAttributes(o).on(l),e.setStyles(n).on(c),e.setStyles(i).on(a);var d="onwebkitspeechchange"in l?"webkitspeechchange":"speechchange";e.observe(l,d,function(){s.execCommand("insertText",l.value),l.value=""}),e.observe(l,"click",function(t){e.hasClass(a,"wysihtml5-command-disabled")&&t.preventDefault(),t.stopPropagation()})}}(wysihtml5),function(t){var e="wysihtml5-command-disabled",i="wysihtml5-commands-disabled",n="wysihtml5-command-active",r="wysihtml5-action-active",o=t.dom;
t.toolbar.Toolbar=Base.extend({constructor:function(e,i){this.editor=e,this.container="string"==typeof i?document.getElementById(i):i,this.composer=e.composer,this._getLinks("command"),this._getLinks("action"),this._observe(),this.show();for(var n=this.container.querySelectorAll("[data-wysihtml5-command=insertSpeech]"),r=n.length,o=0;r>o;o++)new t.toolbar.Speech(this,n[o])},_getLinks:function(e){for(var i,n,r,o,s,a=this[e+"Links"]=t.lang.array(this.container.querySelectorAll("[data-wysihtml5-"+e+"]")).get(),l=a.length,c=0,d=this[e+"Mapping"]={};l>c;c++)i=a[c],r=i.getAttribute("data-wysihtml5-"+e),o=i.getAttribute("data-wysihtml5-"+e+"-value"),n=this.container.querySelector("[data-wysihtml5-"+e+"-group='"+r+"']"),s=this._getDialog(i,r),d[r+":"+o]={link:i,group:n,name:r,value:o,dialog:s,state:!1}},_getDialog:function(e,i){var n,r,o=this,s=this.container.querySelector("[data-wysihtml5-dialog='"+i+"']");return s&&(n=new t.toolbar.Dialog(e,s),n.observe("show",function(){r=o.composer.selection.getBookmark(),o.editor.fire("show:dialog",{command:i,dialogContainer:s,commandLink:e})}),n.observe("save",function(t){r&&o.composer.selection.setBookmark(r),o._execCommand(i,t),o.editor.fire("save:dialog",{command:i,dialogContainer:s,commandLink:e})}),n.observe("cancel",function(){o.editor.focus(!1),o.editor.fire("cancel:dialog",{command:i,dialogContainer:s,commandLink:e})})),n},execCommand:function(t,e){if(!this.commandsDisabled){var i=this.commandMapping[t+":"+e];i&&i.dialog&&!i.state?i.dialog.show():this._execCommand(t,e)}},_execCommand:function(t,e){this.editor.focus(!1),this.composer.commands.exec(t,e),this._updateLinkStates()},execAction:function(t){var e=this.editor;switch(t){case"change_view":e.currentView===e.textarea?e.fire("change_view","composer"):e.fire("change_view","textarea")}},_observe:function(){for(var t=this,e=this.editor,n=this.container,r=this.commandLinks.concat(this.actionLinks),s=r.length,a=0;s>a;a++)o.setAttributes({href:"javascript:;",unselectable:"on"}).on(r[a]);o.delegate(n,"[data-wysihtml5-command]","mousedown",function(t){t.preventDefault()}),o.delegate(n,"[data-wysihtml5-command]","click",function(e){var i=this,n=i.getAttribute("data-wysihtml5-command"),r=i.getAttribute("data-wysihtml5-command-value");t.execCommand(n,r),e.preventDefault()}),o.delegate(n,"[data-wysihtml5-action]","click",function(e){var i=this.getAttribute("data-wysihtml5-action");t.execAction(i),e.preventDefault()}),e.observe("focus:composer",function(){t.bookmark=null,clearInterval(t.interval),t.interval=setInterval(function(){t._updateLinkStates()},500)}),e.observe("blur:composer",function(){clearInterval(t.interval)}),e.observe("destroy:composer",function(){clearInterval(t.interval)}),e.observe("change_view",function(e){setTimeout(function(){t.commandsDisabled="composer"!==e,t._updateLinkStates(),t.commandsDisabled?o.addClass(n,i):o.removeClass(n,i)},0)})},_updateLinkStates:function(){var i,s,a,l,c=(this.composer.element,this.commandMapping),d=this.actionMapping;for(i in c)l=c[i],this.commandsDisabled?(s=!1,o.removeClass(l.link,n),l.group&&o.removeClass(l.group,n),l.dialog&&l.dialog.hide()):(s=this.composer.commands.state(l.name,l.value),t.lang.object(s).isArray()&&(s=1===s.length?s[0]:!0),o.removeClass(l.link,e),l.group&&o.removeClass(l.group,e)),l.state!==s&&(l.state=s,s?(o.addClass(l.link,n),l.group&&o.addClass(l.group,n),l.dialog&&("object"==typeof s?l.dialog.show(s):l.dialog.hide())):(o.removeClass(l.link,n),l.group&&o.removeClass(l.group,n),l.dialog&&l.dialog.hide()));for(i in d)a=d[i],"change_view"===a.name&&(a.state=this.editor.currentView===this.editor.textarea,a.state?o.addClass(a.link,r):o.removeClass(a.link,r))},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}})}(wysihtml5),function(t){var e,i={name:e,style:!0,toolbar:e,autoLink:!0,parserRules:{tags:{br:{},span:{},div:{},p:{}},classes:{}},parser:t.dom.parse,composerClassName:"wysihtml5-editor",bodyClassName:"wysihtml5-supported",stylesheets:[],placeholderText:e,allowObjectResizing:!0,supportTouchDevices:!0};t.Editor=t.lang.Dispatcher.extend({constructor:function(e,n){if(this.textareaElement="string"==typeof e?document.getElementById(e):e,this.config=t.lang.object({}).merge(i).merge(n).get(),this.textarea=new t.views.Textarea(this,this.textareaElement,this.config),this.currentView=this.textarea,this._isCompatible=t.browser.supported(),!this._isCompatible||!this.config.supportTouchDevices&&t.browser.isTouchDevice()){var r=this;return setTimeout(function(){r.fire("beforeload").fire("load")},0),void 0}t.dom.addClass(document.body,this.config.bodyClassName),this.composer=new t.views.Composer(this,this.textareaElement,this.config),this.currentView=this.composer,"function"==typeof this.config.parser&&this._initParser(),this.observe("beforeload",function(){this.synchronizer=new t.views.Synchronizer(this,this.textarea,this.composer),this.config.toolbar&&(this.toolbar=new t.toolbar.Toolbar(this,this.config.toolbar))});try{console.log("Heya! This page is using wysihtml5 for rich text editing. Check out https://github.com/xing/wysihtml5")}catch(o){}},isCompatible:function(){return this._isCompatible},clear:function(){return this.currentView.clear(),this},getValue:function(t){return this.currentView.getValue(t)},setValue:function(t,e){return t?(this.currentView.setValue(t,e),this):this.clear()},focus:function(t){return this.currentView.focus(t),this},disable:function(){return this.currentView.disable(),this},enable:function(){return this.currentView.enable(),this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},parse:function(e){var i=this.config.parser(e,this.config.parserRules,this.composer.sandbox.getDocument(),!0);return"object"==typeof e&&t.quirks.redraw(e),i},_initParser:function(){this.observe("paste:composer",function(){var e=!0,i=this;i.composer.selection.executeAndRestore(function(){t.quirks.cleanPastedHTML(i.composer.element),i.parse(i.composer.element)},e)}),this.observe("paste:textarea",function(){var t,e=this.textarea.getValue();t=this.parse(e),this.textarea.setValue(t)})}})}(wysihtml5),!function(t,e){"use strict";var i={"font-styles":"<li class='dropdown'><a class='btn dropdown-toggle' data-toggle='dropdown' href='#'><i class='icon-font'></i>&nbsp;<span class='current-font'>Normal text</span>&nbsp;<b class='caret'></b></a><ul class='dropdown-menu'><li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='div'>Texte normal</a></li><li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='h1'>Entte 1</a></li><li><a data-wysihtml5-command='formatBlock' data-wysihtml5-command-value='h2'>Entte 2</a></li></ul></li>",emphasis:"<li><div class='btn-group'><a class='btn' data-wysihtml5-command='bold' title='CTRL+B'>Gras</a><a class='btn' data-wysihtml5-command='italic' title='CTRL+I'>Italic</a><a class='btn' data-wysihtml5-command='underline' title='CTRL+U'>Souslign</a></div></li>",lists:"<li><div class='btn-group'><a class='btn' data-wysihtml5-command='insertUnorderedList' title='Unordered List'><i class='icon-list'></i></a><a class='btn' data-wysihtml5-command='insertOrderedList' title='Ordered List'><i class='icon-th-list'></i></a><a class='btn' data-wysihtml5-command='Outdent' title='Outdent'><i class='icon-indent-right'></i></a><a class='btn' data-wysihtml5-command='Indent' title='Indent'><i class='icon-indent-left'></i></a></div></li>",table:"<li><div class='bootstrap-wysihtml5-insert-table-modal modal hide fade'><div class='modal-header'><a class='close' data-dismiss='modal'>&times;</a><h3>Insert Table</h3></div><div class='modal-body'><input value='2' class='bootstrap-wysihtml5-insert-table-columns input-xlarge'><input value='3' class='bootstrap-wysihtml5-insert-table-rows input-xlarge'></div><div class='modal-footer'><a href='#' class='btn' data-dismiss='modal'>Cancel</a><a href='#' class='btn btn-primary' data-dismiss='modal'>Insert Table</a></div></div><a class='btn' data-wysihtml5-command='insertTable' title='Table'><i class='icon-tasks'></i></a></li>",link:"<li><div class='bootstrap-wysihtml5-insert-link-modal modal hide fade'><div class='modal-header'><a class='close' data-dismiss='modal'>&times;</a><h3>Insert Link</h3></div><div class='modal-body'><input value='http://' class='bootstrap-wysihtml5-insert-link-url input-xlarge'></div><div class='modal-footer'><a href='#' class='btn' data-dismiss='modal'>Cancel</a><a href='#' class='btn btn-primary' data-dismiss='modal'>Insert link</a></div></div><a class='btn' data-wysihtml5-command='createLink' title='Link'><i class='icon-share'></i></a></li>",image:"<li><div class='bootstrap-wysihtml5-insert-image-modal modal hide fade'><div class='modal-header'><a class='close' data-dismiss='modal'>&times;</a><h3>Insert Image</h3></div><div class='modal-body'><input value='http://' class='bootstrap-wysihtml5-insert-image-url input-xlarge'><iframe id='dialog_iframe' frameborder='0' marginheight='0' marginwidth='0' border='0' width='100%' height='100%'></iframe></div><div class='modal-footer'><a href='#' class='btn' data-dismiss='modal'>Cancel</a><a href='#' class='btn btn-primary' data-dismiss='modal'>Insert image</a></div></div><a class='btn' data-wysihtml5-command='insertImage' title='Insert image'><i class='icon-picture'></i></a></li>",html:"<li><div class='btn-group'><a class='btn' data-wysihtml5-action='change_view' title='Edit HTML'><i class='icon-pencil'></i></a></div></li>"},n={"font-styles":!0,emphasis:!0,lists:!0,html:!0,table:!1,link:!1,image:!1,events:{},parserRules:{tags:{b:{},i:{},br:{},ol:{},ul:{},li:{},h1:{},h2:{},blockquote:{},u:1,img:{check_attributes:{width:"numbers",alt:"alt",src:"url",height:"numbers"}},a:{set_attributes:{target:"_blank",rel:"nofollow"},check_attributes:{href:"url"}}}},stylesheets:[]},r=function(e,i){this.el=e,this.toolbar=this.createToolbar(e,i||n),this.editor=this.createEditor(i),window.editor=this.editor,t("iframe.wysihtml5-sandbox").each(function(e,i){t(i.contentWindow).off("focus.wysihtml5").on({"focus.wysihtml5":function(){t("li.dropdown").removeClass("open")}})})};r.prototype={constructor:r,createEditor:function(i){i=t.extend(n,i||{}),i.toolbar=this.toolbar[0];var r=new e.Editor(this.el[0],i);if(i&&i.events)for(var o in i.events)r.on(o,i.events[o]);return r},createToolbar:function(e,r){var o=this,s=t("<ul/>",{"class":"wysihtml5-toolbar",style:"display:none"});for(var a in n){var l=!1;void 0!==r[a]?r[a]===!0&&(l=!0):l=n[a],l===!0&&(s.append(i[a]),"html"==a&&this.initHtml(s),"link"==a&&this.initInsertLink(s),"image"==a&&this.initInsertImage(s),"table"==a&&this.initInsertTable(s))}return s.find("a[data-wysihtml5-command='formatBlock']").click(function(e){var i=t(e.srcElement);o.toolbar.find(".current-font").text(i.html())}),this.el.before(s),s},initHtml:function(t){var e="a[data-wysihtml5-action='change_view']";t.find(e).click(function(){t.find("a.btn").not(e).toggleClass("disabled")})},initInsertTable:function(t){var e=this,i=t.find(".bootstrap-wysihtml5-insert-table-modal"),n=i.find(".bootstrap-wysihtml5-insert-table-columns"),r=i.find(".bootstrap-wysihtml5-insert-table-rows"),o=i.find("a.btn-primary"),s=n.val(),a=r.val(),l=function(){var t=n.val();n.val(s);var i=r.val();r.val(a);for(var o="<tr>",l=0;t>l;l++)o+="<td></td>";o+="</tr>";for(var c="<table class='table'><tbody>",d=0;i>d;d++)c+=o;c+="</tbody></table>",e.editor.composer.commands.exec("insertHTML",c)};o.click(l),i.on("shown",function(){n.focus()}),i.on("hide",function(){e.editor.currentView.element.focus()}),t.find("a[data-wysihtml5-command=insertTable]").click(function(){return i.modal("show"),i.on("click.dismiss.modal",'[data-dismiss="modal"]',function(t){t.stopPropagation()}),!1})},initInsertImage:function(t){var e=this,i=t.find(".bootstrap-wysihtml5-insert-image-modal"),n=i.find(".bootstrap-wysihtml5-insert-image-url"),r=i.find("a.btn-primary"),o=n.val(),s=function(){var t=n.val();n.val(o),e.editor.composer.commands.exec("insertImage",t)};n.keypress(function(t){13==t.which&&(s(),i.modal("hide"))}),r.click(s),i.on("shown",function(){n.focus()}),i.on("hide",function(){e.editor.currentView.element.focus()}),t.find("a[data-wysihtml5-command=insertImage]").click(function(){return i.find("#dialog_iframe").attr("src","/admin/sites/1/images/insert?dialog=true"),i.modal("show"),i.on("click.dismiss.modal",'[data-dismiss="modal"]',function(t){t.stopPropagation()}),!1})},initInsertLink:function(t){var e=this,i=t.find(".bootstrap-wysihtml5-insert-link-modal"),n=i.find(".bootstrap-wysihtml5-insert-link-url"),r=i.find("a.btn-primary"),o=n.val(),s=function(){var t=n.val();n.val(o),e.editor.composer.commands.exec("createLink",{href:t,target:"_blank",rel:"nofollow"})};n.keypress(function(t){13==t.which&&(s(),i.modal("hide"))}),r.click(s),i.on("shown",function(){n.focus()}),i.on("hide",function(){e.editor.currentView.element.focus()}),t.find("a[data-wysihtml5-command=createLink]").click(function(){return i.modal("show"),i.on("click.dismiss.modal",'[data-dismiss="modal"]',function(t){t.stopPropagation()}),!1})}},t.fn.wysihtml5=function(e){return this.each(function(){var i=t(this);i.data("wysihtml5",new r(i,e))})},t.fn.wysihtml5.Constructor=r}(window.jQuery,window.wysihtml5),/*
 * Bootstrap Image Gallery 2.8.1
 * https://github.com/blueimp/Bootstrap-Image-Gallery
 *
 * Copyright 2011, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */
function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery","load-image","bootstrap"],t):t(window.jQuery,window.loadImage)}(function(t,e){"use strict";t.extend(t.fn.modal.defaults,{delegate:document,selector:null,filter:"*",index:0,href:null,preloadRange:2,offsetWidth:100,offsetHeight:200,canvas:!1,slideshow:0,imageClickDivision:.5});var i=t.fn.modal.Constructor.prototype.show,n=t.fn.modal.Constructor.prototype.hide;t.extend(t.fn.modal.Constructor.prototype,{initLinks:function(){var e=this,i=this.options,n=i.selector||"a[data-target="+i.target+"]";this.$links=t(i.delegate).find(n).filter(i.filter).each(function(t){e.getUrl(this)===i.href&&(i.index=t)}),this.$links[i.index]||(i.index=0)},getUrl:function(e){return e.href||t(e).data("href")},startSlideShow:function(){var t=this;this.options.slideshow&&(this._slideShow=window.setTimeout(function(){t.next()},this.options.slideshow))},stopSlideShow:function(){window.clearTimeout(this._slideShow)},toggleSlideShow:function(){var t=this.$element.find(".modal-slideshow");this.options.slideshow?(this.options.slideshow=0,this.stopSlideShow()):(this.options.slideshow=t.data("slideshow")||5e3,this.startSlideShow()),t.find("i").toggleClass("icon-play icon-pause")},preloadImages:function(){var e,i,n=this.options,r=n.index+n.preloadRange+1;for(i=n.index-n.preloadRange;r>i;i+=1)e=this.$links[i],e&&i!==n.index&&t("<img>").prop("src",this.getUrl(e))},loadImage:function(){var t,i=this,n=this.$element,r=this.options.index,o=this.getUrl(this.$links[r]);this.abortLoad(),this.stopSlideShow(),n.trigger("beforeLoad"),this._loadingTimeout=window.setTimeout(function(){n.addClass("modal-loading")},100),t=n.find(".modal-image").children().removeClass("in"),window.setTimeout(function(){t.remove()},3e3),n.find(".modal-title").text(this.$links[r].title),n.find(".modal-download").prop("href",o),this._loadingImage=e(o,function(t){i.img=t,window.clearTimeout(i._loadingTimeout),n.removeClass("modal-loading"),n.trigger("load"),i.showImage(t),i.startSlideShow()},this._loadImageOptions),this.preloadImages()},showImage:function(e){var i,n,r=this.$element,o=t.support.transition&&r.hasClass("fade"),s=o?r.animate:r.css,a=r.find(".modal-image");a.css({width:e.width,height:e.height}),r.find(".modal-title").css({width:Math.max(e.width,380)}),o&&(i=r.clone().hide().appendTo(document.body)),t(window).width()>767?s.call(r.stop(),{"margin-top":-((i||r).outerHeight()/2),"margin-left":-((i||r).outerWidth()/2)}):r.css({top:(t(window).height()-(i||r).outerHeight())/2}),i&&i.remove(),a.append(e),n=e.offsetWidth,r.trigger("display"),o?r.is(":visible")?t(e).on(t.support.transition.end,function(i){i.target===e&&(t(e).off(t.support.transition.end),r.trigger("displayed"))}).addClass("in"):(t(e).addClass("in"),r.one("shown",function(){r.trigger("displayed")})):(t(e).addClass("in"),r.trigger("displayed"))},abortLoad:function(){this._loadingImage&&(this._loadingImage.onload=this._loadingImage.onerror=null),window.clearTimeout(this._loadingTimeout)},prev:function(){var t=this.options;t.index-=1,t.index<0&&(t.index=this.$links.length-1),this.loadImage()},next:function(){var t=this.options;t.index+=1,t.index>this.$links.length-1&&(t.index=0),this.loadImage()},keyHandler:function(t){switch(t.which){case 37:case 38:t.preventDefault(),this.prev();break;case 39:case 40:t.preventDefault(),this.next()}},wheelHandler:function(t){t.preventDefault(),t=t.originalEvent,this._wheelCounter=this._wheelCounter||0,this._wheelCounter+=t.wheelDelta||t.detail||0,t.wheelDelta&&this._wheelCounter>=120||!t.wheelDelta&&this._wheelCounter<0?(this.prev(),this._wheelCounter=0):(t.wheelDelta&&this._wheelCounter<=-120||!t.wheelDelta&&this._wheelCounter>0)&&(this.next(),this._wheelCounter=0)},initGalleryEvents:function(){var e=this,i=this.$element;i.find(".modal-image").on("click.modal-gallery",function(i){var n=t(this);1===e.$links.length?e.hide():(i.pageX-n.offset().left)/n.width()<e.options.imageClickDivision?e.prev(i):e.next(i)}),i.find(".modal-prev").on("click.modal-gallery",function(t){e.prev(t)}),i.find(".modal-next").on("click.modal-gallery",function(t){e.next(t)}),i.find(".modal-slideshow").on("click.modal-gallery",function(t){e.toggleSlideShow(t)}),t(document).on("keydown.modal-gallery",function(t){e.keyHandler(t)}).on("mousewheel.modal-gallery, DOMMouseScroll.modal-gallery",function(t){e.wheelHandler(t)})},destroyGalleryEvents:function(){var e=this.$element;this.abortLoad(),this.stopSlideShow(),e.find(".modal-image, .modal-prev, .modal-next, .modal-slideshow").off("click.modal-gallery"),t(document).off("keydown.modal-gallery").off("mousewheel.modal-gallery, DOMMouseScroll.modal-gallery")},show:function(){if(!this.isShown&&this.$element.hasClass("modal-gallery")){var e=this.$element,n=this.options,r=t(window).width(),o=t(window).height();e.hasClass("modal-fullscreen")?(this._loadImageOptions={maxWidth:r,maxHeight:o,canvas:n.canvas},e.hasClass("modal-fullscreen-stretch")&&(this._loadImageOptions.minWidth=r,this._loadImageOptions.minHeight=o)):this._loadImageOptions={maxWidth:r-n.offsetWidth,maxHeight:o-n.offsetHeight,canvas:n.canvas},r>767?e.css({"margin-top":-(e.outerHeight()/2),"margin-left":-(e.outerWidth()/2)}):e.css({top:(t(window).height()-e.outerHeight())/2}),this.initGalleryEvents(),this.initLinks(),this.$links.length&&(e.find(".modal-slideshow, .modal-prev, .modal-next").toggle(1!==this.$links.length),e.toggleClass("modal-single",1===this.$links.length),this.loadImage())}i.apply(this,arguments)},hide:function(){this.isShown&&this.$element.hasClass("modal-gallery")&&(this.options.delegate=document,this.options.href=null,this.destroyGalleryEvents()),n.apply(this,arguments)}}),t(function(){t(document.body).on("click.modal-gallery.data-api",'[data-toggle="modal-gallery"]',function(e){var i,n=t(this),r=n.data(),o=t(r.target),s=o.data("modal");s||(r=t.extend(o.data(),r)),r.selector||(r.selector="a[rel=gallery]"),i=t(e.target).closest(r.selector),i.length&&o.length&&(e.preventDefault(),r.href=i.prop("href")||i.data("href"),r.delegate=i[0]!==this?this:document,s&&t.extend(s.options,r),o.modal(r))})})}),/*
 * JavaScript Canvas to Blob 2.0.5
 * https://github.com/blueimp/JavaScript-Canvas-to-Blob
 *
 * Copyright 2012, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 *
 * Based on stackoverflow user Stoive's code snippet:
 * http://stackoverflow.com/q/4998908
 */
function(t){"use strict";var e=t.HTMLCanvasElement&&t.HTMLCanvasElement.prototype,i=t.Blob&&function(){try{return Boolean(new Blob)}catch(t){return!1}}(),n=i&&t.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(t){return!1}}(),r=t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||t.MSBlobBuilder,o=(i||r)&&t.atob&&t.ArrayBuffer&&t.Uint8Array&&function(t){var e,o,s,a,l,c;for(e=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):decodeURIComponent(t.split(",")[1]),o=new ArrayBuffer(e.length),s=new Uint8Array(o),a=0;a<e.length;a+=1)s[a]=e.charCodeAt(a);return l=t.split(",")[0].split(":")[1].split(";")[0],i?new Blob([n?s:o],{type:l}):(c=new r,c.append(o),c.getBlob(l))};t.HTMLCanvasElement&&!e.toBlob&&(e.mozGetAsFile?e.toBlob=function(t,i,n){n&&e.toDataURL&&o?t(o(this.toDataURL(i,n))):t(this.mozGetAsFile("blob",i))}:e.toDataURL&&o&&(e.toBlob=function(t,e,i){t(o(this.toDataURL(e,i)))})),"function"==typeof define&&define.amd?define(function(){return o}):t.dataURLtoBlob=o}(this),/*
 * JavaScript Load Image 1.3.1
 * https://github.com/blueimp/JavaScript-Load-Image
 *
 * Copyright 2011, Sebastian Tschan
 * https://blueimp.net
 *
 * iOS image scaling fixes based on
 * https://github.com/stomita/ios-imagefile-megapixel
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */
function(t){"use strict";var e=function(t,i,n){var r,o,s=document.createElement("img");return s.onerror=i,s.onload=function(){!o||n&&n.noRevoke||e.revokeObjectURL(o),i(e.scale(s,n))},window.Blob&&t instanceof Blob||window.File&&t instanceof File?(r=o=e.createObjectURL(t),s._type=t.type):r=t,r?(s.src=r,s):e.readFile(t,function(t){var e=t.target;e&&e.result?s.src=e.result:i(t)})},i=window.createObjectURL&&window||window.URL&&URL.revokeObjectURL&&URL||window.webkitURL&&webkitURL;e.detectSubsampling=function(t){var e,i,n=t.width,r=t.height;return n*r>1048576?(e=document.createElement("canvas"),e.width=e.height=1,i=e.getContext("2d"),i.drawImage(t,-n+1,0),0===i.getImageData(0,0,1,1).data[3]):!1},e.detectVerticalSquash=function(t,e){var i,n,r,o,s,a=document.createElement("canvas"),l=a.getContext("2d");for(a.width=1,a.height=e,l.drawImage(t,0,0),i=l.getImageData(0,0,1,e).data,n=0,r=e,o=e;o>n;)s=i[4*(o-1)+3],0===s?r=o:n=o,o=r+n>>1;return o/e||1},e.renderImageToCanvas=function(t,i,n,r){var o,s,a,l,c,d,h,u,f=t.width,p=t.height,m=i.getContext("2d"),g=1024,v=document.createElement("canvas");for(m.save(),e.detectSubsampling(t)&&(f/=2,p/=2),o=e.detectVerticalSquash(t,p),v.width=v.height=g,s=v.getContext("2d"),a=Math.ceil(g*n/f),l=Math.ceil(g*r/p/o),d=0,u=0;p>u;){for(c=0,h=0;f>h;)s.clearRect(0,0,g,g),s.drawImage(t,-h,-u),m.drawImage(v,0,0,g,g,c,d,a,l),h+=g,c+=a;u+=g,d+=l}m.restore(),v=s=null},e.scale=function(t,i){i=i||{};var n=document.createElement("canvas"),r=t.width,o=t.height,s=Math.max((i.minWidth||r)/r,(i.minHeight||o)/o);return s>1&&(r=Math.ceil(r*s),o=Math.ceil(o*s)),s=Math.min((i.maxWidth||r)/r,(i.maxHeight||o)/o),1>s&&(r=Math.ceil(r*s),o=Math.ceil(o*s)),t.getContext||i.canvas&&n.getContext?(n.width=r,n.height=o,"image/jpeg"===t._type?e.renderImageToCanvas(t,n,r,o):n.getContext("2d").drawImage(t,0,0,r,o),n):(t.width=r,t.height=o,t)},e.createObjectURL=function(t){return i?i.createObjectURL(t):!1},e.revokeObjectURL=function(t){return i?i.revokeObjectURL(t):!1},e.readFile=function(t,e){if(window.FileReader&&FileReader.prototype.readAsDataURL){var i=new FileReader;return i.onload=i.onerror=e,i.readAsDataURL(t),i}return!1},"function"==typeof define&&define.amd?define(function(){return e}):t.loadImage=e}(this),/*
 * JavaScript Templates 2.1.0
 * https://github.com/blueimp/JavaScript-Templates
 *
 * Copyright 2011, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 *
 * Inspired by John Resig's JavaScript Micro-Templating:
 * http://ejohn.org/blog/javascript-micro-templating/
 */
function(t){"use strict";var e=function(t,i){var n=/[^\w\-\.:]/.test(t)?new Function(e.arg+",tmpl","var _e=tmpl.encode"+e.helper+",_s='"+t.replace(e.regexp,e.func)+"';return _s;"):e.cache[t]=e.cache[t]||e(e.load(t));return i?n(i,e):function(t){return n(t,e)}};e.cache={},e.load=function(t){return document.getElementById(t).innerHTML},e.regexp=/([\s'\\])(?![^%]*%\})|(?:\{%(=|#)([\s\S]+?)%\})|(\{%)|(%\})/g,e.func=function(t,e,i,n,r,o){return e?{"\n":"\\n","\r":"\\r","	":"\\t"," ":" "}[t]||"\\"+t:i?"="===i?"'+_e("+n+")+'":"'+("+n+"||'')+'":r?"';":o?"_s+='":void 0},e.encReg=/[<>&"'\x00]/g,e.encMap={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&#39;"},e.encode=function(t){return String(t||"").replace(e.encReg,function(t){return e.encMap[t]||""})},e.arg="o",e.helper=",print=function(s,e){_s+=e&&(s||'')||_e(s);},include=function(s,d){_s+=tmpl(s,d);}","function"==typeof define&&define.amd?define(function(){return e}):t.tmpl=e}(this),/*
 * jQuery Iframe Transport Plugin 1.7
 * https://github.com/blueimp/jQuery-File-Upload
 *
 * Copyright 2011, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */
function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):t(window.jQuery)}(function(t){"use strict";var e=0;t.ajaxTransport("iframe",function(i){if(i.async){var n,r,o;return{send:function(s,a){n=t('<form style="display:none;"></form>'),n.attr("accept-charset",i.formAcceptCharset),o=/\?/.test(i.url)?"&":"?","DELETE"===i.type?(i.url=i.url+o+"_method=DELETE",i.type="POST"):"PUT"===i.type?(i.url=i.url+o+"_method=PUT",i.type="POST"):"PATCH"===i.type&&(i.url=i.url+o+"_method=PATCH",i.type="POST"),e+=1,r=t('<iframe src="javascript:false;" name="iframe-transport-'+e+'"></iframe>').bind("load",function(){var e,o=t.isArray(i.paramName)?i.paramName:[i.paramName];r.unbind("load").bind("load",function(){var e;try{if(e=r.contents(),!e.length||!e[0].firstChild)throw new Error}catch(i){e=void 0}a(200,"success",{iframe:e}),t('<iframe src="javascript:false;"></iframe>').appendTo(n),window.setTimeout(function(){n.remove()},0)}),n.prop("target",r.prop("name")).prop("action",i.url).prop("method",i.type),i.formData&&t.each(i.formData,function(e,i){t('<input type="hidden"/>').prop("name",i.name).val(i.value).appendTo(n)}),i.fileInput&&i.fileInput.length&&"POST"===i.type&&(e=i.fileInput.clone(),i.fileInput.after(function(t){return e[t]}),i.paramName&&i.fileInput.each(function(e){t(this).prop("name",o[e]||i.paramName)}),n.append(i.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data")),n.submit(),e&&e.length&&i.fileInput.each(function(i,n){var r=t(e[i]);t(n).prop("name",r.prop("name")),r.replaceWith(n)})}),n.append(r).appendTo(document.body)},abort:function(){r&&r.unbind("load").prop("src","javascript".concat(":false;")),n&&n.remove()}}}}),t.ajaxSetup({converters:{"iframe text":function(e){return e&&t(e[0].body).text()},"iframe json":function(e){return e&&t.parseJSON(t(e[0].body).text())},"iframe html":function(e){return e&&t(e[0].body).html()},"iframe xml":function(e){var i=e&&e[0];return i&&t.isXMLDoc(i)?i:t.parseXML(i.XMLDocument&&i.XMLDocument.xml||t(i.body).html())},"iframe script":function(e){return e&&t.globalEval(t(e[0].body).text())}}})}),/*
 * jQuery File Upload Plugin 5.32.6
 * https://github.com/blueimp/jQuery-File-Upload
 *
 * Copyright 2010, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */
function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery.ui.widget"],t):t(window.jQuery)}(function(t){"use strict";t.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||t('<input type="file">').prop("disabled")),t.support.xhrFileUpload=!(!window.XMLHttpRequestUpload||!window.FileReader),t.support.xhrFormDataFileUpload=!!window.FormData,t.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),t.widget("blueimp.fileupload",{options:{dropZone:t(document),pasteZone:t(document),fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(e,i){return e=this.messages[e]||e.toString(),i&&t.each(i,function(t,i){e=e.replace("{"+t+"}",i)}),e},formData:function(t){return t.serializeArray()},add:function(e,i){(i.autoUpload||i.autoUpload!==!1&&t(this).fileupload("option","autoUpload"))&&i.process().done(function(){i.submit()})},processData:!1,contentType:!1,cache:!1},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:t.support.blobSlice&&function(){var t=this.slice||this.webkitSlice||this.mozSlice;return t.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(t,e,i){var n=t-this.timestamp;return(!this.bitrate||!i||n>i)&&(this.bitrate=8*(e-this.loaded)*(1e3/n),this.loaded=e,this.timestamp=t),this.bitrate}},_isXHRUpload:function(e){return!e.forceIframeTransport&&(!e.multipart&&t.support.xhrFileUpload||t.support.xhrFormDataFileUpload)},_getFormData:function(e){var i;return"function"==typeof e.formData?e.formData(e.form):t.isArray(e.formData)?e.formData:"object"===t.type(e.formData)?(i=[],t.each(e.formData,function(t,e){i.push({name:t,value:e})}),i):[]},_getTotal:function(e){var i=0;return t.each(e,function(t,e){i+=e.size||1}),i},_initProgressObject:function(e){var i={loaded:0,total:0,bitrate:0};e._progress?t.extend(e._progress,i):e._progress=i},_initResponseObject:function(t){var e;if(t._response)for(e in t._response)t._response.hasOwnProperty(e)&&delete t._response[e];else t._response={}},_onProgress:function(t,e){if(t.lengthComputable){var i,n=Date.now?Date.now():(new Date).getTime();if(e._time&&e.progressInterval&&n-e._time<e.progressInterval&&t.loaded!==t.total)return;e._time=n,i=Math.floor(t.loaded/t.total*(e.chunkSize||e._progress.total))+(e.uploadedBytes||0),this._progress.loaded+=i-e._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(n,this._progress.loaded,e.bitrateInterval),e._progress.loaded=e.loaded=i,e._progress.bitrate=e.bitrate=e._bitrateTimer.getBitrate(n,i,e.bitrateInterval),this._trigger("progress",t,e),this._trigger("progressall",t,this._progress)}},_initProgressListener:function(e){var i=this,n=e.xhr?e.xhr():t.ajaxSettings.xhr();n.upload&&(t(n.upload).bind("progress",function(t){var n=t.originalEvent;t.lengthComputable=n.lengthComputable,t.loaded=n.loaded,t.total=n.total,i._onProgress(t,e)}),e.xhr=function(){return n})},_isInstanceOf:function(t,e){return Object.prototype.toString.call(e)==="[object "+t+"]"},_initXHRData:function(e){var i,n=this,r=e.files[0],o=e.multipart||!t.support.xhrFileUpload,s=e.paramName[0];e.headers=t.extend({},e.headers),e.contentRange&&(e.headers["Content-Range"]=e.contentRange),o&&!e.blob&&this._isInstanceOf("File",r)||(e.headers["Content-Disposition"]='attachment; filename="'+encodeURI(r.name)+'"'),o?t.support.xhrFormDataFileUpload&&(e.postMessage?(i=this._getFormData(e),e.blob?i.push({name:s,value:e.blob}):t.each(e.files,function(t,n){i.push({name:e.paramName[t]||s,value:n})})):(n._isInstanceOf("FormData",e.formData)?i=e.formData:(i=new FormData,t.each(this._getFormData(e),function(t,e){i.append(e.name,e.value)})),e.blob?i.append(s,e.blob,r.name):t.each(e.files,function(t,r){(n._isInstanceOf("File",r)||n._isInstanceOf("Blob",r))&&i.append(e.paramName[t]||s,r,r.name)})),e.data=i):(e.contentType=r.type,e.data=e.blob||r),e.blob=null},_initIframeSettings:function(e){var i=t("<a></a>").prop("href",e.url).prop("host");e.dataType="iframe "+(e.dataType||""),e.formData=this._getFormData(e),e.redirect&&i&&i!==location.host&&e.formData.push({name:e.redirectParamName||"redirect",value:e.redirect})},_initDataSettings:function(t){this._isXHRUpload(t)?(this._chunkedUpload(t,!0)||(t.data||this._initXHRData(t),this._initProgressListener(t)),t.postMessage&&(t.dataType="postmessage "+(t.dataType||""))):this._initIframeSettings(t)},_getParamName:function(e){var i=t(e.fileInput),n=e.paramName;return n?t.isArray(n)||(n=[n]):(n=[],i.each(function(){for(var e=t(this),i=e.prop("name")||"files[]",r=(e.prop("files")||[1]).length;r;)n.push(i),r-=1}),n.length||(n=[i.prop("name")||"files[]"])),n},_initFormSettings:function(e){e.form&&e.form.length||(e.form=t(e.fileInput.prop("form")),e.form.length||(e.form=t(this.options.fileInput.prop("form")))),e.paramName=this._getParamName(e),e.url||(e.url=e.form.prop("action")||location.href),e.type=(e.type||"string"===t.type(e.form.prop("method"))&&e.form.prop("method")||"").toUpperCase(),"POST"!==e.type&&"PUT"!==e.type&&"PATCH"!==e.type&&(e.type="POST"),e.formAcceptCharset||(e.formAcceptCharset=e.form.attr("accept-charset"))},_getAJAXSettings:function(e){var i=t.extend({},this.options,e);return this._initFormSettings(i),this._initDataSettings(i),i},_getDeferredState:function(t){return t.state?t.state():t.isResolved()?"resolved":t.isRejected()?"rejected":"pending"},_enhancePromise:function(t){return t.success=t.done,t.error=t.fail,t.complete=t.always,t},_getXHRPromise:function(e,i,n){var r=t.Deferred(),o=r.promise();return i=i||this.options.context||o,e===!0?r.resolveWith(i,n):e===!1&&r.rejectWith(i,n),o.abort=r.promise,this._enhancePromise(o)},_addConvenienceMethods:function(e,i){var n=this,r=function(e){return t.Deferred().resolveWith(n,[e]).promise()};i.process=function(t,e){return(t||e)&&(i._processQueue=this._processQueue=(this._processQueue||r(this)).pipe(t,e)),this._processQueue||r(this)},i.submit=function(){return"pending"!==this.state()&&(i.jqXHR=this.jqXHR=n._trigger("submit",e,this)!==!1&&n._onSend(e,this)),this.jqXHR||n._getXHRPromise()},i.abort=function(){return this.jqXHR?this.jqXHR.abort():n._getXHRPromise()},i.state=function(){return this.jqXHR?n._getDeferredState(this.jqXHR):this._processQueue?n._getDeferredState(this._processQueue):void 0},i.progress=function(){return this._progress},i.response=function(){return this._response}},_getUploadedBytes:function(t){var e=t.getResponseHeader("Range"),i=e&&e.split("-"),n=i&&i.length>1&&parseInt(i[1],10);return n&&n+1},_chunkedUpload:function(e,i){e.uploadedBytes=e.uploadedBytes||0;var n,r,o=this,s=e.files[0],a=s.size,l=e.uploadedBytes,c=e.maxChunkSize||a,d=this._blobSlice,h=t.Deferred(),u=h.promise();return this._isXHRUpload(e)&&d&&(l||a>c)&&!e.data?i?!0:l>=a?(s.error=e.i18n("uploadedBytes"),this._getXHRPromise(!1,e.context,[null,"error",s.error])):(r=function(){var i=t.extend({},e),u=i._progress.loaded;i.blob=d.call(s,l,l+c,s.type),i.chunkSize=i.blob.size,i.contentRange="bytes "+l+"-"+(l+i.chunkSize-1)+"/"+a,o._initXHRData(i),o._initProgressListener(i),n=(o._trigger("chunksend",null,i)!==!1&&t.ajax(i)||o._getXHRPromise(!1,i.context)).done(function(n,s,c){l=o._getUploadedBytes(c)||l+i.chunkSize,u+i.chunkSize-i._progress.loaded&&o._onProgress(t.Event("progress",{lengthComputable:!0,loaded:l-i.uploadedBytes,total:l-i.uploadedBytes}),i),e.uploadedBytes=i.uploadedBytes=l,i.result=n,i.textStatus=s,i.jqXHR=c,o._trigger("chunkdone",null,i),o._trigger("chunkalways",null,i),a>l?r():h.resolveWith(i.context,[n,s,c])}).fail(function(t,e,n){i.jqXHR=t,i.textStatus=e,i.errorThrown=n,o._trigger("chunkfail",null,i),o._trigger("chunkalways",null,i),h.rejectWith(i.context,[t,e,n])})},this._enhancePromise(u),u.abort=function(){return n.abort()},r(),u):!1},_beforeSend:function(t,e){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(e),this._initProgressObject(e),e._progress.loaded=e.loaded=e.uploadedBytes||0,e._progress.total=e.total=this._getTotal(e.files)||1,e._progress.bitrate=e.bitrate=0,this._active+=1,this._progress.loaded+=e.loaded,this._progress.total+=e.total},_onDone:function(e,i,n,r){var o=r._progress.total,s=r._response;r._progress.loaded<o&&this._onProgress(t.Event("progress",{lengthComputable:!0,loaded:o,total:o}),r),s.result=r.result=e,s.textStatus=r.textStatus=i,s.jqXHR=r.jqXHR=n,this._trigger("done",null,r)},_onFail:function(t,e,i,n){var r=n._response;n.recalculateProgress&&(this._progress.loaded-=n._progress.loaded,this._progress.total-=n._progress.total),r.jqXHR=n.jqXHR=t,r.textStatus=n.textStatus=e,r.errorThrown=n.errorThrown=i,this._trigger("fail",null,n)},_onAlways:function(t,e,i,n){this._trigger("always",null,n)},_onSend:function(e,i){i.submit||this._addConvenienceMethods(e,i);var n,r,o,s,a=this,l=a._getAJAXSettings(i),c=function(){return a._sending+=1,l._bitrateTimer=new a._BitrateTimer,n=n||((r||a._trigger("send",e,l)===!1)&&a._getXHRPromise(!1,l.context,r)||a._chunkedUpload(l)||t.ajax(l)).done(function(t,e,i){a._onDone(t,e,i,l)}).fail(function(t,e,i){a._onFail(t,e,i,l)}).always(function(t,e,i){if(a._onAlways(t,e,i,l),a._sending-=1,a._active-=1,l.limitConcurrentUploads&&l.limitConcurrentUploads>a._sending)for(var n=a._slots.shift();n;){if("pending"===a._getDeferredState(n)){n.resolve();break}n=a._slots.shift()}0===a._active&&a._trigger("stop")})};return this._beforeSend(e,l),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(o=t.Deferred(),this._slots.push(o),s=o.pipe(c)):(this._sequence=this._sequence.pipe(c,c),s=this._sequence),s.abort=function(){return r=[void 0,"abort","abort"],n?n.abort():(o&&o.rejectWith(l.context,r),c())},this._enhancePromise(s)):c()},_onAdd:function(e,i){var n,r,o,s,a=this,l=!0,c=t.extend({},this.options,i),d=c.limitMultiFileUploads,h=this._getParamName(c);if((c.singleFileUploads||d)&&this._isXHRUpload(c))if(!c.singleFileUploads&&d)for(o=[],n=[],s=0;s<i.files.length;s+=d)o.push(i.files.slice(s,s+d)),r=h.slice(s,s+d),r.length||(r=h),n.push(r);else n=h;else o=[i.files],n=[h];return i.originalFiles=i.files,t.each(o||i.files,function(r,s){var c=t.extend({},i);return c.files=o?s:[s],c.paramName=n[r],a._initResponseObject(c),a._initProgressObject(c),a._addConvenienceMethods(e,c),l=a._trigger("add",e,c)}),l},_replaceFileInput:function(e){var i=e.clone(!0);t("<form></form>").append(i)[0].reset(),e.after(i).detach(),t.cleanData(e.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(t,n){return n===e[0]?i[0]:n}),e[0]===this.element[0]&&(this.element=i)},_handleFileTreeEntry:function(e,i){var n,r=this,o=t.Deferred(),s=function(t){t&&!t.entry&&(t.entry=e),o.resolve([t])};return i=i||"",e.isFile?e._file?(e._file.relativePath=i,o.resolve(e._file)):e.file(function(t){t.relativePath=i,o.resolve(t)},s):e.isDirectory?(n=e.createReader(),n.readEntries(function(t){r._handleFileTreeEntries(t,i+e.name+"/").done(function(t){o.resolve(t)}).fail(s)},s)):o.resolve([]),o.promise()},_handleFileTreeEntries:function(e,i){var n=this;return t.when.apply(t,t.map(e,function(t){return n._handleFileTreeEntry(t,i)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(e){e=e||{};var i=e.items;return i&&i.length&&(i[0].webkitGetAsEntry||i[0].getAsEntry)?this._handleFileTreeEntries(t.map(i,function(t){var e;return t.webkitGetAsEntry?(e=t.webkitGetAsEntry(),e&&(e._file=t.getAsFile()),e):t.getAsEntry()})):t.Deferred().resolve(t.makeArray(e.files)).promise()},_getSingleFileInputFiles:function(e){e=t(e);var i,n,r=e.prop("webkitEntries")||e.prop("entries");if(r&&r.length)return this._handleFileTreeEntries(r);if(i=t.makeArray(e.prop("files")),i.length)void 0===i[0].name&&i[0].fileName&&t.each(i,function(t,e){e.name=e.fileName,e.size=e.fileSize});else{if(n=e.prop("value"),!n)return t.Deferred().resolve([]).promise();i=[{name:n.replace(/^.*\\/,"")}]}return t.Deferred().resolve(i).promise()},_getFileInputFiles:function(e){return e instanceof t&&1!==e.length?t.when.apply(t,t.map(e,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(e)},_onChange:function(e){var i=this,n={fileInput:t(e.target),form:t(e.target.form)};this._getFileInputFiles(n.fileInput).always(function(t){n.files=t,i.options.replaceFileInput&&i._replaceFileInput(n.fileInput),i._trigger("change",e,n)!==!1&&i._onAdd(e,n)})},_onPaste:function(e){var i=e.originalEvent&&e.originalEvent.clipboardData&&e.originalEvent.clipboardData.items,n={files:[]};i&&i.length&&(t.each(i,function(t,e){var i=e.getAsFile&&e.getAsFile();i&&n.files.push(i)}),this._trigger("paste",e,n)!==!1&&this._onAdd(e,n))},_onDrop:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var e=this,i=t.dataTransfer,n={};i&&i.files&&i.files.length&&(t.preventDefault(),this._getDroppedFiles(i).always(function(i){n.files=i,e._trigger("drop",t,n)!==!1&&e._onAdd(t,n)}))},_onDragOver:function(e){e.dataTransfer=e.originalEvent&&e.originalEvent.dataTransfer;var i=e.dataTransfer,n={dropEffect:"copy",preventDefault:!0};i&&-1!==t.inArray("Files",i.types)&&this._trigger("dragover",e,n)!==!1&&(i.dropEffect=n.dropEffect,n.preventDefault&&e.preventDefault())},_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop}),this._on(this.options.pasteZone,{paste:this._onPaste})),t.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_setOption:function(e,i){var n=-1!==t.inArray(e,this._specialOptions);n&&this._destroyEventHandlers(),this._super(e,i),n&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var e=this.options;void 0===e.fileInput?e.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):e.fileInput instanceof t||(e.fileInput=t(e.fileInput)),e.dropZone instanceof t||(e.dropZone=t(e.dropZone)),e.pasteZone instanceof t||(e.pasteZone=t(e.pasteZone))},_getRegExp:function(t){var e=t.split("/"),i=e.pop();return e.shift(),new RegExp(e.join("/"),i)},_isRegExpOption:function(e,i){return"url"!==e&&"string"===t.type(i)&&/^\/.*\/[igm]{0,3}$/.test(i)},_initDataAttributes:function(){var e=this,i=this.options;t.each(t(this.element[0].cloneNode(!1)).data(),function(t,n){e._isRegExpOption(t,n)&&(n=e._getRegExp(n)),i[t]=n})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(e){var i=this;e&&!this.options.disabled&&(e.fileInput&&!e.files?this._getFileInputFiles(e.fileInput).always(function(t){e.files=t,i._onAdd(null,e)}):(e.files=t.makeArray(e.files),this._onAdd(null,e)))},send:function(e){if(e&&!this.options.disabled){if(e.fileInput&&!e.files){var i,n,r=this,o=t.Deferred(),s=o.promise();return s.abort=function(){return n=!0,i?i.abort():(o.reject(null,"abort","abort"),s)},this._getFileInputFiles(e.fileInput).always(function(t){if(!n){if(!t.length)return o.reject(),void 0;e.files=t,i=r._onSend(null,e).then(function(t,e,i){o.resolve(t,e,i)},function(t,e,i){o.reject(t,e,i)})}}),this._enhancePromise(s)}if(e.files=t.makeArray(e.files),e.files.length)return this._onSend(null,e)}return this._getXHRPromise(!1,e&&e.context)}})}),/*
 * jQuery File Upload Processing Plugin 1.2.2
 * https://github.com/blueimp/jQuery-File-Upload
 *
 * Copyright 2012, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */
function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery","./jquery.fileupload"],t):t(window.jQuery)}(function(t){"use strict";var e=t.blueimp.fileupload.prototype.options.add;t.widget("blueimp.fileupload",t.blueimp.fileupload,{options:{processQueue:[],add:function(i,n){var r=t(this);n.process(function(){return r.fileupload("process",n)}),e.call(this,i,n)}},processActions:{},_processFile:function(e){var i=this,n=t.Deferred().resolveWith(i,[e]),r=n.promise();return this._trigger("process",null,e),t.each(e.processQueue,function(t,e){var n=function(t){return i.processActions[e.action].call(i,t,e)};r=r.pipe(n,e.always&&n)}),r.done(function(){i._trigger("processdone",null,e),i._trigger("processalways",null,e)}).fail(function(){i._trigger("processfail",null,e),i._trigger("processalways",null,e)}),r},_transformProcessQueue:function(e){var i=[];t.each(e.processQueue,function(){var n={},r=this.action,o=this.prefix===!0?r:this.prefix;t.each(this,function(i,r){n[i]="string"===t.type(r)&&"@"===r.charAt(0)?e[r.slice(1)||(o?o+i.charAt(0).toUpperCase()+i.slice(1):i)]:r}),i.push(n)}),e.processQueue=i},processing:function(){return this._processing},process:function(e){var i=this,n=t.extend({},this.options,e);return n.processQueue&&n.processQueue.length&&(this._transformProcessQueue(n),0===this._processing&&this._trigger("processstart"),t.each(e.files,function(e){var r=e?t.extend({},n):n,o=function(){return i._processFile(r)};r.index=e,i._processing+=1,i._processingQueue=i._processingQueue.pipe(o,o).always(function(){i._processing-=1,0===i._processing&&i._trigger("processstop")})})),this._processingQueue},_create:function(){this._super(),this._processing=0,this._processingQueue=t.Deferred().resolveWith(this).promise()}})}),/*
 * jQuery File Upload User Interface Plugin 8.8.5
 * https://github.com/blueimp/jQuery-File-Upload
 *
 * Copyright 2010, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */
function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery","tmpl","./jquery.fileupload-image","./jquery.fileupload-audio","./jquery.fileupload-video","./jquery.fileupload-validate"],t):t(window.jQuery,window.tmpl)}(function(t,e){"use strict";t.blueimp.fileupload.prototype._specialOptions.push("filesContainer","uploadTemplateId","downloadTemplateId"),t.widget("blueimp.fileupload",t.blueimp.fileupload,{options:{autoUpload:!1,uploadTemplateId:"template-upload",downloadTemplateId:"template-download",filesContainer:void 0,prependFiles:!1,dataType:"json",getNumberOfFiles:function(){return this.filesContainer.children().length},getFilesFromResponse:function(e){return e.result&&t.isArray(e.result.files)?e.result.files:[]},add:function(e,i){var n=t(this),r=n.data("blueimp-fileupload")||n.data("fileupload"),o=r.options,s=i.files;i.process(function(){return n.fileupload("process",i)}).always(function(){i.context=r._renderUpload(s).data("data",i),r._renderPreviews(i),o.filesContainer[o.prependFiles?"prepend":"append"](i.context),r._forceReflow(i.context),r._transition(i.context).done(function(){r._trigger("added",e,i)===!1||!o.autoUpload&&!i.autoUpload||i.autoUpload===!1||i.files.error||i.submit()})})},send:function(e,i){var n=t(this).data("blueimp-fileupload")||t(this).data("fileupload");return i.context&&i.dataType&&"iframe"===i.dataType.substr(0,6)&&i.context.find(".progress").addClass(!t.support.transition&&"progress-animated").attr("aria-valuenow",100).children().first().css("width","100%"),n._trigger("sent",e,i)},done:function(e,i){var n,r,o=t(this).data("blueimp-fileupload")||t(this).data("fileupload"),s=i.getFilesFromResponse||o.options.getFilesFromResponse,a=s(i);i.context?i.context.each(function(s){var l=a[s]||{error:"Empty file upload result"};r=o._addFinishedDeferreds(),o._transition(t(this)).done(function(){var s=t(this);n=o._renderDownload([l]).replaceAll(s),o._forceReflow(n),o._transition(n).done(function(){i.context=t(this),o._trigger("completed",e,i),o._trigger("finished",e,i),r.resolve()})})}):(n=o._renderDownload(a)[o.options.prependFiles?"prependTo":"appendTo"](o.options.filesContainer),o._forceReflow(n),r=o._addFinishedDeferreds(),o._transition(n).done(function(){i.context=t(this),o._trigger("completed",e,i),o._trigger("finished",e,i),r.resolve()}))},fail:function(e,i){var n,r,o=t(this).data("blueimp-fileupload")||t(this).data("fileupload");i.context?i.context.each(function(s){if("abort"!==i.errorThrown){var a=i.files[s];a.error=a.error||i.errorThrown||!0,r=o._addFinishedDeferreds(),o._transition(t(this)).done(function(){var s=t(this);n=o._renderDownload([a]).replaceAll(s),o._forceReflow(n),o._transition(n).done(function(){i.context=t(this),o._trigger("failed",e,i),o._trigger("finished",e,i),r.resolve()})})}else r=o._addFinishedDeferreds(),o._transition(t(this)).done(function(){t(this).remove(),o._trigger("failed",e,i),o._trigger("finished",e,i),r.resolve()})}):"abort"!==i.errorThrown?(i.context=o._renderUpload(i.files)[o.options.prependFiles?"prependTo":"appendTo"](o.options.filesContainer).data("data",i),o._forceReflow(i.context),r=o._addFinishedDeferreds(),o._transition(i.context).done(function(){i.context=t(this),o._trigger("failed",e,i),o._trigger("finished",e,i),r.resolve()})):(o._trigger("failed",e,i),o._trigger("finished",e,i),o._addFinishedDeferreds().resolve())},progress:function(e,i){var n=Math.floor(100*(i.loaded/i.total));i.context&&i.context.each(function(){t(this).find(".progress").attr("aria-valuenow",n).children().first().css("width",n+"%")})},progressall:function(e,i){var n=t(this),r=Math.floor(100*(i.loaded/i.total)),o=n.find(".fileupload-progress"),s=o.find(".progress-extended");s.length&&s.html((n.data("blueimp-fileupload")||n.data("fileupload"))._renderExtendedProgress(i)),o.find(".progress").attr("aria-valuenow",r).children().first().css("width",r+"%")},start:function(e){var i=t(this).data("blueimp-fileupload")||t(this).data("fileupload");i._resetFinishedDeferreds(),i._transition(t(this).find(".fileupload-progress")).done(function(){i._trigger("started",e)})},stop:function(e){var i=t(this).data("blueimp-fileupload")||t(this).data("fileupload"),n=i._addFinishedDeferreds();t.when.apply(t,i._getFinishedDeferreds()).done(function(){i._trigger("stopped",e)}),i._transition(t(this).find(".fileupload-progress")).done(function(){t(this).find(".progress").attr("aria-valuenow","0").children().first().css("width","0%"),t(this).find(".progress-extended").html("&nbsp;"),n.resolve()})},processstart:function(){t(this).addClass("fileupload-processing")},processstop:function(){t(this).removeClass("fileupload-processing")},destroy:function(e,i){var n=t(this).data("blueimp-fileupload")||t(this).data("fileupload"),r=function(){n._transition(i.context).done(function(){t(this).remove(),n._trigger("destroyed",e,i)})};i.url?t.ajax(i).done(r):r()}},_resetFinishedDeferreds:function(){this._finishedUploads=[]},_addFinishedDeferreds:function(e){return e||(e=t.Deferred()),this._finishedUploads.push(e),e},_getFinishedDeferreds:function(){return this._finishedUploads},_enableDragToDesktop:function(){var e=t(this),i=e.prop("href"),n=e.prop("download"),r="application/octet-stream";e.bind("dragstart",function(t){try{t.originalEvent.dataTransfer.setData("DownloadURL",[r,n,i].join(":"))}catch(e){}})},_formatFileSize:function(t){return"number"!=typeof t?"":t>=1e9?(t/1e9).toFixed(2)+" GB":t>=1e6?(t/1e6).toFixed(2)+" MB":(t/1e3).toFixed(2)+" KB"},_formatBitrate:function(t){return"number"!=typeof t?"":t>=1e9?(t/1e9).toFixed(2)+" Gbit/s":t>=1e6?(t/1e6).toFixed(2)+" Mbit/s":t>=1e3?(t/1e3).toFixed(2)+" kbit/s":t.toFixed(2)+" bit/s"},_formatTime:function(t){var e=new Date(1e3*t),i=Math.floor(t/86400);return i=i?i+"d ":"",i+("0"+e.getUTCHours()).slice(-2)+":"+("0"+e.getUTCMinutes()).slice(-2)+":"+("0"+e.getUTCSeconds()).slice(-2)},_formatPercentage:function(t){return(100*t).toFixed(2)+" %"},_renderExtendedProgress:function(t){return this._formatBitrate(t.bitrate)+" | "+this._formatTime(8*(t.total-t.loaded)/t.bitrate)+" | "+this._formatPercentage(t.loaded/t.total)+" | "+this._formatFileSize(t.loaded)+" / "+this._formatFileSize(t.total)},_renderTemplate:function(e,i){if(!e)return t();var n=e({files:i,formatFileSize:this._formatFileSize,options:this.options});return n instanceof t?n:t(this.options.templatesContainer).html(n).children()},_renderPreviews:function(e){e.context.find(".preview").each(function(i,n){t(n).append(e.files[i].preview)})},_renderUpload:function(t){return this._renderTemplate(this.options.uploadTemplate,t)},_renderDownload:function(t){return this._renderTemplate(this.options.downloadTemplate,t).find("a[download]").each(this._enableDragToDesktop).end()},_startHandler:function(e){e.preventDefault();var i=t(e.currentTarget),n=i.closest(".template-upload"),r=n.data("data");r&&r.submit&&!r.jqXHR&&r.submit()&&i.prop("disabled",!0)},_cancelHandler:function(e){e.preventDefault();var i=t(e.currentTarget).closest(".template-upload,.template-download"),n=i.data("data")||{};n.jqXHR?n.jqXHR.abort():(n.context=n.context||i,n.errorThrown="abort",this._trigger("fail",e,n))},_deleteHandler:function(e){e.preventDefault();var i=t(e.currentTarget);this._trigger("destroy",e,t.extend({context:i.closest(".template-download"),type:"DELETE"},i.data()))},_forceReflow:function(e){return t.support.transition&&e.length&&e[0].offsetWidth},_transition:function(e){var i=t.Deferred();return t.support.transition&&e.hasClass("fade")&&e.is(":visible")?e.bind(t.support.transition.end,function(n){n.target===e[0]&&(e.unbind(t.support.transition.end),i.resolveWith(e))}).toggleClass("in"):(e.toggleClass("in"),i.resolveWith(e)),i},_initButtonBarEventHandlers:function(){var e=this.element.find(".fileupload-buttonbar"),i=this.options.filesContainer;this._on(e.find(".start"),{click:function(t){t.preventDefault(),i.find(".start").click()}}),this._on(e.find(".cancel"),{click:function(t){t.preventDefault(),i.find(".cancel").click()}}),this._on(e.find(".delete"),{click:function(t){t.preventDefault(),i.find(".toggle:checked").closest(".template-download").find(".delete").click(),e.find(".toggle").prop("checked",!1)}}),this._on(e.find(".toggle"),{change:function(e){i.find(".toggle").prop("checked",t(e.currentTarget).is(":checked"))}})},_destroyButtonBarEventHandlers:function(){this._off(this.element.find(".fileupload-buttonbar").find(".start, .cancel, .delete"),"click"),this._off(this.element.find(".fileupload-buttonbar .toggle"),"change.")},_initEventHandlers:function(){this._super(),this._on(this.options.filesContainer,{"click .start":this._startHandler,"click .cancel":this._cancelHandler,"click .delete":this._deleteHandler}),this._initButtonBarEventHandlers()},_destroyEventHandlers:function(){this._destroyButtonBarEventHandlers(),this._off(this.options.filesContainer,"click"),this._super()},_enableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!1).parent().removeClass("disabled")},_disableFileInputButton:function(){this.element.find(".fileinput-button input").prop("disabled",!0).parent().addClass("disabled")},_initTemplates:function(){var t=this.options;t.templatesContainer=this.document[0].createElement(t.filesContainer.prop("nodeName")),e&&(t.uploadTemplateId&&(t.uploadTemplate=e(t.uploadTemplateId)),t.downloadTemplateId&&(t.downloadTemplate=e(t.downloadTemplateId)))},_initFilesContainer:function(){var e=this.options;void 0===e.filesContainer?e.filesContainer=this.element.find(".files"):e.filesContainer instanceof t||(e.filesContainer=t(e.filesContainer))},_initSpecialOptions:function(){this._super(),this._initFilesContainer(),this._initTemplates()},_create:function(){this._super(),this._resetFinishedDeferreds(),t.support.fileInput||this._disableFileInputButton()},enable:function(){var t=!1;this.options.disabled&&(t=!0),this._super(),t&&(this.element.find("input, button").prop("disabled",!1),this._enableFileInputButton())},disable:function(){this.options.disabled||(this.element.find("input, button").prop("disabled",!0),this._disableFileInputButton()),this._super()}})}),/*
 * jQuery File Upload Plugin Localization Example 6.5.1
 * https://github.com/blueimp/jQuery-File-Upload
 *
 * Copyright 2012, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */
window.locale={fileupload:{errors:{maxFileSize:"File is too big",minFileSize:"File is too small",acceptFileTypes:"Filetype not allowed",maxNumberOfFiles:"Max number of files exceeded",uploadedBytes:"Uploaded bytes exceed file size",emptyResult:"Empty file upload result"},error:"Error",start:"Start",cancel:"Cancel",destroy:"Delete"}},/*
	Redactor v9.0
	Updated: May 30, 2013

	http://imperavi.com/redactor/

	Copyright (c) 2009-2013, Imperavi LLC.
	License: http://imperavi.com/redactor/license/

	Usage: $('#content').redactor();
*/
function(t){function e(t,i){return new e.prototype.init(t,i)}var i=0,n=function(t){return this[0]=t.startOffset,this[1]=t.endOffset,this.range=t,this};n.prototype.equals=function(){return this[0]===this[1]},t.fn.redactor=function(i){var n=[],r=Array.prototype.slice.call(arguments,1);return"string"==typeof i?this.each(function(){var e=t.data(this,"redactor");if("undefined"==typeof e||!t.isFunction(e[i]))return t.error('No such method "'+i+'" for Redactor');var o=e[i].apply(e,r);void 0!==o&&o!==e&&n.push(o)}):this.each(function(){t.data(this,"redactor")||t.data(this,"redactor",e(this,i))}),0===n.length?this:1===n.length?n[0]:n},t.Redactor=e,t.Redactor.opts={initCallback:!1,focusCallback:!1,blurCallback:!1,keydownCallback:!1,keyupCallback:!1,execCommandCallback:!1,autosaveCallback:!1,imageUploadCallback:!1,imageUploadErrorCallback:!1,imageDeleteCallback:!1,fileUploadCallback:!1,fileUploadErrorCallback:!1,rangy:!1,iframe:!1,fullpage:!1,css:!1,lang:"en",direction:"ltr",placeholder:!1,wym:!1,mobile:!0,cleanup:!0,visual:!0,focus:!1,tabindex:!1,autoresize:!0,minHeight:!1,shortcuts:!0,autosave:!1,autosaveInterval:60,plugins:!1,linkAnchor:!1,linkEmail:!1,linkProtocol:"http://",imageGetJson:!1,imageUpload:!1,fileUpload:!1,s3:!1,uploadFields:!1,observeImages:!0,modalOverlay:!0,air:!1,airButtons:["formatting","|","bold","italic","deleted","|","unorderedlist","orderedlist","outdent","indent","|","fontcolor","backcolor"],toolbar:!0,toolbarFixed:!1,toolbarFixedTopOffset:0,toolbarFixedBox:!1,toolbarExternal:!1,buttonSource:!0,buttonSeparator:'<li class="redactor_separator"></li>',buttonsCustom:{},buttonsAdd:[],buttons:["html","|","formatting","|","bold","italic","deleted","|","unorderedlist","orderedlist","outdent","indent","|","image","video","file","table","link","|","fontcolor","backcolor","|","alignment","|","horizontalrule"],colors:["#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646","#ffff00","#f2f2f2","#7f7f7f","#ddd9c3","#c6d9f0","#dbe5f1","#f2dcdb","#ebf1dd","#e5e0ec","#dbeef3","#fdeada","#fff2ca","#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5","#ffe694","#bfbfbf","#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#b7dde8","#fac08f","#f2c314","#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#92cddc","#e36c09","#c09100","#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#31859b","#974806","#7f6000"],activeButtons:["deleted","italic","bold","underline","unorderedlist","orderedlist","alignleft","aligncenter","alignright","justify","table"],activeButtonsStates:{b:"bold",strong:"bold",i:"italic",em:"italic",del:"deleted",strike:"deleted",ul:"unorderedlist",ol:"orderedlist",u:"underline",tr:"table",td:"table",table:"table"},activeButtonsAdd:!1,formattingTags:["p","blockquote","pre","h1","h2","h3","h4"],linebreaks:!1,paragraphy:!0,convertDivs:!0,convertLinks:!0,formattingPre:!1,phpTags:!1,allowedTags:!1,deniedTags:["html","head","link","body","meta","script","style","applet"],boldTag:"strong",italicTag:"em",buffer:[],rebuffer:[],textareamode:!1,emptyHtml:"<p>&#x200b;</p>",invisibleSpace:"&#x200b;",alignmentTags:["H1","H2","H3","H4","H5","H6","P","TD","DIV","BLOCKQUOTE"],ownLine:["area","body","head","hr","i?frame","link","meta","noscript","style","script","table","tbody","thead","tfoot"],contOwnLine:["li","dt","dt","h[1-6]","option","script"],newLevel:["blockquote","div","dl","fieldset","form","frameset","map","ol","p","pre","select","td","th","tr","ul"],blockLevelElements:["P","H1","H2","H3","H4","H5","H6","DD","DL","DT","DIV","LI","BLOCKQUOTE","OUTPUT","FIGCAPTION","PRE","ADDRESS","SECTION","HEADER","FOOTER","ASIDE","ARTICLE"],langs:{en:{html:"HTML",video:"Insert Video",image:"Insert Image",table:"Table",link:"Link",link_insert:"Insert link",unlink:"Unlink",formatting:"Formatting",paragraph:"Normal text",quote:"Quote",code:"Code",header1:"Header 1",header2:"Header 2",header3:"Header 3",header4:"Header 4",bold:"Bold",italic:"Italic",fontcolor:"Font Color",backcolor:"Back Color",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",cancel:"Cancel",insert:"Insert",save:"Save",_delete:"Delete",insert_table:"Insert Table",insert_row_above:"Add Row Above",insert_row_below:"Add Row Below",insert_column_left:"Add Column Left",insert_column_right:"Add Column Right",delete_column:"Delete Column",delete_row:"Delete Row",delete_table:"Delete Table",rows:"Rows",columns:"Columns",add_head:"Add Head",delete_head:"Delete Head",title:"Title",image_position:"Position",none:"None",left:"Left",right:"Right",image_web_link:"Image Web Link",text:"Text",mailto:"Email",web:"URL",video_html_code:"Video Embed Code",file:"Insert File",upload:"Upload",download:"Download",choose:"Choose",or_choose:"Or choose",drop_file_here:"Drop file here",align_left:"Align text to the left",align_center:"Center text",align_right:"Align text to the right",align_justify:"Justify text",horizontalrule:"Insert Horizontal Rule",deleted:"Deleted",anchor:"Anchor",link_new_tab:"Open link in new tab",underline:"Underline",alignment:"Alignment",filename:"Name (optional)"}}},e.fn=t.Redactor.prototype={keyCode:{BACKSPACE:8,DELETE:46,DOWN:40,ENTER:13,ESC:27,TAB:9,CTRL:17,META:91,LEFT:37,LEFT_WIN:91},init:function(e,n){if(this.$element=this.$source=t(e),this.uuid=i++,this.opts=t.extend({},t.Redactor.opts,this.$element.data(),n),this.dropdowns=[],this.sourceHeight=this.$source.css("height"),this.sourceWidth=this.$source.css("width"),this.opts.fullpage&&(this.opts.iframe=!0),this.opts.linebreaks&&(this.opts.paragraphy=!1),this.opts.paragraphy&&(this.opts.linebreaks=!1),this.opts.toolbarFixedBox&&(this.opts.toolbarFixed=!0),this.document=document,this.window=window,this.savedSel=!1,this.cleanlineBefore=new RegExp("^<(/?"+this.opts.ownLine.join("|/?")+"|"+this.opts.contOwnLine.join("|")+")[ >]"),this.cleanlineAfter=new RegExp("^<(br|/?"+this.opts.ownLine.join("|/?")+"|/"+this.opts.contOwnLine.join("|/")+")[ >]"),this.cleannewLevel=new RegExp("^</?("+this.opts.newLevel.join("|")+")[ >]"),this.rTestBlock=new RegExp("^("+this.opts.blockLevelElements.join("|")+")$","i"),this.opts.linebreaks===!1&&(this.opts.allowedTags!==!1&&"-1"===t.inArray("p",this.opts.allowedTags)&&this.opts.allowedTags.push("p"),this.opts.deniedTags!==!1)){var r=t.inArray("p",this.opts.deniedTags);"-1"!==r&&this.opts.deniedTags.splice(r,r)}(this.browser("msie")||this.browser("opera"))&&(this.opts.buttons=this.removeFromArrayByValue(this.opts.buttons,"horizontalrule")),this.opts.curLang=this.opts.langs[this.opts.lang],this.buildStart()},initToolbar:function(t){return{html:{title:t.html,func:"toggle"},formatting:{title:t.formatting,func:"show",dropdown:{p:{title:t.paragraph,func:"formatBlocks"},blockquote:{title:t.quote,func:"formatQuote",className:"redactor_format_blockquote"},pre:{title:t.code,func:"formatBlocks",className:"redactor_format_pre"},h1:{title:t.header1,func:"formatBlocks",className:"redactor_format_h1"},h2:{title:t.header2,func:"formatBlocks",className:"redactor_format_h2"},h3:{title:t.header3,func:"formatBlocks",className:"redactor_format_h3"},h4:{title:t.header4,func:"formatBlocks",className:"redactor_format_h4"}}},bold:{title:t.bold,exec:"bold"},italic:{title:t.italic,exec:"italic"},deleted:{title:t.deleted,exec:"strikethrough"},underline:{title:t.underline,exec:"underline"},unorderedlist:{title:"&bull; "+t.unorderedlist,exec:"insertunorderedlist"},orderedlist:{title:"1. "+t.orderedlist,exec:"insertorderedlist"},outdent:{title:"< "+t.outdent,func:"indentingOutdent"},indent:{title:"> "+t.indent,func:"indentingIndent"},image:{title:t.image,func:"imageShow"},video:{title:t.video,func:"videoShow"},file:{title:t.file,func:"fileShow"},table:{title:t.table,func:"show",dropdown:{insert_table:{title:t.insert_table,func:"tableShow"},separator_drop1:{name:"separator"},insert_row_above:{title:t.insert_row_above,func:"tableAddRowAbove"},insert_row_below:{title:t.insert_row_below,func:"tableAddRowBelow"},insert_column_left:{title:t.insert_column_left,func:"tableAddColumnLeft"},insert_column_right:{title:t.insert_column_right,func:"tableAddColumnRight"},separator_drop2:{name:"separator"},add_head:{title:t.add_head,func:"tableAddHead"},delete_head:{title:t.delete_head,func:"tableDeleteHead"},separator_drop3:{name:"separator"},delete_column:{title:t.delete_column,func:"tableDeleteColumn"},delete_row:{title:t.delete_row,func:"tableDeleteRow"},delete_table:{title:t.delete_table,func:"tableDeleteTable"}}},link:{title:t.link,func:"show",dropdown:{link:{title:t.link_insert,func:"linkShow"},unlink:{title:t.unlink,exec:"unlink"}}},fontcolor:{title:t.fontcolor,func:"show"},backcolor:{title:t.backcolor,func:"show"},alignment:{title:t.alignment,func:"show",dropdown:{alignleft:{title:t.align_left,func:"alignmentLeft"},aligncenter:{title:t.align_center,func:"alignmentCenter"},alignright:{title:t.align_right,func:"alignmentRight"},justify:{title:t.align_justify,func:"alignmentJustify"}}},alignleft:{title:t.align_left,func:"alignmentLeft"},aligncenter:{title:t.align_center,func:"alignmentCenter"},alignright:{title:t.align_right,func:"alignmentRight"},justify:{title:t.align_justify,func:"alignmentJustify"},horizontalrule:{exec:"inserthorizontalrule",title:t.horizontalrule}}},callback:function(e,i,n){var r=this.opts[e+"Callback"];return t.isFunction(r)?i===!1?r.call(this,n):r.call(this,i,n):n},destroy:function(){clearInterval(this.autosaveInterval),t(window).off(".redactor"),this.$element.off(".redactor").removeData("redactor");var e=this.get();if(this.opts.textareamode)this.$box.after(this.$source),this.$box.remove(),this.$source.val(e).show();else{var i=this.$editor;this.opts.iframe&&(i=this.$element),this.$box.after(i),this.$box.remove(),i.removeClass("redactor_editor").removeClass("redactor_editor_wym").removeAttr("contenteditable").html(e).show()}},get:function(){return this.$source.val()},getCodeIframe:function(){this.$editor.removeAttr("contenteditable").removeAttr("dir");var t=this.outerHtml(this.$frame.contents().children());return this.$editor.attr({contenteditable:!0,dir:this.opts.direction}),t},set:function(t,e){t=t.toString(),this.opts.fullpage?this.setCodeIframe(t):this.setEditor(t,e)},setEditor:function(t,e){e!==!1&&(t=this.cleanSavePreCode(t),t=this.cleanStripTags(t),t=this.cleanConvertProtected(t),t=this.cleanConvertInlineTags(t),t=this.opts.linebreaks===!1?this.cleanConverters(t):t.replace(/<p(.*?)>([\w\W]*?)<\/p>/gi,"$2<br>")),t=this.cleanEmpty(t),this.$editor.html(t),this.sync()},setCodeIframe:function(t){var e=this.iframePage();this.$frame[0].src="about:blank",t=this.cleanConvertProtected(t),t=this.cleanConvertInlineTags(t),t=this.cleanRemoveSpaces(t),e.open(),e.write(t),e.close(),this.opts.fullpage&&(this.$editor=this.$frame.contents().find("body").attr({contenteditable:!0,dir:this.opts.direction})),this.sync()},setFullpageOnInit:function(t){t=this.cleanSavePreCode(t,!0),t=this.cleanConverters(t),t=this.cleanEmpty(t),this.$editor.html(t),this.sync()},sync:function(){var e="";this.cleanUnverified(),e=this.opts.fullpage?this.getCodeIframe():this.$editor.html(),e=this.syncClean(e),e=this.cleanRemoveSpaces(e),e=this.cleanRemoveEmptyTags(e),e=e.replace(/<\/li><(ul|ol)>([\w\W]*?)<\/(ul|ol)>/gi,"<$1>$2</$1></li>"),"<br>"===t.trim(e)&&(e=""),""!==e&&(e=this.cleanHtml(e)),e=this.callback("syncBefore",!1,e),this.$source.val(e),"undefined"!=typeof htmlEncode&&t("#"+this.$element[0].id+"_code").html(htmlEncode(e)),this.callback("syncAfter",!1,e)},syncClean:function(e){return this.opts.fullpage||(e=this.cleanStripTags(e)),e=t.trim(e),e=this.placeholderRemoveFromCode(e),e=e.replace(/&#x200b;/gi,""),e=e.replace(/&#8203;/gi,""),e=e.replace(/&nbsp;/gi," "),e=e.replace("<!--?php","<?php"),e=e.replace("?-->","?>"),e=e.replace(/<span(.*?)data-redactor="verified"(.*?)>([\w\W]*?)<\/span>/gi,'<font$1data-redactor="verified"$2>$3</font>'),e=e.replace(/<span(.*?)>([\w\W]*?)<\/span>/gi,"$2"),e=e.replace(/<font(.*?)data-redactor="verified"(.*?)>([\w\W]*?)<\/font>/gi,"<span$1$2>$3</span>"),e=e.replace(/<br\s?\/?>\n?<\/(.*?)>/gi,"</$1>"),e=e.replace(/<span(.*?)data-redactor-inlineMethods=""(.*?)>([\w\W]*?)<\/span>/gi,"<span$1$2>$3</span>"),e=e.replace(/<span\s*?>([\w\W]*?)<\/span>/gi,"$1"),e=e.replace(/<span\s*?id="selection-marker(.*?)"(.*?)>([\w\W]*?)<\/span>/gi,""),e=this.cleanReConvertProtected(e)},buildStart:function(){this.content="",this.$box=t('<div class="redactor_box" />'),"TEXTAREA"===this.$source[0].tagName&&(this.opts.textareamode=!0),this.opts.mobile===!1&&this.isMobile()?this.buildMobile():(this.buildContent(),this.opts.iframe?(this.opts.autoresize=!1,this.iframeStart()):this.opts.textareamode?this.buildFromTextarea():this.buildFromElement(),this.opts.iframe||(this.buildOptions(),this.buildAfter()))},buildMobile:function(){this.opts.textareamode||(this.$editor=this.$source,this.$editor.hide(),this.$source=this.buildCodearea(this.$editor),this.$source.val(this.content)),this.$box.insertAfter(this.$source).append(this.$source)},buildContent:function(){this.content=this.opts.textareamode?t.trim(this.$source.val()):t.trim(this.$source.html())},buildFromTextarea:function(){this.$editor=t("<div />"),this.$box.insertAfter(this.$source).append(this.$editor).append(this.$source),this.buildAddClasses(this.$editor),this.buildEnable()},buildFromElement:function(){this.$editor=this.$source,this.$source=this.buildCodearea(this.$editor),this.$box.insertAfter(this.$editor).append(this.$editor).append(this.$source),this.buildEnable()},buildCodearea:function(e){return t("<textarea />").attr("name",e.attr("id")).css("height",this.sourceHeight)},buildAddClasses:function(e){t.each(this.$source.get(0).className.split(/\s+/),function(t,i){e.addClass("redactor_"+i)})},buildEnable:function(){this.$editor.addClass("redactor_editor").attr({contenteditable:!0,dir:this.opts.direction}),this.$source.attr("dir",this.opts.direction).hide(),this.set(this.content)},buildOptions:function(){var t=this.$editor;this.opts.iframe&&(t=this.$frame),this.opts.tabindex&&t.attr("tabindex",this.opts.tabindex),this.opts.minHeight&&t.css("min-height",this.opts.minHeight+"px"),this.opts.wym&&this.$editor.addClass("redactor_editor_wym"),this.opts.autoresize||t.css("height",this.sourceHeight)},buildAfter:function(){if(this.opts.toolbar&&(this.opts.toolbar=this.initToolbar(this.opts.curLang),this.toolbarBuild()),this.modalTemplatesInit(),this.buildPlugins(),this.browser("opera")||this.pasteInit(),this.buildBindKeyboard(),this.opts.autosave&&this.autosave(),setTimeout(t.proxy(this.observeStart,this),4),this.browser("mozilla"))try{this.document.execCommand("enableObjectResizing",!1,!1),this.document.execCommand("enableInlineTableEditing",!1,!1)}catch(e){}this.opts.focus&&setTimeout(t.proxy(this.focus,this),100),this.opts.visual||setTimeout(t.proxy(function(){this.opts.visual=!0,this.toggle(!1)},this),200),this.callback("init")},buildBindKeyboard:function(){this.$editor.on("keydown.redactor",t.proxy(function(e){var i=e.which,n=e.ctrlKey||e.metaKey,r=this.getParent(),o=this.getCurrent(),s=this.getBlock(),a=!1;if(this.callback("keydown",e),(r&&"PRE"===t(r).get(0).tagName||o&&"PRE"===t(o).get(0).tagName)&&(a=!0,i===this.keyCode.DOWN&&this.insertAfterLastElement(s)),i===this.keyCode.DOWN&&(r&&"BLOCKQUOTE"===t(r).get(0).tagName&&this.insertAfterLastElement(r),o&&"BLOCKQUOTE"===t(o).get(0).tagName&&this.insertAfterLastElement(o)),n&&!e.shiftKey&&this.shortcuts(e,i),n&&90===i&&!e.shiftKey&&!e.altKey)return e.preventDefault(),this.opts.buffer.length?this.bufferUndo():this.document.execCommand("undo",!1,!1),void 0;if(n&&90===i&&e.shiftKey&&!e.altKey)return e.preventDefault(),0!=this.opts.rebuffer.length?this.bufferRedo():this.document.execCommand("redo",!1,!1),void 0;if(n&&(65===i?this.selectall=!0:i==this.keyCode.LEFT_WIN||n||(this.selectall=!1)),i!=this.keyCode.ENTER||e.shiftKey||e.ctrlKey||e.metaKey)i===this.keyCode.ENTER&&(e.ctrlKey||e.shiftKey)&&(this.bufferSet(),e.preventDefault(),this.insertLineBreak());else{if(1==r.nodeType&&("TD"==r.tagName||"TH"==r.tagName))return this.insertNode(document.createElement("br")),e.preventDefault(),void 0;if(a===!0){this.bufferSet(),e.preventDefault();var l=t(o).parent().text();return this.insertNode(document.createTextNode("\n")),-1==l.search(/\s$/)&&this.insertNode(document.createTextNode("\n")),this.sync(),!1}if(!this.opts.linebreaks)if(s&&/^(P|H[1-6]|LI|ADDRESS|SECTION|HEADER|FOOTER|ASIDE|ARTICLE)$/i.test(s.tagName))setTimeout(t.proxy(function(){var e=this.getBlock();if("DIV"===e.tagName&&!t(e).hasClass("redactor_editor")){var i=t("<p>"+this.opts.invisibleSpace+"</p>");t(e).replaceWith(i),this.selectionStart(i)}},this),1);else if(s===!1){var c=t("<p>"+this.opts.invisibleSpace+"</p>");return this.insertNode(c[0]),this.selectionStart(c),!1}if(this.opts.linebreaks){if(!s||!/^(P|H[1-6]|LI|ADDRESS|SECTION|HEADER|FOOTER|ASIDE|ARTICLE)$/i.test(s.tagName))return this.insertLineBreak(),e.preventDefault(),void 0;setTimeout(t.proxy(function(){var e=this.getBlock();"DIV"!==e.tagName&&"P"!==e.tagName||t(e).hasClass("redactor_editor")||this.replaceLineBreak(e)},this),1)}if("BLOCKQUOTE"==s.tagName||"FIGCAPTION"==s.tagName)return this.insertLineBreak(),e.preventDefault(),void 0}if(i===this.keyCode.TAB&&this.opts.shortcuts)return e.preventDefault(),a!==!0||e.shiftKey?(e.shiftKey?this.indentingOutdent():this.indentingIndent(),!1):(this.bufferSet(),this.insertNode(document.createTextNode("	")),this.sync(),!1);if(i===this.keyCode.BACKSPACE){var d=t.trim(o.nodeValue.replace(/[^\u0000-\u007E]/g,""));3===o.nodeType&&8203==o.nodeValue.charCodeAt(0)&&""==d&&o.remove()}},this)),this.$editor.on("keyup.redactor",t.proxy(function(e){var i=e.which,n=this.getParent(),r=this.getCurrent();if(!this.opts.linebreaks&&3==r.nodeType&&(0==n||"BODY"==n.tagName)){var o=t("<p>").append(t(r).clone());t(r).replaceWith(o);var s=t(o).next();"BR"==s[0].tagName&&s.remove(),this.selectionEnd(o)}return this.opts.convertLinks&&i===this.keyCode.ENTER&&this.formatLinkify(this.opts.linkProtocol),this.opts.linebreaks!==!1||i!==this.keyCode.DELETE&&i!==this.keyCode.BACKSPACE?(this.callback("keyup",e),this.sync(),void 0):this.formatEmpty(e)},this)),t.isFunction(this.opts.focusCallback)&&this.$editor.on("focus.redactor",t.proxy(this.opts.focusCallback,this)),t.isFunction(this.opts.blurCallback)&&this.$editor.on("blur.redactor",t.proxy(this.opts.blurCallback,this))},buildPlugins:function(){this.opts.plugins&&t.each(this.opts.plugins,t.proxy(function(e,i){RedactorPlugins[i]&&(t.extend(this,RedactorPlugins[i]),t.isFunction(RedactorPlugins[i].init)&&this.init())},this))},iframeStart:function(){this.iframeCreate(),this.opts.textareamode?this.iframeAppend(this.$source):(this.$sourceOld=this.$source.hide(),this.$source=this.buildCodearea(this.$sourceOld),this.iframeAppend(this.$sourceOld))},iframeAppend:function(t){this.$source.attr("dir",this.opts.direction).hide(),this.$box.insertAfter(t).append(this.$frame).append(this.$source)},iframeCreate:function(){this.$frame=t('<iframe style="width: 100%;" frameborder="0" />').one("load",t.proxy(function(){if(this.opts.fullpage){this.iframePage(),""===this.content&&(this.content=this.opts.invisibleSpace),this.$frame.contents()[0].write(this.content),this.$frame.contents()[0].close();var e=setInterval(t.proxy(function(){this.$frame.contents().find("body").html()&&(clearInterval(e),this.iframeLoad())},this),0)}else this.iframeLoad()},this))},iframeDoc:function(){return this.$frame[0].contentWindow.document},iframePage:function(){var t=this.iframeDoc();return t.documentElement&&t.removeChild(t.documentElement),t},iframeAddCss:function(e){e=e||this.opts.css,this.isString(e)&&this.$frame.contents().find("head").append('<link rel="stylesheet" href="'+e+'" />'),t.isArray(e)&&t.each(e,t.proxy(function(t,e){this.iframeAddCss(e)},this))},iframeLoad:function(){this.$editor=this.$frame.contents().find("body").attr({contenteditable:!0,dir:this.opts.direction}),this.$editor[0]&&(this.document=this.$editor[0].ownerDocument,this.window=this.document.defaultView||window),this.iframeAddCss(),this.opts.fullpage?this.setFullpageOnInit(this.$editor.html()):this.set(this.content),this.buildOptions(),this.buildAfter()},placeholderStart:function(e){return this.isEmpty(e)&&(this.$element.attr("placeholder")&&(this.opts.placeholder=this.$element.attr("placeholder")),""===this.opts.placeholder&&(this.opts.placeholder=!1),this.opts.placeholder!==!1)?(this.opts.focus=!1,this.$editor.one("focus.redactor_placeholder",t.proxy(this.placeholderFocus,this)),t('<span class="redactor_placeholder" data-redactor="verified">').attr("contenteditable",!1).text(this.opts.placeholder)):!1},placeholderFocus:function(){this.$editor.find("span.redactor_placeholder").remove();var t="";this.opts.linebreaks===!1&&(t=this.opts.emptyHtml),this.$editor.off("focus.redactor_placeholder"),this.$editor.html(t),this.opts.linebreaks===!1&&this.selectionStart(this.$editor.children()[0]),this.sync()},placeholderRemove:function(){this.opts.placeholder=!1,this.$editor.find("span.redactor_placeholder").remove(),this.$editor.off("focus.redactor_placeholder")},placeholderRemoveFromCode:function(t){return t.replace(/<span class="redactor_placeholder"(.*?)>(.*?)<\/span>/i,"")},shortcuts:function(t,e){this.opts.shortcuts&&(t.altKey?48===e?this.shortcutsLoadFormat(t,"p"):49===e?this.shortcutsLoadFormat(t,"h1"):50===e?this.shortcutsLoadFormat(t,"h2"):51===e?this.shortcutsLoadFormat(t,"h3"):52===e?this.shortcutsLoadFormat(t,"h4"):53===e?this.shortcutsLoadFormat(t,"h5"):54===e&&this.shortcutsLoadFormat(t,"h6"):77===e?this.shortcutsLoad(t,"removeFormat"):66===e?this.shortcutsLoad(t,"bold"):73===e?this.shortcutsLoad(t,"italic"):74===e?this.shortcutsLoad(t,"insertunorderedlist"):75===e?this.shortcutsLoad(t,"insertorderedlist"):76===e?this.shortcutsLoad(t,"superscript"):72===e&&this.shortcutsLoad(t,"subscript"))},shortcutsLoad:function(t,e){t.preventDefault(),this.execCommand(e,!1)},shortcutsLoadFormat:function(t,e){t.preventDefault(),this.formatBlocks(e)},focus:function(){this.browser("opera")?this.$editor.focus():this.window.setTimeout(t.proxy(this.focusSet,this,!0),1)},focusEnd:function(){this.focusSet()},focusSet:function(t){this.$editor.focus();var e=this.getRange();e.selectNodeContents(this.$editor[0]),e.collapse(t||!1);var i=this.getSelection();i.removeAllRanges(),i.addRange(e)},toggle:function(e){var i;if(this.opts.visual){e!==!1&&this.selectionSave();var n=null;this.opts.iframe?(n=this.$frame.height(),this.opts.fullpage&&this.$editor.removeAttr("contenteditable"),this.$frame.hide()):(n=this.$editor.innerHeight(),this.$editor.hide()),i=this.$source.val(),this.modified=i,this.$source.height(n).show().focus(),this.$source.on("keydown.redactor-textarea",function(e){if(9===e.keyCode){var i=t(this),n=i.get(0).selectionStart;return i.val(i.val().substring(0,n)+"	"+i.val().substring(i.get(0).selectionEnd)),i.get(0).selectionStart=i.get(0).selectionEnd=n+1,!1}}),this.buttonInactiveVisual(),this.buttonActive("html"),this.opts.visual=!1}else i=this.$source.hide().val(),"undefined"!=typeof this.modified&&(this.modified=this.cleanRemoveSpaces(this.modified,!1)!==this.cleanRemoveSpaces(i,!1)),this.modified&&(this.opts.fullpage&&""===i?this.setFullpageOnInit(i):(this.set(i),this.opts.fullpage&&this.buildBindKeyboard())),this.opts.iframe?this.$frame.show():this.$editor.show(),this.opts.fullpage&&this.$editor.attr("contenteditable",!0),this.$source.off("keydown.redactor-textarea"),this.$editor.focus(),this.selectionRestore(),this.observeStart(),this.buttonActiveVisual(),this.buttonInactive("html"),this.opts.visual=!0},autosave:function(){var e=!1;this.autosaveInterval=setInterval(t.proxy(function(){var i=this.get();e!==i&&t.ajax({url:this.opts.autosave,type:"post",data:this.$source.attr("name")+"="+escape(encodeURIComponent(i)),success:t.proxy(function(t){this.callback("autosave",!1,t),e=i},this)})},this),1e3*this.opts.autosaveInterval)},toolbarBuild:function(){if(this.opts.air)this.opts.buttons=this.opts.airButtons;else if(!this.opts.buttonSource){var e=this.opts.buttons.indexOf("html"),i=this.opts.buttons[e+1];this.opts.buttons.splice(e,1),"|"===i&&this.opts.buttons.splice(e,1)}if(t.extend(this.opts.toolbar,this.opts.buttonsCustom),t.each(this.opts.buttonsAdd,t.proxy(function(t,e){this.opts.buttons.push(e)},this)),this.opts.toolbar&&t.each(this.opts.toolbar.formatting.dropdown,t.proxy(function(e){"-1"==t.inArray(e,this.opts.formattingTags)&&delete this.opts.toolbar.formatting.dropdown[e]},this)),0===this.opts.buttons.length)return!1;if(this.airEnable(),this.$toolbar=t("<ul>").addClass("redactor_toolbar").attr("id","redactor_toolbar_"+this.uuid),this.opts.air?(this.$air=t('<div class="redactor_air">').attr("id","redactor_air_"+this.uuid).hide(),this.$air.append(this.$toolbar),t("body").append(this.$air)):this.opts.toolbarExternal?t(this.opts.toolbarExternal).html(this.$toolbar):this.$box.prepend(this.$toolbar),t.each(this.opts.buttons,t.proxy(function(e,i){if("|"===i)this.$toolbar.append(t(this.opts.buttonSeparator));else if(this.opts.toolbar[i]){var n=this.opts.toolbar[i];if(this.opts.fileUpload===!1&&"file"===i)return!0;this.$toolbar.append(t("<li>").append(this.buttonBuild(i,n)))}},this)),this.$toolbar.find("a").attr("tabindex","-1"),this.opts.toolbarFixed&&(this.toolbarObserveScroll(),t(document).on("scroll.redactor",t.proxy(this.toolbarObserveScroll,this))),this.opts.activeButtons){var n=t.proxy(this.buttonActiveObserver,this);this.$editor.on("mouseup.redactor keyup.redactor",n)}},toolbarObserveScroll:function(){var e=t(this.document).scrollTop(),i=this.$box.offset().top,n=0,r=i+this.$box.height()+40;if(e>i){var o="100%";this.opts.toolbarFixedBox&&(n=this.$box.offset().left,o=this.$box.innerWidth(),this.$toolbar.addClass("toolbar_fixed_box")),this.toolbarFixed=!0,this.$toolbar.css({position:"fixed",width:o,zIndex:1005,top:this.opts.toolbarFixedTopOffset+"px",left:n}),r>e?this.$toolbar.css("visibility","visible"):this.$toolbar.css("visibility","hidden")}else this.toolbarFixed=!1,this.$toolbar.css({position:"relative",width:"auto",top:0,left:n}),this.opts.toolbarFixedBox&&this.$toolbar.removeClass("toolbar_fixed_box")},airEnable:function(){this.opts.air&&this.$editor.on("mouseup.redactor keyup.redactor",this,t.proxy(function(e){var i=this.getSelectionText();if("mouseup"===e.type&&""!=i&&this.airShow(e),"keyup"===e.type&&e.shiftKey&&""!=i){var n=t(this.getElement(this.getSelection().focusNode)),r=n.offset();r.height=n.height(),this.airShow(r,!0)}},this))},airShow:function(e,i){if(this.opts.air){var n,r;if(t(".redactor_air").hide(),i)n=e.left,r=e.top+e.height+14,this.opts.iframe&&(r+=this.$box.position().top-t(this.document).scrollTop(),n+=this.$box.position().left);else{var o=this.$air.innerWidth();n=e.clientX,t(this.document).width()<n+o&&(n-=o),r=e.clientY+14,this.opts.iframe?(r+=this.$box.position().top,n+=this.$box.position().left):r+=t(this.document).scrollTop()}this.$air.css({left:n+"px",top:r+"px"}).show(),this.airBindHide()}},airBindHide:function(){if(this.opts.air){var e=t.proxy(function(e){t(e).on("mousedown.redactor",t.proxy(function(i){0===t(i.target).closest(this.$toolbar).length&&(this.$air.fadeOut(100),this.selectionRemove(),t(e).off(i))},this)).on("keydown.redactor",t.proxy(function(i){i.which===this.keyCode.ESC&&this.getSelection().collapseToStart(),this.$air.fadeOut(100),t(e).off(i)},this))},this);e(document),this.opts.iframe&&e(this.document)}},airBindMousemoveHide:function(){if(this.opts.air){var e=t.proxy(function(e){t(e).on("mousemove.redactor",t.proxy(function(i){0===t(i.target).closest(this.$toolbar).length&&(this.$air.fadeOut(100),t(e).off(i))},this))},this);e(document),this.opts.iframe&&e(this.document)}},pickerBuild:function(e,i){e.width(210);var n="color";"backcolor"===i&&(n="background-color");for(var r=this.opts.colors.length,o=this,s=0;r>s;s++){var a=this.opts.colors[s],l=t('<a rel="'+a+'" href="javascript:;" class="redactor_color_link"></a>').css({backgroundColor:a});e.append(l),l.on("click",function(){var e=t(this).attr("rel");"backcolor"===i&&(e=t(this).css("background-color")),o.pickerSet(n,e)})}var c=t('<a href="javascript:;" class="redactor_color_none"></a>').html(this.opts.curLang.none).on("click",function(){o.pickerSet(n,!1)});e.append(c)},pickerSet:function(t,e){this.bufferSet(),this.$editor.focus(),this.inlineRemoveStyle(t),e!==!1&&this.inlineSetStyle(t,e),this.opts.air&&this.$air.fadeOut(100),this.sync()},dropdownBuild:function(e,i){t.each(i,t.proxy(function(i,n){n.className||(n.className="");var r;"separator"===n.name?r=t('<a class="redactor_separator_drop">'):(r=t('<a href="javascript:;" class="'+n.className+'">'+n.title+"</a>"),r.on("click",t.proxy(function(t){t.preventDefault&&t.preventDefault(),this.browser("msie")&&(t.returnValue=!1),n.callback&&n.callback.call(this,i,r,n),n.exec&&this.execCommand(n.exec,i),n.func&&this[n.func](i),this.buttonActiveObserver(),this.opts.air&&this.$air.fadeOut(100)},this))),e.append(r)},this))},dropdownShow:function(e,i,n){if(!this.opts.visual)return e.preventDefault(),!1;if(this.buttonGet(n).hasClass("dropact"))this.dropdownHideAll();else{this.dropdownHideAll(),this.buttonActive(n),this.buttonGet(n).addClass("dropact");var r=this.buttonGet(n).position(),o=r.left+"px",s=29;this.opts.air?i.css({position:"absolute",left:o,top:s+"px"}).show():this.opts.toolbarFixed&&this.toolbarFixed?i.css({position:"fixed",left:o,top:s+"px"}).show():i.css({position:"absolute",left:o,top:r.top+s+"px"}).show()}var a=t.proxy(function(t){this.dropdownHide(t,i)},this);t(document).one("click",a),this.$editor.one("click",a),e.stopPropagation()},dropdownHideAll:function(){this.$toolbar.find("a.dropact").removeClass("redactor_act").removeClass("dropact"),t(".redactor_dropdown").hide()},dropdownHide:function(e,i){t(e.target).hasClass("dropact")||(i.removeClass("dropact"),this.dropdownHideAll())},buttonBuild:function(e,i){var n=t('<a href="javascript:;" title="'+i.title+'" class="redactor_btn redactor_btn_'+e+'"></a>'),r=t('<div class="redactor_dropdown" style="display: none;">');return n.on("click",t.proxy(function(t){return t.preventDefault&&t.preventDefault(),this.browser("msie")&&(t.returnValue=!1),this.opts.visual||"html"===e?(i.exec?(this.execCommand(i.exec,e),this.airBindMousemoveHide()):i.func&&"show"!==i.func?(this[i.func](e),this.airBindMousemoveHide()):i.callback?(i.callback.call(this,e,n,i),this.airBindMousemoveHide()):("backcolor"===e||"fontcolor"===e||i.dropdown)&&this.dropdownShow(t,r,e),this.buttonActiveObserver(),void 0):!1},this)),("backcolor"===e||"fontcolor"===e||i.dropdown)&&(r.appendTo(this.$toolbar),"backcolor"===e||"fontcolor"===e?this.pickerBuild(r,e):this.dropdownBuild(r,i.dropdown)),n},buttonGet:function(e){return this.opts.toolbar?t(this.$toolbar.find("a.redactor_btn_"+e)):!1},buttonActive:function(t){this.buttonGet(t).addClass("redactor_act")},buttonInactive:function(t){this.buttonGet(t).removeClass("redactor_act")},buttonInactiveAll:function(){t.each(this.opts.activeButtons,t.proxy(function(t,e){this.buttonInactive(e)},this))},buttonActiveVisual:function(){this.$toolbar.find("a.redactor_btn").not("a.redactor_btn_html").removeClass("redactor_button_disabled")},buttonInactiveVisual:function(){this.$toolbar.find("a.redactor_btn").not("a.redactor_btn_html").addClass("redactor_button_disabled")},buttonChangeIcon:function(t,e){this.buttonGet(t).addClass("redactor_btn_"+e)},buttonRemoveIcon:function(t,e){this.buttonGet(t).removeClass("redactor_btn_"+e)},buttonAddSeparator:function(){this.$toolbar.append(t(this.opts.buttonSeparator))},buttonAddSeparatorAfter:function(e){this.buttonGet(e).parent().after(t(this.opts.buttonSeparator))},buttonAddSeparatorBefore:function(e){this.buttonGet(e).parent().before(t(this.opts.buttonSeparator))},buttonRemoveSeparatorAfter:function(t){this.buttonGet(t).parent().next().remove()},buttonRemoveSeparatorBefore:function(t){this.buttonGet(t).parent().prev().remove()},buttonSetRight:function(t){this.opts.toolbar&&this.buttonGet(t).parent().addClass("redactor_btn_right")},buttonSetLeft:function(t){this.opts.toolbar&&this.buttonGet(t).parent().removeClass("redactor_btn_right")},buttonAdd:function(e,i,n,r){if(this.opts.toolbar){var o=this.buttonBuild(e,{title:i,callback:n,dropdown:r});this.$toolbar.append(t("<li>").append(o))}},buttonAddFirst:function(e,i,n,r){if(this.opts.toolbar){var o=this.buttonBuild(e,{title:i,callback:n,dropdown:r});this.$toolbar.prepend(t("<li>").append(o))}},buttonAddAfter:function(e,i,n,r,o){if(this.opts.toolbar){var s=this.buttonBuild(i,{title:n,callback:r,dropdown:o}),a=this.buttonGet(e);a.parent().after(t("<li>").append(s))}},buttonAddBefore:function(e,i,n,r,o){if(this.opts.toolbar){var s=this.buttonBuild(i,{title:n,callback:r,dropdown:o}),a=this.buttonGet(e);
a.parent().before(t("<li>").append(s))}},buttonRemove:function(t,e){var i=this.buttonGet(t);e&&i.parent().next().remove(),i.parent().removeClass("redactor_btn_right"),i.remove()},buttonActiveObserver:function(){var e=this.getParent();this.buttonInactiveAll(),this.opts.activeButtonsAdd&&(t.each(this.opts.activeButtonsAdd,t.proxy(function(t,e){this.opts.activeButtons.push(e)},this)),t.extend(this.opts.activeButtonsStates,this.opts.activeButtonsAdd)),t.each(this.opts.activeButtonsStates,t.proxy(function(i,n){0!=t(e).closest(i,this.$editor.get()[0]).length&&this.buttonActive(n)},this));var i=t(e).closest(this.opts.alignmentTags.toString().toLowerCase(),this.$editor[0]);if(i.length){var n=i.css("text-align");switch(n){case"right":this.buttonActive("alignright");break;case"center":this.buttonActive("aligncenter");break;case"justify":this.buttonActive("justify");break;default:this.buttonActive("alignleft")}}},exec:function(t,e,i){"formatblock"===t&&this.browser("msie")&&(e="<"+e+">"),"inserthtml"===t&&this.browser("msie")?(this.$editor.focus(),this.document.selection.createRange().pasteHTML(e)):this.document.execCommand(t,!1,e),i!==!1&&this.sync(),this.callback("execCommand",t,e)},execCommand:function(e,i,n){if(!this.opts.visual)return this.$source.focus(),!1;if("inserthtml"===e)return this.insertHtml(i,n),this.callback("execCommand",e,i),void 0;if(this.currentOrParentIs("PRE")&&!this.opts.formattingPre)return!1;if("insertunorderedlist"===e||"insertorderedlist"===e){var r=this.getParent(),o=t(r).closest("ol, ul"),s=!1;if(o.length){s=!0;var a=o[0].tagName;("insertunorderedlist"===e&&"OL"===a||"insertorderedlist"===e&&"UL"===a)&&(s=!1)}if(s){this.selectionSave();var l=this.getNodes(),c=this.getBlocks(l);"undefined"!=typeof l[0]&&l.length>1&&3==l[0].nodeType&&c.unshift(this.getBlock());var d="",h="";t.each(c,t.proxy(function(e,i){if("LI"==i.tagName){var n=t(i),r=n.clone();r.find("ul","ol").remove(),d+=this.opts.linebreaks===!1?this.outerHtml(t("<p>").append(r.contents())):r.html()+"<br>",0==e?(n.addClass("redactor-replaced").empty(),h=this.outerHtml(n)):n.remove()}},this)),html=this.$editor.html().replace(h,"</"+a+">"+d+"<"+a+">"),this.$editor.html(html),this.$editor.find(a+":empty").remove(),this.selectionRestore()}else{this.selectionSave(),this.document.execCommand(e);var r=this.getParent(),o=t(r).closest("ol, ul");if(o.length){(this.browser("msie")||this.browser("mozilla"))&&"LI"!==r.tagName&&t(r).replaceWith(t(r).html());var u=o.parent();this.isParentRedactor(u)&&this.nodeTestBlocks(u[0])&&u.replaceWith(u.contents())}this.browser("mozilla")&&this.$editor.focus(),this.selectionRestore()}return this.sync(),this.callback("execCommand",e,i),void 0}if("unlink"===e){var r=this.getParent();if("A"===t(r)[0].tagName)return t(r).replaceWith(t(r).text()),this.sync(),this.callback("execCommand",e,i),void 0}this.exec(e,i,n),"inserthorizontalrule"===e&&this.$editor.find("hr").removeAttr("id")},indentingIndent:function(){this.indentingStart("indent")},indentingOutdent:function(){this.indentingStart("outdent")},indentingStart:function(e){if("indent"===e){var i=this.getBlock();if(i&&"LI"==i.tagName){this.selectionSave();var n=this.getParent(),r=t(n).closest("ol, ul"),o=r[0].tagName,s=this.getBlocks();t.each(s,function(e,i){if("LI"==i.tagName){var n=t(i).prev();if(0!=n.size()&&"LI"==n[0].tagName){var r=n.children("ul, ol");0==r.size()?n.append(t("<"+o+">").append(i)):r.append(i)}}}),this.selectionRestore()}}else{this.selectionSave();var i=this.getBlock();if(i&&"LI"==i.tagName){var s=this.getBlocks(),a=0;this.insideOutdent(i,a,s)}this.selectionRestore()}},insideOutdent:function(e,i,n){if(e&&"LI"==e.tagName){var r=t(e).parent().parent();0!=r.size()&&"LI"==r[0].tagName?r.after(e):"undefined"!=typeof n[i]?(e=n[i],i++,this.insideOutdent(e,i,n)):this.execCommand("insertunorderedlist")}},cleanEmpty:function(t){var e=this.placeholderStart(t);return e!==!1?e:(this.opts.linebreaks===!1&&(""===t?t=this.opts.emptyHtml:-1!==t.search(/^<hr\s?\/?>$/gi)&&(t="<hr>"+this.opts.emptyHtml)),t)},cleanConverters:function(t){return this.opts.convertDivs&&(t=t.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p$1>$2</p>")),this.opts.paragraphy&&(t=this.cleanParagraphy(t)),t},cleanConvertProtected:function(t){return t=t.replace(/<script(.*?)>([\w\W]*?)<\/script>/gi,'<title type="text/javascript" style="display: none;" class="redactor-script-tag"$1>$2</title>'),t=t.replace(/<style(.*?)>([\w\W]*?)<\/style>/gi,'<section$1 style="display: none;" rel="redactor-style-tag">$2</section>'),t=t.replace(/<form(.*?)>([\w\W]*?)<\/form>/gi,'<section$1 rel="redactor-form-tag">$2</section>'),t=this.opts.phpTags?t.replace(/<\?php([\w\W]*?)\?>/gi,'<section style="display: none;" rel="redactor-php-tag">$1</section>'):t.replace(/<\?php([\w\W]*?)\?>/gi,"")},cleanReConvertProtected:function(t){return t=t.replace(/<title type="text\/javascript" style="display: none;" class="redactor-script-tag"(.*?)>([\w\W]*?)<\/title>/gi,'<script$1 type="text/javascript">$2</script>'),t=t.replace(/<section(.*?) style="display: none;" rel="redactor-style-tag">([\w\W]*?)<\/section>/gi,"<style$1>$2</style>"),t=t.replace(/<section(.*?)rel="redactor-form-tag"(.*?)>([\w\W]*?)<\/section>/gi,"<form$1$2>$3</form>"),this.opts.phpTags&&(t=t.replace(/<section style="display: none;" rel="redactor-php-tag">([\w\W]*?)<\/section>/gi,"<?php\r\n$1\r\n?>")),t},cleanRemoveSpaces:function(e,i){if(i!==!1){var n,i=[],r=0;n=e.match(/<(pre|style|script|title)(.*?)>([\w\W]*?)<\/(pre|style|script|title)>/gi),null!==n&&t.each(n,function(t,n){r=t,e=e.replace(n,"buffer_"+r),i.push(n)}),this.opts.phpTags&&(n=e.match(/<\?php([\w\W]*?)\?>/gi),null!==n&&t.each(n,function(t,n){r+=t,e=e.replace(n,"buffer_"+t),i.push(n)}))}return e=e.replace(/\n/g," "),e=e.replace(/[\t]*/g,""),e=e.replace(/\n\s*\n/g,"\n"),e=e.replace(/^[\s\n]*/g," "),e=e.replace(/[\s\n]*$/g," "),e=e.replace(/>\s{2,}</g,"><"),i!==!1&&(e=this.cleanReplacer(i,e)),e=e.replace(/\n\n/g,"\n")},cleanReplacer:function(e,i){return e&&t.each(e,function(t,e){i=i.replace("buffer_"+t,e)}),i},cleanRemoveEmptyTags:function(t){t=t.replace(/<span>([\w\W]*?)<\/span>/gi,"$1"),t=t.replace(/[\u200B-\u200D\uFEFF]/g,"");for(var e=["<pre></pre>","<blockquote>\\s*</blockquote>","<dd></dd>","<dt></dt>","<em>\\s*</em>","<ul></ul>","<ol></ol>","<li></li>","<table></table>","<tr></tr>","<span>\\s*<span>","<span>&nbsp;<span>","<b>\\s*</b>","<b>&nbsp;</b>","<p>\\s*</p>","<p></p>","<p>&nbsp;</p>","<p>\\s*<br>\\s*</p>","<div>\\s*</div>","<div>\\s*<br>\\s*</div>"],i=e.length,n=0;i>n;++n)t=t.replace(new RegExp(e[n],"gi"),"");return t},cleanParagraphy:function(e){function i(t,i,n){return e.replace(new RegExp(t,i),n)}if(e=t.trim(e),this.opts.linebreaks===!0)return e;if(""===e||"<p></p>"===e)return this.opts.emptyHtml;e+="\n";var n=[],r=0;-1!==e.search(/<(table|div|pre|object)/gi)&&t.each(e.match(/<(table|div|pre|object)(.*?)>([\w\W]*?)<\/(table|div|pre|object)>/gi),function(t,i){r++,n[r]=i,e=e.replace(i,"{replace"+r+"}\n")}),this.opts.phpTags&&-1!==e.search(/<section(.*?)rel="redactor-php-tag">/gi)&&t.each(e.match(/<section(.*?)rel="redactor-php-tag">([\w\W]*?)<\/section>/gi),function(t,i){r++,n[r]=i,e=e.replace(i,"{replace"+r+"}\n")}),e=e.replace(/<\!\-\-([\w\W]*?)\-\->/gi,"<comment>$1</comment>"),e=e.replace(/<br \/>\s*<br \/>/gi,"\n\n");var o="(comment|html|body|head|title|meta|style|script|link|iframe|table|thead|tfoot|caption|col|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|option|form|map|area|blockquote|address|math|style|p|h[1-6]|hr|fieldset|legend|section|article|aside|hgroup|header|footer|nav|figure|figcaption|details|menu|summary)";e=i("(<"+o+"[^>]*>)","gi","\n$1"),e=i("(</"+o+">)","gi","$1\n\n"),e=i("\r\n","g","\n"),e=i("\r","g","\n"),e=i("/\n\n+/","g","\n\n");var s=e.split(new RegExp("\ns*\n","g"),-1);e="";for(var a in s)s.hasOwnProperty(a)&&(e+=-1==s[a].search("{replace")?"<p>"+s[a].replace(/^\n+|\n+$/g,"")+"</p>":s[a]);return-1!==e.search(/<blockquote/gi)&&t.each(e.match(/<blockquote(.*?)>([\w\W]*?)<\/blockquote>/gi),function(t,i){var n="";n=i.replace("<p>",""),n=n.replace("</p>","<br>"),e=e.replace(i,n)}),e=i("<p>s*</p>","gi",""),e=i("<p>([^<]+)</(div|address|form)>","gi","<p>$1</p></$2>"),e=i("<p>s*(</?"+o+"[^>]*>)s*</p>","gi","$1"),e=i("<p>(<li.+?)</p>","gi","$1"),e=i("<p>s*(</?"+o+"[^>]*>)","gi","$1"),e=i("(</?"+o+"[^>]*>)s*</p>","gi","$1"),e=i("(</?"+o+"[^>]*>)s*<br />","gi","$1"),e=i("<br />(s*</?(?:p|li|div|dl|dd|dt|th|pre|td|ul|ol)[^>]*>)","gi","$1"),e=i("\n</p>","gi","</p>"),e=i("</li><p>","gi","</li>"),e=i("</ul><p>(.*?)</li>","gi","</ul></li>"),e=i("</ol><p>","gi","</ol>"),e=i("<p>	?\n?<p>","gi","<p>"),e=i("</dt><p>","gi","</dt>"),e=i("</dd><p>","gi","</dd>"),e=i("<br></p></blockquote>","gi","</blockquote>"),t.each(n,function(t,i){e=e.replace("{replace"+t+"}",i)}),e=e.replace(/<comment>([\w\W]*?)<\/comment>/gi,"<!--$1-->"),t.trim(e)},cleanConvertInlineTags:function(t){var e="strong";"b"===this.opts.boldTag&&(e="b");var i="em";return"i"===this.opts.italicTag&&(i="i"),t=t.replace(/<span style="font-style: italic;">([\w\W]*?)<\/span>/gi,"<"+i+">$1</"+i+">"),t=t.replace(/<span style="font-weight: bold;">([\w\W]*?)<\/span>/gi,"<"+e+">$1</"+e+">"),t="strong"===this.opts.boldTag?t.replace(/<b>([\w\W]*?)<\/b>/gi,"<strong>$1</strong>"):t.replace(/<strong>([\w\W]*?)<\/strong>/gi,"<b>$1</b>"),t="em"===this.opts.italicTag?t.replace(/<i>([\w\W]*?)<\/i>/gi,"<em>$1</em>"):t.replace(/<em>([\w\W]*?)<\/em>/gi,"<i>$1</i>"),t=t.replace(/<strike>([\w\W]*?)<\/strike>/gi,"<del>$1</del>"),/<span(.*?)data-redactor="verified"(.*?)>([\w\W]*?)<\/span>/gi.test(t)||(t=t.replace(/<span(.*?)(?!data-redactor="verified")(.*?)>([\w\W]*?)<\/span>/gi,'<span$1 data-redactor="verified"$2>$3</span>')),t},cleanStripTags:function(e){if(""==e||"undefined"==typeof e)return e;var i=!1;this.opts.allowedTags!==!1&&(i=!0);var n=i===!0?this.opts.allowedTags:this.opts.deniedTags,r=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return e=e.replace(r,function(e,r){return i===!0?t.inArray(r.toLowerCase(),n)>"-1"?e:"":t.inArray(r.toLowerCase(),n)>"-1"?"":e}),e=this.cleanConvertInlineTags(e)},cleanSavePreCode:function(e,i){var n=e.match(/<(pre|code)(.*?)>([\w\W]*?)<\/(pre|code)>/gi);return null!==n&&t.each(n,t.proxy(function(t,n){var r=n.match(/<(pre|code)(.*?)>([\w\W]*?)<\/(pre|code)>/i);r[3]=r[3].replace(/&nbsp;/g," "),i!==!1&&(r[3]=this.cleanEncodeEntities(r[3])),e=e.replace(n,"<"+r[1]+r[2]+">"+r[3]+"</"+r[1]+">")},this)),e},cleanEncodeEntities:function(t){return t=String(t).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"'),String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},cleanUnverified:function(){var e=this.$editor.find("img, a, b, strong, sub, sup, i, em, u, small, strike, del, span, cite").filter('[style*="font-size"][style*="line-height"]').css("font-size","").css("line-height","");t.each(e,t.proxy(function(t,e){this.removeEmptyAttr(e,"style")},this)),this.$editor.find('div[style="text-align: -webkit-auto;"]').contents().unwrap()},cleanHtml:function(t){var e=0,i=t.length,n=0,r=null,o=null,s="",a="",l="";for(this.cleanlevel=0;i>e;e++){if(n=e,-1==t.substr(e).indexOf("<"))return a+=t.substr(e),this.cleanFinish(a);for(;i>n&&"<"!=t.charAt(n);)n++;for(e!=n&&(l=t.substr(e,n-e),l.match(/^\s{2,}$/g)||("\n"==a.charAt(a.length-1)?a+=this.cleanGetTabs():"\n"==l.charAt(0)&&(a+="\n"+this.cleanGetTabs(),l=l.replace(/^\s+/,"")),a+=l),l.match(/\n/)&&(a+="\n"+this.cleanGetTabs())),r=n;i>n&&">"!=t.charAt(n);)n++;s=t.substr(r,n-r),e=n;var c;if("!--"==s.substr(1,3)){if(!s.match(/--$/)){for(;"-->"!=t.substr(n,3);)n++;n+=2,s=t.substr(r,n-r),e=n}"\n"!=a.charAt(a.length-1)&&(a+="\n"),a+=this.cleanGetTabs(),a+=s+">\n"}else"!"==s[1]?a=this.placeTag(s+">",a):"?"==s[1]?a+=s+">\n":(c=s.match(/^<(script|style|pre)/i))?(c[1]=c[1].toLowerCase(),s=this.cleanTag(s),a=this.placeTag(s,a),o=String(t.substr(e+1)).toLowerCase().indexOf("</"+c[1]),o&&(l=t.substr(e+1,o),e+=o,a+=l)):(s=this.cleanTag(s),a=this.placeTag(s,a))}return this.cleanFinish(a)},cleanGetTabs:function(){for(var t="",e=0;e<this.cleanlevel;e++)t+="	";return t},cleanFinish:function(t){return t=t.replace(/\n\s*\n/g,"\n"),t=t.replace(/^[\s\n]*/,""),t=t.replace(/[\s\n]*$/,""),t=t.replace(/<script(.*?)>\n<\/script>/gi,"<script$1></script>"),this.cleanlevel=0,t},cleanTag:function(t){var e="";t=t.replace(/\n/g," "),t=t.replace(/\s{2,}/g," "),t=t.replace(/^\s+|\s+$/g," ");var i="";t.match(/\/$/)&&(i="/",t=t.replace(/\/+$/,""));for(var n;n=/\s*([^= ]+)(?:=((['"']).*?\3|[^ ]+))?/.exec(t);)n[2]?e+=n[1].toLowerCase()+"="+n[2]:n[1]&&(e+=n[1].toLowerCase()),e+=" ",t=t.substr(n[0].length);return e.replace(/\s*$/,"")+i+">"},placeTag:function(t,e){var i=t.match(this.cleannewLevel);return(t.match(this.cleanlineBefore)||i)&&(e=e.replace(/\s*$/,""),e+="\n"),i&&"/"==t.charAt(1)&&this.cleanlevel--,"\n"==e.charAt(e.length-1)&&(e+=this.cleanGetTabs()),i&&"/"!=t.charAt(1)&&this.cleanlevel++,e+=t,(t.match(this.cleanlineAfter)||t.match(this.cleannewLevel))&&(e=e.replace(/ *$/,""),e+="\n"),e},alignmentLeft:function(){this.alignmentSet("","JustifyLeft")},alignmentRight:function(){this.alignmentSet("right","JustifyRight")},alignmentCenter:function(){this.alignmentSet("center","JustifyCenter")},alignmentJustify:function(){this.alignmentSet("justify","JustifyFull")},alignmentSet:function(e,i){if(this.bufferSet(),this.oldIE())return this.document.execCommand(i,!1,!1),!0;this.selectionSave();var n=this.getBlocks();t.each(n,t.proxy(function(i,n){var r=!1;r=-1!==t.inArray(n.tagName,this.opts.alignmentTags)?t(n):t(n).closest(this.opts.alignmentTags.toString().toLowerCase(),this.$editor[0]),r&&(r.css("text-align",e),this.removeEmptyAttr(r,"style"))},this)),this.selectionRestore(),this.sync()},formatEmpty:function(e){var i=t.trim(this.$editor.html());i=i.replace(/<br\s?\/?>/i,"");var n=i.replace(/<p>\s?<\/p>/gi,"");if(""===i||""===n){e.preventDefault();var r=t(this.opts.emptyHtml).get(0);this.$editor.html(r),this.focus()}this.sync()},formatBlocks:function(e){this.bufferSet();var i=this.getBlocks();this.selectionSave(),t.each(i,t.proxy(function(t,i){"LI"!==i.tagName&&this.formatBlock(e,i)},this)),this.selectionRestore(),this.sync()},formatBlock:function(e,i){if(i===!1&&(i=this.getBlock()),i===!1)return this.opts.linebreaks===!0&&this.execCommand("formatblock",e),!0;var n="";if("pre"!==e?n=t(i).contents():(n=t(i).html(),""===t.trim(n)&&(n='<span id="selection-marker-1"></span>')),"PRE"===i.tagName&&(e="p"),this.opts.linebreaks===!0&&"p"===e)t(i).replaceWith(t("<div>").append(n).html()+"<br>");else{var r=t("<"+e+">").append(n);t(i).replaceWith(r)}},formatChangeTag:function(e,i,n){n!==!1&&this.selectionSave();var r=t("<"+i+"/>");return t(e).replaceWith(function(){return r.append(t(this).contents())}),n!==!1&&this.selectionRestore(),r},formatQuote:function(){if(this.bufferSet(),this.opts.linebreaks===!1){this.selectionSave();var e=this.getBlocks();e&&t.each(e,t.proxy(function(t,e){"BLOCKQUOTE"===e.tagName?this.formatBlock("p",e,!1):"LI"!==e.tagName&&this.formatBlock("blockquote",e,!1)},this)),this.selectionRestore()}else{var i=this.getBlock();if("BLOCKQUOTE"===i.tagName)this.selectionSave(),t(i).replaceWith(t(i).html()+"<br>"),this.selectionRestore();else{var n=this.selectionWrap("blockquote"),r=t(n).html(),o=["ul","ol","table","tr","tbody","thead","tfoot","dl"];t.each(o,function(t,e){r=r.replace(new RegExp("<"+e+"(.*?)>","gi"),""),r=r.replace(new RegExp("</"+e+">","gi"),"")});var s=this.opts.blockLevelElements;s.push("td"),t.each(s,function(t,e){r=r.replace(new RegExp("<"+e+"(.*?)>","gi"),""),r=r.replace(new RegExp("</"+e+">","gi"),"<br>")}),t(n).html(r),this.selectionElement(n);var a=t(n).next();"BR"===a[0].tagName&&a.remove()}}this.sync()},blockRemoveAttr:function(e){var i=this.getBlocks();t(i).removeAttr(e),this.sync()},blockSetAttr:function(e,i){var n=this.getBlocks();t(n).attr(e,i),this.sync()},blockRemoveStyle:function(e){var i=this.getBlocks();t(i).css(e,""),this.removeEmptyAttr(i,"style"),this.sync()},blockSetStyle:function(e,i){var n=this.getBlocks();t(n).css(e,i),this.sync()},blockRemoveClass:function(e){var i=this.getBlocks();t(i).removeClass(e),this.removeEmptyAttr(i,"class"),this.sync()},blockSetClass:function(e){var i=this.getBlocks();t(i).addClass(e),this.sync()},inlineRemoveClass:function(e){this.selectionSave(),this.inlineEachNodes(function(i){t(i).removeClass(e),this.removeEmptyAttr(i,"class")}),this.selectionRestore(),this.sync()},inlineSetClass:function(e){var i=this.getCurrent();t(i).hasClass(e)||this.inlineMethods("addClass",e)},inlineRemoveStyle:function(e){this.selectionSave(),this.inlineEachNodes(function(i){t(i).css(e,""),this.removeEmptyAttr(i,"style")}),this.selectionRestore(),this.sync()},inlineSetStyle:function(t,e){this.inlineMethods("css",t,e)},inlineRemoveAttr:function(e){this.selectionSave();var i=this.getRange(),n=this.getElement(),r=this.getNodes();(i.collapsed||i.startContainer===i.endContainer&&n)&&(r=t(n)),t(r).removeAttr(e),this.inlineUnwrapSpan(),this.selectionRestore(),this.sync()},inlineSetAttr:function(t,e){this.inlineMethods("attr",t,e)},inlineMethods:function(e,i,n){this.selectionSave();var r=this.getRange(),o=this.getElement();if(r.collapsed||r.startContainer===r.endContainer&&o)t(o)[e](i,n);else{this.document.execCommand("fontSize",!1,4);var s=this.$editor.find("font");t.each(s,t.proxy(function(t,r){this.inlineSetMethods(e,r,i,n)},this))}this.selectionRestore(),this.sync()},inlineSetMethods:function(e,i,n,r){var o,s=t(i).parent();return s&&"SPAN"===s[0].tagName?(o=s,t(i).replaceWith(t(i).html())):(o=t('<span data-redactor="verified" data-redactor-inlineMethods>').append(t(i).contents()),t(i).replaceWith(o)),t(o)[e](n,r),o},inlineEachNodes:function(e){var i,n=this.getRange(),r=this.getElement(),o=this.getNodes();(n.collapsed||n.startContainer===n.endContainer&&r)&&(o=t(r),i=!0),t.each(o,t.proxy(function(n,r){if(!i&&"SPAN"!==r.tagName){if("SPAN"!==r.parentNode.tagName||t(r.parentNode).hasClass("redactor_editor"))return;r=r.parentNode}e.call(this,r)},this))},inlineUnwrapSpan:function(){var e=this.$editor.find("span[data-redactor-inlineMethods]");t.each(e,t.proxy(function(e,i){var n=t(i);void 0===n.attr("class")&&void 0===n.attr("style")&&n.contents().unwrap()},this))},inlineFormat:function(e){this.selectionSave(),this.document.execCommand("fontSize",!1,4);var i,n=this.$editor.find("font");t.each(n,function(n,r){var o=t("<"+e+"/>").append(t(r).contents());t(r).replaceWith(o),i=o}),this.selectionRestore(),this.sync()},inlineRemoveFormat:function(e){this.selectionSave();var i=e.toUpperCase(),n=this.getNodes();t.each(n,function(e,n){n.tagName===i&&t(n).replaceWith(t(n).contents())}),this.selectionRestore(),this.sync()},insertHtml:function(e,i){var n=this.getCurrent(),r=n.parentNode;this.$editor.focus(),this.bufferSet();var o=t("<div>").append(t.parseHTML(e));e=o.html(),e=this.cleanRemoveEmptyTags(e),o=t("<div>").append(t.parseHTML(e));var s=this.getBlock(),a=o.contents()[0].tagName;(1==o.contents().length&&"P"!=a&&a==s.tagName||"PRE"==a)&&(e=o.text(),o=t("<div>").append(e)),!this.opts.linebreaks&&1==o.contents().length&&3==o.contents()[0].nodeType&&(this.getRangeSelectedNodes().length>2||!n||"BODY"==n.tagName&&!r||"HTML"==r.tagName)&&(e="<p>"+e+"</p>"),"BLOCKQUOTE"==s.tagName&&-1===e.indexOf("<a")?this.insertText(e):o.contents().length>1&&s||o.contents().is("p, :header, ul, ol, div, table, blockquote, pre, address, section, header, footer, aside, article")?this.browser("msie")?this.document.selection.createRange().pasteHTML(e):this.document.execCommand("inserthtml",!1,e):this.insertHtmlAdvanced(e),this.selectall&&this.window.setTimeout(t.proxy(function(){this.opts.linebreaks?this.focusEnd():this.selectionEnd(this.$editor.contents().last())},this),1),this.observeStart(),i!==!1&&this.sync()},insertHtmlAdvanced:function(t){var e=this.getSelection();if(e.getRangeAt&&e.rangeCount){var i=e.getRangeAt(0);i.deleteContents();var n=this.document.createElement("div");n.innerHTML=t;for(var r,o,s=this.document.createDocumentFragment();r=n.firstChild;)o=s.appendChild(r);i.insertNode(s),o&&(i=i.cloneRange(),i.setStartAfter(o),i.collapse(!0),e.removeAllRanges(),e.addRange(i))}},insertText:function(e){var i=t(t.parseHTML(e));i.length&&(e=i.text()),this.$editor.focus(),this.browser("msie")?this.document.selection.createRange().pasteHTML(e):this.document.execCommand("inserthtml",!1,e),this.sync()},insertNode:function(t){var e=this.getSelection();e.getRangeAt&&e.rangeCount&&(range=e.getRangeAt(0),range.deleteContents(),range.insertNode(t),range.setEndAfter(t),range.setStartAfter(t),e.removeAllRanges(),e.addRange(range))},insertAfterLastElement:function(e){if(this.isEndOfElement()&&this.opts.linebreaks===!1){if(this.$editor.contents().last()[0]!==e)return!1;this.bufferSet();var i=t(this.opts.emptyHtml);t(e).after(i),this.selectionStart(i)}},insertLineBreak:function(){this.selectionSave(),this.$editor.find("#selection-marker-1").before("<br>"+(this.browser("webkit")?this.opts.invisibleSpace:"")),this.selectionRestore()},insertDoubleLineBreak:function(){this.selectionSave(),this.$editor.find("#selection-marker-1").before("<br><br>"+(this.browser("webkit")?this.opts.invisibleSpace:"")),this.selectionRestore()},replaceLineBreak:function(e){var i=t("<br>"+this.opts.invisibleSpace);t(e).replaceWith(i),this.selectionStart(i)},pasteInit:function(){return this.isMobile()?!1:(this.$editor.on("paste.redactor",t.proxy(function(){if(!this.opts.cleanup)return!0;this.selectionSave(),this.selectall||(this.opts.autoresize===!0?(this.$editor.height(this.$editor.height()),this.saveScroll=this.document.body.scrollTop):this.saveScroll=this.$editor.scrollTop());var e=this.extractContent();setTimeout(t.proxy(function(){var t=this.extractContent();this.$editor.append(e),this.selectionRestore();var i=this.getFragmentHtml(t);this.pasteClean(i),this.opts.autoresize===!0&&this.$editor.css("height","auto")},this),1)},this)),void 0)},pasteClean:function(t){if(this.currentOrParentIs("PRE"))return t=this.pastePre(t),this.pasteInsert(t),!0;if(t=t.replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,""),t=t.replace(/(&nbsp;){2,}/gi,"&nbsp;"),t=t.replace(/&nbsp;/gi," "),t=t.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2"),t=this.cleanStripTags(t),t=t.replace(/<td><\/td>/gi,"[td]"),t=t.replace(/<td>&nbsp;<\/td>/gi,"[td]"),t=t.replace(/<td><br><\/td>/gi,"[td]"),t=t.replace(/<a(.*?)href="(.*?)"(.*?)>([\w\W]*?)<\/a>/gi,'[a href="$2"]$4[/a]'),t=t.replace(/<iframe(.*?)>([\w\W]*?)<\/iframe>/gi,"[iframe$1]$2[/iframe]"),t=t.replace(/<video(.*?)>([\w\W]*?)<\/video>/gi,"[video$1]$2[/video]"),t=t.replace(/<audio(.*?)>([\w\W]*?)<\/audio>/gi,"[audio$1]$2[/audio]"),t=t.replace(/<embed(.*?)>([\w\W]*?)<\/embed>/gi,"[embed$1]$2[/embed]"),t=t.replace(/<object(.*?)>([\w\W]*?)<\/object>/gi,"[object$1]$2[/object]"),t=t.replace(/<param(.*?)>/gi,"[param$1]"),t=t.replace(/<img(.*?)style="(.*?)"(.*?)>/gi,"[img$1$3]"),t=t.replace(/<(\w+)([\w\W]*?)>/gi,"<$1>"),t=t.replace(/<[^\/>][^>]*>(\s*|\t*|\n*|&nbsp;|<br>)<\/[^>]+>/gi,""),t=t.replace(/<div>\s*?\t*?\n*?(<ul>|<ol>|<p>)/gi,"$1"),t=t.replace(/\[td\]/gi,"<td>&nbsp;</td>"),t=t.replace(/\[a href="(.*?)"\]([\w\W]*?)\[\/a\]/gi,'<a href="$1">$2</a>'),t=t.replace(/\[iframe(.*?)\]([\w\W]*?)\[\/iframe\]/gi,"<iframe$1>$2</iframe>"),t=t.replace(/\[video(.*?)\]([\w\W]*?)\[\/video\]/gi,"<video$1>$2</video>"),t=t.replace(/\[audio(.*?)\]([\w\W]*?)\[\/audio\]/gi,"<audio$1>$2</audio>"),t=t.replace(/\[embed(.*?)\]([\w\W]*?)\[\/embed\]/gi,"<embed$1>$2</embed>"),t=t.replace(/\[object(.*?)\]([\w\W]*?)\[\/object\]/gi,"<object$1>$2</object>"),t=t.replace(/\[param(.*?)\]/gi,"<param$1>"),t=t.replace(/\[img(.*?)\]/gi,"<img$1>"),this.opts.convertDivs&&(t=t.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p>$2</p>"),t=t.replace(/<\/div><p>/gi,"<p>"),t=t.replace(/<\/p><\/div>/gi,"</p>")),t=this.cleanParagraphy(t),t=t.replace(/<span(.*?)>([\w\W]*?)<\/span>/gi,"$2"),t=t.replace(/<img>/gi,""),t=t.replace(/<[^\/>][^>][^img|param|source]*>(\s*|\t*|\n*|&nbsp;|<br>)<\/[^>]+>/gi,""),t=t.replace(/\n{3,}/gi,"\n"),t=t.replace(/<p><p>/gi,"<p>"),t=t.replace(/<\/p><\/p>/gi,"</p>"),this.opts.linebreaks===!0&&(t=t.replace(/<p(.*?)>([\w\W]*?)<\/p>/gi,"$2<br>")),t=t.replace(/<[^\/>][^>][^img|param|source]*>(\s*|\t*|\n*|&nbsp;|<br>)<\/[^>]+>/gi,""),this.browser("mozilla"))for(;/<br>$/gi.test(t);)t=t.replace(/<br>$/gi,"");for(;/<font>([\w\W]*?)<\/font>/gi.test(t);)t=t.replace(/<font>([\w\W]*?)<\/font>/gi,"$1");this.pasteInsert(t)},pastePre:function(t){t=t.replace(/<br>|<\/H[1-6]>|<\/p>|<\/div>/gi,"\n");var e=this.document.createElement("div");return e.innerHTML=t,this.cleanEncodeEntities(e.textContent||e.innerText)},pasteInsert:function(e){this.selectall&&(this.opts.linebreaks?this.$editor.html(""):this.$editor.html(this.opts.emptyHtml),this.$editor.focus()),this.insertHtml(e),this.selectall=!1,this.opts.autoresize?t(this.document.body).scrollTop(this.saveScroll):this.$editor.scrollTop(this.saveScroll)},bufferSet:function(t){void 0!==t?this.opts.buffer.push(t):(this.selectionSave(),this.opts.buffer.push(this.$editor.html()),this.selectionRemoveMarkers(!0))},bufferUndo:function(){return 0===this.opts.buffer.length?(this.$editor.focus(),void 0):(this.selectionSave(),this.opts.rebuffer.push(this.$editor.html()),this.selectionRestore(!1,!0),this.$editor.html(this.opts.buffer.pop()),this.selectionRestore(),setTimeout(t.proxy(this.observeStart,this),100),void 0)},bufferRedo:function(){return 0===this.opts.rebuffer.length?(this.$editor.focus(),!1):(this.selectionSave(),this.opts.buffer.push(this.$editor.html()),this.selectionRestore(!1,!0),this.$editor.html(this.opts.rebuffer.pop()),this.selectionRestore(!0),setTimeout(t.proxy(this.observeStart,this),4),void 0)},observeStart:function(){this.observeImages(),this.observeTables()},observeTables:function(){this.$editor.find("table").on("click",t.proxy(this.tableObserver,this))},observeImages:function(){return this.opts.observeImages===!1?!1:(this.$editor.find("img").each(t.proxy(function(e,i){this.browser("msie")&&t(i).attr("unselectable","on"),this.imageResize(i)},this)),void 0)},getSelection:function(){return this.opts.rangy?this.opts.iframe?rangy.getSelection(this.$frame[0]):rangy.getSelection():this.document.getSelection()},getRange:function(){if(this.opts.rangy)return this.opts.iframe?rangy.createRange(this.iframeDoc()):rangy.createRange();if(this.document.getSelection){var t=this.document.getSelection();if(t.getRangeAt&&t.rangeCount)return t.getRangeAt(0)}return this.document.createRange()},selectionElement:function(t){this.setCaret(t)},selectionStart:function(t){this.selectionSet(t[0]||t,0,null,0)},selectionEnd:function(t){this.selectionSet(t[0]||t,1,null,1)},selectionSet:function(t,e,i,n){null==i&&(i=t),null==n&&(n=e);var r=this.getSelection();if(r){var o=this.getRange();o.setStart(t,e),o.setEnd(i,n);try{r.removeAllRanges()}catch(s){}r.addRange(o)}},selectionWrap:function(t){t=t.toLowerCase();var e=this.getBlock();if(e){var i=this.formatChangeTag(e,t);return this.sync(),i}var n=this.getSelection(),r=n.getRangeAt(0),i=document.createElement(t);return i.appendChild(r.extractContents()),r.insertNode(i),this.selectionElement(i),i},selectionAll:function(){var t=this.getRange();t.selectNodeContents(this.$editor[0]);var e=this.getSelection();e.removeAllRanges(),e.addRange(t)},selectionRemove:function(){this.getSelection().removeAllRanges()},getCaretOffset:function(e){var i=0,n=this.getSelection().getRangeAt(0),r=n.cloneRange();return r.selectNodeContents(e),r.setEnd(n.endContainer,n.endOffset),i=t.trim(r.toString()).length},getCaretOffsetRange:function(){return new n(this.getSelection().getRangeAt(0))},setCaret:function(t,e,i){"undefined"==typeof i&&(i=e),t=t[0]||t;var n=this.getRange();n.selectNodeContents(t);var r,o=this.getTextNodesIn(t),s=!1,a=0;if(1==o.length&&e)n.setStart(o[0],e),n.setEnd(o[0],i);else for(var l,c=0;l=o[c++];){if(r=a+l.length,!s&&e>=a&&(r>e||e==r&&c<o.length)&&(n.setStart(l,e-a),s=!0),s&&r>=i){n.setEnd(l,i-a);break}a=r}var d=this.getSelection();d.removeAllRanges(),d.addRange(n)},getTextNodesIn:function(t){var e=[];if(3==t.nodeType)e.push(t);else for(var i=t.childNodes,n=0,r=i.length;r>n;++n)e.push.apply(e,this.getTextNodesIn(i[n]));return e},selectionSave:function(){this.isFocused()||this.$editor.focus(),this.opts.rangy?this.savedSel=rangy.saveSelection():this.selectionCreateMarker(this.getRange())},selectionCreateMarker:function(e){if(e){var i=t('<span id="selection-marker-1">'+this.opts.invisibleSpace+"</span>",this.document)[0],n=t('<span id="selection-marker-2">'+this.opts.invisibleSpace+"</span>",this.document)[0];e.collapsed===!0?this.selectionSetMarker(e,i,!0):(this.selectionSetMarker(e,i,!0),this.selectionSetMarker(e,n,!1)),this.savedSel=this.$editor.html(),this.selectionRestore(!1,!1)}},selectionSetMarker:function(t,e,i){var n=t.cloneRange();n.collapse(i),n.insertNode(e),n.detach()},selectionRestore:function(t,e){if(this.opts.rangy)rangy.restoreSelection(this.savedSel);else{t===!0&&this.savedSel&&this.$editor.html(this.savedSel);var i=this.$editor.find("span#selection-marker-1"),n=this.$editor.find("span#selection-marker-2");this.isFocused()||this.$editor.focus(),0!=i.length&&0!=n.length?this.selectionSet(i[0],0,n[0],0):0!=i.length&&this.selectionSet(i[0],0,null,0),e!==!1&&(this.selectionRemoveMarkers(),this.savedSel=!1)}},selectionRemoveMarkers:function(){this.opts.rangy?rangy.removeMarkers(this.savedSel):(this.$editor.find("span#selection-marker-1").remove(),this.$editor.find("span#selection-marker-2").remove())},getCurrent:function(){var t=!1,e=this.getSelection();return e.rangeCount>0&&(t=e.getRangeAt(0).startContainer),this.isParentRedactor(t)},getParent:function(e){return e=e||this.getCurrent(),e?this.isParentRedactor(t(e).parent()[0]):!1},getBlock:function(e){for("undefined"==typeof e&&(e=this.getCurrent());e;){if(this.nodeTestBlocks(e))return t(e).hasClass("redactor_editor")?!1:e;e=e.parentNode}return!1},getBlocks:function(e){var i=[];if("undefined"==typeof e){var n=this.getRange();if(n&&n.collapsed===!0)return[this.getBlock()];var e=this.getNodes(n)}return t.each(e,t.proxy(function(e,n){return this.opts.iframe===!1&&0==t(n).parents("div.redactor_editor").size()?!1:(this.nodeTestBlocks(n)&&i.push(n),void 0)},this)),0===i.length&&(i=[this.getBlock()]),i},nodeTestBlocks:function(t){return 1==t.nodeType&&this.rTestBlock.test(t.nodeName)},tagTestBlock:function(t){return this.rTestBlock.test(t)},getSelectedNodes:function(t){if("undefined"==typeof t||0==t)var t=this.getRange();if(t&&t.collapsed===!0)return[this.getCurrent()];var e=this.getSelection();try{var i=e.getRangeAt(0).cloneContents()}catch(n){return!1}var r=this.document.createElement("span");r.appendChild(i),window.selnodes=r.childNodes;for(var o=selnodes.length,s=[],a=0,l=o;l>a;a++)s.push(selnodes[a]);return 0==s.length&&s.push(this.getCurrent()),s},getNodes:function(e,i){if(this.opts.linebreaks)return this.getSelectedNodes(e);if("undefined"==typeof e||0==e)var e=this.getRange();if(e&&e.collapsed===!0){if("undefined"==typeof i&&this.tagTestBlock(i)){var n=this.getBlock();return n.tagName==i?[n]:[]}return[this.getCurrent()]}var r=[],o=[],s=this.document.getSelection();if(s.isCollapsed||(r=this.getRangeSelectedNodes(s.getRangeAt(0))),t.each(r,t.proxy(function(e,n){return this.opts.iframe===!1&&0==t(n).parents("div.redactor_editor").size()?!1:("undefined"==typeof i?""!=t.trim(n.textContent)&&o.push(n):n.tagName==i&&o.push(n),void 0)},this)),0==o.length){if("undefined"==typeof i&&this.tagTestBlock(i)){var n=this.getBlock();return n.tagName==i?o.push(n):[]}o.push(this.getCurrent())}return o},getElement:function(e){for(e||(e=this.getCurrent());e;){if(1==e.nodeType)return t(e).hasClass("redactor_editor")?!1:e;e=e.parentNode}return!1},getRangeSelectedNodes:function(t){t=t||this.getRange();var e=t.startContainer,i=t.endContainer;if(e==i)return[e];for(var n=[];e&&e!=i;)n.push(e=this.nextNode(e));for(e=t.startContainer;e&&e!=t.commonAncestorContainer;)n.unshift(e),e=e.parentNode;return n},nextNode:function(t){if(t.hasChildNodes())return t.firstChild;for(;t&&!t.nextSibling;)t=t.parentNode;return t?t.nextSibling:null},getSelectionText:function(){return this.getSelection().toString()},getSelectionHtml:function(){var t="",e=this.getSelection();if(e.rangeCount){for(var i=this.document.createElement("div"),n=e.rangeCount,r=0;n>r;++r)i.appendChild(e.getRangeAt(r).cloneContents());t=i.innerHTML}return this.syncClean(t)},tableShow:function(){this.selectionSave(),this.modalInit(this.opts.curLang.table,this.opts.modal_table,300,t.proxy(function(){t("#redactor_insert_table_btn").click(t.proxy(this.tableInsert,this)),setTimeout(function(){t("#redactor_table_rows").focus()},200)},this))},tableInsert:function(){var e,i,n,r,o=t("#redactor_table_rows").val(),s=t("#redactor_table_columns").val(),a=t("<div></div>"),l=Math.floor(99999*Math.random()),c=t('<table id="table'+l+'"><tbody></tbody></table>');
for(e=0;o>e;e++){for(i=t("<tr></tr>"),n=0;s>n;n++)r=t("<td>"+this.opts.invisibleSpace+"</td>"),0===e&&0===n&&r.append('<span id="selection-marker-1">'+this.opts.invisibleSpace+"</span>"),t(i).append(r);c.append(i)}a.append(c);var d=a.html();this.modalClose(),this.selectionRestore();var h=this.getBlock()||this.getCurrent();h?t(h).after(d):this.insertHtmlAdvanced(d),this.selectionRestore();var u=this.$editor.find("#table"+l);this.tableObserver(u),this.buttonActiveObserver(),u.removeAttr("id"),this.sync()},tableObserver:function(e){this.$table=t(e.target||e).closest("table"),this.$tbody=t(e.target).closest("tbody"),this.$thead=this.$table.find("thead"),this.$current_td=t(e.target||this.$table.find("td").first()),this.$current_tr=t(e.target||this.$table.find("tr").first()).closest("tr")},tableDeleteTable:function(){this.bufferSet(),this.$table.remove(),this.$table=!1,this.sync()},tableDeleteRow:function(){this.bufferSet();var t=this.$current_tr.prev().length?this.$current_tr.prev():this.$current_tr.next();if(t.length){var e=t.children("td").first();e.length&&(e.prepend('<span id="selection-marker-1">'+this.opts.invisibleSpace+"</span>"),this.selectionRestore())}this.$current_tr.remove(),this.sync()},tableDeleteColumn:function(){this.bufferSet();var e=this.$current_td.get(0).cellIndex;this.$table.find("tr").each(t.proxy(function(i,n){var r=0>e-1?e+1:e-1;0===i&&(t(n).find("td").eq(r).prepend('<span id="selection-marker-1">'+this.opts.invisibleSpace+"</span>"),this.selectionRestore()),t(n).find("td").eq(e).remove()},this)),this.sync()},tableAddHead:function(){if(this.bufferSet(),0!==this.$table.find("thead").size())this.tableDeleteHead();else{var e=this.$table.find("tr").first().clone();e.find("td").html(this.opts.invisibleSpace),this.$thead=t("<thead></thead>"),this.$thead.append(e),this.$table.prepend(this.$thead),this.sync()}},tableDeleteHead:function(){this.bufferSet(),t(this.$thead).remove(),this.$thead=!1,this.sync()},tableAddRowAbove:function(){this.tableAddRow("before")},tableAddRowBelow:function(){this.tableAddRow("after")},tableAddColumnLeft:function(){this.tableAddColumn("before")},tableAddColumnRight:function(){this.tableAddColumn("after")},tableAddRow:function(t){this.bufferSet();var e=this.$current_tr.clone();e.find("td").html(this.opts.invisibleSpace),"after"===t?this.$current_tr.after(e):this.$current_tr.before(e),this.sync()},tableAddColumn:function(e){this.bufferSet();var i=0;this.$current_tr.find("td").each(t.proxy(function(e,n){t(n)[0]===this.$current_td[0]&&(i=e)},this)),this.$table.find("tr").each(t.proxy(function(n,r){var o=t(r).find("td").eq(i),s=o.clone();s.html(this.opts.invisibleSpace),"after"===e?o.after(s):o.before(s)},this)),this.sync()},videoShow:function(){this.selectionSave(),this.modalInit(this.opts.curLang.video,this.opts.modal_video,600,t.proxy(function(){t("#redactor_insert_video_btn").click(t.proxy(this.videoInsert,this)),setTimeout(function(){t("#redactor_insert_video_area").focus()},200)},this))},videoInsert:function(){var e=t("#redactor_insert_video_area").val();e=this.cleanStripTags(e),this.selectionRestore();var i=this.getBlock()||this.getCurrent();i?(t(i).after(e),this.sync()):this.insertHtmlAdvanced(e),this.modalClose()},linkShow:function(){this.selectionSave();var e=t.proxy(function(){this.insert_link_node=!1;var e=this.getSelection(),i="",n="",r="";e.anchorNode.parentNode;var o=this.getParent();o&&"A"===o.tagName?(i=o.href,n=t(o).text(),r=o.target,""===e.toString()&&(this.insert_link_node=o)):n=e.toString(),t(".redactor_link_text").val(n);var s=self.location.href.replace(/\/$/i,""),a=i.replace(s,""),l=t("#redactor_tabs").find("a");this.opts.linkEmail===!1&&l.eq(1).remove(),this.opts.linkAnchor===!1&&l.eq(2).remove(),this.opts.linkEmail===!1&&this.opts.linkAnchor===!1?(t("#redactor_tabs").remove(),t("#redactor_link_url").val(a)):0===i.search("mailto:")?(this.modalSetTab.call(this,2),t("#redactor_tab_selected").val(2),t("#redactor_link_mailto").val(i.replace("mailto:",""))):0===a.search(/^#/gi)?(this.modalSetTab.call(this,3),t("#redactor_tab_selected").val(3),t("#redactor_link_anchor").val(a.replace(/^#/gi,""))):t("#redactor_link_url").val(a),"_blank"===r&&t("#redactor_link_blank").prop("checked",!0),t("#redactor_insert_link_btn").click(t.proxy(this.linkProcess,this)),setTimeout(function(){t("#redactor_link_url").focus()},200)},this);this.modalInit(this.opts.curLang.link,this.opts.modal_link,460,e)},linkProcess:function(){var e=t("#redactor_tab_selected").val(),i="",n="",r="",o="";if("1"===e){i=t("#redactor_link_url").val(),n=t("#redactor_link_url_text").val(),t("#redactor_link_blank").prop("checked")&&(r=' target="_blank"',o="_blank");var s="((xn--)?[a-z0-9]+(-[a-z0-9]+)*.)+[a-z]{2,}",a=new RegExp("^(http|ftp|https)://"+s,"i"),l=new RegExp("^"+s,"i");-1==i.search(a)&&0==i.search(l)&&this.opts.linkProtocol&&(i=this.opts.linkProtocol+i)}else"2"===e?(i="mailto:"+t("#redactor_link_mailto").val(),n=t("#redactor_link_mailto_text").val()):"3"===e&&(i="#"+t("#redactor_link_anchor").val(),n=t("#redactor_link_anchor_text").val());this.linkInsert('<a href="'+i+'"'+r+">"+n+"</a>",t.trim(n),i,o)},linkInsert:function(e,i,n,r){this.selectionRestore(),""!==i&&(this.insert_link_node?(this.bufferSet(),t(this.insert_link_node).text(i).attr("href",n),""!==r?t(this.insert_link_node).attr("target",r):t(this.insert_link_node).removeAttr("target"),this.sync()):this.exec("inserthtml",e)),this.modalClose()},fileShow:function(){this.selectionSave();var e=t.proxy(function(){var e=this.getSelection(),i="";i=this.oldIE()?e.text:e.toString(),t("#redactor_filename").val(i),this.isMobile()||this.draguploadInit("#redactor_file",{url:this.opts.fileUpload,uploadFields:this.opts.uploadFields,success:t.proxy(this.fileCallback,this),error:t.proxy(function(t,e){this.callback("fileUploadError",e)},this)}),this.uploadInit("redactor_file",{auto:!0,url:this.opts.fileUpload,success:t.proxy(this.fileCallback,this),error:t.proxy(function(t,e){this.callback("fileUploadError",e)},this)})},this);this.modalInit(this.opts.curLang.file,this.opts.modal_file,500,e)},fileCallback:function(e){if(this.selectionRestore(),e!==!1){var i=t("#redactor_filename").val();""===i&&(i=e.filename);var n='<a href="'+e.filelink+'" id="filelink-marker">'+i+"</a>";this.browser("webkit")&&this.window.chrome&&(n+="&nbsp;"),this.execCommand("inserthtml",n,!1);var r=t(this.$editor.find("a#filelink-marker"));0!=r.size()?r.removeAttr("id"):r=!1,this.sync(),this.callback("fileUpload",r,e)}this.modalClose()},imageShow:function(){this.selectionSave();var e=t.proxy(function(){if(this.opts.imageGetJson?t.getJSON(this.opts.imageGetJson,t.proxy(function(e){var i={},n=0;t.each(e,t.proxy(function(t,e){"undefined"!=typeof e.folder&&(n++,i[e.folder]=n)},this));var r=!1;if(t.each(e,t.proxy(function(e,n){var o="";"undefined"!=typeof n.title&&(o=n.title);var s=0;t.isEmptyObject(i)||"undefined"==typeof n.folder||(s=i[n.folder],r===!1&&(r=".redactorfolder"+s));var a=t('<img src="'+n.thumb+'" class="redactorfolder redactorfolder'+s+'" rel="'+n.image+'" title="'+o+'" />');t("#redactor_image_box").append(a),t(a).click(t.proxy(this.imageThumbClick,this))},this)),!t.isEmptyObject(i)){t(".redactorfolder").hide(),t(r).show();var o=function(e){t(".redactorfolder").hide(),t(".redactorfolder"+t(e.target).val()).show()},s=t('<select id="redactor_image_box_select">');t.each(i,function(e,i){s.append(t('<option value="'+i+'">'+e+"</option>"))}),t("#redactor_image_box").before(s),s.change(o)}},this)):t("#redactor_tabs").find("a").eq(1).remove(),this.opts.imageUpload||this.opts.s3)this.isMobile()||this.opts.s3!==!1||t("#redactor_file").length&&this.draguploadInit("#redactor_file",{url:this.opts.imageUpload,uploadFields:this.opts.uploadFields,success:t.proxy(this.imageCallback,this),error:t.proxy(function(t,e){this.callback("imageUploadError",e)},this)}),this.opts.s3===!1?this.uploadInit("redactor_file",{auto:!0,url:this.opts.imageUpload,success:t.proxy(this.imageCallback,this),error:t.proxy(function(t,e){this.callback("imageUploadError",e)},this)}):t("#redactor_file").on("change.redactor",t.proxy(this.s3handleFileSelect,this));else if(t(".redactor_tab").hide(),this.opts.imageGetJson){var e=t("#redactor_tabs").find("a");e.eq(0).remove(),e.eq(1).addClass("redactor_tabs_act"),t("#redactor_tab2").show()}else t("#redactor_tabs").remove(),t("#redactor_tab3").show();t("#redactor_upload_btn").click(t.proxy(this.imageCallbackLink,this)),this.opts.imageUpload||this.opts.imageGetJson||setTimeout(function(){t("#redactor_file_link").focus()},200)},this);this.modalInit(this.opts.curLang.image,this.opts.modal_image,610,e)},imageEdit:function(e){var i=t(e.target),n=i.parent(),r=t.proxy(function(){t("#redactor_file_alt").val(i.attr("alt")),t("#redactor_image_edit_src").attr("href",i.attr("src")),t("#redactor_form_image_align").val(i.css("float")),"A"===t(n).get(0).tagName&&t("#redactor_file_link").val(t(n).attr("href")),t("#redactor_image_delete_btn").click(t.proxy(function(){this.imageRemove(i)},this)),t("#redactorSaveBtn").click(t.proxy(function(){this.imageSave(i)},this))},this);this.modalInit(this.opts.curLang.image,this.opts.modal_image_edit,380,r)},imageRemove:function(e){var i=t(e).parent();t(e).remove(),i.length&&"P"===i[0].tagName&&(this.$editor.focus(),this.selectionStart(i)),this.callback("imageDelete",e),this.modalClose(),this.sync()},imageSave:function(e){var i=t(e).parent();t(e).attr("alt",t("#redactor_file_alt").val());var n=t("#redactor_form_image_align").val();"left"===n?t(e).css({"float":"left",margin:"0 10px 10px 0"}):"right"===n?t(e).css({"float":"right",margin:"0 0 10px 10px"}):t(e).css({"float":"none",margin:"0"});var r=t.trim(t("#redactor_file_link").val());""!==r?"A"!==t(i).get(0).tagName?t(e).replaceWith('<a href="'+r+'">'+this.outerHtml(e)+"</a>"):t(i).attr("href",r):"A"===t(i).get(0).tagName&&t(i).replaceWith(this.outerHtml(e)),this.modalClose(),this.observeImages(),this.sync()},imageResize:function(e){var i,n,r=t(e),o=!1,s=!1,a=r.width()/r.height(),l=10;r.off("hover mousedown mouseup click mousemove"),r.hover(function(){r.css("cursor","nw-resize")},function(){r.css("cursor",""),o=!1}),r.mousedown(function(t){t.preventDefault(),a=r.width()/r.height(),o=!0,s=!0,i=Math.round(t.pageX-r.eq(0).offset().left),n=Math.round(t.pageY-r.eq(0).offset().top)}),r.mouseup(t.proxy(function(){o=!1,r.css("cursor",""),this.sync()},this)),r.click(t.proxy(function(t){s&&this.imageEdit(t)},this)),r.mousemove(function(e){if(o){s=!1,Math.round(e.pageX-t(this).eq(0).offset().left)-i;var c=Math.round(e.pageY-t(this).eq(0).offset().top)-n,d=r.height(),h=parseInt(d,10)+c,u=Math.round(h*a);u>l&&r.width(u),i=Math.round(e.pageX-t(this).eq(0).offset().left),n=Math.round(e.pageY-t(this).eq(0).offset().top)}})},imageThumbClick:function(e){var i='<img id="image-marker" src="'+t(e.target).attr("rel")+'" alt="'+t(e.target).attr("title")+'" />';this.opts.paragraphy&&(i="<p>"+i+"</p>"),this.imageInsert(i,!0)},imageCallbackLink:function(){var e=t("#redactor_file_link").val();if(""!==e){var i='<img id="image-marker" src="'+e+'" />';this.opts.linebreaks===!1&&(i="<p>"+i+"</p>"),this.imageInsert(i,!0)}else this.modalClose()},imageCallback:function(t){this.imageInsert(t)},imageInsert:function(e,i){if(this.selectionRestore(),e!==!1){var n="";i!==!0?(n='<img id="image-marker" src="'+e.filelink+'" />',this.opts.paragraphy&&(n="<p>"+n+"</p>")):n=e,this.execCommand("inserthtml",n,!1);var r=t(this.$editor.find("img#image-marker"));r.length?r.removeAttr("id"):r=!1,this.sync(),i!==!0&&this.callback("imageUpload",r,e)}this.modalClose(),this.observeImages()},modalTemplatesInit:function(){t.extend(this.opts,{modal_file:String()+"<section>"+'<div id="redactor-progress" class="redactor-progress redactor-progress-striped" style="display: none;">'+'<div id="redactor-progress-bar" class="redactor-progress-bar" style="width: 100%;"></div>'+"</div>"+'<form id="redactorUploadFileForm" method="post" action="" enctype="multipart/form-data">'+"<label>"+this.opts.curLang.filename+"</label>"+'<input type="text" id="redactor_filename" class="redactor_input" />'+'<div style="margin-top: 7px;">'+'<input type="file" id="redactor_file" name="file" />'+"</div>"+"</form>"+"</section>",modal_image_edit:String()+"<section>"+"<label>"+this.opts.curLang.title+"</label>"+'<input id="redactor_file_alt" class="redactor_input" />'+"<label>"+this.opts.curLang.link+"</label>"+'<input id="redactor_file_link" class="redactor_input" />'+"<label>"+this.opts.curLang.image_position+"</label>"+'<select id="redactor_form_image_align">'+'<option value="none">'+this.opts.curLang.none+"</option>"+'<option value="left">'+this.opts.curLang.left+"</option>"+'<option value="right">'+this.opts.curLang.right+"</option>"+"</select>"+"</section>"+"<footer>"+'<a href="#" id="redactor_image_delete_btn" class="redactor_modal_btn">'+this.opts.curLang._delete+"</a>&nbsp;&nbsp;&nbsp;"+'<a href="#" class="redactor_modal_btn redactor_btn_modal_close">'+this.opts.curLang.cancel+"</a>"+'<input type="button" name="save" class="redactor_modal_btn" id="redactorSaveBtn" value="'+this.opts.curLang.save+'" />'+"</footer>",modal_image:String()+"<section>"+'<div id="redactor_tabs">'+'<a href="#" class="redactor_tabs_act">'+this.opts.curLang.upload+"</a>"+'<a href="#">'+this.opts.curLang.choose+"</a>"+'<a href="#">'+this.opts.curLang.link+"</a>"+"</div>"+'<div id="redactor-progress" class="redactor-progress redactor-progress-striped" style="display: none;">'+'<div id="redactor-progress-bar" class="redactor-progress-bar" style="width: 100%;"></div>'+"</div>"+'<form id="redactorInsertImageForm" method="post" action="" enctype="multipart/form-data">'+'<div id="redactor_tab1" class="redactor_tab">'+'<input type="file" id="redactor_file" name="file" />'+"</div>"+'<div id="redactor_tab2" class="redactor_tab" style="display: none;">'+'<div id="redactor_image_box"></div>'+"</div>"+"</form>"+'<div id="redactor_tab3" class="redactor_tab" style="display: none;">'+"<label>"+this.opts.curLang.image_web_link+"</label>"+'<input type="text" name="redactor_file_link" id="redactor_file_link" class="redactor_input"  />'+"</div>"+"</section>"+"<footer>"+'<a href="#" class="redactor_modal_btn redactor_btn_modal_close">'+this.opts.curLang.cancel+"</a>"+'<input type="button" name="upload" class="redactor_modal_btn" id="redactor_upload_btn" value="'+this.opts.curLang.insert+'" />'+"</footer>",modal_link:String()+"<section>"+'<form id="redactorInsertLinkForm" method="post" action="">'+'<div id="redactor_tabs">'+'<a href="#" class="redactor_tabs_act">URL</a>'+'<a href="#">Email</a>'+'<a href="#">'+this.opts.curLang.anchor+"</a>"+"</div>"+'<input type="hidden" id="redactor_tab_selected" value="1" />'+'<div class="redactor_tab" id="redactor_tab1">'+"<label>URL</label>"+'<input type="text" id="redactor_link_url" class="redactor_input"  />'+"<label>"+this.opts.curLang.text+"</label>"+'<input type="text" class="redactor_input redactor_link_text" id="redactor_link_url_text" />'+'<label><input type="checkbox" id="redactor_link_blank"> '+this.opts.curLang.link_new_tab+"</label>"+"</div>"+'<div class="redactor_tab" id="redactor_tab2" style="display: none;">'+"<label>Email</label>"+'<input type="text" id="redactor_link_mailto" class="redactor_input" />'+"<label>"+this.opts.curLang.text+"</label>"+'<input type="text" class="redactor_input redactor_link_text" id="redactor_link_mailto_text" />'+"</div>"+'<div class="redactor_tab" id="redactor_tab3" style="display: none;">'+"<label>"+this.opts.curLang.anchor+"</label>"+'<input type="text" class="redactor_input" id="redactor_link_anchor"  />'+"<label>"+this.opts.curLang.text+"</label>"+'<input type="text" class="redactor_input redactor_link_text" id="redactor_link_anchor_text" />'+"</div>"+"</form>"+"</section>"+"<footer>"+'<a href="#" class="redactor_modal_btn redactor_btn_modal_close">'+this.opts.curLang.cancel+"</a>"+'<input type="button" class="redactor_modal_btn" id="redactor_insert_link_btn" value="'+this.opts.curLang.insert+'" />'+"</footer>",modal_table:String()+"<section>"+"<label>"+this.opts.curLang.rows+"</label>"+'<input type="text" size="5" value="2" id="redactor_table_rows" />'+"<label>"+this.opts.curLang.columns+"</label>"+'<input type="text" size="5" value="3" id="redactor_table_columns" />'+"</section>"+"<footer>"+'<a href="#" class="redactor_modal_btn redactor_btn_modal_close">'+this.opts.curLang.cancel+"</a>"+'<input type="button" name="upload" class="redactor_modal_btn" id="redactor_insert_table_btn" value="'+this.opts.curLang.insert+'" />'+"</footer>",modal_video:String()+"<section>"+'<form id="redactorInsertVideoForm">'+"<label>"+this.opts.curLang.video_html_code+"</label>"+'<textarea id="redactor_insert_video_area" style="width: 99%; height: 160px;"></textarea>'+"</form>"+"</section>"+"<footer>"+'<a href="javascript:void(null);" class="redactor_modal_btn redactor_btn_modal_close">'+this.opts.curLang.cancel+"</a>"+'<input type="button" class="redactor_modal_btn" id="redactor_insert_video_btn" value="'+this.opts.curLang.insert+'" />'+"</footer>"})},modalInit:function(e,i,n,r){var o=t("#redactor_modal_overlay");o.length||(this.$overlay=o=t('<div id="redactor_modal_overlay" style="display: none;"></div>'),t("body").prepend(this.$overlay)),this.opts.modalOverlay&&o.show().on("click",t.proxy(this.modalClose,this));var s=t("#redactor_modal");s.length||(this.$modal=s=t('<div id="redactor_modal" style="display: none;"><div id="redactor_modal_close">&times;</div><header id="redactor_modal_header"></header><div id="redactor_modal_inner"></div></div>'),t("body").append(this.$modal)),t("#redactor_modal_close").on("click",t.proxy(this.modalClose,this)),this.hdlModalClose=t.proxy(function(t){return t.keyCode===this.keyCode.ESC?(this.modalClose(),!1):void 0},this),t(document).keyup(this.hdlModalClose),this.$editor.keyup(this.hdlModalClose),this.modalcontent=!1,0==i.indexOf("#")?(this.modalcontent=t(i),t("#redactor_modal_inner").empty().append(this.modalcontent.html()),this.modalcontent.html("")):t("#redactor_modal_inner").empty().append(i),s.find("#redactor_modal_header").html(e),"undefined"!=typeof t.fn.draggable&&(s.draggable({handle:"#redactor_modal_header"}),s.find("#redactor_modal_header").css("cursor","move"));var a=t("#redactor_tabs");if(a.length){var l=this;a.find("a").each(function(e,i){e++,t(i).on("click",function(i){if(i.preventDefault(),a.find("a").removeClass("redactor_tabs_act"),t(this).addClass("redactor_tabs_act"),t(".redactor_tab").hide(),t("#redactor_tab"+e).show(),t("#redactor_tab_selected").val(e),l.isMobile()===!1){var n=s.outerHeight();s.css("margin-top","-"+(n+10)/2+"px")}})})}s.find(".redactor_btn_modal_close").on("click",t.proxy(this.modalClose,this)),this.isMobile()===!1?(s.css({position:"fixed",top:"-2000px",left:"50%",width:n+"px",marginLeft:"-"+n/2+"px"}).show(),this.modalSaveBodyOveflow=t(document.body).css("overflow"),t(document.body).css("overflow","hidden")):s.css({position:"fixed",width:"100%",height:"100%",top:"0",left:"0",margin:"0",minHeight:"300px"}).show(),"function"==typeof r&&r(),this.isMobile()===!1&&setTimeout(function(){var t=s.outerHeight();s.css({top:"50%",height:"auto",minHeight:"auto",marginTop:"-"+(t+10)/2+"px"})},20)},modalClose:function(){return t("#redactor_modal_close").off("click",this.modalClose),t("#redactor_modal").fadeOut("fast",t.proxy(function(){var e=t("#redactor_modal_inner");this.modalcontent!==!1&&(this.modalcontent.html(e.html()),this.modalcontent=!1),e.html(""),this.opts.modalOverlay&&t("#redactor_modal_overlay").hide().off("click",this.modalClose),t(document).unbind("keyup",this.hdlModalClose),this.$editor.unbind("keyup",this.hdlModalClose)},this)),this.isMobile()===!1&&t(document.body).css("overflow",this.modalSaveBodyOveflow?this.modalSaveBodyOveflow:"visible"),!1},modalSetTab:function(e){t(".redactor_tab").hide(),t("#redactor_tabs").find("a").removeClass("redactor_tabs_act").eq(e-1).addClass("redactor_tabs_act"),t("#redactor_tab"+e).show()},s3handleFileSelect:function(t){for(var e,i=t.target.files,n=0;e=i[n];n++)this.s3uploadFile(e)},s3uploadFile:function(e){this.s3executeOnSignedUrl(e,t.proxy(function(t){this.s3uploadToS3(e,t)},this))},s3executeOnSignedUrl:function(e,i){var n=new XMLHttpRequest;n.open("GET",this.opts.s3+"?name="+e.name+"&type="+e.type,!0),n.overrideMimeType("text/plain; charset=x-user-defined"),n.onreadystatechange=function(){4==this.readyState&&200==this.status?(t("#redactor-progress").fadeIn(),i(decodeURIComponent(this.responseText))):4==this.readyState&&200!=this.status},n.send()},s3createCORSRequest:function(t,e){var i=new XMLHttpRequest;return"withCredentials"in i?i.open(t,e,!0):"undefined"!=typeof XDomainRequest?(i=new XDomainRequest,i.open(t,e)):i=null,i},s3uploadToS3:function(e,i){var n=this.s3createCORSRequest("PUT",i);n&&(n.onload=t.proxy(function(){if(200==n.status){t("#redactor-progress").hide();var e=i.split("?");if(!e[0])return!1;this.selectionRestore();var r="";r='<img id="image-marker" src="'+e[0]+'" />',this.opts.paragraphy&&(r="<p>"+r+"</p>"),this.execCommand("inserthtml",r,!1);var o=t(this.$editor.find("img#image-marker"));o.length?o.removeAttr("id"):o=!1,this.sync(),this.callback("imageUpload",o,!1),this.modalClose(),this.observeImages()}},this),n.onerror=function(){},n.upload.onprogress=function(){},n.setRequestHeader("Content-Type",e.type),n.setRequestHeader("x-amz-acl","public-read"),n.send(e))},uploadInit:function(e,i){this.uploadOptions={url:!1,success:!1,error:!1,start:!1,trigger:!1,auto:!1,input:!1},t.extend(this.uploadOptions,i);var n=t("#"+e);n.length&&"INPUT"===n[0].tagName?(this.uploadOptions.input=n,this.el=t(n[0].form)):this.el=n,this.element_action=this.el.attr("action"),this.uploadOptions.auto?t(this.uploadOptions.input).change(t.proxy(function(t){this.el.submit(function(){return!1}),this.uploadSubmit(t)},this)):this.uploadOptions.trigger&&t("#"+this.uploadOptions.trigger).click(t.proxy(this.uploadSubmit,this))},uploadSubmit:function(){t("#redactor-progress").fadeIn(),this.uploadForm(this.element,this.uploadFrame())},uploadFrame:function(){this.id="f"+Math.floor(99999*Math.random());var e=this.document.createElement("div"),i='<iframe style="display:none" id="'+this.id+'" name="'+this.id+'"></iframe>';return e.innerHTML=i,t(e).appendTo("body"),this.uploadOptions.start&&this.uploadOptions.start(),t("#"+this.id).load(t.proxy(this.uploadLoaded,this)),this.id},uploadForm:function(e,i){if(this.uploadOptions.input){var n="redactorUploadForm"+this.id,r="redactorUploadFile"+this.id;this.form=t('<form  action="'+this.uploadOptions.url+'" method="POST" target="'+i+'" name="'+n+'" id="'+n+'" enctype="multipart/form-data" />'),this.opts.uploadFields!==!1&&"object"==typeof this.opts.uploadFields&&t.each(this.opts.uploadFields,t.proxy(function(e,i){0===i.toString().indexOf("#")&&(i=t(i).val());var n=t("<input/>",{type:"hidden",name:e,value:i});t(this.form).append(n)},this));var o=this.uploadOptions.input,s=t(o).clone();t(o).attr("id",r).before(s).appendTo(this.form),t(this.form).css("position","absolute").css("top","-2000px").css("left","-2000px").appendTo("body"),this.form.submit()}else e.attr("target",i).attr("method","POST").attr("enctype","multipart/form-data").attr("action",this.uploadOptions.url),this.element.submit()},uploadLoaded:function(){var e,i=t("#"+this.id)[0];if(e=i.contentDocument?i.contentDocument:i.contentWindow?i.contentWindow.document:window.frames[this.id].document,this.uploadOptions.success)if(t("#redactor-progress").hide(),"undefined"!=typeof e){var n=e.body.innerHTML,r=n.match(/\{(.|\n)*\}/)[0];r=r.replace(/^\[/,""),r=r.replace(/\]$/,"");var o=t.parseJSON(r);"undefined"==typeof o.error?this.uploadOptions.success(o):(this.uploadOptions.error(this,o),this.modalClose())}else this.modalClose(),alert("Upload failed!");this.el.attr("action",this.element_action),this.el.attr("target","")},draguploadInit:function(e,i){return this.draguploadOptions=t.extend({url:!1,success:!1,error:!1,preview:!1,uploadFields:!1,text:this.opts.curLang.drop_file_here,atext:this.opts.curLang.or_choose},i),void 0===window.FormData?!1:(this.droparea=t('<div class="redactor_droparea"></div>'),this.dropareabox=t('<div class="redactor_dropareabox">'+this.draguploadOptions.text+"</div>"),this.dropalternative=t('<div class="redactor_dropalternative">'+this.draguploadOptions.atext+"</div>"),this.droparea.append(this.dropareabox),t(e).before(this.droparea),t(e).before(this.dropalternative),this.dropareabox.on("dragover",t.proxy(function(){return this.draguploadOndrag()},this)),this.dropareabox.on("dragleave",t.proxy(function(){return this.draguploadOndragleave()},this)),this.dropareabox.get(0).ondrop=t.proxy(function(t){t.preventDefault(),this.dropareabox.removeClass("hover").addClass("drop"),this.draguploadUpload(t.dataTransfer.files[0])},this),void 0)},draguploadUpload:function(e){var i=jQuery.ajaxSettings.xhr();i.upload&&i.upload.addEventListener("progress",t.proxy(this.uploadProgress,this),!1);var n=function(){return i},r=new FormData;this.draguploadOptions.uploadFields!==!1&&"object"==typeof this.draguploadOptions.uploadFields&&t.each(this.draguploadOptions.uploadFields,t.proxy(function(e,i){0===i.toString().indexOf("#")&&(i=t(i).val()),r.append(e,i)},this)),r.append("file",e),t.ajax({url:this.draguploadOptions.url,dataType:"html",data:r,xhr:n,cache:!1,contentType:!1,processData:!1,type:"POST",success:t.proxy(function(e){e=e.replace(/^\[/,""),e=e.replace(/\]$/,"");var i=t.parseJSON(e);"undefined"==typeof i.error?this.draguploadOptions.success(i):(this.draguploadOptions.error(this,i),this.draguploadOptions.success(!1))},this)})},draguploadOndrag:function(){return this.dropareabox.addClass("hover"),!1},draguploadOndragleave:function(){return this.dropareabox.removeClass("hover"),!1},uploadProgress:function(t,e){var i=t.loaded?parseInt(100*(t.loaded/t.total),10):t;this.dropareabox.text("Loading "+i+"% "+(e||""))},isMobile:function(){return/(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent)},outerHtml:function(e){return t("<div>").append(t(e).eq(0).clone()).html()},isString:function(t){return"[object String]"==Object.prototype.toString.call(t)},isEmpty:function(t){return t=t.replace(/&#x200b;|<br>|<br\/>|&nbsp;/gi,""),t=t.replace(/\s/g,""),t=t.replace(/^<p>[^\w\d]*?<\/p>$/i,""),""==t},browser:function(t){var e=navigator.userAgent.toLowerCase(),i=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return"version"==t?i[2]:"webkit"==t?"chrome"==i[1]||"webkit"==i[1]:i[1]==t},oldIE:function(){return this.browser("msie")&&parseInt(this.browser("version"),10)<9?!0:!1},getFragmentHtml:function(t){var e=t.cloneNode(!0),i=this.document.createElement("div");return i.appendChild(e),i.innerHTML},extractContent:function(){for(var t,e=this.$editor[0],i=this.document.createDocumentFragment();t=e.firstChild;)i.appendChild(t);return i},isParentRedactor:function(e){return e?this.opts.iframe?e:0==t(e).parents("div.redactor_editor").length||t(e).hasClass("redactor_editor")?!1:e:!1},currentOrParentIs:function(t){var e=this.getParent(),i=this.getCurrent();return e&&e.tagName===t?e:i&&i.tagName===t?i:!1},isEndOfElement:function(){var e=this.getBlock(),i=this.getCaretOffset(e),n=t.trim(t(e).text()).replace(/\n\r\n/g,""),r=n.length;return i==r?!0:!1},isFocused:function(){var e,i=this.getSelection();return i.rangeCount>0&&(e=i.getRangeAt(0).startContainer),e?this.opts.iframe?this.getCaretOffsetRange().equals()?!this.$editor.is(e):!0:0!=t(e).closest("div.redactor_editor").length:!1},removeEmptyAttr:function(e,i){""==t(e).attr(i)&&t(e).removeAttr(i)},removeFromArrayByValue:function(t,e){for(var i=null;-1!==(i=t.indexOf(e));)t.splice(i,1);return t}},e.prototype.init.prototype=e.prototype,t.Redactor.fn.formatLinkify=function(e){for(var i=/(^|&lt;|\s)(www\..+?\..+?)(\s|&gt;|$)/g,n=/(^|&lt;|\s)(((https?|ftp):\/\/|mailto:).+?)(\s|&gt;|$)/g,r=(this.$editor?this.$editor.get(0):this).childNodes,o=r.length;o--;){var s=r[o];if(3===s.nodeType){var a=s.nodeValue;a&&(a.match(i)||a.match(n))&&(a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(i,'$1<a href="'+e+'$2">$2</a>$3').replace(n,'$1<a href="$2">$2</a>$5'),t(s).after(a).remove())}else 1!==s.nodeType||/^(a|button|textarea)$/i.test(s.tagName)||t.Redactor.fn.formatLinkify.call(s,e)}}}(jQuery),function(t){t.Redactor.opts.langs.fr={html:"Code HTML",video:"Insrer une vido...",image:"Insrer une image...",table:"Tableau",link:"Lien",link_insert:"Insrer un lien...",link_edit:"Edit link",unlink:"Supprimer le lien",formatting:"Styles",paragraph:"Paragraphe",quote:"Citation",code:"Code",header1:"Titre 1",header2:"Titre 2",header3:"Titre 3",header4:"Titre 4",bold:"Gras",italic:"Italique",fontcolor:"Couleur du texte",backcolor:"Couleur d'arrire plan du texte",unorderedlist:"Liste  puces",orderedlist:"Liste numrote",outdent:"Diminuer le trait",indent:"Augmenter le trait",cancel:"Annuler",insert:"Insrer",save:"Sauvegarder",_delete:"Supprimer",insert_table:"Insrer un tableau...",insert_row_above:"Ajouter une range au-dessus",insert_row_below:"Ajouter une range en-dessous",insert_column_left:"Ajouter une colonne  gauche",insert_column_right:"Ajouter une colonne  droite",delete_column:"Supprimer la colonne",delete_row:"Supprimer la range",delete_table:"Supprimer le tableau",rows:"Ranges",columns:"Colonnes",add_head:"Ajouter un en-tte",delete_head:"Supprimer l'en-tte",title:"Titre",image_position:"Position",none:"Aucun",left:"Gauche",right:"Droite",image_web_link:"Adresse URL de l'image",text:"Texte",mailto:"Courriel",web:"Adresse URL",video_html_code:"Code d'intgration du vido",file:"Insrer un fichier...",upload:"Tlverser",download:"Tlcharger",choose:"Choisir",or_choose:"Ou choisissez",drop_file_here:"Dposez le fichier ici",align_left:"Aligner  gauche",align_center:"Aligner au centre",align_right:"Aligner  droite",align_justify:"Justifier",horizontalrule:"Insrer une ligne horizontale",deleted:"Supprim",anchor:"Ancre",link_new_tab:"Ouvrir le lien dans un nouvel onglet",underline:"Underline",alignment:"Alignment",filename:"Name (optional)"}}(jQuery),!RedactorPlugins)var RedactorPlugins={};RedactorPlugins.clips={init:function(){var t=$.proxy(function(){$("#redactor_modal").find(".redactor_clip_link").each($.proxy(function(t,e){$(e).click($.proxy(function(){return this.insertClip($(e).next().html()),!1},this))},this)),this.selectionSave(),this.bufferSet()},this);this.buttonAdd("clips","Clips",function(){this.modalInit("Clips","#clipsmodal",500,t)})},insertClip:function(t){this.selectionRestore(),this.insertHtml($.trim(t)),this.modalClose()}},/*
 * HTML5 Sortable jQuery Plugin
 * http://farhadi.ir/projects/html5sortable
 * 
 * Copyright 2012, Ali Farhadi
 * Released under the MIT license.
 */
function(t){var e,i=t();t.fn.sortable=function(n){var r=String(n);return n=t.extend({connectWith:!1},n),this.each(function(){if(/^enable|disable|destroy$/.test(r)){var o=t(this).children(t(this).data("items")).attr("draggable","enable"==r);return"destroy"==r&&o.add(this).removeData("connectWith items").off("dragstart.h5s dragend.h5s selectstart.h5s dragover.h5s dragenter.h5s drop.h5s"),void 0}var s,a,o=t(this).children(n.items),l=t("<"+(/^ul|ol$/i.test(this.tagName)?"li":"div")+' class="sortable-placeholder">');o.find(n.handle).mousedown(function(){s=!0}).mouseup(function(){s=!1}),t(this).data("items",n.items),i=i.add(l),n.connectWith&&t(n.connectWith).add(this).data("connectWith",n.connectWith),o.attr("draggable","true").on("dragstart.h5s",function(i){if(n.handle&&!s)return!1;s=!1;var r=i.originalEvent.dataTransfer;r.effectAllowed="move",r.setData("Text","dummy"),a=(e=t(this)).addClass("sortable-dragging").index()}).on("dragend.h5s",function(){e&&(e.removeClass("sortable-dragging").show(),i.detach(),a!=e.index()&&e.parent().trigger("sortupdate",{item:e}),e=null)}).not("a[href], img").on("selectstart.h5s",function(){return this.dragDrop&&this.dragDrop(),!1}).end().add([this,l]).on("dragover.h5s dragenter.h5s drop.h5s",function(r){return o.is(e)||n.connectWith===t(e).parent().data("connectWith")?"drop"==r.type?(r.stopPropagation(),i.filter(":visible").after(e),e.trigger("dragend.h5s"),!1):(r.preventDefault(),r.originalEvent.dataTransfer.dropEffect="move",o.is(this)?(n.forcePlaceholderSize&&l.height(e.outerHeight()),e.hide(),t(this)[l.index()<t(this).index()?"after":"before"](l),i.not(l).detach()):i.is(this)||t(this).children(n.items).length||(i.detach(),t(this).append(l)),!1):!0})})}}(jQuery),function(t){t.fn.dndPageScroll=function(e){e||(e={});var i={topId:"top_scroll_page",bottomId:"bottom_scroll_page",delay:50},e=t.extend(i,e),n=t("#"+e.topId);n.length||(n=t('<div id="top_scroll_page">&nbsp;</div>').appendTo("body"));var r=t("#"+e.bottomId);r.length||(r=t('<div id="bottom_scroll_page">&nbsp;</div>').appendTo("body"));var o=t("#top_scroll_page, #bottom_scroll_page");o.hide(),o.css({position:"fixed",left:0,right:0,height:20,zIndex:999999}),n.css({top:0}),r.css({bottom:0});var s,a;o.bind("dragenter",function(){return t(this).attr("id")==e.topId?"up":"down",!0}),o.bind("dragover",function(){if(t("html,body").is(":animated"))return!0;var i=t(window).scrollTop(),n=t(this).attr("id")==e.topId?-1:1,r=-1==n?s:a,o=-1==n?i:t(document).height()-(i+t(window).height());if(void 0!=r&&r==o&&o>0){var l=i+50*n;t("html,body").animate({scrollTop:l},e.delay,"linear")}return-1==n?s=o:a=o,!0});var l=function(){return o.hide(),timestamp=void 0,scrolltop=0,scrollbottom=0,!0};t(document).bind("dragstart",function(){return o.show(),!0}),t(document).bind("dragend",l),o.bind("mouseover",l)}}(jQuery),parseURL=function(t){var e={href:t},i=t.replace("//","/").split("/");return e.protocol=i[0],e.host=i[1],i[1]=i[1].split(":"),e.hostname=i[1][0],e.port=i[1].length>1?i[1][1]:"",i.splice(0,2),e.pathname="/"+i.join("/"),e.pathname=e.pathname.split("#"),e.hash=e.pathname.length>1?"#"+e.pathname[1]:"",e.pathname=e.pathname[0],e.pathname=e.pathname.split("?"),e.search=e.pathname.length>1?"?"+e.pathname[1]:"",e.pathname=e.pathname[0],e},iframed=function(){return parent&&parent.document.location.href!=document.location.href&&$.isFunction(parent.$)},attachLoading=function(t,e,i,n){"undefined"==typeof t&&(t="body"),container=$(t),"undefined"==typeof n&&(n=function(){}),"undefined"==typeof i&&(i=500),"undefined"==typeof e&&(e="Please wait..."),loader=$(t+" .gko-loader"),loader.length>0?loader.fadeIn(n):(container.append("<div class='gko-loader'><div class='progress progress-striped active'><div class='bar' style='width: 100%;'></div></div></div>"),loader=$(t+" .loader"),loader.css({"z-index":1e4,top:100}),loader.hide().fadeIn(i,n)),$("html").addClass("loading")},removeLoading=function(t,e,i){"undefined"==typeof t&&(t="body"),void 0==typeof e&&(e=500),"undefined"==typeof i&&(i=function(){$(this).remove()}),$(t+" .gko-loader").fadeOut(e,i),$("html").removeClass("loading")},parseValue=function(t){if("number"==typeof t)return t;if("string"==typeof t){var e=t.match(/\-?\d/g);return e&&e.constructor===Array?parseInt(e.join(""),10):0}return 0},timestamp=function(){return(new Date).getTime()},get_number_from_string=function(t){return t.replace(/[^\d]+/g,"")},getScreenSize=function(){var t=window.innerHeight>window.innerWidth?"landscape":"portrait",e="portrait"===t,i=e?480:320,n=e?320:480,r=e?screen.availHeight:screen.availWidth,o=e?screen.availWidth:screen.availHeight,s=Math.max(i,$(window).height()),a=Math.max(n,$(window).width()),l={width:Math.min(o,a),height:Math.min(r,s)};return l},init_navigation=function(){var t=$(".sidebar-nav");$("body").click(function(){$(this).hasClass("sidebar-open")&&$(this).removeClass("sidebar-open")}),t.click(function(t){t.stopPropagation()}),$("#sidebar-toggler").click(function(t){t.stopPropagation(),$("body").toggleClass("sidebar-open")}),$(window).resize(function(){$(this).width()>769&&$("body.sidebar-open").removeClass("sidebar-open")})},init_images=function(){$(".change-upload-file-btn").bind("click",function(t){t.preventDefault();var e=$(this).find(".ui-btn-text:first");e.length||(e=$(this));var i=e.html(),n=$(this).attr("data-text");e.html(n),$(this).attr("data-text",i),$(this).parent().parent().find(".js-file-preview:first").toggle("fast").parent().find(".file-field:first").slideToggle("fast")}),$(".delete-file-btn").bind("click",function(t){t.preventDefault(),$(this).parent().parent().find(".js-file-preview:first").toggle("fast").parent().find(".file-field:first").slideToggle("fast").find("input.file").val("")}),$("ol#image_folders_nested_set li a").on("click",function(){$("ol#image_folders_nested_set li").removeClass("ui-selected"),$(this).parent().addClass("ui-selected")})},init_text_editor=function(){$(".redactor").each(function(){var t=$(this),e=t.attr("data-redactor-image-upload"),i=t.attr("data-image-browser-url"),n=t.attr("data-link-browser-url"),r=t.attr("data-file-browser-url"),o=(t.attr("data-redactor-get-images"),$("meta[name=csrf-token]").attr("content")),s=$("meta[name=csrf-param]").attr("content"),a="modal=true";void 0!==s&&void 0!==o&&(a=a+"&"+s+"="+encodeURIComponent(o)),e+="?"+a,t.redactor({lang:"fr",linkEmail:!0,linkAnchor:!0,wym:!0,minHeight:200,formattingTags:["p","blockquote","h2","h3","h4"],shortcuts:!1,convertDivs:!1,plugins:["clips"],path:"/assets",imageGetJson:!1,uploadFields:{cl:"#cl",attachable_id:"#attachable_id",attachable_type:"#attachable_type",folder_ids:"#folder_ids"},buttons:["html","|","formatting","|","bold","italic","deleted","|","unorderedlist","orderedlist","outdent","indent","|","gkoimage","video","gkofile","table","gkolink","|","|","alignment","|","horizontalrule"],fileBrowserUrl:r,linkBrowserUrl:n,imageBrowserUrl:i,imageUpload:e,buttonsCustom:{gkoimage:{title:"Image",callback:function(){this.getCurrent()||this.focusEnd(),$.ajax({url:this.opts.imageBrowserUrl,dataType:"script",success:function(){console.log("hello image")}})}},gkolink:{title:"Link",dropdown:{link:{title:"lang.link_insert",func:"linkShow"},unlink:{title:"lang.unlink",exec:"unlink"}},callback:function(){this.getCurrent()||alert("Please select a text before "+this.opts.linkBrowserUrl),$.ajax({url:this.opts.linkBrowserUrl,dataType:"script",success:function(){console.log("hello link")}})}},gkofile:{title:"File",callback:function(){this.getCurrent()||this.focusEnd(),$.ajax({url:this.opts.fileBrowserUrl,dataType:"script",success:function(){console.log("hello file")}})}}},imageShowCallBack:function(){console.log("imageShowCallBack")},imageUploadCallback:function(){console.log("imageUploadCallback")},imageUploadErrorCallback:function(t){console.log(t.error)},fileUpload:"/file_upload.php",fileUploadCallback:function(){console.log("fileUploadCallback")},fileUploadErrorCallback:function(t){console.log(t.error)}})})};var images_dialog={init:function(){$("#image-dialog-size-container ul li a").on("click",function(t){$("#image-dialog-size-container ul li").removeClass("active"),$(this).parent().addClass("active"),t.preventDefault()}),$("#insert-images-modal").on("click",".selectable-thumbnail",function(t){t.preventDefault();var e=$(this),i=$("#image_assignments_form");if(i.length>0){var n=e.closest(".thumbnail-wrapper").attr("id"),r=parseValue(n);$("#image_assignment_image_id").val(r),i.submit()}else{var o=$(".redactor").redactor("getCurrent");o||$(".redactor").redactor("focusEnd"),$(".redactor").redactor("imageThumbClick",t),$("#insert-images-modal").modal("toggle")}}),this.initialised=!0,images_dialog.update()},update:function(){$("#insert-images-modal .pagination a").attr("data-remote","true")}},documents_dialog={init:function(){this.initialised||$("#documents-list > li").on("click","a.preview",function(t){t.preventDefault();var e=$(this),i=$("#document-assignments-form");if(i.length>0){var n=parseValue(e.closest("li").attr("id"));$("#document_assignment_document_id").val(n),i.live("ajax:beforeSend.rails",function(){attachLoading("body#dialog_container")}).live("ajax:complete.rails",function(){removeLoading("body#dialog_container")}).submit()}return!1})}},link_dialog={initialised:!1,init:function(){this.initialised||(this.init_close(),this.page_tab(),this.web_tab(),this.email_tab(),this.document_tab(),this.initialised=!0)},init_close:function(){parent&&parent.document.location.href!=document.location.href&&null!=parent.document.getElementById("wym_dialog_submit")&&$("#dialog_container input#insert_link_submit").click(function(t){t.preventDefault(),$(parent.document.getElementById("wym_dialog_submit")).click()})},page_tab:function(){$("#link_to_page").on("click",".selectable",function(t){var e=$(this),i=e.parent();i.parent(),t.preventDefault(),$("#link_to_page ul.selection").find(".ui-selected").removeClass("ui-selected"),i.addClass("ui-selected"),link_dialog.update_parent(e.attr("href"),e.html()),$(parent.document.getElementById("wym_dialog_submit")).click()})},document_tab:function(){$("#link_to_document li a").click(function(t){t.preventDefault(),link_dialog.update_parent($(this).attr("href")),$(parent.document.getElementById("wym_dialog_submit")).click()})},web_tab:function(){$("#web_address_text").change(function(){link_dialog.update_parent($("#web_address_text").val(),null,"_blank")})},email_tab:function(){$("#email_address_text, #email_default_subject_text, #email_default_body_text").change(function(){var t=$("#email_default_subject_text").val(),e=$("#email_default_body_text").val(),i="mailto:"+$("#email_address_text").val(),n="?";t.length>0&&(i+=n+"subject="+t,n="&"),e.length>0&&(i+=n+"body="+e,n="&"),link_dialog.update_parent(i,i.replace("mailto:",""))})},update_parent:function(t,e,i){null!=parent&&(null!=(wym_href=parent.document.getElementById("wym_href"))&&(wym_href.value=t),null!=(wym_title=parent.document.getElementById("wym_title"))&&(wym_title.value=e),null!=(wym_target=parent.document.getElementById("wym_target"))&&(wym_target.value=i||""))}},pages_modal={initialised:!1,init:function(){this.initialised||($("#page_selection_modal").on("click","a.selectable",function(t){var e=$(this).parent();e.parent().find("> .ui-selected").removeClass("ui-selected"),e.addClass("ui-selected"),t.preventDefault()}),$("#page_selection_modal").on("click","a#validate_page_selection_btn",function(){var t=$("li.ui-selected:first"),e=t.data("type"),i=parseValue(t.attr("id")),n=t.find("a.selectable:first").html();$("#owner_name").html(n),$("#owner_id").val(i),$("#owner_type").val(e),$("#page_selection_modal").modal("hide")}),this.initialised=!0)}};selectable_list=function(){$.fn.selectAllRows=function(t){var e,i,n;return e=$.extend({column:"first",selectTip:"Click to Select All",unselectTip:"Click to Un-Select All"},t||{}),isNaN(e.column)?(i=$("thead tr th:"+e.column+"-child input:checkbox",this),n=$("tbody tr td:"+e.column+"-child input:checkbox",this)):(i=$("thead tr th:nth-child("+e.column+") input:checkbox",this),n=$("tbody tr td:nth-child("+e.column+") input:checkbox",this)),i.attr("title",e.selectTip),i.click(function(){var t=this.checked;n.each(function(){this.checked=t}),1==t?$(this).attr("title",e.unselectTip):$(this).attr("title",e.selectTip)}),$(this)}},make_sortable=function(t){var e=t.data("sortable-url"),i=t.data("sortable-handle");if(t.get(0))var n="UL"==t.get(0).tagName?"li":"tr";t.sortable().on("sortupdate",function(t,r){var o=$(r.item);$.ajax({type:"GET",url:e,items:n,handle:i,data:{position:o.prevAll().length+1,id:parseValue(o.attr("id"))},beforeSend:function(){attachLoading()},success:function(){},complete:function(){removeLoading()}})})},dnd_join_list=function(t,e,i){$.event.props.push("dataTransfer"),Modernizr.draganddrop&&($().dndPageScroll(),e.find("li").each(function(){$(this).attr("draggable","true")}),e.on({dragenter:function(t){t.stopPropagation(),t.preventDefault(),$(this).toggleClass("dragover")},dragover:function(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"},dragleave:function(t){t.stopPropagation(),t.preventDefault(),$(this).toggleClass("dragover")},drop:function(t){t.stopPropagation(),t.preventDefault();var e=$(this),n=t.dataTransfer.getData("Text"),r=get_number_from_string(n),o=get_number_from_string(e.attr("id"));e.removeClass("dragover"),jQuery.ajax({type:"POST",url:i,data:{image_id:r,id:o},dataType:"script",beforeSend:function(){attachLoading("body")},error:function(t,e,i){alert(i)},complete:function(){removeLoading("body")}})}},"li"),t.on({dragstart:function(t){var e=$(this);e.css("opacity","0.5"),t.dataTransfer.effectAllowed="copy",t.dataTransfer.setData("text/plain",e.attr("id"))},dragend:function(t){t.stopPropagation(),t.preventDefault(),$(this).css("opacity","1")}},"li"))};